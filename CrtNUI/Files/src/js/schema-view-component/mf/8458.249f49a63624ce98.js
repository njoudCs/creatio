(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[8458],{88458:(q,ee,g)=>{g.r(ee),g.d(ee,{AttributeConfigProvider:()=>E,AttributeControlDataValueTypeDesignConfig:()=>P,AttributeControlExtraConfigProvider:()=>W,BaseDataSourceDesignItemsIconsProvider:()=>J,BaseDesignerCommand:()=>Ce,ColumnControlDataValueTypeDesignConfig:()=>ce,ConnectedDropListService:()=>L,ControlTypes:()=>d,DesignItemsIconsProvider:()=>k,DesignType:()=>Y,DesignerCommandFactoryService:()=>D,DesignerLoaderService:()=>M,DesignerSchemaService:()=>F,DesignerSyncService:()=>R,EntityDataSourceAttributeConfigProvider:()=>B,EntityDataSourceDesignItemsIconsProvider:()=>U,InterfaceDesignerUtilsModule:()=>x,LoadingPart:()=>G,MetaItemDesignSettingChangesApplierService:()=>b,MetaItemDesignSettingsService:()=>w,PAGE_PARAMETERS_ATTRIBUTE_PROPERTIES_DATA_PROVIDER_TOKEN:()=>ue,PageParametersDataSourceAttributeConfigProvider:()=>O,PageParametersDataSourceDesignItemsIconsProvider:()=>$,ParameterControlDataValueTypeDesignConfig:()=>pe,RelatedPages:()=>le,RelatedPagesFactory:()=>H,USE_DESIGNER_LOADER_MASK:()=>ne,ViewItemCommandExecutor:()=>j,executeCommand:()=>fe,executeCommand$:()=>ae,getMacrosKey:()=>Z});var te=g(31134),s=g(94450);class x{}x.\u0275fac=function(e){return new(e||x)},x.\u0275mod=s.\u0275\u0275defineNgModule({type:x}),x.\u0275inj=s.\u0275\u0275defineInjector({imports:[te.CommonModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(x,{imports:[te.CommonModule]})}();var c=g(75378),re=g(77207),me=g(41307),A=g(49475),u=g(52045),ge=g(83612),y=g(21322),_=g(27049),de=g(99293),G;(function(o){o[o.DataSourceLoaded=0]="DataSourceLoaded",o[o.ViewModelGenerated=1]="ViewModelGenerated"})(G||(G={}));const ne=new s.InjectionToken("CRT_USE_DESIGNER_LOADER_MASK");class M{constructor(e,t){this._maskService=e,this._showMask=t,this._loadingPartComplete$=new y.Subject,this._initParts(),this._subscribeLoadingPartComplete()}_subscribeLoadingPartComplete(){this._loadingPartComplete$.subscribe(({loadingPart:e,state:t})=>{this._loadingsParts.set(e,t);const r=[...this._loadingsParts.values()].every(Boolean);this._showMask&&(r?this._maskService.hideBodyMask():this._maskService.isVisible||this._maskService.showBodyMask({delay:0}))})}_initParts(){this._loadingsParts=new Map([[G.DataSourceLoaded,!1],[G.ViewModelGenerated,!1]])}completeLoadingPart(e){this._loadingPartComplete$.next({loadingPart:e,state:!0})}resetLoadingPart(e){this._loadingPartComplete$.next({loadingPart:e,state:!1})}}M.\u0275fac=function(e){return new(e||M)(s.\u0275\u0275inject(de.MaskService),s.\u0275\u0275inject(ne,8))},M.\u0275prov=s.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac,providedIn:"root"});class L{constructor(){this._connectedDropList=[],this.connectedDropList$=new y.BehaviorSubject([])}_removeDropList(e){this._connectedDropList=this._connectedDropList.filter(t=>t!==e)}add(e){this._connectedDropList.includes(e)&&this._removeDropList(e),this._connectedDropList.unshift(e),this.connectedDropList$.next([...this._connectedDropList])}remove(e){this._removeDropList(e),this.connectedDropList$.next([...this._connectedDropList])}}L.\u0275fac=function(e){return new(e||L)},L.\u0275prov=s.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac,providedIn:"root"});var f=g(97600);class b{constructor(e){this._jsonApplierService=e}static _applyOperationByViewConfig(e,t,r){const n=t.settings.itemConfig,i=e.item.name===n?.name;if(i){const a=e.parent[e.propertyName];a instanceof Array&&r(a,e,t)}return i}static _insertValidate(e){if(!e.parentName)throw new Error('Invalid options, "parentName" is required.')}static _moveToIndexValidate(e){if(!e.parentName)throw new Error('Invalid options, "parentName" is required.');if(typeof e.index!="number")throw new Error('Invalid options, "index" is required.')}static _validate(e){switch(e.operation){case u.MetaItemDesignSettingChangesOperation.Insert:b._insertValidate(e);break;case u.MetaItemDesignSettingChangesOperation.MoveToIndex:b._moveToIndexValidate(e);break;default:break}}static _mergeConfigs(e,t){return(0,f.mergeWith)(e,t,(r,n)=>{(0,f.isArray)(r)&&(r.length=0,r.concat(n))})}_updateViewConfig(e,t){(0,u.iterateChildItems)(e,r=>!b._applyOperationByViewConfig(r,t,this._updateConfigInProperty),this)}_removeViewConfig(e,t){(0,u.iterateChildItems)(e,r=>!b._applyOperationByViewConfig(r,t,this._removeConfigInProperty),this)}_moveViewConfig(e,t){(0,u.iterateChildItems)(e,r=>!b._applyOperationByViewConfig(r,t,this._moveConfigInProperty),this)}_updateConfigInProperty(e,t,r){const n=e.findIndex(i=>i.name===t.item.name);e[n]=b._mergeConfigs(e[n],(0,f.cloneDeep)(r.settings.itemConfig)),r.settings.applyPropertiesStrategies?.forEach(i=>{if(i.value===u.ApplyChangedPropertyStrategy.Override){const a=i.propertyPath.replace("itemConfig.","");(0,f.set)(e[n],a,(0,f.cloneDeep)((0,f.get)(r.settings,i.propertyPath)))}})}_removeConfigInProperty(e,t){const r=e.findIndex(n=>n.name===t.item.name);e.splice(r,1)}_moveConfigInProperty(e,t,r){const n=e.findIndex(i=>i.name===t.item.name);e.splice(r.index,0,e.splice(n,1)[0])}_insertViewConfig(e,t){const r=t.parentPropertyName||"items";(0,u.iterateChildItems)(e,n=>{const i=n.item.name===t.parentName;return i&&((0,f.isUndefined)(t.index)?n.item[r].push(t.settings.itemConfig):n.item[r].splice(t.index,0,t.settings.itemConfig)),!i},this)}apply(e,t){const r=e.itemConfig;switch(b._validate(t),t.operation){case u.MetaItemDesignSettingChangesOperation.Insert:this._insertViewConfig(r,t);break;case u.MetaItemDesignSettingChangesOperation.Remove:this._removeViewConfig(r,t);break;case u.MetaItemDesignSettingChangesOperation.Update:case u.MetaItemDesignSettingChangesOperation.Move:this._updateViewConfig(r,t);break;case u.MetaItemDesignSettingChangesOperation.MoveToIndex:this._moveViewConfig(r,t);break;case u.MetaItemDesignSettingChangesOperation.MoveToContainer:this._removeViewConfig(r,t),this._insertViewConfig(r,t);break}return{itemConfig:r}}}b.\u0275fac=function(e){return new(e||b)(s.\u0275\u0275inject(u.JsonApplierService))},b.\u0275prov=s.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac});var ie=g(33177),oe=g(8239),X=g(2546);class R{constructor(){this._observablesUIds=new Set,this._observablesSubject=new y.Subject}register(e){const t=(0,c.generateGuid)();return this._observablesUIds.add(t),e.pipe((0,_.tap)(()=>this._observablesUIds.delete(t)),(0,_.tap)(()=>this._observablesSubject.next()),(0,_.catchError)(r=>(this._observablesUIds.delete(t),this._observablesSubject.next(),(0,y.throwError)(()=>r))))}complete$(){const e=new Set(this._observablesUIds);return new y.Observable(t=>{if(this._observablesUIds.size===0)t.next(),t.complete();else{const r=this._observablesSubject.subscribe(()=>{e.forEach(n=>{this._observablesUIds.has(n)||e.delete(n)}),e.size===0&&(r.unsubscribe(),t.next(),t.complete())})}})}}R.\u0275fac=function(e){return new(e||R)},R.\u0275prov=s.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac});function fe(o,e,t){return z.apply(this,arguments)}function z(){return z=(0,oe.Z)(function*(o,e,t,r=new y.Subject){return yield(0,y.firstValueFrom)(ae(o,e,t,r))}),z.apply(this,arguments)}function ae(o,e,t,r=new y.Subject,n=!0){return o.exists(e)?o.create(e,t).pipe((0,_.takeUntil)(r),(0,_.mergeMap)(i=>i.execute()),(0,_.map)(i=>i)):(n||console.error(`Command ${e} not found`),(0,y.of)({success:!1}))}class D{constructor(e){this._injector=e}static register(e,t){this._items.set(e,t)}static _getCommandType(e){return(0,y.of)(D._items.get(e))}static exists(e){return D._items.has(e)}exists(e){return D._items.has(e)||X.InterfaceDesignerCommandRegistry.items.has(e)}create(e,t){if(X.InterfaceDesignerCommandRegistry.items.has(e)){const r=this._injector.get(R),i=this._injector.get(u.SchemaApiService).schemaApi;return i.sync(),(0,y.of)(Reflect.construct(class{execute(){return(0,oe.Z)(function*(){const{instantiate:a}=X.InterfaceDesignerCommandRegistry.items.get(e);try{const l=a();return yield(0,y.lastValueFrom)(r.register((0,y.from)(l.execute(i,t)))),{success:!0}}catch(l){return console.error(e,l),{success:!1,errorMessage:l.message}}})()}},[]))}return D._getCommandType(e).pipe((0,_.tap)(r=>{if(!r)throw new TypeError(`Type ${e} is not defined`)}),(0,_.map)(r=>new r(this._injector,t)),(0,_.mergeMap)(r=>r.init()),(0,_.map)(r=>({execute:()=>(0,y.firstValueFrom)(r.execute())})))}}D._items=new Map,D.\u0275fac=function(e){return new(e||D)(s.\u0275\u0275inject(s.Injector))},D.\u0275prov=s.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac,providedIn:"root"});const se=new Map([["create","crt.AddViewItemCommand"],["update","crt.ChangeViewItemCommand"],["copy","crt.CopyViewItemCommand"],["delete","crt.RemoveViewItemCommand"]]);class j{constructor(e){this._commandFactoryService=e}_getViewItemCommand(e,t){return c.InterfaceDesignerItemRegistry.interfaceDesignerItemRegistrationInfos.get(e.type)?.designViewItemCommands?.[t]??se.get(t)}add(e){return this._commandFactoryService.create(se.get("create"),e)}change(e,t,r){const n=this._getViewItemCommand(e,"update");return this._commandFactoryService.create(n,{name:e.name,changes:t,selectOnCanvas:r})}copy({viewElement:e,index:t,propertyName:r,parentName:n,copyMetadata:i}){const a=this._getViewItemCommand(e,"copy");return this._commandFactoryService.create(a,{name:e.name,layoutConfig:e.layoutConfig,index:t,propertyName:r,parentName:n,copyMetadata:i})}remove(e){const t=this._getViewItemCommand(e,"delete");return this._commandFactoryService.create(t,{itemName:e.name})}}j.\u0275fac=function(e){return new(e||j)(s.\u0275\u0275inject(D))},j.\u0275prov=s.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac,providedIn:"root"});function Z(o){return o.split(/[.-]/).join("")}class w{constructor(e,t,r){this._translateService=e,this._generateNameMacroProcessor=t,this._viewCommandExecutor=r,this._separator="_",this._defaultItemPropertyValues=(0,s.inject)(A.DEFAULT_ITEM_PROPERTY_VALUES,{optional:!0})}static _generateName(e){const t=e.split(".").slice(1).join(".");return ie.NameGenerator.generateUnique(t)}_nestedSet(e,t,r){const n=t.split(this._separator),i=n.pop(),a=n.reduce((l,p)=>l[p]=l[p]||{},e);typeof a=="object"&&(a[i]=r)}_getPropertyPath(e){if(e.indexOf(this._separator)===-1)return e;const t=e.split(this._separator);return t.shift(),t.join(this._separator)}_isResourceMacros(e,t){return new RegExp("#ResourceString(.*"+t+".*)#$","g").test(e)}_setResourcesMacros(e,t,r){for(const[n,i]of Object.entries(e)){if((0,f.isEmpty)(i))continue;typeof i=="string"&&this._isResourceMacros(i,t)&&(e[n]=i.replace(t,r)),typeof i=="object"&&this._setResourcesMacros(i,t,r)}}_copyResources(e,t,r,n){const i=Z(e.name),a=Z(t.name);this._setResourcesMacros(t,i,a);const l={strings:{}};let p=[];return typeof n?.applyPostfix=="object"&&(p=Object.keys(n.applyPostfix)),Object.entries(r.strings).filter(([m])=>m.startsWith(i)).forEach(([m,N])=>{const v=m.replace(i,a),C={};for(const[h,T]of Object.entries(N)){let S="";if(p.length){const V=p.findIndex(K=>v.endsWith(K));if(V>=0){const K=n.applyPostfix[p[V]],Q=K.translationKey;S=this._translateService.instant(Q),K.parent&&delete n.applyPostfix[p[V]]}}C[h]=`${T}${S}`}l.strings[v]=C}),l}_hasCopyDesignViewItemCommand(e){const r=c.InterfaceDesignerItemRegistry.get(e)?.designViewItemCommands?.copy;return Boolean(r)}_changeViewConfigPropertyValue(e,t,r,n){(0,f.has)(e,t)&&(0,f.get)(e,t)===r&&(0,f.set)(e,t,n)}_processResources(e,t,r,n,i){const a=e.split(/[.-]/).join(""),l=this._translateService.currentLang,p={strings:{}},m=(0,ie.flattenObject)(n,this._separator);Object.entries(m||{}).forEach(([v,C])=>{const h=this._getPropertyPath(v),T=`${a}${this._separator}${h}`,S=this._translateService.instant(C);this._nestedSet(r,v,`#ResourceString(${T})#`),p.strings[T]={[l]:S}}),(0,A.getViewElementContentSlots)(t)?.forEach(v=>{const C=r?.[v];C&&Array.isArray(C)&&(r[v]=C.map(h=>{const S=h?.name||w._generateName(h.type);return this._processResources(S,h.type,h,h.defaultLocalizableStrings,p),delete h.defaultLocalizableStrings,h}))}),Object.assign(i.strings,p.strings)}_getDefaultPropertyValues(e){const t=(0,f.cloneDeep)(e.defaultPropertyValues)||{},r=this._defaultItemPropertyValues?.[e.type]||{};return Object.entries(r).forEach(([n,i])=>{t[n]=i}),t}create(e){const t=this._getDefaultPropertyValues(e);this._generateNameMacroProcessor.process(t);const r=e.type,n=t?.name||w._generateName(r),i={strings:{}};return this._processResources(n,r,t,e.defaultLocalizableStrings,i),{itemConfig:{name:n,type:r,...t},resources:i}}*copy({viewConfig:e,resources:t,layoutConfig:r,parentName:n,parentPropertyName:i,originalName:a,copyMetadata:l}){const p=e,m=(0,f.cloneDeep)(p);m.name=w._generateName(p.type),m.layoutConfig=(0,f.cloneDeep)(r);const N=this._copyResources(e,m,t,l),v=(0,A.getViewElementContentSlots)(p.type);v.forEach(C=>{p[C]&&(m[C]=[])}),yield[{itemConfig:m,resources:N},n,i,a];for(const C of v){const h=p[C];if(h)if(typeof h=="string")m[C]=h;else for(const T of h)this._hasCopyDesignViewItemCommand(T?.type)?this._viewCommandExecutor.copy({viewElement:T,index:T.index,propertyName:C,parentName:m.name,copyMetadata:l}).pipe((0,_.switchMap)(S=>S.execute()),(0,_.take)(1)).subscribe():yield*this.copy({viewConfig:T,resources:t,layoutConfig:T.layoutConfig,parentName:m.name,parentPropertyName:C,originalName:T.name,copyMetadata:l})}}rename(e,t,r){if(!r)return;(0,f.isArray)(e)&&e.forEach(i=>this.rename(i,t,r)),e=e,this._changeViewConfigPropertyValue(e,"name",t,r),this._changeViewConfigPropertyValue(e,"for",t,r),(0,A.getViewElementContentSlots)(e.type).forEach(i=>{const a=e[i];a&&this.rename(a,t,r)})}}w.\u0275fac=function(e){return new(e||w)(s.\u0275\u0275inject(re.TranslateService),s.\u0275\u0275inject(A.GenerateNameMacroProcessor),s.\u0275\u0275inject(j))},w.\u0275prov=s.\u0275\u0275defineInjectable({token:w,factory:w.\u0275fac});class F extends u.SchemaService{constructor(e,t,r,n,i,a,l,p){super(p),this._connectedDropListService=e,this._designerLoaderService=t,this._metaItemDesignSettingsService=r,this._changesApplierService=n,this._sysSettingsService=i,this._userInfo=a,this._translateService=l,this._schemaApiService=(0,s.inject)(u.SchemaApiService),this._namePrefix=null}_getNamePrefix(){return this._namePrefix!=null?(0,y.of)(this._namePrefix):this._sysSettingsService.getValueByCode("SchemaNamePrefix","").pipe((0,_.tap)(e=>this._namePrefix=e))}_applyChanges(e){const t={itemConfig:this._schema?.viewConfig};this._changesApplierService.apply(t,e)}_getRootNames(){const e=this._schema?.viewConfig;return(0,ge.isArray)(e)?e.map(t=>t.name):[e?.name]}_publishSchemaChanged(e,t){this.schemaChanged$.next({schema:this._schema,changes:e,restored:t})}_applyParameterChanges(e,t){t?.forEach(r=>{Object.prototype.hasOwnProperty.call(e,r.path)&&(e[r.path]=r.value)})}_getUniqueName(e,t){let r=0,n;do r++,n=`${e}${r}`;while(t.find(i=>i===n));return n}_getLocalizedCaptions(e){const t=[];return Object.entries(e).forEach(([r,n])=>{t.push(n.caption)}),t}_getNewParameterName(e,t){const r=Object.keys(t);return this._getUniqueName(e,r)}isRootContainer(e){return this._getRootNames().includes(e)}create({defaultViewConfig:e={},defaultConfig:t,parentName:r,propertyName:n,index:i}){const a=this._metaItemDesignSettingsService.create(t);a.itemConfig={...e,...a.itemConfig};const l=u.MetaItemDesignSettingChangesOperation.Insert;this._applyChanges({settings:a,operation:l,parentName:r,parentPropertyName:n,index:i}),this.updateResources(a.resources);const p=a.itemConfig,m={viewConfig:p,operation:l,parentName:r,propertyName:n,index:i};return this._publishSchemaChanged(m),p}update({itemConfig:e,resources:t,modelConfig:r,viewModelConfig:n,applyPropertiesStrategies:i,selectOnCanvas:a=!0}){const l=u.MetaItemDesignSettingChangesOperation.Update;this._applyChanges({settings:{itemConfig:e,applyPropertiesStrategies:i},operation:l}),this.updateResources(t),this.updateModelConfig(r),this.updateSchemaViewModelConfig(n);const p=this.getViewConfigInfoByName(e.name),N={viewConfig:p.viewConfig||[],operation:l,selectOnCanvas:a,parentName:p.parentName};this._publishSchemaChanged(N)}remove(e){const{viewConfig:t,parentName:r,index:n}=this.getViewConfigInfoByName(e);if(!t)return;const i=u.MetaItemDesignSettingChangesOperation.Remove;this._applyChanges({settings:{itemConfig:t},operation:i});const a={viewConfig:t,operation:i,parentName:r,index:n};this._publishSchemaChanged(a),this._connectedDropListService.remove(e)}rename(e,t){const r=this._schema.viewConfig;this._metaItemDesignSettingsService.rename(r,e,t);const{viewConfig:n,parentName:i,parentPropertyName:a,index:l}=this.getViewConfigInfoByName(t);if(i){const p=u.MetaItemDesignSettingChangesOperation.Rename;this._publishSchemaChanged({viewConfig:n,parentName:i,operation:p,oldName:e,propertyName:a,index:l})}}copy(e,t,r,n,i,a){const l=n,{parentName:p,parentPropertyName:m,viewConfig:N}=this.getViewConfigInfoByName(e),v=this._schema.resources,C=this._metaItemDesignSettingsService.copy({viewConfig:N,layoutConfig:t,resources:v,parentName:a||p,parentPropertyName:r||m,copyMetadata:i,originalName:N.name});let h=null,T=null,S;do{if(S=C.next(),S.done){const{viewConfig:Te}=this.getViewConfigInfoByName(T),be={viewConfig:Te,operation:u.MetaItemDesignSettingChangesOperation.Insert,parentName:a||p,propertyName:m,index:l};this._publishSchemaChanged(be);break}const[V,K,Q,_e]=S.value;T=T??V?.itemConfig?.name;const Ie=n??this.getViewConfigInfoByName(_e).index;this._applyChanges({settings:{itemConfig:V.itemConfig},operation:u.MetaItemDesignSettingChangesOperation.Insert,parentName:K,parentPropertyName:Q,index:Ie}),this.updateResources(V.resources),n=null,h??(h=V.itemConfig)}while(!S.done);return h}undo(e){const{viewConfig:t,operation:r,parentName:n,index:i}=e;this._applyChanges({settings:{itemConfig:t},index:i,operation:r,parentName:n});const a={viewConfig:t,parentName:n,operation:r,index:i};this._publishSchemaChanged(a,!0)}move(e,t){const r=u.MetaItemDesignSettingChangesOperation.Move;let{viewConfig:n}=this.getViewConfigInfoByName(e);n={...n,layoutConfig:t},this._applyChanges({settings:{itemConfig:n},operation:r}),this._publishSchemaChanged({viewConfig:n,operation:r})}moveToIndex(e,t){const{viewConfig:r,parentName:n}=this.getViewConfigInfoByName(e),i=u.MetaItemDesignSettingChangesOperation.MoveToIndex;this._applyChanges({settings:{itemConfig:r},index:t,operation:i,parentName:n}),this._publishSchemaChanged({viewConfig:r,parentName:n,operation:i})}moveToContainer({name:e,index:t,parentName:r,parentPropertyName:n,layoutConfig:i}){let{viewConfig:a}=this.getViewConfigInfoByName(e);i&&(a={...a,layoutConfig:i});const l=u.MetaItemDesignSettingChangesOperation.MoveToContainer;this._applyChanges({settings:{itemConfig:a},index:t,operation:l,parentName:r,parentPropertyName:n});const p={viewConfig:a,parentName:r,propertyName:n,operation:l,index:t};this._publishSchemaChanged(p),this._connectedDropListService.add(a.name)}updateResources(e){var t,r;!this._schema||((t=this._schema).resources??(t.resources={strings:{}}),(r=this._schema.resources).strings??(r.strings={}),e?.strings&&Object.entries(e.strings).forEach(([n,i])=>{this._schema.resources.strings[n]=i}))}createDataSource(e,t){(!t?.hiddenInPageDesigner||t?.scope===c.DataSourceScope.Page)&&this._designerLoaderService.resetLoadingPart(G.DataSourceLoaded),super.createDataSource(e,t)}updateParameter(e,t){const r=this._schema.parameters,n=r[e];if(!n)return(0,y.of)(null);this._applyParameterChanges(n,t),delete r[e],r[n.name]=n;const i=u.MetaItemDesignSettingChangesOperation.ParameterChanged;return this._publishSchemaChanged({operation:i,viewConfig:this._schema.viewConfig}),(0,y.of)(n)}_getDataValueTypeNewAttributesCount(e,t,r){return e.filter(n=>n.find(i=>i.cultureName===t&&i.value?.startsWith(r))).length}_getNewParameterCaption(e,t,r){const n=r??`${c.DataValueType[t]}Parameter`,i=this._translateService.instant(`NewParameterSubGroup.${n}`),a=this._userInfo.cultureInfo.sysCultureName,l=this._getLocalizedCaptions(e),p=this._getDataValueTypeNewAttributesCount(l,a,i);return{cultureName:a,value:i+" "+(p+1)}}_rebindViewConfigs(e,t){this.getViewConfigInfoByFilter(n=>{const i=c.ViewElementRegistry.getFormControlRelatesAttribute(n.type);return n[i]?.startsWith(`$${e}`)}).forEach(n=>{const i=c.ViewElementRegistry.getFormControlRelatesAttribute(n.viewConfig.type),l=n.viewConfig[i].replace(`$${e}`,`$${t}`);this.update({itemConfig:{[i]:l,name:n.viewConfig.name,label:`$Resources.Strings.${t}`},selectOnCanvas:!1})})}createParameter(e,t,r){return this._getNamePrefix().pipe((0,_.map)(n=>{const i=this._schema.parameters,a=this._getNewParameterName(n+e,i),l=new A.LocalizableStringArray([this._getNewParameterCaption(i,t,r?.captionKey)]),p={uId:(0,c.generateGuid)(),name:a,caption:l,dataValueType:t,required:!1,isOwnParameter:!0,referenceSchemaUId:c.EMPTY_GUID};i[p.name]=p;const m=u.MetaItemDesignSettingChangesOperation.ParameterChanged;return this._publishSchemaChanged({operation:m,viewConfig:this._schema.viewConfig}),p}))}removeParameter(e){const t=this._schema.parameters;delete t[e];const r=u.MetaItemDesignSettingChangesOperation.ParameterChanged;this._publishSchemaChanged({operation:r,viewConfig:this._schema.viewConfig})}renameViewModelAttribute(e,t){if(!this.isViewModelAttributeExists(e))throw new Error(`ViewModel does not contain attribute with name '${e}'`);const r=this.getViewModelAttributesConfig();r[t]=r[e],delete r[e],this._rebindViewConfigs(e,t)}init(e){this._schemaApiService.init(e),super.init(e)}}F.\u0275fac=function(e){return new(e||F)(s.\u0275\u0275inject(L),s.\u0275\u0275inject(M),s.\u0275\u0275inject(w),s.\u0275\u0275inject(b),s.\u0275\u0275inject(me.SysSettingsService),s.\u0275\u0275inject(A.UserInfo),s.\u0275\u0275inject(re.TranslateService),s.\u0275\u0275inject(s.Injector))},F.\u0275prov=s.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac});var d;(function(o){o.Input="crt.Input",o.NumberInput="crt.NumberInput",o.Checkbox="crt.Checkbox",o.Combobox="crt.ComboBox",o.DateTime="crt.DateTimePicker",o.Slider="crt.Slider",o.FileList="crt.FileList",o.Color="crt.ColorPicker",o.RichInput="crt.RichTextEditor",o.PhoneInput="crt.PhoneInput",o.EmailInput="crt.EmailInput",o.WebInput="crt.WebInput",o.ImageLink="crt.ImageInput",o.Timer="crt.Timer",o.LocalTime="crt.LocalTime",o.FileInput="crt.FileInput",o.Timeline="crt.Timeline"})(d||(d={}));const I="crt.DataSourceAttributePropertiesPanel",P={Input:{controlType:d.Input,viewModelAttributeName:"StringAttribute",propertiesPanelComponentTypeName:I},RichInput:{controlType:d.RichInput,viewModelAttributeName:"StringAttribute",propertiesPanelComponentTypeName:I},NumberInput:{controlType:d.NumberInput,viewModelAttributeName:"NumberAttribute",propertiesPanelComponentTypeName:I},Checkbox:{controlType:d.Checkbox,viewModelAttributeName:"BooleanAttribute",propertiesPanelComponentTypeName:I},Combobox:{controlType:d.Combobox,viewModelAttributeName:"LookupAttribute",propertiesPanelComponentTypeName:I},DateTime:{controlType:d.DateTime,viewModelAttributeName:"DateTimeAttribute",propertiesPanelComponentTypeName:I},Slider:{controlType:d.Slider,viewModelAttributeName:"SliderAttribute",propertiesPanelComponentTypeName:I},FileList:{controlType:d.FileList,viewModelAttributeName:"FileListAttribute",propertiesPanelComponentTypeName:I},Color:{controlType:d.Color,viewModelAttributeName:"ColorAttribute",propertiesPanelComponentTypeName:I},WebInput:{controlType:d.WebInput,viewModelAttributeName:"StringAttribute",propertiesPanelComponentTypeName:I},EmailInput:{controlType:d.EmailInput,viewModelAttributeName:"StringAttribute",propertiesPanelComponentTypeName:I},PhoneInput:{controlType:d.PhoneInput,viewModelAttributeName:"StringAttribute",propertiesPanelComponentTypeName:I},ImageLink:{controlType:d.ImageLink,viewModelAttributeName:"ImageLinkAttribute",propertiesPanelComponentTypeName:I},Timer:{controlType:d.Timer,viewModelAttributeName:"TimerAttribute",propertiesPanelComponentTypeName:I},LocalTime:{controlType:d.LocalTime,viewModelAttributeName:"LocalTimeAttribute",propertiesPanelComponentTypeName:I},Timeline:{controlType:d.Timeline,viewModelAttributeName:"LookupAttribute",propertiesPanelComponentTypeName:I}},ce={Input:{...P.Input,propertiesPanelComponentTypeName:"crt.EntityDataSourceTextAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},RichInput:{...P.RichInput,propertiesPanelComponentTypeName:"crt.EntityDataSourceTextAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},NumberInput:{...P.NumberInput,propertiesPanelComponentTypeName:"crt.EntityDataSourceNumberAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},Checkbox:{...P.Checkbox,propertiesPanelComponentTypeName:"crt.EntityDataSourceAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},Combobox:{...P.Combobox,propertiesPanelComponentTypeName:"crt.EntityDataSourceLookupAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},DateTime:{...P.DateTime,propertiesPanelComponentTypeName:"crt.EntityDataSourceDateTimeAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},Slider:{...P.Slider,propertiesPanelComponentTypeName:"crt.EntityDataSourceNumberAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},FileList:{...P.FileList,propertiesPanelComponentTypeName:"crt.FileListPropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},Color:{...P.Color,propertiesPanelComponentTypeName:"crt.EntityDataSourceColorAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},WebInput:{...P.WebInput,propertiesPanelComponentTypeName:"crt.EntityDataSourceTextAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},EmailInput:{...P.EmailInput,propertiesPanelComponentTypeName:"crt.EntityDataSourceTextAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},PhoneInput:{...P.PhoneInput,propertiesPanelComponentTypeName:"crt.EntityDataSourceTextAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},ImageLink:{...P.ImageLink,propertiesPanelComponentTypeName:"crt.EntityDataSourceImageLookupAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},Timer:{...P.Timer,propertiesPanelComponentTypeName:"crt.EntityDataSourceTextAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},LocalTime:{...P.LocalTime,propertiesPanelComponentTypeName:"crt.EntityDataSourceTextAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"},Timeline:{...P.Timeline,propertiesPanelComponentTypeName:"crt.EntityDataSourceLookupAttributePropertiesPanel",forwardReferencePropertiesPanelComponentTypeName:"crt.EntityForwardReferenceAttributePropertiesPanel"}},pe=P;class E{constructor(){this._convertableTypes=[c.DataValueType.PHONE_TEXT,c.DataValueType.WEB_TEXT,c.DataValueType.EMAIL_TEXT,c.DataValueType.RICH_TEXT]}getPropertiesPanelDataProviderToken(e){}get controlConfig(){return P}_getControlConfigByDataValueType(e){const t=["requirementType"];switch(e){case c.DataValueType.Text:case c.DataValueType.SHORT_TEXT:case c.DataValueType.MEDIUM_TEXT:case c.DataValueType.MAXSIZE_TEXT:case c.DataValueType.LONG_TEXT:case c.DataValueType.SECURE_TEXT:return{configType:"Input",editableProperties:[...t,"type"]};case c.DataValueType.Integer:case c.DataValueType.Float:case c.DataValueType.FLOAT1:case c.DataValueType.FLOAT2:case c.DataValueType.FLOAT3:case c.DataValueType.FLOAT4:case c.DataValueType.FLOAT8:case c.DataValueType.Money:return{configType:"NumberInput",editableProperties:[...t,"type"]};case c.DataValueType.Boolean:return{configType:"Checkbox",editableProperties:[]};case c.DataValueType.Lookup:return{configType:"Combobox",editableProperties:[...t,"referenceSchema"]};case c.DataValueType.Date:case c.DataValueType.DateTime:case c.DataValueType.Time:return{configType:"DateTime",editableProperties:[...t,"type"]};case c.DataValueType.Color:return{configType:"Color",editableProperties:t};case c.DataValueType.RICH_TEXT:return{configType:"RichInput",editableProperties:[...t,"type"]};case c.DataValueType.WEB_TEXT:return{configType:"WebInput",editableProperties:[...t,"type"]};case c.DataValueType.EMAIL_TEXT:return{configType:"EmailInput",editableProperties:[...t,"type"]};case c.DataValueType.PHONE_TEXT:return{configType:"PhoneInput",editableProperties:[...t,"type"]};case c.DataValueType.IMAGELOOKUP:return{configType:"ImageLink",editableProperties:[...t,"referenceSchema"]};default:return{configType:"Input",editableProperties:t}}}getAttributeEditablePropertiesByType(e){return this._getControlConfigByDataValueType(e).editableProperties}getConfigByType(e){const t=this._getControlConfigByDataValueType(e).configType,r=this.controlConfig[t];return r.propertiesPanelDataProviderToken=this.getPropertiesPanelDataProviderToken(e),r}getControlTypeToReplace(e,t){return this._convertableTypes.includes(e)?this.getConfigByType(e)?.controlType:t}}E.\u0275fac=function(e){return new(e||E)},E.\u0275prov=s.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"});var Y;(function(o){o.ViewElement="ViewElement",o.ViewElementBinding="ViewElementBinding",o.DataSource="DataSource",o.DataSourceAttribute="DataSourceAttribute",o.Page="Page"})(Y||(Y={}));class le{constructor(e){this._pages=[],this._validateData(e),this._pages=(0,f.cloneDeep)(e)??[]}_validateData(e){const t=e?.filter(n=>n.IsDefault)??[];if(this._containsMultiplePagesForRole(t))throw new Error("There are multiple default pages for the same role");const r=e?.filter(n=>n.Actions?.Add)??[];if(this._containsMultiplePagesForRole(r))throw new Error("There are multiple add pages for the same role")}_containsMultiplePagesForRole(e){const t=[];for(const r of e)if(r.Role){if(t.includes(r.Role))return!0;t.push(r.Role)}return!1}_isSamePage(e,t,r){return e&&e.PageSchemaUId===t&&e.Role===r}_getDefaultPageByRole(e){const t=this._pages.filter(r=>r.IsDefault);return this._getPageByRole(t,e)}_getAddPageByRole(e){const t=this._pages.filter(r=>r.Actions?.Add);return this._getPageByRole(t,e)}_getPageByRole(e,t){return t===A.ALL_EMPLOYEES_SYSADMINUNIT_ID?e.find(r=>r.Role===t||(0,f.isEmpty)(r.Role)||r.Role===c.EMPTY_GUID):e.find(r=>r.Role===t)}_createNewDefaultPage(e,t){const r=this._initPageWithRole(e,t);this._applyIsDefault(r),this._pages.push(r)}_createNewAddPage(e,t){const r=this._initPageWithRole(e,t);this._applyPageAction(r,"Add"),this._pages.push(r)}_initPageWithRole(e,t){const r=this._getInitialPage(e);return this._applyRole(r,t),r}_getInitialPage(e){return{IsDefault:!1,IsSspDefault:!1,PageSchemaUId:e,UId:(0,c.generateGuid)(),Role:null}}_applyIsDefault(e){e.IsDefault=!0}_applyPageAction(e,t){(0,f.isEmpty)(e.Actions)&&(e.Actions={}),e.Actions[t]=!0}_updatePage(e,t,r){this._updatePageSchemaUId(e,t),e.Role||this._applyRole(e,r)}_applyRole(e,t){e.Role=t}_updatePageSchemaUId(e,t){e.PageSchemaUId=t}_removeDefaultPage(e,t){const r=this._pages.filter(n=>n.IsDefault);this._removePage(r,e,t)}_removeAddPage(e,t){const r=this._pages.filter(n=>n.Actions?.Add);this._removePage(r,e,t)}_removePage(e,t,r){const n=this._pages.indexOf(e.find(i=>i.PageSchemaUId===t&&i.Role===r));n>-1&&this._pages.splice(n,1)}_getPageUIdByRoleOrSspDefault(e,t){const r=t===A.ALL_PORTAL_USERS_SYSADMINUNIT_ID;return e.find(n=>!(0,f.isEmpty)(n.Role)&&n.Role!==c.EMPTY_GUID?n.Role===t:n.IsSspDefault===r)?.PageSchemaUId}getAddPageUIdByRole(e){const t=this._pages?.filter(r=>r.Actions?.Add);return this._getPageUIdByRoleOrSspDefault(t,e)}setAddPageUId(e,t){const r=this._getAddPageByRole(t);if(!this._isSamePage(r,e,t)){if(!e){this._removeAddPage(r?.PageSchemaUId,t);return}r?this._updatePage(r,e,t):this._createNewAddPage(e,t)}}getDefaultPageUIdByRole(e){const t=this._pages?.filter(r=>r.IsDefault);return this._getPageUIdByRoleOrSspDefault(t,e)}setDefaultPageUId(e,t){const r=this._getDefaultPageByRole(t);if(!this._isSamePage(r,e,t)){if(!e){this._removeDefaultPage(r?.PageSchemaUId,t);return}r?this._updatePage(r,e,t):this._createNewDefaultPage(e,t)}}setPageSchemaUIdByAction(e,t,r){if(t==="Add"){this.setAddPageUId(e,r);return}this.setDefaultPageUId(e,r)}equals(e){return(0,f.isEqual)(this._pages,e)}getMetaData(){return this._pages}}class H{create(e){return new le(e)}}H.\u0275fac=function(e){return new(e||H)},H.\u0275prov=s.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac});class B extends E{get controlConfig(){return ce}}B.\u0275fac=function(){let o;return function(t){return(o||(o=s.\u0275\u0275getInheritedFactory(B)))(t||B)}}(),B.\u0275prov=s.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac,providedIn:"root"});const ue=new s.InjectionToken("PageParametersAttributePropertiesDataProvider");class O extends E{get controlConfig(){return pe}getPropertiesPanelDataProviderToken(e){return ue}}O.\u0275fac=function(){let o;return function(t){return(o||(o=s.\u0275\u0275getInheritedFactory(O)))(t||O)}}(),O.\u0275prov=s.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac,providedIn:"root"});var he=g(72856),ye=g(54514);class k{constructor(){this._iconRegistry=(0,s.inject)(he.MatIconRegistry),this._domSanitizer=(0,s.inject)(ye.DomSanitizer),this._iconNames=new Set}_getRegistryElementIcon(e){return c.InterfaceDesignerItemRegistry.get(e).toolbarConfig?.icon}registerIcon(e,t){return this._iconNames.has(e)||(this._iconRegistry.addSvgIconLiteral(e,this._domSanitizer.bypassSecurityTrustHtml(t)),this._iconNames.add(e)),e}registerIconByTypeAndGetIconName(e){const t=this._getRegistryElementIcon(e);return this.registerIcon(`page-designer-${e}`,t)}registerIconAndGetIconName(e){const t=this._iconNames.size;return this.registerIcon(`page-designer-${t}`,e)}}k.\u0275fac=function(e){return new(e||k)},k.\u0275prov=s.\u0275\u0275defineInjectable({token:k,factory:k.\u0275fac,providedIn:"root"});class J extends k{constructor(){super(...arguments),this.attributeConfigProvider=(0,s.inject)(E),this.iconsProvider=(0,s.inject)(A.DesignerDataValueTypeIconsProvider)}getControlIconNameByDataValueType(e){const t=this.getDesignElementConfigByType(e);return this.registerIconByTypeAndGetIconName(t.controlType)}}var Pe=g(38626);class U extends J{constructor(){super(...arguments),this._autonumberControlIcon=g(77826),this._autonumberIcons=new Map}_getAutonumberControlIconName(e){if(!this._autonumberIcons.has(e)){const t=this.registerIcon("page-designer-AutonumberColumn",this._autonumberControlIcon);this._autonumberIcons.set(e,t)}return this._autonumberIcons.get(e)}_getControlIconNameByColumn(e){return e.isAutonumberColumn?this._getAutonumberControlIconName(e.type):this.getControlIconNameByDataValueType(e.type)}_getControlIconNameByDataValueType(e,t){return t?this._getAutonumberControlIconName(e):this.getControlIconNameByDataValueType(e)}getDesignElementConfigByType(e){return this.attributeConfigProvider.getConfigByType(e)}getColumnIconName(e){return this.iconsProvider.getDesignerDataValueTypeIcon(e.type,e.isAutonumberColumn)}getColumnControlIconName(...e){return e.length===1?e[0]instanceof Pe.BaseEntitySchemaColumn?this._getControlIconNameByColumn(e[0]):this.getControlIconNameByDataValueType(e[0]):this._getControlIconNameByDataValueType(e[0],e[1])}}U.\u0275fac=function(){let o;return function(t){return(o||(o=s.\u0275\u0275getInheritedFactory(U)))(t||U)}}(),U.\u0275prov=s.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"});class $ extends J{getDesignElementConfigByType(e){return this.attributeConfigProvider.getConfigByType(e)}getParameterIconName(e){return this.iconsProvider.getDesignerDataValueTypeIcon(e)}}$.\u0275fac=function(){let o;return function(t){return(o||(o=s.\u0275\u0275getInheritedFactory($)))(t||$)}}(),$.\u0275prov=s.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac,providedIn:"root"});class W{getControlExtraConfig(e,t,r=!1){let n=null;switch(e){case d.Input:t&&(n={multiline:r});break;case d.DateTime:switch(t){case c.DataValueType.DateTime:n={pickerType:"datetime"};break;case c.DataValueType.Date:n={pickerType:"date"};break;case c.DataValueType.Time:n={pickerType:"time"};break}break}return n}}W.\u0275fac=function(e){return new(e||W)},W.\u0275prov=s.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac,providedIn:"root"});class Ce{constructor(e){this.injector=e}injectDependencies(){return(0,y.of)(null).pipe((0,_.tap)(()=>{this.designerSchemaService=this.injector.get(F),this._designerSyncService=this.injector.get(R)}))}execute(){return this._designerSyncService.register(this.innerExecute()).pipe((0,_.catchError)(e=>(console.log(`Command execution error!
CommandType: ${this.constructor.name}.
Error: ${e.message}`),(0,y.of)({success:!1,errorMessage:e.message}))))}init(){return this.injectDependencies().pipe((0,_.map)(()=>this))}}},77826:q=>{q.exports=`<svg width="72" height="40" viewBox="0 0 72 40" fill="none" xmlns="http://www.w3.org/2000/svg">
	<rect x="8.5" y="8.5" width="55" height="23" rx="0.5" fill="white" stroke="#0D2E4E"/>
	<path d="M37 17H19C17.3431 17 16 18.3431 16 20C16 21.6569 17.3431 23 19 23H37C38.6569 23 40 21.6569 40 20C40 18.3431 38.6569 17 37 17Z" fill="#D1D1D1"/>
	<path d="M45 14.49845H45.7838V17.00128H47.4838V13.00049H45V14.49845Z" fill="#FF4013"/>
	<path fill-rule="evenodd" clip-rule="evenodd" d="M59 14.00089H50.087V16.00089H59V14.00089ZM59 19.0005H50.087V21.0005H59V21.0005ZM45 25.7274V26.9998H48.1904V22.9998H45V24.1761H46.5V24.5073H45.75V25.3962H46.5V25.7274H45ZM59 23.9998H50.087V25.9998H59V23.9998Z" fill="#FF4013"/>
	<path d="M45 20.5638V21.9997L48.159 21.9998V20.5638L47.2617 20.5638L48.159 19.8663L48.159 18.0013L45 18.0013L45 19.4333H46.5L45 20.5638Z" fill="#FF4013"/>
</svg>
`}}]);
