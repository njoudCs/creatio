(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[5041,8239,5036,6118,7344,8160,1034,8056,1906,4501,1216,9256,9795,1006,7571,6025,9424,885,7709,6662,9669,2375,411],{55041:(P,A,c)=>{c.r(A),c.d(A,{FolderTreeActiveFolderChangedHandler:()=>h,FolderTreeAddFolderDataHandler:()=>y,FolderTreeConvertToStaticFolderHandler:()=>S,FolderTreeCopyFolderDataHandler:()=>_,FolderTreeDeleteFolderDataHandler:()=>D,FolderTreeExpandedItemsHandler:()=>H,FolderTreeModule:()=>T,FolderTreeRenameHandler:()=>R,FolderTreeToggleFolderFavoriteHandler:()=>O,FolderTreeUpdateFiltersHandler:()=>b,FolderTreeVisibleHandler:()=>w});var d=c(74742),M=c(31134),a=c(75378),g=c(33177),v=c(34038),i=c(8239),m=c(49475),n=c(21322);let h=class extends a.BaseRequestHandler{constructor(e){super(),this._folderTreeUserProfileService=e}_isNeedSaveToProfile(e){const t=e.$context,{activeFolderIdAttrName:r}=(0,m.buildFolderTreeAttributeNames)(e.folderTreeName);return t.attributes[r]!==e.id}handle(e){var t=this;return(0,i.Z)(function*(){t._isNeedSaveToProfile(e)&&(yield t._folderTreeUserProfileService.setFolderTreeSelectedNode(e.folderTreeName,e.id,e.isFavorite));const r=(0,m.buildFolderTreeAttributeNames)(e.folderTreeName),o=e.$context;return(0,n.lastValueFrom)(o.setValue({[e.activeFolderIdAttrName??r.activeFolderIdAttrName]:e.id,[e.activeFolderNameAttrName??r.activeFolderNameAttrName]:e.name,[e.activeFolderFavoriteStateAttrName??r.activeFolderFavoriteStateAttrName]:e.isFavorite}),{defaultValue:null})})()}};h=(0,d.__decorate)([(0,a.CrtRequestHandler)({type:"crt.FolderTreeActiveFolderChangedHandler",requestType:"crt.FolderTreeActiveFolderChangedRequest"}),(0,d.__metadata)("design:paramtypes",[v.FolderTreeUserProfileService])],h);var l=c(94450),p=c(27049),C=c(24709),E=c(99293),I=c(97600);class f{constructor(e,t){this._ngZone=e,this._dialogService=t}_reloadMainDs(e,t){const r=e.getBoundDataSourceNameByAttributePath(t.itemsAttrName);return e.load(r,[],{loadType:a.DataSourceLoadType.Reload})}_reloadFavoritesDs(e,t){const r=e.$context;if(e.reloadFavorites){const o=r.getBoundDataSourceNameByAttributePath(t.favoriteItemsAttrName);return r.load(o,[],{loadType:a.DataSourceLoadType.Reload})}return(0,n.of)({})}_getErrorMessage(e){const t=e.errorInfo;return e.message||((0,I.isString)(t)?t:t.message)}handle(e,t,r){const o=t.$context,s=(0,m.buildFolderTreeAttributeNames)(t.folderTreeName);return(0,n.lastValueFrom)(e.pipe((0,p.mergeMap)(()=>(0,n.concat)([this._reloadMainDs(o,s),this._reloadFavoritesDs(t,s)])),(0,p.concatAll)(),(0,p.catchError)(F=>this.handleError(F,t,r))),{defaultValue:null})}handleError(e,t,r){var o=this;const s=t.$context,F=(0,m.buildFolderTreeAttributeNames)(t.folderTreeName),j=this._getErrorMessage(e);return this._ngZone.run(()=>this._dialogService.openInfoDialog(j)).subscribe({next:function(){var V=(0,i.Z)(function*(){yield r?.process({type:"crt.FolderTreeActiveFolderChangedRequest",folderTreeName:t.folderTreeName,$context:t.$context}),yield(0,n.lastValueFrom)(o._reloadMainDs(s,F),{defaultValue:null}),yield(0,n.lastValueFrom)(o._reloadFavoritesDs(t,F),{defaultValue:null})});return function(){return V.apply(this,arguments)}}()}),(0,n.of)({})}}f.\u0275fac=function(e){return new(e||f)(l.\u0275\u0275inject(l.NgZone),l.\u0275\u0275inject(E.DialogService))},f.\u0275prov=l.\u0275\u0275defineInjectable({token:f,factory:f.\u0275fac,providedIn:"any"});var U=c(2876),J=c(77207);class N{constructor(){this._userInfo=(0,l.inject)(m.UserInfo),this._featureValues=(0,l.inject)(m.FEATURE_VALUES),this._httpClient=(0,l.inject)(U.HttpClient),this._translateService=(0,l.inject)(J.TranslateService),this._serviceEndpoint=(this._userInfo.isSSP?"ssp/":"")+"rest/FolderManagerService/"}_asyncConvert(e){return this._callService("ConvertToStaticFolder",e).pipe((0,n.map)(t=>(t?.success&&(t.additionalNotification=this._translateService.instant("StaticFolderConvertor.AsyncConvertMessage")),t)))}_convert(e){return this._callService("ConvertFolder",e).pipe((0,n.map)(t=>(t||(t={success:!0}),t)))}_callService(e,t){const r=`${this._serviceEndpoint}${e}`,o=`${e}Result`;return this._httpClient.post(r,{newFolderId:t.newFolderId,parentFolderId:t.parentFolderId,entitySchemaName:t.rootSchemaName}).pipe((0,n.map)(s=>s[o]),(0,n.catchError)(s=>this._catchHttpErrorResponse(s)))}_catchHttpErrorResponse(e){return(0,n.of)({success:!1,errorInfo:{message:e.error?.errorInfo?.message??e.message}})}convert(e){return this._featureValues.ConvertDynamicToStaticFolderByChunk?this._asyncConvert(e):this._convert(e)}}N.\u0275fac=function(e){return new(e||N)},N.\u0275prov=l.\u0275\u0275defineInjectable({token:N,factory:N.\u0275fac});class x extends a.BaseRequestHandler{constructor(e){super(),this.modelRequestService=e.get(f)}insertModel(e){return(0,i.Z)(function*(){const t=yield(0,n.lastValueFrom)(C.Model.create(e.sourceSchemaName));let r={Id:e.folderId,Name:e.folderName,Parent:e.parentId};return(0,v.isOldSourceSchema)(e.sourceSchemaName)?r={...r,FolderType:e.folderTypeId||v.DYNAMIC_FOLDER_TYPE_ID,SearchData:e.filterData}:r={...r,EntitySchemaName:e.rootSchemaName,FilterData:e.filterData},t.insert(r)})()}}let y=class extends x{constructor(e){super(e)}handle(e){var t=this;return(0,i.Z)(function*(){const r=e.$context,o=(0,m.buildFolderTreeAttributeNames)(e.folderTreeName).itemsAttrName,s=r.getBoundDataSourceNameByAttributePath(o);return(0,n.lastValueFrom)((yield t.insertModel(e)).pipe((0,p.switchMap)(()=>r.load(s,[],{loadType:a.DataSourceLoadType.Reload})),(0,p.catchError)(F=>t.modelRequestService.handleError(F,e,t.handlerChain))),{defaultValue:null})})()}};y.\u0275fac=function(e){return new(e||y)(l.\u0275\u0275inject(l.Injector))},y.\u0275prov=l.\u0275\u0275defineInjectable({token:y,factory:y.\u0275fac,providedIn:"any"}),y=(0,d.__decorate)([(0,a.CrtRequestHandler)({type:"crt.FolderTreeAddFolderDataHandler",requestType:"crt.AddFolderDataRequest"}),(0,d.__metadata)("design:paramtypes",[l.Injector])],y);let S=class extends a.BaseRequestHandler{constructor(e,t,r){super(),this._staticFolderConvertor=e,this._notifyService=t,this._maskService=r}_addNewFolder(e){return this.handlerChain.process({...e,type:"crt.AddFolderDataRequest"})}_isAddFolderResultFailed(e){return(0,I.isObject)(e)&&!e.rowsAffected||!(0,I.isObject)(e)&&e!==null}_convert(e){return this._showLoadingMask(e),(0,n.lastValueFrom)(this._staticFolderConvertor.convert({newFolderId:e.folderId,parentFolderId:e.parentId,rootSchemaName:e.rootSchemaName}).pipe((0,n.tap)(()=>this._hideLoadingMask(e))))}_showLoadingMask(e){this._maskService.showMask(this._getTaskName(e.rootSchemaName),e.$context)}_hideLoadingMask(e){this._maskService.hideMask(this._getTaskName(e.rootSchemaName),e.$context)}_getTaskName(e){return`ConvertToStaticFolder_${e}`}_notify(e){let t="";if(e.success&&e.additionalNotification)t=e.additionalNotification;else if(!e.success)t=e.errorInfo?.message;else return;this._notifyService.show({message:t,translate:!1})}_refreshDataSource(e){return(0,i.Z)(function*(){const t=e.$context,r=(0,m.buildFolderTreeAttributeNames)(e.folderTreeName),o=t.getBoundDataSourceNameByAttributePath(r.itemsAttrName);yield(0,n.lastValueFrom)(t.load(o,[],{loadType:a.DataSourceLoadType.Reload}))})()}handle(e){var t=this;return(0,i.Z)(function*(){const r=yield t._addNewFolder(e);if(t._isAddFolderResultFailed(r))return;const o=yield t._convert(e);return t._notify(o),yield t._refreshDataSource(e),o})()}};S.\u0275fac=function(e){return new(e||S)(l.\u0275\u0275inject(N),l.\u0275\u0275inject(E.NotifyService),l.\u0275\u0275inject(a.MaskService))},S.\u0275prov=l.\u0275\u0275defineInjectable({token:S,factory:S.\u0275fac}),S=(0,d.__decorate)([(0,a.CrtRequestHandler)({type:"crt.FolderTreeConvertToStaticFolderHandler",requestType:"crt.ConvertToStaticFolderRequest"}),(0,d.__param)(2,(0,a.CrtInject)(m.DEVKIT_MASK_SERVICE)),(0,d.__metadata)("design:paramtypes",[N,E.NotifyService,a.MaskService])],S);var B=c(41307);let _=class extends x{constructor(e){super(e),this._rightsService=e.get(B.RightsService)}handle(e){var t=this;return(0,i.Z)(function*(){const r=e.$context,o=(0,m.buildFolderTreeAttributeNames)(e.folderTreeName).itemsAttrName,s=r.getBoundDataSourceNameByAttributePath(o);return(0,n.lastValueFrom)((yield t.insertModel(e)).pipe((0,p.switchMap)(()=>e.copyRights&&e.folderId?t._rightsService.copyRights({schemaName:e.sourceSchemaName,sourceId:e.sourceId,targetId:e.folderId,options:{overwrite:!1}}):(0,n.of)({})),(0,p.switchMap)(()=>r.load(s,[],{loadType:a.DataSourceLoadType.Reload})),(0,p.catchError)(F=>t.modelRequestService.handleError(F,e,t.handlerChain))),{defaultValue:null})})()}};_.\u0275fac=function(e){return new(e||_)(l.\u0275\u0275inject(l.Injector))},_.\u0275prov=l.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac}),_=(0,d.__decorate)([(0,a.CrtRequestHandler)({type:"crt.FolderTreeCopyFolderDataHandler",requestType:"crt.CopyFolderDataRequest"}),(0,d.__metadata)("design:paramtypes",[l.Injector])],_);let D=class extends a.BaseRequestHandler{constructor(e){super(),this._modelRequestService=e.get(f)}handle(e){const r=e.$context.delete(e.dataSourceName,[{type:a.ModelParameterType.PrimaryColumnValue,value:e.folderId}]);return this._modelRequestService.handle(r,e)}};D=(0,d.__decorate)([(0,a.CrtRequestHandler)({type:"crt.FolderTreeDeleteFolderDataHandler",requestType:"crt.DeleteFolderDataRequest"}),(0,d.__metadata)("design:paramtypes",[l.Injector])],D);let H=class extends a.BaseRequestHandler{constructor(e){super(),this._folderTreeUserProfileService=e}handle(e){var t=this;return(0,i.Z)(function*(){yield t._folderTreeUserProfileService.setFolderTreeExpandedItems(e.folderTreeName,e.expandedItems);const r=(0,m.buildFolderTreeAttributeNames)(e.folderTreeName),o=e.$context;return(0,n.firstValueFrom)(o.setValue({[r.expandedItemsAttrName]:e.expandedItems}))})()}};H=(0,d.__decorate)([(0,a.CrtRequestHandler)({type:"crt.FolderTreeExpandedItemsHandler",requestType:"crt.FolderTreeExpandedItemsRequest"}),(0,d.__metadata)("design:paramtypes",[v.FolderTreeUserProfileService])],H);let R=class extends a.BaseRequestHandler{constructor(e){super(),this._modelRequestService=e.get(f)}handle(e){var t=this;return(0,i.Z)(function*(){const o=(yield(0,n.lastValueFrom)(C.Model.create(e.sourceSchemaName))).update({Name:e.folderName},[{type:a.ModelParameterType.PrimaryColumnValue,value:e.folderId}]);return t._modelRequestService.handle(o,e,t.handlerChain)})()}};R=(0,d.__decorate)([(0,a.CrtRequestHandler)({type:"crt.FolderTreeRenameHandler",requestType:"crt.FolderTreeRenameRequest"}),(0,d.__metadata)("design:paramtypes",[l.Injector])],R);let O=class extends a.BaseRequestHandler{_getReloadDataSourceOperator(e){const t=e.$context,r=(0,m.buildFolderTreeAttributeNames)(e.folderTreeName),o=t.getBoundDataSourceNameByAttributePath(r.favoriteItemsAttrName);return(0,p.mergeMap)(()=>t.load(o,[],{loadType:a.DataSourceLoadType.Reload}))}_getEntitySchemaUId(e){return(0,n.lastValueFrom)(this._entitySchemaService.getEntitySchemaByName(e).pipe((0,p.map)(t=>t.entitySchema.uId)))}_insertFolder(e,t,r){var o=this;return(0,i.Z)(function*(){let s={};if((0,v.isOldSourceSchema)(e.sourceSchemaName)){const F=yield o._getEntitySchemaUId(e.sourceSchemaName);s={FolderId:e.id,FolderEntitySchemaUId:F}}else s={FolderTree:e.id,EntitySchemaName:e.rootSchemaName};return(0,n.lastValueFrom)(t.insert(s).pipe(r))})()}_deleteFolder(e,t,r){return(0,n.lastValueFrom)(t.delete([{type:a.ModelParameterType.PrimaryColumnValue,value:e.favoriteId}]).pipe(r))}constructor(e){super(),this._entitySchemaService=e}handle(e){var t=this;return(0,i.Z)(function*(){const r=(0,v.isOldSourceSchema)(e.sourceSchemaName)?v.OLD_FOLDER_TREE_FAVORITE_SCHEMA_NAME:v.DEFAULT_FOLDER_TREE_FAVORITE_SCHEMA_NAME,o=yield(0,n.lastValueFrom)(C.Model.create(r)),s=t._getReloadDataSourceOperator(e);return e.status?t._insertFolder(e,o,s):t._deleteFolder(e,o,s)})()}};O=(0,d.__decorate)([(0,a.CrtRequestHandler)({type:"crt.ToggleFolderFavoriteHandler",requestType:"crt.ToggleFolderFavoriteRequest"}),(0,d.__metadata)("design:paramtypes",[m.EntitySchemaService])],O);let b=class extends a.BaseRequestHandler{constructor(e){super(),this._modelRequestService=e.get(f)}handle(e){var t=this;return(0,i.Z)(function*(){const r=yield(0,n.lastValueFrom)(C.Model.create(e.sourceSchemaName));let o={};(0,v.isOldSourceSchema)(e.sourceSchemaName)?o={SearchData:e.filterData}:o={FilterData:e.filterData};const s=r.update(o,[{type:a.ModelParameterType.PrimaryColumnValue,value:e.folderId}]);return t._modelRequestService.handle(s,e)})()}};b=(0,d.__decorate)([(0,a.CrtRequestHandler)({type:"crt.FolderTreeUpdateFiltersHandler",requestType:"crt.FolderTreeUpdateFiltersRequest"}),(0,d.__metadata)("design:paramtypes",[l.Injector])],b);let w=class extends a.BaseRequestHandler{constructor(e){super(),this._folderTreeUserProfileService=e}_getIsIsFolderTreeVisible(e,t){return(0,i.Z)(function*(){const r=e.$context;let o=e.visible;if(e.togglePanel){let s=yield r[t];s=(0,I.isNil)(s)?!1:s,o=!s}return o})()}_setFolderTreeVisible(e,t,r,o,s){var F=this;return(0,i.Z)(function*(){F._folderTreeUserProfileService.setFolderTreeVisibleState(o,t);const j=e.setValue({[r]:t});if(t){const V=F._reloadDataSource(e,s);return(0,n.lastValueFrom)(j.pipe(V),{defaultValue:null})}return(0,n.lastValueFrom)(j,{defaultValue:null})})()}_reloadDataSource(e,t){const r=e.getBoundDataSourceNameByAttributePath(t);return(0,p.mergeMap)(()=>e.load(r,[],{loadType:a.DataSourceLoadType.Reload}))}handle(e){var t=this;return(0,i.Z)(function*(){const r=(0,m.buildFolderTreeAttributeNames)(e.folderTreeName),o=r.visibleAttrName,s=e.$context,F=yield t._getIsIsFolderTreeVisible(e,o);return t._setFolderTreeVisible(s,F,o,e.folderTreeName,r.itemsAttrName)})()}};w=(0,d.__decorate)([(0,a.CrtRequestHandler)({type:"crt.FolderTreeVisibleHandler",requestType:"crt.FolderTreeVisibleRequest"}),(0,d.__metadata)("design:paramtypes",[v.FolderTreeUserProfileService])],w);const L=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),$=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),W=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),Z=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),k=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),K=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"Nous vous informerons lorsque la conversion sera termin\xE9e."}}'),G=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),z=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),Y=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),Q=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),X=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),q=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),ee=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),te=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),re=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"Iremos notific\xE1-lo quando a convers\xE3o for conclu\xEDda."}}'),oe=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),ae=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),ne=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"\u041C\u044B \u0441\u043E\u043E\u0431\u0449\u0438\u043C \u0432\u0430\u043C, \u043A\u043E\u0433\u0434\u0430 \u043A\u043E\u043D\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044F \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430."}}'),le=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),se=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),de=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),ce=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),ie=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"\u041C\u0438 \u043F\u043E\u0432\u0456\u0434\u043E\u043C\u0438\u043C\u043E \u0432\u0430\u043C, \u043A\u043E\u043B\u0438 \u043A\u043E\u043D\u0432\u0435\u0440\u0442\u0430\u0446\u0456\u044E \u0431\u0443\u0434\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043E."}}'),me=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),ue=JSON.parse('{"StaticFolderConvertor":{"AsyncConvertMessage":"We will notify you when the convertation is completed."}}'),pe={"ar-SA":L,"cs-CZ":$,"de-DE":W,"en-US":Z,"es-ES":k,"fr-FR":K,"he-IL":G,"hu-HU":z,"id-ID":Y,"it-IT":Q,"ja-JP":X,"ko-KR":q,"nl-NL":ee,"pl-PL":te,"pt-BR":re,"pt-PT":oe,"ro-RO":ae,"ru-RU":ne,"sq-AL":le,"sv-SE":se,"th-TH":de,"tr-TR":ce,"uk-UA":ie,"vi-VN":me,"zh-CN":ue};let T=class{};T.\u0275fac=function(e){return new(e||T)},T.\u0275mod=l.\u0275\u0275defineNgModule({type:T}),T.\u0275inj=l.\u0275\u0275defineInjector({providers:[v.FolderTreeUserProfileService,N],imports:[M.CommonModule,g.CrtLibTranslateModule.forRoot({i18n:pe})]}),T=(0,d.__decorate)([(0,a.CrtModule)({requestHandlers:[h,y,D,H,R,O,b,w,_,S]})],T),function(){(typeof ngJitMode>"u"||ngJitMode)&&l.\u0275\u0275setNgModuleScope(T,{imports:[M.CommonModule,g.CrtLibTranslateModule]})}()},8239:(P,A,c)=>{c.d(A,{Z:()=>M});function d(a,g,v,i,m,n,h){try{var l=a[n](h),p=l.value}catch(C){v(C);return}l.done?g(p):Promise.resolve(p).then(i,m)}function M(a){return function(){var g=this,v=arguments;return new Promise(function(i,m){var n=a.apply(g,v);function h(p){d(n,i,m,h,l,"next",p)}function l(p){d(n,i,m,h,l,"throw",p)}h(void 0)})}}}}]);
