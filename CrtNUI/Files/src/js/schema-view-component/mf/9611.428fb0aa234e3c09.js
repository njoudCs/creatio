(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[9611],{8446:(K,N,s)=>{s.d(N,{A:()=>A});var p=s(94450),c=s.n(p);const A=new p.InjectionToken("ROUTER_OUTLET_HISTORY_VIEW_LIMIT_TOKEN")},76698:(K,N,s)=>{s.d(N,{B:()=>D});var p=s(33177),c=s.n(p),A=s(49475),V=s.n(A),M=s(34617),C=s.n(M),L=s(97600),d=s.n(L),g=s(8446),u=s(1141),y=s(94450),R=s.n(y);class D{get lastTransition(){return this._lastTransition}get length(){return this._items.length}constructor(a,f,l){var _;this._window=a,this._featureValues=l,this._historyLimit=20,this._items=[],this._previous=-1,this._current=-1,f!==null&&(this._historyLimit=f),((_=this._window).__crtHistory??(_.__crtHistory=[])).push(this)}_assertIndexedState(a){if(!("historyIndex"in a)||isNaN(a.historyIndex))throw new Error("History state should have historyIndex.")}_enforceHistoryLimit(){for(let a=this._current+1;a<this._items.length;a++)this.destroy(a);for(let a=0;a<this._current-this._historyLimit;a++)this.destroy(a)}destroy(a){const f=this._items[a];f?.view&&(f.view.destroy(),f.view=null)}_hasChildrenState(a){const f=a.state;return!(0,L.isEmpty)(f.children)}_getRootViewForChildrenRouting(){let a=!0;const f=this._items[this._current].state;for(let l=this._current-1;l>=0;l--){const _=this._items[l];if((0,L.isEmpty)(_)||!a)return null;if((0,M.crtStatesEqual)(f,_.state)&&a&&!(0,L.isEmpty)(_?.view?.pageRef))return _.view;a=this._hasChildrenState(_)}return null}goTo(a){this._assertIndexedState(a),this._previous=this._current,this._current=a.historyIndex;const f=this._current<this._previous,l=f&&!this._items[this._current],_=this._current===this._previous,S=this._current>this._previous;this._lastTransition={isBack:f,isReplace:_,isPush:S},!(a.silent&&!a._internalNotSilentIn8x&&!f)&&(_&&this.destroy(this._previous),(l||_||S)&&(this._items[this._current]={state:a}),S&&this._items.splice(this._current+1),this._enforceHistoryLimit())}canRestoreView(){const f=this._getCurrentView()?.pageRef;return this._current<this._previous&&Boolean(f)}_getCurrentView(){const a=this._items[this._current],f=this._hasChildrenState(a);let l;return f&&(0,L.isEmpty)(a?.view?.pageRef)&&(l=this._getRootViewForChildrenRouting()),l?new u.f7(l.pageRef,a?.view?.modalRefs,l.schemaState,l.pageRefReusable,l.scrollPositions,this._featureValues):a?.view}getView(){if(!this.canRestoreView())throw new Error("Cannot restore view");return this._getCurrentView()}getViewByOffset(a){return this._items[this._current+a]?.view}validateBeforeStore(a){const f=this._items[this._current].view;if(f?.pageRef&&f?.pageRef!==a.pageRef)throw new Error("This history item already contain another view. If you want to change view, do replace history state first.")}storeView(a){this.validateBeforeStore(a),this._items[this._current].view=a}}D.\u0275fac=function(a){return new(a||D)(y.\u0275\u0275inject(p.WINDOW_TOKEN),y.\u0275\u0275inject(g.A,8),y.\u0275\u0275inject(A.FEATURE_VALUES))},D.\u0275prov=y.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac})},61437:(K,N,s)=>{s.d(N,{vq:()=>w,ex:()=>W});var p=s(27049);const c=1;class A{constructor(r,o){this._bindingContext=r,this._dataGridViewConfig=o}getViewModelItemsAttributeName(){const r=this._dataGridViewConfig.items;if(r&&typeof r=="string")return r.substring(c)}getViewModel(){return this._bindingContext.viewModel$.pipe((0,p.take)(1))}getDataSourceName(){return this.getViewModel().pipe((0,p.map)(r=>r.getBoundDataSourceName(this.getViewModelItemsAttributeName())))}}var V=s(41307),M=s(34038);const C="DisableCompiledCellView",L="EnableDataGridColumnEdit";function d(P){return P.getFeatureState(C).pipe((0,p.distinctUntilChanged)(),(0,p.map)(r=>!r))}const g={provide:M.USE_DATA_TABLE_COMPILED_CELLS_VIEW,useFactory:d,deps:[V.FeatureService]};var u=s(94450),y=s(14537);class R{resolve(r){return new A(r.get(y.BINDING_CONTEXT),r.get(y.VIEW_ELEMENT_CONFIG))}}R.\u0275fac=function(r){return new(r||R)},R.\u0275prov=u.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac,providedIn:"root"});var D=s(46338),O=s(21322);class a{constructor(r,o){this._featureService=r,this._rightsService=o}getFeatures(){return(0,O.forkJoin)([this._featureService.getFeatureState(D.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE),this._featureService.getFeatureState(L),this._rightsService.getCanExecuteOperation(D.CAN_CREATE_DEFAULT_GRID_SETTING_OPERATION_CODE)]).pipe((0,p.map)(([r,o,e])=>({rows:{toolbar:!0,numeration:!0,selection:{enable:!1,multiple:!1}},columns:{toolbar:!0,sorting:!0,resizing:!0,dragAndDrop:!0,editing:o,adding:!0},cells:{selection:!0},header:{visible:!0},operations:{canCreateDefaultGridSettings:e},editable:!r})))}}a.\u0275fac=function(r){return new(r||a)(u.\u0275\u0275inject(V.FeatureService),u.\u0275\u0275inject(V.RightsService))},a.\u0275prov=u.\u0275\u0275defineInjectable({token:a,factory:a.\u0275fac,providedIn:"root"});let f={};const l={provide:M.DATA_GRID_FEATURES,useFactory:()=>f};class _{constructor(r){this._dataGridFeaturesService=r}init(){return this._dataGridFeaturesService.getFeatures().pipe((0,p.tap)(r=>f=r),(0,p.map)(()=>{}))}}_.\u0275fac=function(r){return new(r||_)(u.\u0275\u0275inject(a))},_.\u0275prov=u.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac,providedIn:"root"});var S=s(8239),E=s(75378),T=s(77207),x=s(10801),j=s(96923),F=s(49475),b=s(52045),z=s(24709),U=s(97600);class W extends D.BaseDataGridStateHandlerService{constructor(r,o,e,t,i,n,h){super(r),this._schemaPartsService=o,this._maskService=e,this._translateService=t,this._cultureApiService=i,this._metadataModifierService=n,this._featureValues=h,this._dataGridRunTimeLocalizableTitleFeatureState=!1,this._dataGridDynamicDSLocalizableTitleFeatureState=!1,this._activeCultures=[],this.loadFeatures(),this.loadActiveCultures()}_updateDataSourceAttributes(r,o){const{columns:e,dataSourceName:t}=r;if(e.length===0)return;const i=e.filter(I=>I.columnType!=="tools").map(I=>I.code.split(`${t}_`).pop()),h=(0,U.uniq)(i).map(I=>{const v=e.find($=>$.code===`${t}_${I}`);if(!v)return;let B;v.aggregationConfig?.aggregationFunction&&(B=E.DataSchemaAttributeType.AggregationAttribute);const G=v.code.split(`${t}_`).pop(),H=v.path||G,Z=(0,U.cloneDeep)(v.aggregationConfig);return delete v.aggregationConfig,delete v.captionResources,delete v.originalCaption,delete v.captionResourcesChanged,{name:G,path:H,type:B,aggregationConfig:Z,caption:v.caption}}),m=o.getEntityDataSourceConfigService(t);m&&m.setAttributes(h).apply()}_updateViewItem(r,o,e){const{viewElementConfig:t,columns:i}=r,h=o.getViewConfigInfoByName(t.name).viewConfig;h.columns=i.map(m=>({...(0,U.omit)(m,"changed"),caption:this._getCaption(h.columns,e,m),code:(0,F.removeSpecialSymbols)(m.code)})),this._metadataModifierService.revert(h)}_getCaption(r,o,e){const t=r.find(n=>n.id===e.id),i=o.find(n=>n.id===e.id);if(!this._dataGridRunTimeLocalizableTitleFeatureState||!this._dataGridDynamicDSLocalizableTitleFeatureState)return i.caption;if(!i?.captionResources&&!i.changed)return t?.caption||i.caption;if(!i.captionResourcesChanged)return i.caption;if(this._featureValues?.DisableGridColumnCaptionMacroFix){const n=i.id.split("-")[0],m=`${this.injector.get(y.VIEW_ELEMENT_CONFIG).name}_${n}`;return"#ResourceString("+m+","+(0,F.removeSpecialSymbols)(i.code)+")#"}return"#ResourceString("+(0,F.removeSpecialSymbols)(i.code)+")#"}_updateViewModelAttributes(r,o){const{viewElementConfig:e,columns:t,dataSourceName:i}=r,h=e.items.toString().split("$").pop(),m=t.filter(v=>v.columnType!=="tools").map(v=>v.code).map(v=>(0,F.removeSpecialSymbols)(v)).map(v=>v.split(`${i}_`).pop());e.primaryColumnName&&m.push(e.primaryColumnName.split(`${i}_`).pop());const I=(0,U.uniq)(m);o.bindViewModelAttributeCollection(h,i,I,`${i}_`,x.ApplyChangedPropertyStrategy.Override)}_updateLocalizations(r,o){var e=this;return(0,S.Z)(function*(){const t={localizableStrings:{}},i=o.filter(m=>m.captionResourcesChanged),h=e.injector.get(y.VIEW_ELEMENT_CONFIG);i.forEach(m=>{let I=(0,F.removeSpecialSymbols)(m.code);if(e._featureValues?.DisableGridColumnCaptionMacroFix){const B=m.id.split("-")[0];I=`${h.name}_${B}`}const v=m?.captionResources;if(v&&v.length){if(m.aggregationConfig?.aggregationFunction===E.AggregationFunction.Count){const G=v.find(H=>H.cultureName===e._translateService.defaultLang);e._activeCultures.forEach(H=>{if(!v.find($=>$.cultureName===H)){const $=(0,U.clone)(G);$.cultureName=H,v.push($)}})}t.localizableStrings[I]={},v.forEach(G=>{t.localizableStrings[I][G.cultureName]=G.value===""?void 0:G.value})}}),i.length!==0&&(e._maskService.showBodyMask(),yield r?.upsertResources(t),e._maskService.hideBodyMask())})()}loadFeatures(){this._dataGridRunTimeLocalizableTitleFeatureState=this._featureValues.DataGridRunTimeLocalizableTitle,this._dataGridDynamicDSLocalizableTitleFeatureState=this._featureValues.DataGridDynamicDSLocalizableTitle}loadActiveCultures(){(0,O.lastValueFrom)(this._cultureApiService.getAllCultures(),{defaultValue:null}).then(r=>{this._activeCultures=r.filter(o=>o.isActive).map(o=>o.name)})}innerHandle(r){var o=this;const e=(0,U.cloneDeep)(r?.columns),t=r?.previousColumns,n=e?.length!==t?.length||e?.some(h=>h.changed);return(0,O.from)(this._schemaPartsService.apply(function(){var h=(0,S.Z)(function*([m,I]){o._updateDataSourceAttributes(r,m),o._updateViewModelAttributes(r,m),o._updateViewItem(r,m,e),n&&(yield o._updateLocalizations(I,e))});return function(m){return h.apply(this,arguments)}}())).pipe((0,p.switchMap)(()=>this._schemaPartsService.commit({silent:n===!1})),(0,p.map)(()=>{}))}handle(r,o){return super.handle({...r},o)}}W.\u0275fac=function(r){return new(r||W)(u.\u0275\u0275inject(b.SchemaService),u.\u0275\u0275inject(b.SchemaPartsService),u.\u0275\u0275inject(E.MaskService),u.\u0275\u0275inject(T.TranslateService),u.\u0275\u0275inject(j.CultureApiService),u.\u0275\u0275inject(z.MetadataModifierService),u.\u0275\u0275inject(F.FEATURE_VALUES))},W.\u0275prov=u.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac});var J=s(74742);function k(P){return()=>(0,O.lastValueFrom)(P.init(),{defaultValue:null})}let w=class{};w.\u0275fac=function(r){return new(r||w)},w.\u0275mod=u.\u0275\u0275defineNgModule({type:w}),w.\u0275inj=u.\u0275\u0275defineInjector({providers:[l,g,{provide:u.APP_INITIALIZER,useFactory:k,deps:[_],multi:!0}],imports:[D.CrtDataGridCdkModule,M.CrtDataGridToolbarModule]}),w=(0,J.__decorate)([(0,E.CrtModule)({includes:[D.CrtDataGridCdkModule]})],w),function(){(typeof ngJitMode>"u"||ngJitMode)&&u.\u0275\u0275setNgModuleScope(w,{imports:[D.CrtDataGridCdkModule],exports:[M.CrtDataGridToolbarModule]})}()},1141:(K,N,s)=>{s.d(N,{aK:()=>c,Hi:()=>p,HO:()=>L,TV:()=>C,pb:()=>M,f7:()=>A});class p{constructor(g){g&&(this.title=g.title,this.schemaName=g.schemaName)}}class c{}class A{constructor(g=null,u=new Map,y=g?.instance?.schemaState,R=!1,D=g?.instance?.scrollPositions,O={}){this.pageRef=g,this.modalRefs=u,this.schemaState=y,this.pageRefReusable=R,this.scrollPositions=D,this._featureValues=O,this.isDestroyed=!1}_destroyModalViews(){const g=this?.modalRefs;g?.size&&(Array.from(g.values()).forEach(u=>u.close()),this.modalRefs.clear())}destroy(){if(this._destroyModalViews(),this.pageRefReusable){const g=this.schemaState?.viewModel._injectionContext.id;this.pageRef?.instance?.schemaComponent?.invalidateInstance(g),this.schemaState.viewModel.destroy(),this.schemaState=null}else this.pageRef?.instance?.schemaComponent?.schemaState?.viewModel?.destroy(),this.pageRef?.destroy(),this.pageRef?.hostView?.destroy(),this.pageRef=null;this.isDestroyed=!0}get viewModel(){return this._featureValues?.UseSchemaOutletReuseViewStrategy?this?.schemaState?.viewModel:this?.pageRef?.instance?.schemaState?.viewModel}}var V=s(94450),M;(function(d){d.LookupValues="lookupValues",d.Filter="filter"})(M||(M={}));const C=M.LookupValues,L=new V.InjectionToken("PageLookupDataToken")},25644:(K,N,s)=>{s.d(N,{jZ:()=>W,SX:()=>u,j_:()=>S,b:()=>F,zi:()=>_,jW:()=>T,mJ:()=>E,dO:()=>z,am:()=>J.a,Gm:()=>g,F$:()=>k.F,Lu:()=>k.L,Q1:()=>j,N1:()=>y,FL:()=>O,Wn:()=>r});var p=s(2876),c=s(94450),A=s(75378),V=s(77207),M=s(49475),C=s(97600),L=s.n(C),d=s(21322),g;(function(o){o[o.AddRelatedRecords=0]="AddRelatedRecords",o[o.RemoveRelatedRecords=1]="RemoveRelatedRecords"})(g||(g={}));class u{constructor(){this._translateService=(0,c.inject)(V.TranslateService),this._httpClient=(0,c.inject)(p.HttpClient),this._userInfo=(0,c.inject)(M.UserInfo)}get _relatedInMainRecordsServiceEndpoint(){return(this._userInfo.isSSP?"ssp/":"")+`rest/${this.relatedInMainRecordsServiceName}/`}_isInvalidParameters(e){return(0,C.isEmpty)(e.relatedRecordsSchemaName)||(0,C.isEmpty)(e.relatedInMainRecordsSchemaName)||(0,C.isEmpty)(e.relatedRecordColumnName)||(0,C.isEmpty)(e.mainRecordColumnName)||!this._isValidFilters(e.relatedRecordsFilters)||!this._isValidFilters(e.mainRecordsFilters)}_isValidFilters(e){return(0,C.isObject)(e)&&"items"in e&&!(0,C.isEmpty)(e.items)}_catchHttpErrorResponse(e){return(0,d.of)({success:!1,message:e.error?.errorInfo?.message??e.message})}_createEsqWithFilters(e,t){const i=new A.EntitySchemaQuery(e);return this._addFiltersToEsq(i,t),i}_addFiltersToEsq(e,t){Object.entries(t.items).forEach(([i,n])=>{e.filters.add(n,i)})}getServiceResultMessage(e,t,i){if(e.success){const n=this.relatedRecordsActionsNames.get(t);return this._translateService.instant(`${this.relatedInMainRecordsServiceName}.ServiceResult.${n}${i}`,{count:(0,C.get)(e,"processedRecordsCount",null)})}return e.errorInfo?.message||this._translateService.instant("BaseRelatedInMainRecordsService.ServiceResult.ErrorMessage")}executeAction(e,t){return this._isInvalidParameters(t)?(0,d.of)({success:!1,message:this._translateService.instant("BaseRelatedInMainRecordsService.NotValidParametersMessage")}):this.process(e,t)}process(e,t){const i=this.createRelatedRecordsEsq(t),n=this.createMainRecordsEsq(t),h=this.createRequest(i,n,t);return this.callService(e,h,t)}createRelatedRecordsEsq(e){return this._createEsqWithFilters(e.relatedRecordsSchemaName,e.relatedRecordsFilters)}createMainRecordsEsq(e){return this._createEsqWithFilters(e.mainRecordsSchemaName,e.mainRecordsFilters)}callService(e,t,i){const n=this.relatedRecordsActionsNames.get(e);return this._httpClient.post(`${this._relatedInMainRecordsServiceEndpoint}${n}`,{request:t}).pipe((0,d.map)(h=>({success:h.success,message:this.getServiceResultMessage(h,e,"Message")})),(0,d.catchError)(h=>this._catchHttpErrorResponse(h)))}addRelatedRecords(e){return this.executeAction(g.AddRelatedRecords,e)}removeRelatedRecords(e){return this.executeAction(g.RemoveRelatedRecords,e)}}class y extends u{constructor(){super(...arguments),this.relatedInMainRecordsServiceName="StaticFolderService",this.relatedRecordsActionsNames=new Map([[g.AddRelatedRecords,"AddRecords"],[g.RemoveRelatedRecords,"RemoveRecords"]])}createRequest(e,t,i){return{recordsEsqSerialized:JSON.stringify(e.getMetadata()),foldersEsqSerialized:JSON.stringify(t.getMetadata()),recordInFolderRecordsSchemaName:i.relatedInMainRecordsSchemaName,recordColumnName:i.relatedRecordColumnName,folderColumnName:i.mainRecordColumnName,defaultValues:i.defaultValues?JSON.stringify(i.defaultValues):null}}}y.\u0275fac=function(){let o;return function(t){return(o||(o=c.\u0275\u0275getInheritedFactory(y)))(t||y)}}(),y.\u0275prov=c.\u0275\u0275defineInjectable({token:y,factory:y.\u0275fac});var R=s(41307),D=s(6523);class O extends u{constructor(){super(...arguments),this._featureValues=(0,c.inject)(M.FEATURE_VALUES),this._processEngineService=(0,c.inject)(R.ProcessEngineService),this._queryExecutor=(0,c.inject)(D.QueryExecutor),this._disableAsyncTaggingFeatureName="DisableAsyncTagging",this._taggingProcessName="TaggingProcess",this._syncRequestMaxRecordsCount=200,this.relatedInMainRecordsServiceName="TaggingService",this.relatedRecordsActionsNames=new Map([[g.AddRelatedRecords,"AddTags"],[g.RemoveRelatedRecords,"RemoveTags"]])}_isDisabledAsyncTagging(){return!!this._featureValues[this._disableAsyncTaggingFeatureName]}_callProcess(e,t){const i=this._createProcessParameters(e,t);return this._processEngineService.executeProcessByName(this._taggingProcessName,i).pipe((0,d.map)(n=>({success:n.success,message:super.getServiceResultMessage(n,e,"SuccessfulRunProcess")})))}_createProcessParameters(e,t){return{TaggingAction:this.relatedRecordsActionsNames.get(e),RecordsEsqSerialized:t.recordsEsqSerialized,TagsEsqSerialized:t.tagsEsqSerialized,TagInRecordSchemaName:t.tagInRecordSchemaName,RecordColumnName:t.recordColumnName,TagColumnName:t.tagColumnName,DefaultValues:t.defaultValues}}_getRecordsCount(e){const t=this.createRelatedRecordsEsq(e);this._addRowCountToEsq(t);const i=this.createMainRecordsEsq(e);return this._addRowCountToEsq(i),(0,d.forkJoin)([this._getEsqRecordsCount(t),this._getEsqRecordsCount(i)]).pipe((0,d.map)(([n,h])=>n*h))}_addRowCountToEsq(e){e.rowCount=this._syncRequestMaxRecordsCount+1}_getEsqRecordsCount(e){return this._queryExecutor.executeSelectQuery(e).pipe((0,d.map)(t=>t.length))}_isNeedCallService(e){return this._isDisabledAsyncTagging()?(0,d.of)(!0):this._getRecordsCount(e).pipe((0,d.map)(t=>t<=this._syncRequestMaxRecordsCount))}createRequest(e,t,i){return{recordsEsqSerialized:JSON.stringify(e.getMetadata()),tagsEsqSerialized:JSON.stringify(t.getMetadata()),tagInRecordSchemaName:i.relatedInMainRecordsSchemaName,recordColumnName:i.relatedRecordColumnName,tagColumnName:i.mainRecordColumnName,defaultValues:i.defaultValues?JSON.stringify(i.defaultValues):null}}callService(e,t,i){return this._isNeedCallService(i).pipe((0,d.switchMap)(n=>n?super.callService(e,t,i):this._callProcess(e,t)))}}O.\u0275fac=function(){let o;return function(t){return(o||(o=c.\u0275\u0275getInheritedFactory(O)))(t||O)}}(),O.\u0275prov=c.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac});var a=s(8239),f=s(27049),l=s(1141);const _="Desktop",S="CrtCurrentDesktop";class E{constructor(e,t,i,n){this._queryExecutor=e,this._sysSettingsService=t,this._rightsService=i,this._userProfileService=n,this._canEditDesktopOperationName="CanManageSolution",this._currentDesktopSchemaNameInitialized=!1,this._canEditDesktopSchemaInitialized=!1,this._canEditDesktopSchema=!1}_convertToDesktops(e,t){const i=t.get("schemaName"),n=t.get("title");return e.map(h=>new l.Hi({schemaName:h[i],title:h[n]}))}_requestDesktopSysSetting(){return(0,d.lastValueFrom)(this._sysSettingsService.getValueByCode(S,""))}_requestDesktopProfileSettings(){return(0,d.lastValueFrom)(this._userProfileService.getProfile(S))}getCurrentDesktopSchemaName(){var e=this;return(0,a.Z)(function*(){if(!e._currentDesktopSchemaNameInitialized){let t=yield e._requestDesktopProfileSettings();(0,C.isEmpty)(t)&&(t=yield e._requestDesktopSysSetting()),e._currentDesktopSchemaName=t,e._currentDesktopSchemaNameInitialized=!0}return e._currentDesktopSchemaName})()}getUserDesktops(){const e=new Map([["schemaName","DesktopSchemaName"],["title","Title"]]),t=new A.EntitySchemaQuery(_);return t.addSchemaColumn(e.get("schemaName")),t.addSchemaColumn(e.get("title")),(0,d.firstValueFrom)(this._queryExecutor.executeSelectQuery(t).pipe((0,d.map)(i=>this._convertToDesktops(i,e))))}setCurrentDesktop(e){var t=this;return(0,a.Z)(function*(){const i=e?e.schemaName:null;t._currentDesktopSchemaName=i,yield(0,d.firstValueFrom)(t._userProfileService.saveProfile(S,i))})()}canEditDesktop(){return this._canEditDesktopSchemaInitialized?Promise.resolve(this._canEditDesktopSchema):(0,d.lastValueFrom)(this._rightsService.getCanExecuteOperation(this._canEditDesktopOperationName).pipe((0,f.tap)(e=>{this._canEditDesktopSchema=e,this._canEditDesktopSchemaInitialized=!0})))}}E.\u0275fac=function(e){return new(e||E)(c.\u0275\u0275inject(D.QueryExecutor),c.\u0275\u0275inject(R.SysSettingsService),c.\u0275\u0275inject(R.RightsService),c.\u0275\u0275inject(R.UserProfileService))},E.\u0275prov=c.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"});class T{constructor(){this._repository=new Map}set(e,t){this._repository.set(e,t)}get(e){return this._repository.get(e)}getAll(){return Array.from(this._repository.values())}}T.\u0275fac=function(e){return new(e||T)},T.\u0275prov=c.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac,providedIn:"root"});var x=s(24709);class j extends x.DataSourceFactoryService{constructor(e,t,i){super(t,i),this._dataSourceRepository=e}create(e,t,i){return super.create(e,t,i).pipe((0,f.tap)(n=>{this._dataSourceRepository.set(e,n)}))}}j.\u0275fac=function(e){return new(e||j)(c.\u0275\u0275inject(T),c.\u0275\u0275inject(c.Injector),c.\u0275\u0275inject(x.DataSourceTypeResolver))},j.\u0275prov=c.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac});class F{constructor(e){this._configurationDataService=e}getConfigurationStructure(){return this._configurationDataService.getData(!0).pipe((0,d.map)(e=>{if(!e.success)throw new Error(e.errorInfo.message);return e.data}))}}F.\u0275fac=function(e){return new(e||F)(c.\u0275\u0275inject(R.ConfigurationDataService))},F.\u0275prov=c.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac,providedIn:"any"});var b=s(8785);class z{constructor(e,t){this._translateService=e,this._sysSettingsService=t}_getMaxFileSizeExceededExceptionCode(){return"MaxFileSizeExceededException"}_getIsOversizedErrorExist(e){return e&&e.some(t=>t.error===this._getMaxFileSizeExceededExceptionCode())}_getOversizeErrorTipMessage(e){const t=this._getIsOversizedErrorExist(e),i=`{0}\r
\r
`;return t?b.String.format(i,this._translateService.instant("InfoDialog.FileUpload.ChangeFileSizeInfoMessage")):b.String.empty}_getFormattedFilesNames(e){return e.map(t=>"- "+t.file.name).join(`\r
`)}_getOversizedFilesLogs(e,t){const i=b.String.format(this._translateService.instant("InfoDialog.FileUpload.MaxFileSizeExceededExceptionMessage"),t);return e.map(n=>(0,M.createFileErrorLogItem)(n,this._getMaxFileSizeExceededExceptionCode(),i))}createFileErrorMessageForLogs(e){e=e.reverse();const t=`\r
\r
`,i=this._translateService.instant("InfoDialog.FileUpload.FileListHeader"),n="{0}"+t+i+`:\r
{1}`,h=L().groupBy(e,"message");let m="";for(const[I,v]of Object.entries(h)){const B=this._getFormattedFilesNames(v);m+=b.String.format(n,I,B),m+=t}return m+=this._getOversizeErrorTipMessage(e),m.slice(0,m.length-t.length)}processSelectedFiles(e,t){var i=this;return(0,a.Z)(function*(){const n=[...e],m=(yield(0,d.lastValueFrom)(i._sysSettingsService.getByCode("MaxFileSize")))?.value||0,{allowed:I,oversized:v,maxFileSizeMB:B}=(0,M.separateFilesBySize)(n,m,t);return{files:I,errors:i._getOversizedFilesLogs(v,B)}})()}}z.\u0275fac=function(e){return new(e||z)(c.\u0275\u0275inject(V.TranslateService),c.\u0275\u0275inject(R.SysSettingsService))},z.\u0275prov=c.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac,providedIn:"root"});var U=s(34617);class W{getDefaultAppearanceSettings(e){return(0,d.from)(U.NavigationUtils.isMiniPage(e)).pipe((0,d.map)(t=>({modalSettings:{size:t?M.ModalSize.Small:M.ModalSize.ExtraLarge}})))}}var J=s(82515),k=s(44507),w=s(33177),P=s(76698);class r extends x.ViewModelDataDelayer{constructor(e,t,i,n){super(),this._crtRouter=e,this._routerOutletHistory=t,this._featureValues=i,this._window=n,this._disableDelayingModelEventsFeatureName="DisableDelayingModelEvents",this._disableDelayingModelsEventFeatureState=!1,this._disableOffsetForDelayingModelEventsFeatureName="DisableOffsetForDelayingModelEvents",this._disableOffsetForDelayingModelEventsFeatureState=!1,this._defaultViewLoadingOffset=-1,this._subscriptions=new d.Subscription,this._loadTriggerSubject=new d.Subject,this.loadTrigger$=this._loadTriggerSubject.asObservable(),this._isAngularHost=(0,C.get)(this._window,"Terrasoft")?.isAngularHost,this._isAngularHost&&(this._initFeatureStates(),this._disableDelayingModelsEventFeatureState||this._subscribeOnNavigation())}setViewModel(e){this._viewModel||(this._viewModel=e)}_initFeatureStates(){this._disableDelayingModelsEventFeatureState=this._featureValues[this._disableDelayingModelEventsFeatureName]??!1,this._disableDelayingModelsEventFeatureState||(this._disableOffsetForDelayingModelEventsFeatureState=this._featureValues[this._disableOffsetForDelayingModelEventsFeatureName]??!1),this._viewLoadingOffset=this._disableOffsetForDelayingModelEventsFeatureState?0:this._defaultViewLoadingOffset}_shouldLoadForModals(e,t){return e&&e.modalRefs?Array.from(e.modalRefs.values()).some(i=>i?.componentInstance?.page?.schemaState?.viewModel===t):!1}_shouldLoadForPage(e,t){return e?.viewModel===t}_getViews(){const e=[];if(this._viewLoadingOffset===0)return e.push(this._routerOutletHistory.getViewByOffset(this._viewLoadingOffset)),e;for(let t=this._viewLoadingOffset;t<0;t++)e.push(this._routerOutletHistory.getViewByOffset(t));return e}_shouldLoadForViews(){const e=(0,x.getRootViewModel)(this._viewModel);return this._getViews().some(i=>{const n=this._shouldLoadForPage(i,e),h=this._shouldLoadForModals(i,e);return n||h})}_shouldLoad(){return this?._routerOutletHistory?this._shouldLoadForViews():!1}_subscribeOnNavigation(){this._subscriptions.add(this._crtRouter?.navigateEnd$.subscribe(()=>{this._shouldLoad()&&this._loadTriggerSubject.next()}))}shouldBeDelayed(){return!this._isAngularHost||this._disableDelayingModelsEventFeatureState?!1:this._viewModel.State===x.ViewModelStates.Paused&&!this._shouldLoad()}setState(e,t){this._disableDelayingModelsEventFeatureState||e._setStateAttribute(t)}ngOnDestroy(){this._subscriptions.unsubscribe(),this._loadTriggerSubject.complete()}}r.\u0275fac=function(e){return new(e||r)(c.\u0275\u0275inject(U.CrtRouter,8),c.\u0275\u0275inject(P.B,8),c.\u0275\u0275inject(M.FEATURE_VALUES),c.\u0275\u0275inject(w.WINDOW_TOKEN))},r.\u0275prov=c.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac})},82515:(K,N,s)=>{s.d(N,{a:()=>d});var p=s(41307),c=s.n(p),A=s(52045),V=s.n(A),M=s(1141),C=s(94450),L=s.n(C);class d extends A.ProfileSchemaProvider{constructor(u,y){super(u),this._data=y}getProfileKey(u){return super.getProfileKey(u)+"__"+this._data.entitySchemaName}}d.\u0275fac=function(u){return new(u||d)(C.\u0275\u0275inject(p.UserSchemaProfileService),C.\u0275\u0275inject(M.HO))},d.\u0275prov=C.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac})},44507:(K,N,s)=>{s.d(N,{F:()=>O,L:()=>a});var p=s(8239),c=s(94450),A=s.n(c),V=s(34038),M=s.n(V),C=s(49475),L=s.n(C),d=s(24709),g=s.n(d),u=s(21322),y=s.n(u),R=s(27049),D=s.n(R);const O=new c.InjectionToken("SCHEMA_MODAL_COMPONENT_TYPE");class a{constructor(l,_,S){this._modalProviderService=l,this._appearanceSettingsService=_,this._schemaModalComponentType=S,this._createdModalsMap=new Map,this._modalCreated=new u.Subject,this._modalClosed=new u.Subject,this.modalCreated$=this._modalCreated.asObservable(),this.modalClosed$=this._modalClosed.asObservable()}_getDialogConfig(l){var _=this;return(0,p.Z)(function*(){const S=yield _._appearanceSettingsService.getSchemaModalClasses(l);return{panelClass:["modal-container",...S],maxWidth:0,maxHeight:"90vh",closeOnNavigation:!1}})()}_onModalClose(l){this._createdModalsMap.delete(l),this._modalClosed.next(l)}_onModalCreate(l){this._createdModalsMap.set(l.id,l),this._modalCreated.next(l),l.beforeClosed().pipe((0,R.take)(1)).subscribe(()=>this._onModalClose(l.id))}hideModals(l){const _=this._createdModalsMap;for(const S of l){const E=_.get(S);E&&(this._modalProviderService.hideModal(E),E.componentInstance.schemaOutletComponent.instance.componentRef.instance.onDetach(),E.componentInstance.detachContent())}}closeModals(){const l=this._createdModalsMap;for(const _ of Array.from(l.keys())){const S=l.get(_);S&&S.close()}}restoreModals(l){const _=this._createdModalsMap;for(const S of l){const E=_.get(S);if(E){this._modalProviderService.restoreModal(E);const T=E.componentInstance.schemaOutletComponent.instance;E.componentInstance.attachContent(),T.componentRef.instance.onAttach()}}}show(l,_){var S=this;return(0,p.Z)(function*(){const E=yield S._getDialogConfig(l.schemaName);E.injector=_?.injector;const T=S._modalProviderService.open(S._schemaModalComponentType,{data:l,...E});return T.keydownEvents().pipe((0,R.filter)(()=>T.componentInstance.visible),(0,R.switchMap)(x=>{const F=T.componentInstance.page.schemaState.viewModel,b=new d.HandleKeyboardHotkeysRequest(x,F);return F.executeRequest(b)})).subscribe(),T.disableClose=!0,S._onModalCreate(T),T})()}}a.\u0275fac=function(l){return new(l||a)(c.\u0275\u0275inject(V.ModalProvider),c.\u0275\u0275inject(C.AppearanceSettingsService),c.\u0275\u0275inject(O))},a.\u0275prov=c.\u0275\u0275defineInjectable({token:a,factory:a.\u0275fac,providedIn:"root"})}}]);
