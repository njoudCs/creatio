(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[2009],{62009:(Te,Or,C)=>{C.r(Or),C.d(Or,{AppearanceSettingsDefaultLoaderService:()=>E.jZ,BASE_PAGE_COMPONENT_PROVIDERS:()=>W,BasePageComponent:()=>L,BaseRelatedInMainRecordsService:()=>E.SX,CARD_STATE_ATTRIBUTE_NAME:()=>H,CHILDREN_OUTLET_TOKEN:()=>Zr,CLOSE_PAGE_COMMAND:()=>Re,CURRENT_DESKTOP_OPTION_NAME:()=>E.j_,CardComponent:()=>te,ChildOutlet:()=>A.aK,ChildrenRouterOutletDirective:()=>oe,ConfigurationStructureService:()=>E.b,CreateNewLookupPagePreprocessor:()=>ie,Crt7XRequest:()=>Tt,Crt7xModuleComponent:()=>V,Crt7xSchemaComponent:()=>$,CrtRouterOutletComponent:()=>j,CrtSchemaOutletComponent:()=>k,DATA_GRID_IS_MULTI_SELECTION_MODE_ATTRIBUTE_NAME:()=>Ie,DESKTOP_ENTITY_SCHEMA_NAME:()=>E.zi,DataGridSelectionStateLookupPagePreprocessor:()=>le,DataSourceRepositoryService:()=>E.jW,DataSourcesLookupPagePreprocessor:()=>ce,DataSourcesOldTagMiniPagePreprocessor:()=>ue,Desktop:()=>A.Hi,DesktopPageComponent:()=>re,DesktopService:()=>E.mJ,FileUploadProcessingService:()=>E.dO,HEADER_CAPTION_ATTRIBUTE_NAME:()=>ee,HomePageComponent:()=>J,InitSearchFilterLookupPagePreprocessor:()=>de,LookupPageProfileSchemaProvider:()=>E.am,ModalOutletService:()=>Se,NAVIGATION_PREPROCESSOR_PROVIDERS:()=>$e,OLD_TAG_MINI_PAGE_DATA_TOKEN:()=>Me,PAGE_LOOKUP_CREATED_RECORD_ATTRIBUTE_NAME:()=>Ae,PAGE_LOOKUP_DATA_GRID_NAME:()=>Z,PAGE_LOOKUP_DATA_SOURCE_NAME:()=>ve,PAGE_LOOKUP_DATA_TOKEN:()=>A.HO,PAGE_LOOKUP_IS_CREATE_ALLOWED_ATTRIBUTE_NAME:()=>Pe,PAGE_LOOKUP_IS_MULTI_SELECTION_MODE_PART_ATTRIBUTE_NAME:()=>Ur,PAGE_LOOKUP_RESULT_TYPE_DEFAULT_VALUE:()=>A.TV,PAGE_LOOKUP_SEARCH_FILTER_FILTERED_COLUMN_GROUPS:()=>Lr,PAGE_LOOKUP_SEARCH_FILTER_VALUE:()=>Br,PageComponent:()=>X,PageLookupResultType:()=>A.pb,ROUTER_OUTLET_HISTORY_VIEW_LIMIT_TOKEN:()=>Qa.A,RelatedRecordsActionsEnum:()=>E.Gm,RouterOutletHistory:()=>Ne.B,RunBusinessProcessRequestPreprocessor:()=>pe,SCHEMA_MODAL_COMPONENT_TYPE:()=>E.F$,SCHEMA_VIEW_MASK_TOKEN:()=>je,SchemaModalComponent:()=>ne,SchemaModalService:()=>E.Lu,SchemaOutletComponentResolverService:()=>Y,SchemaOutletPreprocessor:()=>se,SchemaViewDataSourceFactoryService:()=>E.Q1,SchemaViewModule:()=>K,SectionComponent:()=>Q,ShellHomePagePreprocessor:()=>he,StaticFolderService:()=>E.N1,TaggingService:()=>E.FL,TypeFilterOldTagMiniPagePreprocessor:()=>me,ViewModelDataDelayerService:()=>E.Wn,ViewState:()=>A.f7});var l=C(74742),N=C(31134),Ge=C(2876),De=C(34560),Vr=C(71006),i=C(75378),w=C(77207),va=C(99965),x=C(99293),Fr=C(18369),I=C(33177),y=C(41307),Ce=C(6523),O=C(96923),g=C(34038),z=C(46338),F=C(97055),U=C(14537),b=C(78094),h=C(49475),Hr=C(16464),S=C(24709),R=C(97600),s=C(94450),p=C(21322);const ya=["schemaComponent"],W=[U.ViewEventsNotifier,{provide:h.ALLOW_PAGE_DESIGN,useValue:!0}];class L{get hidden(){return this._hidden}set hidden(e){this._hidden=e,this._display=e?"none":""}get pageToolsVisible(){return!this.hidden}constructor(e,t,r,a){this.injector=e,this.googleTagManager=t,this.ngZone=r,this._sysSettingsService=a,this._viewEventsNotifier=(0,s.inject)(U.ViewEventsNotifier),this._display="",this._hidden=!1,this.isBackgroundEffectRequired=!0,this._init$=new p.ReplaySubject(1),this._subscription=new p.Subscription,this._isComponentDetached=!1,this._isComponentAttached=!1,this._addFlexFullHeightToHost=!0,this._isDisableWindowUnloadWatcher=!1,this._useNewShellSettingValue=!1,this._useScrollPositionService=!1,this.handlerChain=i.HandlerChainService.instance,this.destroyed$=new p.Subject,this.schemaStateGenerated=new s.EventEmitter,this.parametersChange=new s.EventEmitter,this.schemaExceptionThrown=new s.EventEmitter,this.schemaState=null,this.modelInitConfigs=null,this.parameters=null,(0,p.forkJoin)([this._sysSettingsService.getByCode("UseNewShell"),this.googleTagManager.initialize()]).subscribe(([o])=>{this._useNewShellSettingValue=o.value,this._init$.next()}),this._useScrollPositionService=this.injector.get(h.USE_SAVE_SCROLL_POSITION_SERVICE,!1),this.window=this.injector.get(I.WINDOW_TOKEN),this._setFeatures()}set schema(e){this._schemaName=e}get schema(){return this._schemaName}get backgroundEffectRequirement(){return this.isBackgroundEffectRequired}get scrollPositions(){return this._saveScrollPositionService?.scrollPositions}set scrollPositions(e){this._saveScrollPositionService&&(this._saveScrollPositionService.scrollPositions=e)}_sendGTMData(e){const t={moduleName:this.gtmModuleName,schemaName:this.schema,primaryData:e,useNewShell:this._useNewShellSettingValue};this.googleTagManager.track(t)}_processRequest(e,t){return this.ngZone.runOutsideAngular(()=>this.sendRequest({...e,scopes:t._scopes,$context:t}))}_getPrimaryDataSourceSchemaNameFromSchemaState(e){let t="";const r=e.models?.find(a=>a.getDataSource().dataSourceName==="PDS");return r&&(t=r?.dataSchemaName),t||(t=e.models[0]?.dataSchemaName),t}_setFeatures(){this.featureValues=this.injector.get(h.FEATURE_VALUES),this._isDisableWindowUnloadWatcher=this.featureValues.DisableWindowUnloadWatcher,this.isPageReusable=this.featureValues.UseSchemaOutletReuseViewStrategy&&(0,R.get)(this.window,["Terrasoft","isAngularHost"])}_trackGTM(){const e=this._getPrimaryDataSourceSchemaNameFromSchemaState(this.schemaState);this._init$.subscribe({next:()=>this._sendGTMData(e)})}sendRequest(e){return this.handlerChain.process(e)}onDetach(){this._isComponentDetached=!0,this._useScrollPositionService&&this._saveScrollPositionService?.stopScrollTracking();const e=this.schemaState?.viewModel;e&&this._isComponentAttached&&this._processRequest(new S.HandleViewModelPauseRequest,e).then(()=>{this._isComponentAttached=!1}),this._viewEventsNotifier.viewAttached$.next(!1)}onAttach(){this._isComponentDetached=!1;let e;this.schemaState?e=(0,p.of)(this.schemaState.viewModel):e=this.schemaStateGenerated.pipe((0,p.take)(1),(0,p.map)(r=>r.viewModel));const t=e.pipe((0,p.observeOn)(p.animationFrameScheduler),(0,p.switchMap)(r=>!this._isComponentDetached&&r?(this._viewEventsNotifier.viewAttached$.next(!0),this._useScrollPositionService&&(this._saveScrollPositionService?.restoreScrollPosition(),this._saveScrollPositionService?.startScrollTracking()),this._processRequest(new S.HandleViewModelResumeRequest,r)):(0,p.of)(null)),(0,p.tap)(()=>this._isComponentAttached=!0),(0,p.map)(()=>null),(0,p.shareReplay)({refCount:!1,bufferSize:1}),(0,p.takeUntil)(this.destroyed$));return t.subscribe(),t}ngOnInit(){globalThis.Terrasoft&&!globalThis.Terrasoft.isAngularHost&&this.onAttach()}ngOnDestroy(){globalThis.Terrasoft&&!globalThis.Terrasoft.isAngularHost&&this.onDetach(),this._init$.complete(),this._subscription.unsubscribe(),this.destroyed$?.next(),this.destroyed$?.complete()}onSchemaStateGenerated(e){this.schemaState=e,this.schemaStateGenerated.next(e),this._trackGTM()}onParametersChange(e){this.parametersChange.emit(e)}onSchemaExceptionThrown(e){this.schemaExceptionThrown.emit(e)}onBeforeUnload(){return Terrasoft.SessionEndUserNotification?.sessionExpired||this._isComponentDetached||this._isDisableWindowUnloadWatcher?!0:!this.schemaState?.viewModel?._isChanged}}L.\u0275fac=function(e){return new(e||L)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(y.GoogleTagManagerService),s.\u0275\u0275directiveInject(s.NgZone),s.\u0275\u0275directiveInject(y.SysSettingsService))},L.\u0275dir=s.\u0275\u0275defineDirective({type:L,selectors:[["","crtBasePage",""]],viewQuery:function(e,t){if(e&1&&(s.\u0275\u0275viewQuery(h.SaveScrollPositionDirective,5,h.SaveScrollPositionService),s.\u0275\u0275viewQuery(ya,5)),e&2){let r;s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(t._saveScrollPositionService=r.first),s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(t.schemaComponent=r.first)}},hostVars:5,hostBindings:function(e,t){e&1&&s.\u0275\u0275listener("beforeunload",function(){return t.onBeforeUnload()},!1,s.\u0275\u0275resolveWindow),e&2&&(s.\u0275\u0275attribute("data-item-marker",t.dataItemMarker),s.\u0275\u0275styleProp("display",t._display),s.\u0275\u0275classProp("flex-full-height",t._addFlexFullHeightToHost))},inputs:{schemaState:"schemaState",modelInitConfigs:"modelInitConfigs",parameters:"parameters",schema:"schema",features:"features"},outputs:{schemaStateGenerated:"schemaStateGenerated",parametersChange:"parametersChange",schemaExceptionThrown:"schemaExceptionThrown"},features:[s.\u0275\u0275ProvidersFeature([W])]});var M=C(27049);const ee="HeaderCaption",H="CardState",$e=[S.MetadataPreprocessorService,{provide:S.CRT_METADATA_PREPROCESSOR,useFactory:(n,e)=>[...n,...e],deps:[[new s.SkipSelf,new s.Optional,S.CRT_METADATA_PREPROCESSOR],[new s.SkipSelf,new s.Optional,S.CRT_METADATA_NAVIGATION_PREPROCESSOR]]}],ve="MainDS",Z="DataGridMain",Br="SearchFilterMainSearchValue",Lr="SearchFilterMain_FilteredColumnsGroups",Pe="IsCreateAllowed",Ae="CreatedRecord",Ur="_IsMultiselectionMode",Ie=`${Z}${Ur}`,Gr=new s.InjectionToken("Listen 7x custom events token");function Ra(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-button",2),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(t);const a=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(a.onDesignButtonClicked())}),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275elementEnd()}n&2&&s.\u0275\u0275property("iconSize","medium")("iconPosition","only-icon")("size","medium")("title",s.\u0275\u0275pipeBind1(1,4,"BasePage.DesignButtonHint"))}function Ea(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-button",3),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(t);const a=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(a.onExpandButtonClicked())}),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275elementEnd()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("icon",t.expandButtonIcon)("iconSize","medium")("iconPosition","only-icon")("size","medium")("title",s.\u0275\u0275pipeBind1(1,5,t.expandButtonTitle)+" (Ctrl+Shift+F)")}}class G{constructor(e){this.injector=e,this._rightsService=this.injector.get(y.RightsService),this._storageService=this.injector.get(h.StorageService),this._featureValues=this.injector.get(h.FEATURE_VALUES),this._window=this.injector.get(I.WINDOW_TOKEN),this._document=this.injector.get(N.DOCUMENT),this._allowPageDesign=this.injector.get(h.ALLOW_PAGE_DESIGN,!1),this._expandAttributeName="center-container-expanded",this._storageExpandedKey="isCenterContainerExpanded",this._features$=new p.ReplaySubject(1),this.expandButtonIcon="expand-icon",this.designButtonVisible=!1,this.expandButtonVisible=!1,this._expandButtonState=this._loadExpandedFromStorage()}set schema(e){this._schemaName=e,this._updateToolsButtonVisibility(),this._updateExpandButtonInfo()}get schema(){return this._schemaName}set features(e){this._features$.next(e)}set _expandButtonState(e){this._document.body.setAttribute(this._expandAttributeName,String(e)),this._saveExpandedToStorage(e)}get _expandButtonState(){return this._document.body.getAttribute(this._expandAttributeName)==="true"}_saveExpandedToStorage(e){this._storageService.set(this._storageExpandedKey,String(e))}_loadExpandedFromStorage(){return this._storageService.get(this._storageExpandedKey)==="true"}_updateExpandButtonInfo(){const e=this._expandButtonState;this._setExpandButtonInfo(e)}_updateToolsButtonVisibility(){this._updateDesignButtonVisibility(),this._updateExpandButtonVisibility()}_updateDesignButtonVisibility(){if(!this._allowPageDesign){this.designButtonVisible=!1;return}(0,p.combineLatest)([this._features$,this._rightsService.getCanExecuteOperation("CanManageSolution")]).subscribe(([e,t])=>{this.designButtonVisible=e?.tools?.canDesign&&t})}_updateExpandButtonVisibility(){if(this._featureValues.DisableCenterContainerExpandButtonFeature){this.expandButtonVisible=!1;return}this._features$.subscribe(e=>{this.expandButtonVisible=e?.tools?.canExpand})}_setExpandButtonInfo(e){this.expandButtonIcon=e?"collapse-icon":"expand-icon",this.expandButtonTitle=e?"BasePage.CollapseButtonTitle":"BasePage.ExpandButtonTitle"}onKeyDown(e){this.expandButtonVisible&&e.ctrlKey&&e.shiftKey&&e.code==="KeyF"&&this.onExpandButtonClicked()}onDesignButtonClicked(){const t=`${(0,h.getWorkspaceBaseUrl)()}ClientApp/#/InterfaceDesigner/${this.schema}`;this._window.open(t,"_blank")}onExpandButtonClicked(){const t=!this._expandButtonState;this._expandButtonState=t,this._setExpandButtonInfo(t)}}G.\u0275fac=function(e){return new(e||G)(s.\u0275\u0275directiveInject(s.Injector))},G.\u0275cmp=s.\u0275\u0275defineComponent({type:G,selectors:[["crt-page-tools"]],hostBindings:function(e,t){e&1&&s.\u0275\u0275listener("keydown",function(a){return t.onKeyDown(a)},!1,s.\u0275\u0275resolveWindow)},inputs:{schema:"schema",features:"features"},features:[s.\u0275\u0275ProvidersFeature([h.StorageService])],decls:2,vars:2,consts:[["class","design-button","icon","min-settings-icon",3,"iconSize","iconPosition","size","title","clicked",4,"ngIf"],["class","expand-button",3,"icon","iconSize","iconPosition","size","title","clicked",4,"ngIf"],["icon","min-settings-icon",1,"design-button",3,"iconSize","iconPosition","size","title","clicked"],[1,"expand-button",3,"icon","iconSize","iconPosition","size","title","clicked"]],template:function(e,t){e&1&&(s.\u0275\u0275template(0,Ra,2,6,"crt-button",0),s.\u0275\u0275template(1,Ea,2,7,"crt-button",1)),e&2&&(s.\u0275\u0275property("ngIf",t.designButtonVisible),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",t.expandButtonVisible))},dependencies:[N.NgIf,g.CrtButtonComponent,w.TranslatePipe],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row}crt-button[_ngcontent-%COMP%]{--button-border-radius: 50%;--crt-button-default-contrast-color: var(--crt-color-primary-grey)}"]});function Ta(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onParametersChange(a))})("schemaStateGenerated",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaStateGenerated(a))})("schemaExceptionThrown",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaExceptionThrown(a))}),s.\u0275\u0275elementEnd()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function Da(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-reusable-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onParametersChange(a))})("schemaStateGenerated",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaStateGenerated(a))})("schemaExceptionThrown",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaExceptionThrown(a))}),s.\u0275\u0275elementEnd()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function Pa(n,e){if(n&1&&s.\u0275\u0275element(0,"crt-page-tools",5),n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("features",t.features)}}class te extends L{constructor(e,t,r,a,o,c){super(a,e,r,o),this.googleTagManager=e,this._customEventService=t,this.ngZone=r,this.injector=a,this.sysSettingsService=o,this._customEvents=c,this._customEventSubscription=new Array,this.moduleName="PageModule",this.gtmModuleName="Form",this.dataItemMarker="card"}_subscribeOnCustomEvents(e,t){return this._customEventService.subscribe(e).pipe(t).subscribe(r=>{this._customEventService.createOutboundChannel(e).next(r)})}_subscribeOnValidateCard(){return this._subscribeOnCustomEvents("ValidateCard8x",e=>e.pipe((0,M.switchMap)(()=>{const t=this.schemaState.viewModel;return t.validate(),t.isValid()})))}_subscribeOnGetOperation(){return this._subscribeOnCustomEvents("GetOperation8x",e=>e.pipe((0,M.switchMap)(()=>this.schemaState.viewModel[H])))}_subscribeOnSaveCard(){return this._subscribeOnCustomEvents("SaveCard8x",e=>e.pipe((0,M.switchMap)(t=>{const r=this.schemaState.viewModel;return r.executeRequest({type:"crt.SaveRecordRequest",$context:r,...t})})))}_subscribeOnUpdateCard(){return this._subscribeOnCustomEvents("UpdateCard8x",e=>e.pipe((0,M.switchMap)(t=>{const r=this.schemaState?.viewModel;return(0,p.combineLatest)([r.getPrimaryModelName(),(0,p.of)(t),(0,p.of)(r)])}),(0,M.tap)(([t,r,a])=>{const o=a.getViewModelAttributePath(t,r.key);o&&(a[o]=r.value)})))}_subscribeCustomEvents(){this._unsubscribeCustomEvents(),this._customEventSubscription.push(this._subscribeOnValidateCard(),this._subscribeOnSaveCard(),this._subscribeOnUpdateCard(),this._subscribeOnGetOperation())}_unsubscribeCustomEvents(){this._customEventSubscription.forEach(e=>e.unsubscribe()),this._customEventSubscription=[]}onAttach(){const e=super.onAttach();return this._customEvents&&this._subscribeCustomEvents(),e}onDetach(){super.onDetach(),this._unsubscribeCustomEvents()}}te.\u0275fac=function(e){return new(e||te)(s.\u0275\u0275directiveInject(y.GoogleTagManagerService),s.\u0275\u0275directiveInject(I.CustomEventService),s.\u0275\u0275directiveInject(s.NgZone),s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(y.SysSettingsService),s.\u0275\u0275directiveInject(Gr,8))},te.\u0275cmp=s.\u0275\u0275defineComponent({type:te,selectors:[["crt-card"]],features:[s.\u0275\u0275ProvidersFeature([W]),s.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown",4,"ngIf","ngIfElse"],["reusableSchema",""],[3,"schema","features",4,"ngIf"],["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown"],["schemaComponent",""],[3,"schema","features"]],template:function(e,t){if(e&1&&(s.\u0275\u0275template(0,Ta,2,4,"crt-schema",0),s.\u0275\u0275template(1,Da,2,4,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275template(3,Pa,1,2,"crt-page-tools",2)),e&2){const r=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",!t.isPageReusable)("ngIfElse",r),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",t.pageToolsVisible)}},dependencies:[N.NgIf,F.SchemaComponent,F.CrtReusableSchemaComponent,h.SaveScrollPositionDirective,G],styles:["[_nghost-%COMP%]{position:relative}crt-page-tools[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.rtl[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{right:initial;left:0}"]});function Aa(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onParametersChange(a))})("schemaStateGenerated",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaStateGenerated(a))})("schemaExceptionThrown",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaExceptionThrown(a))}),s.\u0275\u0275elementEnd()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function Ia(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-reusable-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onParametersChange(a))})("schemaStateGenerated",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaStateGenerated(a))})("schemaExceptionThrown",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaExceptionThrown(a))}),s.\u0275\u0275elementEnd()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function Na(n,e){if(n&1&&s.\u0275\u0275element(0,"crt-page-tools",5),n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("features",t.features)}}class J extends L{constructor(){super(...arguments),this.moduleName="HomePageModule",this.gtmModuleName="HomePage",this.dataItemMarker="home-page"}}J.\u0275fac=function(){let n;return function(t){return(n||(n=s.\u0275\u0275getInheritedFactory(J)))(t||J)}}(),J.\u0275cmp=s.\u0275\u0275defineComponent({type:J,selectors:[["crt-home-page"]],features:[s.\u0275\u0275ProvidersFeature([W]),s.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown",4,"ngIf","ngIfElse"],["reusableSchema",""],[3,"schema","features",4,"ngIf"],["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown"],["schemaComponent",""],[3,"schema","features"]],template:function(e,t){if(e&1&&(s.\u0275\u0275template(0,Aa,2,4,"crt-schema",0),s.\u0275\u0275template(1,Ia,2,4,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275template(3,Na,1,2,"crt-page-tools",2)),e&2){const r=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",!t.isPageReusable)("ngIfElse",r),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",t.pageToolsVisible)}},dependencies:[N.NgIf,F.SchemaComponent,F.CrtReusableSchemaComponent,h.SaveScrollPositionDirective,G],styles:["[_nghost-%COMP%]{position:relative}crt-page-tools[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.rtl[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{right:initial;left:0}"]});var d=C(8239);class he{constructor(e){this._schemaInfoService=e}_isSchemaInheritedBaseHomePage(e){return e.tag.includes("BaseHomePage")}_setWrapElement(e){const t=(0,R.cloneDeep)(e.viewConfig);e.viewConfig=[{name:"MainWrapContainer",type:"crt.FlexContainer",direction:"column",gap:8,stretch:!0,fitContent:!1,items:t}]}_setHeaderViewConfig(e,t){const r={name:"HeaderContainer",type:"crt.FlexContainer",direction:"column",gap:8,color:"primary",padding:{top:"large",right:"large",bottom:"medium",left:"large"},fitContent:!0,items:[{name:"HeaderLabel",type:"crt.Label",caption:t,labelType:"headline-1"}]};e.items.unshift(r)}_setGridPadding(e){const t=e.items.find(r=>r.type==="crt.GridContainer")||{};t.padding="0 8px"}crtOnMetaDataInit(e){var t=this;return(0,d.Z)(function*(){const r=e;if(t._isSchemaInheritedBaseHomePage(r)){const a=yield t._schemaInfoService.getSchemaCaptionByName(r.name);t._setWrapElement(r),t._setHeaderViewConfig(r.viewConfig[0],a),t._setGridPadding(r.viewConfig[0])}return e})()}}he.\u0275fac=function(e){return new(e||he)(s.\u0275\u0275inject(y.SchemaInfoService))},he.\u0275prov=s.\u0275\u0275defineInjectable({token:he,factory:he.\u0275fac});function Ma(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onParametersChange(a))})("schemaStateGenerated",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaStateGenerated(a))})("schemaExceptionThrown",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaExceptionThrown(a))}),s.\u0275\u0275elementEnd()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function xa(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-reusable-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onParametersChange(a))})("schemaStateGenerated",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaStateGenerated(a))})("schemaExceptionThrown",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaExceptionThrown(a))}),s.\u0275\u0275elementEnd()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function ba(n,e){if(n&1&&s.\u0275\u0275element(0,"crt-page-tools",5),n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("features",t.features)}}class Q extends L{constructor(){super(...arguments),this.moduleName="SectionModule",this.gtmModuleName="List",this.dataItemMarker="section"}}Q.\u0275fac=function(){let n;return function(t){return(n||(n=s.\u0275\u0275getInheritedFactory(Q)))(t||Q)}}(),Q.\u0275cmp=s.\u0275\u0275defineComponent({type:Q,selectors:[["crt-section"]],features:[s.\u0275\u0275ProvidersFeature([W]),s.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown",4,"ngIf","ngIfElse"],["reusableSchema",""],[3,"schema","features",4,"ngIf"],["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown"],["schemaComponent",""],[3,"schema","features"]],template:function(e,t){if(e&1&&(s.\u0275\u0275template(0,Ma,2,4,"crt-schema",0),s.\u0275\u0275template(1,xa,2,4,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275template(3,ba,1,2,"crt-page-tools",2)),e&2){const r=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",!t.isPageReusable)("ngIfElse",r),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",t.pageToolsVisible)}},dependencies:[N.NgIf,F.SchemaComponent,F.CrtReusableSchemaComponent,h.SaveScrollPositionDirective,G],styles:["[_nghost-%COMP%]{position:relative}crt-page-tools[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.rtl[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{right:initial;left:0}"]});function wa(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onParametersChange(a))})("schemaStateGenerated",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaStateGenerated(a))})("schemaExceptionThrown",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaExceptionThrown(a))}),s.\u0275\u0275elementEnd()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function ka(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-reusable-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onParametersChange(a))})("schemaStateGenerated",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaStateGenerated(a))})("schemaExceptionThrown",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaExceptionThrown(a))}),s.\u0275\u0275elementEnd()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function Oa(n,e){if(n&1&&s.\u0275\u0275element(0,"crt-page-tools",5),n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("features",t.features)}}class X extends L{constructor(){super(...arguments),this.moduleName="PageModule",this.gtmModuleName="Form",this.dataItemMarker="page"}}X.\u0275fac=function(){let n;return function(t){return(n||(n=s.\u0275\u0275getInheritedFactory(X)))(t||X)}}(),X.\u0275cmp=s.\u0275\u0275defineComponent({type:X,selectors:[["crt-page"]],features:[s.\u0275\u0275ProvidersFeature([W]),s.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown",4,"ngIf","ngIfElse"],["reusableSchema",""],[3,"schema","features",4,"ngIf"],["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown"],["schemaComponent",""],[3,"schema","features"]],template:function(e,t){if(e&1&&(s.\u0275\u0275template(0,wa,2,4,"crt-schema",0),s.\u0275\u0275template(1,ka,2,4,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275template(3,Oa,1,2,"crt-page-tools",2)),e&2){const r=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",!t.isPageReusable)("ngIfElse",r),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",t.pageToolsVisible)}},dependencies:[N.NgIf,F.SchemaComponent,F.CrtReusableSchemaComponent,h.SaveScrollPositionDirective,G],styles:["[_nghost-%COMP%]{position:relative}crt-page-tools[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.rtl[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{right:initial;left:0}"]});const Va=["container"];let V=class extends U.CrtBaseComponent{constructor(e,t){super(e),this._injector=e,this._requireJsProvider=t}get _requirejs(){return this._requireJsProvider.get()}ngAfterViewInit(){this.container.nativeElement.id=I.NameGenerator.generateUnique("7xModule"),this.load7xModule()}load7xModule(){this._requirejs(["core-base"],e=>{this._initSandbox(e),this._requirejs(["sandbox_"+this.module],t=>{t.loadModule(this.module,{id:"sandbox_"+this.module+this.container.nativeElement.id,renderTo:this.doNotRender?null:this.container.nativeElement.id,instanceConfig:{...this.instanceConfig}})})})}_initSandbox(e){e.createContext(this.module,{id:this.module,moduleName:this.module})}};V.\u0275fac=function(e){return new(e||V)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(h.RequireJsProvider))},V.\u0275cmp=s.\u0275\u0275defineComponent({type:V,selectors:[["crt-7x-module"]],viewQuery:function(e,t){if(e&1&&s.\u0275\u0275viewQuery(Va,7,s.ElementRef),e&2){let r;s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(t.container=r.first)}},inputs:{module:"module",doNotRender:"doNotRender",instanceConfig:"instanceConfig"},features:[s.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["container",""]],template:function(e,t){e&1&&s.\u0275\u0275element(0,"div",null,0)}}),(0,l.__decorate)([(0,i.CrtInput)(),(0,l.__metadata)("design:type",String)],V.prototype,"module",void 0),(0,l.__decorate)([(0,i.CrtInput)(),(0,l.__metadata)("design:type",Boolean)],V.prototype,"doNotRender",void 0),(0,l.__decorate)([(0,i.CrtInput)(),(0,l.__metadata)("design:type",Object)],V.prototype,"instanceConfig",void 0),V=(0,l.__decorate)([(0,i.CrtViewElement)({type:"crt.ModuleLoader",reuseStrategy:i.ViewElementReuseStrategy.Reuse}),(0,l.__metadata)("design:paramtypes",[s.Injector,h.RequireJsProvider])],V);const je=new s.InjectionToken("SCHEMA_VIEW_MASK_TOKEN");function Fa(n,e){if(n&1&&s.\u0275\u0275element(0,"crt-page-tools",2),n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("features",t.features)}}class $ extends L{get hidden(){return!this._visible}constructor(e,t,r,a,o,c,u){super(a,e,o,c),this._googleTagManager=e,this._customEventService=t,this._requireJsProvider=r,this.injector=a,this.ngZone=o,this.sysSettingsService=c,this._parentCdr=u,this._isStart7xRenderModule$=new p.ReplaySubject(1),this._visible=!0,this._hide$=new p.Subject,this._shouldShowBodyMask=!1,this.moduleName="7xSchema",this._mask=this.injector.get(je),this._subscribeOn7xMaskEvents()}get _requirejs(){return this._requireJsProvider.get()}ngAfterViewInit(){this._requirejs(["core-base","ext-base"],(e,t)=>{this._moduleId&&e.unloadModule(this._moduleId),this._moduleId=e.loadModule("ViewModuleWrapper",{renderTo:t.get("7xContainer")})})}_subscribeOnStart7xRenderModule(){this._isStart7xRenderModule$.next(!1),this._renderModuleSubscription?.unsubscribe(),this._renderModuleSubscription=this._customEventService.subscribe("Start7xRenderModule").pipe((0,p.first)()).subscribe(()=>{this._isStart7xRenderModule$.next(!0)})}_convertToMaskSettings(e){const t={};return"timeout"in e&&(t.delay=e.timeout),t}_subscribeOn7xMaskEvents(){this._customEventService.subscribe("ShowBodyMask").pipe((0,M.takeUntil)(this.destroyed$)).subscribe(e=>{const t=e?this._convertToMaskSettings(e):null;this._shouldShowBodyMask||(this._shouldShowBodyMask=!0,this._mask.addTask("BLOCKING_BODY_7X_TASK",t))}),this._customEventService.subscribe("HideBodyMask").pipe((0,M.takeUntil)(this.destroyed$)).subscribe(()=>{this._shouldShowBodyMask=!1,this._mask.removeTask("BLOCKING_BODY_7X_TASK")})}subscribeOn7xEvents(){this._subscribeOnStart7xRenderModule()}show(){return this._visible?Promise.resolve(void 0).then(()=>{this?._parentCdr?.detectChanges()}):(0,p.lastValueFrom)(this._isStart7xRenderModule$.pipe((0,p.first)(e=>e),(0,M.map)(()=>(this._visible=!0,this?._parentCdr?.detectChanges(),null)),(0,M.takeUntil)(this._hide$)),{defaultValue:void 0})}hide(){this._hide$.next(),this._renderModuleSubscription?.unsubscribe(),this._visible=!1}}$.\u0275fac=function(e){return new(e||$)(s.\u0275\u0275directiveInject(y.GoogleTagManagerService),s.\u0275\u0275directiveInject(I.CustomEventService),s.\u0275\u0275directiveInject(h.RequireJsProvider),s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(s.NgZone),s.\u0275\u0275directiveInject(y.SysSettingsService),s.\u0275\u0275directiveInject(s.ChangeDetectorRef,4))},$.\u0275cmp=s.\u0275\u0275defineComponent({type:$,selectors:[["crt-7x-schema"]],hostVars:2,hostBindings:function(e,t){e&2&&s.\u0275\u0275classProp("display-none",t.hidden)},features:[s.\u0275\u0275ProvidersFeature([...W,{provide:h.ALLOW_PAGE_DESIGN,useValue:!1}]),s.\u0275\u0275InheritDefinitionFeature],decls:2,vars:1,consts:[["id","7xContainer",1,"flex-full-height"],[3,"schema","features",4,"ngIf"],[3,"schema","features"]],template:function(e,t){e&1&&(s.\u0275\u0275element(0,"div",0),s.\u0275\u0275template(1,Fa,1,2,"crt-page-tools",1)),e&2&&(s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",!t.hidden))},dependencies:[N.NgIf,G],styles:['[_nghost-%COMP%]   div[id="7xContainer"][_ngcontent-%COMP%]{width:100%;background-color:#fff}.display-none[_nghost-%COMP%]{display:none}body[OldUI=false][_ngcontent-%COMP%]   .card-content-container[_ngcontent-%COMP%] > .actions-container[_ngcontent-%COMP%]{position:fixed}',"[_nghost-%COMP%]{position:relative}crt-page-tools[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.rtl[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{right:initial;left:0}"]});var T=C(34617),Ne=C(76698),$r=C(72856),jr=C(54514),E=C(25644);function Ha(n,e){if(n&1&&s.\u0275\u0275element(0,"div",8),n&2){const t=s.\u0275\u0275nextContext(2);s.\u0275\u0275property("ngStyle",t.tileBackgroundStyle)}}const Ba=function(n){return{visible:n}};function La(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",9)(1,"crt-button",10),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(t);const a=s.\u0275\u0275nextContext().$implicit,o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.editDesktop(a))}),s.\u0275\u0275elementEnd()()}if(n&2){const t=s.\u0275\u0275nextContext().$implicit,r=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(6,Ba,r.desktopHovered===t.schemaName))("iconPosition",r.editDesktopIconPosition)("icon",r.editDesktopIconName)("iconSize",r.editDesktopIconSize)("size",r.editDesktopSize)("title",r.editDesktopTooltipTitle)}}const Ua=function(n){return{active:n}};function Ga(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",2),s.\u0275\u0275listener("click",function(){const o=s.\u0275\u0275restoreView(t).$implicit,c=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(c.selectDesktop(o))})("mouseover",function(){const o=s.\u0275\u0275restoreView(t).$implicit,c=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(c.desktopHovered=o.schemaName)})("mouseout",function(){s.\u0275\u0275restoreView(t);const a=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(a.desktopHovered=null)}),s.\u0275\u0275elementStart(1,"div",3),s.\u0275\u0275template(2,Ha,1,1,"div",4),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(3,"div",5)(4,"div",6),s.\u0275\u0275text(5),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(6,La,2,8,"div",7),s.\u0275\u0275elementEnd()()}if(n&2){const t=e.$implicit,r=s.\u0275\u0275nextContext();s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(4,Ua,t.schemaName===r.selectedDesktopSchemaName)),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",r.tileBackgroundStyle),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate1(" ",t.title," "),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",r.canEditDesktop)}}class ge{constructor(e,t,r,a){this.injector=e,this._translateService=t,this._changeDetector=r,this._appBackgroundService=a,this._editDesktopIcon=C(60954),this._subscription=new p.Subscription,this.editDesktopIconName="edit-desktop-icon",this.editDesktopIconPosition=O.IconPositionEnum.OnlyIcon,this.editDesktopIconSize=O.SizeEnum.Large,this.editDesktopSize=O.SizeEnum.Large,this.editDesktopTooltipTitle=this._translateService.instant("DesktopSelector.EditDesktop"),this.desktops=[],this.canEditDesktop=!1,this.desktopSelected=new s.EventEmitter,this.desktopEdit=new s.EventEmitter,this._iconRegistry=e.get($r.MatIconRegistry),this._domSanitizer=e.get(jr.DomSanitizer)}_registerIcons(){this._iconRegistry.addSvgIconLiteral(this.editDesktopIconName,this._domSanitizer.bypassSecurityTrustHtml(this._editDesktopIcon))}ngOnInit(){this._registerIcons();const e=this._appBackgroundService.getConfig().pipe((0,p.map)(t=>g.AppBackgroundService.getBackgroundMode(t)===g.AppBackgroundMode.Image?g.AppBackgroundService.getImageStyle(t):g.AppBackgroundService.getColorStyle(t))).subscribe(t=>{this.tileBackgroundStyle=t,this._changeDetector.detectChanges()});this._subscription.add(e)}ngOnDestroy(){this._subscription.unsubscribe()}selectDesktop(e){e.schemaName!==this.selectedDesktopSchemaName&&this.desktopSelected.emit(e)}editDesktop(e){!this.canEditDesktop||this.desktopEdit.emit(e)}}ge.\u0275fac=function(e){return new(e||ge)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(w.TranslateService),s.\u0275\u0275directiveInject(s.ChangeDetectorRef),s.\u0275\u0275directiveInject(g.AppBackgroundService))},ge.\u0275cmp=s.\u0275\u0275defineComponent({type:ge,selectors:[["crt-desktop-selector"]],inputs:{desktops:"desktops",canEditDesktop:"canEditDesktop",selectedDesktopSchemaName:"selectedDesktopSchemaName"},outputs:{desktopSelected:"desktopSelected",desktopEdit:"desktopEdit"},decls:2,vars:1,consts:[[1,"desktop-selector"],["class","desktop-selector-element",3,"ngClass","click","mouseover","mouseout",4,"ngFor","ngForOf"],[1,"desktop-selector-element",3,"ngClass","click","mouseover","mouseout"],[1,"desktop-selector-element-image-container"],["class","desktop-selector-element-image-container-img",3,"ngStyle",4,"ngIf"],[1,"desktop-selector-element-info-container"],[1,"desktop-selector-element-title"],["class","desktop-selector-element-action",4,"ngIf"],[1,"desktop-selector-element-image-container-img",3,"ngStyle"],[1,"desktop-selector-element-action"],[1,"desktop-selector-element-edit",3,"ngClass","iconPosition","icon","iconSize","size","title","clicked"]],template:function(e,t){e&1&&(s.\u0275\u0275elementStart(0,"div",0),s.\u0275\u0275template(1,Ga,7,6,"div",1),s.\u0275\u0275elementEnd()),e&2&&(s.\u0275\u0275advance(1),s.\u0275\u0275property("ngForOf",t.desktops))},dependencies:[N.NgClass,N.NgForOf,N.NgIf,N.NgStyle,g.CrtButtonComponent],styles:[`.desktop-selector[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;overflow-x:auto;padding:4px;gap:8px}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element[_ngcontent-%COMP%]{width:196px;min-width:196px;padding:8px;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;gap:5px;border-radius:10px;cursor:pointer}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-image-container-img[_ngcontent-%COMP%]{background-size:cover;height:100%;width:180px;aspect-ratio:4/3;border-radius:5px;position:relative}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-image-container-img[_ngcontent-%COMP%]:after{content:"";display:block;position:absolute;inset:0;background-position:center;background-repeat:no-repeat;background-size:40%;background-size:50%;background-image:url("data:image/svg+xml,%3Csvg width='93' height='44' viewBox='0 0 93 44' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect y='12.5715' width='44.2857' height='14.1429' rx='2' fill='%23181818' fill-opacity='0.4'/%3E%3Crect width='44.2857' height='6.28571' rx='2' fill='white' fill-opacity='0.3'/%3E%3Crect x='48.7144' y='12.5715' width='44.2857' height='14.1429' rx='2' fill='%23181818' fill-opacity='0.4'/%3E%3Crect y='29.8572' width='44.2857' height='14.1429' rx='2' fill='%23181818' fill-opacity='0.4'/%3E%3Crect x='48.7144' y='29.8572' width='44.2857' height='14.1429' rx='2' fill='%23181818' fill-opacity='0.4'/%3E%3C/svg%3E%0A")}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-info-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;gap:5px}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-title[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;flex:1}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-action[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;align-self:center}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-edit[_ngcontent-%COMP%]{visibility:hidden}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-edit.visible[_ngcontent-%COMP%]{visibility:visible}`]});function $a(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-schema",4),s.\u0275\u0275listener("schemaStateGenerated",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaStateGenerated(a))}),s.\u0275\u0275elementEnd()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schemaName)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)}}function ja(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-reusable-schema",4),s.\u0275\u0275listener("schemaStateGenerated",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.onSchemaStateGenerated(a))}),s.\u0275\u0275elementEnd()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schemaName)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)}}function Za(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",5),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(t);const a=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(a.setShowDesktopSelectorState(!1))}),s.\u0275\u0275elementStart(1,"div",6),s.\u0275\u0275listener("click",function(a){return a.stopPropagation()}),s.\u0275\u0275elementStart(2,"crt-desktop-selector",7),s.\u0275\u0275listener("desktopSelected",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.setActiveDesktop(a))})("desktopEdit",function(a){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.editDesktop(a))}),s.\u0275\u0275elementEnd()()()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(2),s.\u0275\u0275property("desktops",t.desktops)("selectedDesktopSchemaName",t.schemaName)("canEditDesktop",t.canEditDesktop)}}function qa(n,e){if(n&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",8)(1,"crt-button",9),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(t);const a=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(a.setShowDesktopSelectorState(!0))}),s.\u0275\u0275elementEnd()()}if(n&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275property("iconPosition",t.selectDesktopIconPosition)("icon",t.selectDesktopIconName)("iconSize",t.selectDesktopIconSize)("size",t.selectDesktopSize)("title",t.selectDesktopTooltipTitle)}}class re extends L{constructor(e,t,r,a,o,c,u){super(r,t,a,u),this._desktopService=e,this.injector=r,this.ngZone=a,this._translateService=o,this._changeDetector=c,this.sysSettingsService=u,this._selectDesktopIcon=C(94171),this.moduleName="Desktop",this.gtmModuleName=this.moduleName,this.dataItemMarker="desktop-page",this.isBackgroundEffectRequired=!1,this.selectDesktopIconName="select-desktop-icon",this.canEditDesktop=!1,this.showDesktopSelector=!1,this.showDesktopSelectorButton=!1,this.selectDesktopIconPosition=O.IconPositionEnum.OnlyIcon,this.selectDesktopIconSize=O.SizeEnum.Large,this.selectDesktopSize=O.SizeEnum.Large,this.selectDesktopTooltipTitle=this._translateService.instant("DesktopSelector.ShowDesktopSelector"),this._window=r.get(I.WINDOW_TOKEN),this._iconRegistry=r.get($r.MatIconRegistry),this._domSanitizer=r.get(jr.DomSanitizer)}_getFirstDesktopBySchemaName(e){return this.desktops.find(t=>t.schemaName===e)??null}_getFirstDesktop(){return this.desktops.length===0?null:this.desktops[0]}_getCurrentDesktop(){return this._getFirstDesktopBySchemaName(this.schemaName)}_registerIcons(){this._iconRegistry.addSvgIconLiteral(this.selectDesktopIconName,this._domSanitizer.bypassSecurityTrustHtml(this._selectDesktopIcon))}ngOnInit(){var e=()=>super.ngOnInit,t=this;return(0,d.Z)(function*(){if(e().call(t),t.desktops=yield t._desktopService.getUserDesktops(),t.desktops.length>0){if(t._registerIcons(),t.schemaName=yield t._desktopService.getCurrentDesktopSchemaName(),t.schema=t.schemaName,t.canEditDesktop=yield t._desktopService.canEditDesktop(),t.showDesktopSelectorButton=!0,!t._getCurrentDesktop()){const a=t._getFirstDesktop();yield t.setActiveDesktop(a)}}else t.schema=t.schemaName="CentralAreaDesktopTemplate",t.showDesktopSelectorButton=!1;t._changeDetector.detectChanges()})()}setActiveDesktop(e){var t=this;return(0,d.Z)(function*(){t.schemaName!==e?.schemaName&&(yield t._desktopService.setCurrentDesktop(e),t.schemaName=e?e.schemaName:null,t._changeDetector.detectChanges())})()}editDesktop(e){const t=(0,h.getWorkspaceBaseUrl)()+"ClientApp/#/InterfaceDesigner/"+e.schemaName;this._window.open(t,"_blank")}setShowDesktopSelectorState(e){this.showDesktopSelector=e}}re.\u0275fac=function(e){return new(e||re)(s.\u0275\u0275directiveInject(E.mJ),s.\u0275\u0275directiveInject(y.GoogleTagManagerService),s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(s.NgZone),s.\u0275\u0275directiveInject(w.TranslateService),s.\u0275\u0275directiveInject(s.ChangeDetectorRef),s.\u0275\u0275directiveInject(y.SysSettingsService))},re.\u0275cmp=s.\u0275\u0275defineComponent({type:re,selectors:[["crt-desktop"]],features:[s.\u0275\u0275ProvidersFeature([W]),s.\u0275\u0275InheritDefinitionFeature],decls:5,vars:4,consts:[[3,"schema","schemaState","modelInitConfigs","schemaStateGenerated",4,"ngIf","ngIfElse"],["reusableSchema",""],["class","desktop-selector-overlay",3,"click",4,"ngIf"],["class","desktop-selector-button-container",4,"ngIf"],[3,"schema","schemaState","modelInitConfigs","schemaStateGenerated"],[1,"desktop-selector-overlay",3,"click"],[1,"desktop-selector-container",3,"click"],[3,"desktops","selectedDesktopSchemaName","canEditDesktop","desktopSelected","desktopEdit"],[1,"desktop-selector-button-container"],[1,"desktop-selector-button",3,"iconPosition","icon","iconSize","size","title","clicked"]],template:function(e,t){if(e&1&&(s.\u0275\u0275template(0,$a,1,3,"crt-schema",0),s.\u0275\u0275template(1,ja,1,3,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275template(3,Za,3,3,"div",2),s.\u0275\u0275template(4,qa,2,5,"div",3)),e&2){const r=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",!t.isPageReusable)("ngIfElse",r),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",t.showDesktopSelector),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",t.showDesktopSelectorButton)}},dependencies:[N.NgIf,g.CrtButtonComponent,F.SchemaComponent,F.CrtReusableSchemaComponent,ge],styles:["[_nghost-%COMP%]   .desktop-selector-overlay[_ngcontent-%COMP%]{z-index:999;position:fixed;width:100%;height:100vh;top:0;left:0;right:0;display:flex;align-items:flex-end;flex-direction:column-reverse;padding:0 10px 50px}[_nghost-%COMP%]   .desktop-selector-container[_ngcontent-%COMP%]{z-index:1000;height:228px;padding:12px;max-width:62%;border-radius:10px}[_nghost-%COMP%]   .desktop-selector-button-container[_ngcontent-%COMP%]{position:fixed;bottom:6px;display:flex;width:100%;left:0;right:0;padding:0 10px;flex-direction:row-reverse}"]});class Y{resolve(e){return(0,d.Z)(function*(){let t=e.moduleName;if(e.schemaName){if(!(yield T.NavigationUtils.isAngularSchema(e.schemaName)))return $;t=t||(yield T.NavigationUtils.getModuleName(e.schemaName))}switch(t){case"HomePage":return J;case"CardSchemaViewModule":case"Card":return te;case"PageSchemaViewModule":case"Page":return X;case"SectionSchemaViewModule":case"Section":return Q;case"Desktop":return re;default:return $}})()}}Y.\u0275fac=function(e){return new(e||Y)},Y.\u0275prov=s.\u0275\u0275defineInjectable({token:Y,factory:Y.\u0275fac,providedIn:"root"});const Ka=new s.InjectionToken("SCHEMA_OUTLET_VIEW_STORE_LIMIT_TOKEN");class ae{constructor(e,t){this._schemaChangeListenerService=t,this._storeLimit=20,this._items=new Map,this._destroyed$=new p.Subject,this._outdatedViews=[],e!==null&&(this._storeLimit=e),this._subscribeOnSchemaChanged()}_subscribeOnSchemaChanged(){this._schemaChangeListenerService.schemaChanged$.pipe((0,M.takeUntil)(this._destroyed$)).subscribe(e=>{if(e.schemaType===h.SchemaTypes.ClientUnitSchema){const t=e.name;this._items.has(t)&&(this._outdatedViews.push(this._items.get(t)),this._items.delete(t))}})}_enforceStoreLimit(){const e=Array.from(this._items.keys());for(let t=0;t<this._items.size-this._storeLimit;t++){const r=e[t];this._items.get(r)?.destroy(),this._items.delete(r)}}get size(){return this._items.size}get(e){return this._items.get(e)}set(e,t){this._items.set(e,t),this._enforceStoreLimit()}destroy(){this._items.forEach(e=>e.destroy()),this._items.clear(),this._outdatedViews.forEach(e=>e.destroy()),this._outdatedViews=[],this._destroyed$.next(),this._destroyed$.complete()}}ae.\u0275fac=function(e){return new(e||ae)(s.\u0275\u0275inject(Ka,8),s.\u0275\u0275inject(h.SchemaChangeListenerService))},ae.\u0275prov=s.\u0275\u0275defineInjectable({token:ae,factory:ae.\u0275fac});var A=C(1141),ye=C(44507);const Zr=new s.InjectionToken("CHILDREN_OUTLET_TOKEN"),Re=new s.InjectionToken("CLOSE_PAGE_COMMAND",{providedIn:"root",factory:()=>(0,h.simpleCommand)(()=>i.HandlerChainService.instance.process({type:"crt.7XRequest",action:"BackHistoryState",$context:null}))}),Me=new s.InjectionToken("OldTagMiniPageDataToken");var Ze;const za=["container"],Wa=["7xContainer"];let k=Ze=class extends U.CrtBaseComponent{set parameters(e){this._setParametersValue$.next(e)}set schemaName(e){this._config={schemaName:e},this._changeSchema().pipe((0,p.takeUntil)(this._destroyed)).subscribe()}get schemaName(){return this._config?.schemaName}constructor(e,t,r,a,o,c,u,m,_,f){super(e),this._injector=e,this._customEventService=t,this._cdr=r,this._router=a,this._schemaModalService=o,this._featureValues=c,this._appendSchemaStateFromUrlService=u,this._modelInitConfigsGenerator=m,this._componentResolver=_,this._environmentInjector=f,this._cancelSchemaChanging=new p.Subject,this._destroyed=new p.Subject,this._setParametersValue$=new p.ReplaySubject(1),this._viewStoreService=(0,s.inject)(ae),this._addClsToHost=!0,this._addFlexFullHeightToHost=!0,this.maskSettings={delay:500},this.componentBackgroundStateChanged=new s.EventEmitter,this.beforeSchemaChangeEvent=new s.EventEmitter,this.afterSchemaChangeEvent=new s.EventEmitter,this.parametersChange=new s.EventEmitter,this.schemaExceptionThrown=new s.EventEmitter}ngOnInit(){this._schemaModalService.modalCreated$.pipe((0,p.takeUntil)(this._destroyed)).subscribe(e=>{this.viewState.modalRefs.set(e.id,e)}),this._schemaModalService.modalClosed$.pipe((0,p.takeUntil)(this._destroyed)).subscribe(e=>{this.viewState.modalRefs.delete(e)})}_getComponentType(e){return(0,p.from)(this._componentResolver.resolve({schemaName:e.schemaName,moduleName:e.moduleName}))}_hideCurrentComponent(){this.componentRef?this._hide8xComponent():this.componentRef7x?.instance?.hide()}_hide8xComponent(){!this.componentRef||(this.componentRef.instance.onDetach(),this._featureValues.DisableSchemaOutletHiddenBeforeDetach||(this.componentRef.instance.hidden=!0,this._cdr.detectChanges()),this.viewContainerRef.detach(),this._hideModals(),this.componentRef=null,this.viewState=null)}_hideModals(){const e=this?.viewState?.modalRefs;if(e){const t=Array.from(e.keys());this._schemaModalService.hideModals(t)}}_restoreModals(){if(this.viewState.modalRefs?.size){const e=Array.from(this.viewState.modalRefs.keys());this._schemaModalService.restoreModals(e)}}_subscribeSetParametersValue(){const e=this.componentRef.instance;this._subscriptionSetParametersValue?.unsubscribe(),this._subscriptionSetParametersValue=this._setParametersValue$.subscribe(t=>{e.parameters=t})}_subscribeOnParametersChanges(){this._subscriptionParametersChange?.unsubscribe(),this._subscriptionParametersChange=this.componentRef.instance.parametersChange.subscribe(e=>{this.parametersChange.emit(e)})}_subscribeExceptionThrown(){this._subscriptionErrorThrown?.unsubscribe(),this._subscriptionErrorThrown=this.componentRef.instance.schemaExceptionThrown.subscribe(e=>this.schemaExceptionThrown.emit(e))}_subscribeOn8xComponentDestroy(e){this.componentRef.instance.destroyed$.subscribe(()=>{e?.viewModel?.destroy()})}_canRestore8xComponent(){const e=this._config.restoreViewState;return e&&!e.pageRef.hostView.destroyed}_canReuse8xComponent(){return Boolean(this._config.schemaName&&T.NavigationUtils.isAngularRouting(this._config.moduleName)&&this._viewStoreService.get(this._config.schemaName))}_set8xComponentInitProperties(){this._appendSchemaStateFromUrlService.shouldAppendState(this._config.schemaName)&&this._appendSchemaStateFromUrlService.appendState(this._config);const e=this.componentRef.instance;e.schema=this._config.schemaName,e.modelInitConfigs=this._config.modelInitConfigs??this._modelInitConfigsGenerator.generate(this._config),e.parameters=this._config.parameters,e.scrollPositions=new Map,this.componentRef.changeDetectorRef.detectChanges()}_setup8xComponent(){return this.componentRef.instance.features=this.features,this.componentBackgroundStateChanged.emit(this.componentRef.instance.backgroundEffectRequirement),this._subscribeExceptionThrown(),this._subscribeSetParametersValue(),this._cdr.detectChanges(),this.componentRef.instance.onAttach().pipe((0,p.observeOn)(p.animationFrameScheduler),(0,p.tap)(()=>this._subscribeOnParametersChanges()))}_setViewState(){this.viewState=new A.f7(this.componentRef,new Map,this.componentRef.instance.schemaState,this._featureValues.UseSchemaOutletReuseViewStrategy,this.componentRef.instance.scrollPositions,this._featureValues)}_create7xComponentIfNeeded(){this.componentRef7x||(this.componentRef7x=this.viewContainerRef7x.createComponent($),this.componentRef7x.changeDetectorRef.detectChanges())}_prepare7xComponent(){return this._hide8xComponent(),this._create7xComponentIfNeeded(),this.componentRef7x.instance.features=this.features,this.componentBackgroundStateChanged.emit(this.componentRef7x.instance.backgroundEffectRequirement),(0,p.from)(this.componentRef7x.instance.show())}_create8xComponent(e){return this._hideCurrentComponent(),this.componentRef=this.viewContainerRef.createComponent(e,{injector:this._injector,environmentInjector:this._environmentInjector}),this._set8xComponentInitProperties(),this._setup8xComponent().pipe((0,p.observeOn)(p.animationFrameScheduler),(0,p.tap)(()=>{this._subscribeOn8xComponentDestroy(this.componentRef.instance.schemaState),this._setViewState(),this._featureValues.UseSchemaOutletReuseViewStrategy&&this._viewStoreService.set(this._config.schemaName,this.componentRef)}))}_reuse8xComponent(){return(0,p.of)(null).pipe((0,p.observeOn)(p.animationFrameScheduler),(0,p.tap)(()=>this._hideCurrentComponent()),(0,p.observeOn)(p.animationFrameScheduler),(0,p.switchMap)(()=>{const e=this._viewStoreService.get(this._config.schemaName);return this.viewContainerRef.insert(e.hostView),this.componentRef=e,this.componentRef.instance.schema=null,this.componentRef.instance.schemaState=null,this.componentRef.changeDetectorRef.detectChanges(),this._set8xComponentInitProperties(),this._setup8xComponent()}),(0,p.observeOn)(p.animationFrameScheduler),(0,p.tap)(()=>{this._subscribeOn8xComponentDestroy(this.componentRef.instance.schemaState),this._setViewState(),this.componentRef.instance.hidden&&(this.componentRef.instance.hidden=!1)}))}_restore8xComponent(){this._hideCurrentComponent();const e=this._config.restoreViewState,t=e.pageRef.instance;return t.hidden&&(t.hidden=!1),t.schemaState!==e.schemaState&&(t.schemaState=e.schemaState,t.scrollPositions=e.scrollPositions),e.pageRef.changeDetectorRef.detectChanges(),this.viewContainerRef.insert(e.pageRef.hostView),this.componentRef=e.pageRef,this.viewState=e,this._restoreModals(),this._setup8xComponent()}_prepareComponent(){return this._canRestore8xComponent()?this._restore8xComponent():this._canReuse8xComponent()?this._reuse8xComponent():this._getComponentType(this._config).pipe((0,p.switchMap)(e=>e===$?this._prepare7xComponent():this._create8xComponent(e)))}_changeSchema(){return this._config?(this._cancelSchemaChanging.next(),this.beforeSchemaChange(),this.componentRef7x?.instance.subscribeOn7xEvents(),this._prepareComponent().pipe((0,p.tap)(()=>{this.afterSchemaChange(),this._router.onNavigateEnd(),this._cdr.detectChanges()}),(0,p.takeUntil)(this._cancelSchemaChanging))):(0,p.of)(void 0)}preload7xConfiguration(){const e=(0,p.firstValueFrom)(this._customEventService.getDataViaEvent("ConfigurationViewModuleLoaded"));return this._create7xComponentIfNeeded(),e.then(()=>{})}beforeSchemaChange(){this.mask.addTask("SCHEMA_CHANGE",{delay:1e3}),this.beforeSchemaChangeEvent.emit()}afterSchemaChange(){this.mask.removeTask("SCHEMA_CHANGE"),this.afterSchemaChangeEvent.emit()}setConfig(e){return this._config=e,this._changeSchema()}get config(){return this._config}ngOnDestroy(){this._schemaModalService.closeModals(),this.viewState=null,this._viewStoreService.destroy(),this._cancelSchemaChanging.next(),this._cancelSchemaChanging.complete(),this._destroyed.next(),this._destroyed.complete()}};k.\u0275fac=function(e){return new(e||k)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(I.CustomEventService),s.\u0275\u0275directiveInject(s.ChangeDetectorRef),s.\u0275\u0275directiveInject(T.CrtRouter),s.\u0275\u0275directiveInject(ye.L),s.\u0275\u0275directiveInject(h.FEATURE_VALUES),s.\u0275\u0275directiveInject(T.AppendSchemaStateFromUrlService),s.\u0275\u0275directiveInject(T.ModelInitConfigsGeneratorService),s.\u0275\u0275directiveInject(Y),s.\u0275\u0275directiveInject(s.EnvironmentInjector))},k.\u0275cmp=s.\u0275\u0275defineComponent({type:k,selectors:[["crt-schema-outlet"]],viewQuery:function(e,t){if(e&1&&(s.\u0275\u0275viewQuery(za,7,s.ViewContainerRef),s.\u0275\u0275viewQuery(Wa,7,s.ViewContainerRef),s.\u0275\u0275viewQuery(x.MaskDirective,7)),e&2){let r;s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(t.viewContainerRef=r.first),s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(t.viewContainerRef7x=r.first),s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(t.mask=r.first)}},hostVars:4,hostBindings:function(e,t){e&2&&s.\u0275\u0275classProp("crt-schema-outlet",t._addClsToHost)("flex-full-height",t._addFlexFullHeightToHost)},inputs:{parameters:"parameters",schemaName:"schemaName",componentRef:"componentRef",features:"features"},outputs:{componentBackgroundStateChanged:"componentBackgroundStateChanged",beforeSchemaChangeEvent:"beforeSchemaChangeEvent",afterSchemaChangeEvent:"afterSchemaChangeEvent",parametersChange:"parametersChange",schemaExceptionThrown:"schemaExceptionThrown"},features:[s.\u0275\u0275ProvidersFeature([ye.L,{provide:je,useFactory:n=>n.mask,deps:[(0,s.forwardRef)(()=>Ze)]},ae]),s.\u0275\u0275InheritDefinitionFeature],decls:5,vars:1,consts:[[3,"crtMask","crtMaskSettings"],["container",""],["7xContainer",""]],template:function(e,t){e&1&&(s.\u0275\u0275elementContainerStart(0,0),s.\u0275\u0275elementContainer(1,null,1)(3,null,2),s.\u0275\u0275elementContainerEnd()),e&2&&s.\u0275\u0275property("crtMaskSettings",t.maskSettings)},dependencies:[x.MaskDirective]}),(0,l.__decorate)([(0,i.CrtInput)(),(0,l.__metadata)("design:type",Object),(0,l.__metadata)("design:paramtypes",[Object])],k.prototype,"parameters",null),(0,l.__decorate)([(0,i.CrtInput)(),(0,l.__metadata)("design:type",String),(0,l.__metadata)("design:paramtypes",[String])],k.prototype,"schemaName",null),k=Ze=(0,l.__decorate)([(0,i.CrtViewElement)({type:"crt.SchemaOutlet"}),(0,l.__metadata)("design:paramtypes",[s.Injector,I.CustomEventService,s.ChangeDetectorRef,T.CrtRouter,ye.L,h.FeatureValues,T.AppendSchemaStateFromUrlService,T.ModelInitConfigsGeneratorService,Y,s.EnvironmentInjector])],k);var D=C(52045);function qr(n,e){if(n==="@event")return`${n}.${e}`;const t=n.indexOf(".");return n.substring(0,t+1)+e+n.substring(t)}class se{constructor(e,t,r){this._featureService=e,this._metadataModifierService=t,this._loaderService=r}_getSchemaOutlets(e){return h.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SchemaOutlet",e.viewConfig)}_getIsProcessingDisabled(){return(0,p.lastValueFrom)(this._featureService.getFeatureState("DisableCommunicationBetweenSchemas"))}_getAllSchemaParameters(e){var t=this;return(0,d.Z)(function*(){const r=yield(0,p.lastValueFrom)(t._loaderService.load(e));let a={};return r.forEach(o=>{const c=o.structure.parameters;c&&(a=Object.assign(c,a))}),a})()}_getParametersName(e,t){const r=Object.keys(t);return Object.entries(e).filter(([a])=>r.includes(a))}_getUserRequest(e,t){const r=t.params;if((0,R.isObject)(r))for(const[a,o]of Object.entries(r))/@event/.test(o)&&(r[a]=qr(o,e));return[e,t]}_getDefaultRequest(e,t,r){const o=t.split("|").map(m=>m.trim())[0].replace("$",""),c=r[e];let u=qr("@event",e);return c.dataValueTypeName==="Lookup"&&(u+=` | crt.ToLookup: '${c.referenceSchemaName}'`),[e,{request:"crt.SetViewModelAttributeRequest",params:{attributeName:o,value:u}}]}_getRequestEntries(e,t,r){const a=this._getOutputs(e,t);return t.map(([o,c])=>{const u=a[o];return u?this._getUserRequest(o,u):this._getDefaultRequest(o,c,r)})}_getOutputs(e,t){const r=t.map(([o])=>o),a={};for(const o of r){const c=e[`${o}Change`];c&&(a[o]=c)}return a}_getParametersChangeConfig(e,t,r){const a=this._getRequestEntries(e,t,r);return{request:"crt.ParametersChangeRequest",params:{entries:Object.fromEntries(a)}}}_getKeyValuePairAttributeName(e,t){return`${e}_${t}ToKeyValuePair`}_getConverterExpression(e,t){let r;if(!e[1]&&t)r="crt.ToObjectProp: 'value'";else{const[,...a]=e;r=a.join(" | ")}return r}_addParametersAttributes(e,t,r,a){t.forEach(([o,c])=>{const u=r[o],m=c.split("|").map(v=>v.trim()),_=this._getKeyValuePairAttributeName(a,o),f=u.dataValueTypeName==="Lookup";if(m.length===1&&!f)this._metadataModifierService.addProperty(e,_,{from:c.replace("$",""),converter:`crt.ToKeyValuePair:'${o}'`});else{const v=m[0].replace("$",""),P=v+"Converted";this._metadataModifierService.addProperty(e,P,{from:v,converter:this._getConverterExpression(m,f)}),this._metadataModifierService.addProperty(e,_,{from:P,converter:`crt.ToKeyValuePair:'${o}'`})}})}crtOnMetaDataInit(e){var t=this;return(0,d.Z)(function*(){if(yield t._getIsProcessingDisabled())return e;const r=e,a=t._getSchemaOutlets(r);if(!a.length)return e;const o=r.viewModelConfig.attributes;for(const c of a){const u=c.viewConfig,m=u.name,_=yield t._getAllSchemaParameters(u.schemaName),f=t._getParametersName(u,_);t._addParametersAttributes(o,f,_,m);const v=f.map(([Ks])=>t._getKeyValuePairAttributeName(m,Ks)),P=c.viewConfig.name+"_Parameters";t._metadataModifierService.addProperty(o,P,{from:v,converter:"crt.ToObjectFromEntries"}),t._metadataModifierService.addProperty(c.viewConfig,"parameters",`$${P}`);const fe=t._getParametersChangeConfig(c.viewConfig,f,_);t._metadataModifierService.addProperty(c.viewConfig,"parametersChange",fe)}return Promise.resolve(e)})()}}se.\u0275fac=function(e){return new(e||se)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(S.MetadataModifierService),s.\u0275\u0275inject(D.AmdSchemaLoaderService))},se.\u0275prov=s.\u0275\u0275defineInjectable({token:se,factory:se.\u0275fac});class oe{constructor(){this._subscription=new p.Subscription,this.contextName="root",this._router=(0,s.inject)(T.CrtRouter),this._childrenOutlet=(0,s.inject)(Zr),this._initSubscriptions()}_initSubscriptions(){this._childrenOutlet.forEach(e=>{this._subscription.add(this._router.getChildNavigation$(this.contextName,e.getTarget()).pipe((0,M.switchMap)(t=>e.applySegments(t))).subscribe())})}ngOnDestroy(){this._subscription.unsubscribe()}}oe.\u0275fac=function(e){return new(e||oe)},oe.\u0275dir=s.\u0275\u0275defineDirective({type:oe,selectors:[["","crtChildrenRouterOutlet",""]],inputs:{contextName:"contextName"},standalone:!0});const Ja=["component"];let j=class extends U.CrtBaseComponent{constructor(e,t,r,a,o,c){super(e),this.injector=e,this._crtRouter=t,this._history=r,this._window=a,this._crtZoneService=o,this._maskService=c,this._subscription=new p.Subscription,this._destroyed$=new p.Subject,this.contentBackgroundChanged=new s.EventEmitter,this._navigationService=e.get(T.CrtNavigationService)}_subscribeHistoryState(){[this._subscribeNavigation(),this._subscribeNavigateStart(),this._subscribeNavigateEnd()].forEach(e=>this._subscription.add(e))}_handleLoadingAnimation(){this._maskService.loadingAnimationVisible&&this._maskService.hideBodyMask()}_setSchemaState(e){const{state:t,root:r}=e;return this.schemaOutletComponent.setConfig({schemaName:r.schemaName,moduleName:r.moduleName,...t}).pipe((0,p.tap)(()=>{this._handleLoadingAnimation();const a=this.schemaOutletComponent.viewState;this._history.storeView(a)}))}_handleNavigation(e){const{state:t,root:r}=e;if(this._history.goTo(t),t.silent&&!t._internalNotSilentIn8x&&!this._history.lastTransition.isBack)return(0,p.of)(null);const o={...t};return this._history.canRestoreView()&&(o.restoreViewState=this._history.getView()),this._setSchemaState({root:r,state:o})}_subscribeNavigation(){return this._crtRouter.getNavigation$().pipe((0,p.switchMap)(e=>this._handleNavigation(e))).subscribe()}_subscribeNavigateStart(){return this._crtRouter.navigateStart$.subscribe(()=>{this.schemaOutletComponent.beforeSchemaChange()})}_subscribeNavigateEnd(){return this._crtRouter.navigateEnd$.subscribe(()=>{this.schemaOutletComponent.afterSchemaChange()})}_initMainShellFeatures(){this.injector.get(U.BINDING_CONTEXT,null)?.viewModel$?.pipe((0,p.filter)(t=>t?._scopeName==="MainShell"),(0,p.takeUntil)(this._destroyed$)).subscribe(()=>{this.schemaOutletComponent.features={tools:{canDesign:!0,canExpand:!0}}})}_goToDesktop(){var e=this;return(0,d.Z)(function*(){yield e._navigationService.navigate({mode:T.NavigationMode.Push,options:{type:T.NavigationOptionsTypeEnum.Schema},state:{moduleName:"Desktop"}})})()}ngAfterViewInit(){this._initMainShellFeatures();const e=this._crtZoneService.get(T.NAVIGATION_ZONE_NAME);window[T.EXECUTION_ZONES_CONTAINER_NAME_FOR_7X]={centerPanel:e},this.schemaOutletComponent.preload7xConfiguration().then(()=>this._subscribeHistoryState())}ngOnDestroy(){this._subscription.unsubscribe(),this._destroyed$.next(),this._destroyed$.complete()}onBackgroundStateChanged(e){this.contentBackgroundChanged.emit(e)}handleSchemaException(e){e instanceof h.AclRightsException&&this._goToDesktop()}};j.\u0275fac=function(e){return new(e||j)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(T.CrtRouter),s.\u0275\u0275directiveInject(Ne.B),s.\u0275\u0275directiveInject(I.WINDOW_TOKEN),s.\u0275\u0275directiveInject(h.CrtZoneService),s.\u0275\u0275directiveInject(x.MaskService))},j.\u0275cmp=s.\u0275\u0275defineComponent({type:j,selectors:[["crt-router-outlet"]],viewQuery:function(e,t){if(e&1&&s.\u0275\u0275viewQuery(Ja,7),e&2){let r;s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(t.schemaOutletComponent=r.first)}},outputs:{contentBackgroundChanged:"contentBackgroundChanged"},features:[s.\u0275\u0275ProvidersFeature([...$e,Ne.B,{provide:Gr,useValue:!0},{provide:S.VIEW_EVENT_ZONE_NAME,useValue:T.NAVIGATION_ZONE_NAME},{provide:h.CRT_NAVIGATION_LOCK_TOKEN,deps:[S.VIEW_EVENT_ZONE_NAME,h.CrtZoneService,h.FEATURE_VALUES],useFactory:h.navigationLockFactory},{provide:h.USE_SAVE_SCROLL_POSITION_SERVICE,useValue:!0}]),s.\u0275\u0275InheritDefinitionFeature],decls:3,vars:0,consts:[["crtChildrenRouterOutlet","",3,"componentBackgroundStateChanged","schemaExceptionThrown"],["component",""]],template:function(e,t){e&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"crt-schema-outlet",0,1),s.\u0275\u0275listener("componentBackgroundStateChanged",function(a){return t.onBackgroundStateChanged(a)})("schemaExceptionThrown",function(a){return t.handleSchemaException(a)}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd())},dependencies:[oe,k],styles:[`crt-router-outlet .crt-schema-outlet{height:calc(100vh - 56px)}@media screen and (max-width: 790px){crt-router-outlet .crt-schema-outlet{height:calc(100vh - 96px)}}crt-router-outlet .flex-full-height{display:flex;flex-direction:column;min-height:0;min-width:0;flex-grow:1}
`],encapsulation:2}),j=(0,l.__decorate)([(0,i.CrtViewElement)({type:"crt.RouterOutlet",reuseStrategy:i.ViewElementReuseStrategy.Reuse}),(0,l.__metadata)("design:paramtypes",[s.Injector,T.CrtRouter,Ne.B,Window,h.CrtZoneService,x.MaskService])],j);var Qa=C(8446),xe=C(75903);const Xa={provide:Re,useFactory:(n,e,t)=>e.preventDefaultCloseCommand?t:(0,h.simpleCommand)(()=>n.close()),deps:[xe.MatLegacyDialogRef,xe.MAT_LEGACY_DIALOG_DATA,[new s.SkipSelf,new s.Optional,Re]]},Ya=["container"];class ne{get visible(){return this._visible}constructor(e,t){this.data=e,this._document=t,this._visible=!1}get page(){return this.schemaOutletComponent.instance.componentRef.instance}ngOnInit(){var e=this;return(0,d.Z)(function*(){e.schemaOutletComponent=e.componentContainer.createComponent(k);const{action:t,schemaName:r,recordId:a,defaultValues:o,parameters:c}=e.data,u={operation:t,schemaName:r,recordId:a,parameters:c};t&&(u.modelInitConfigs=[{action:t,recordId:a,defaultValues:o}]),e.schemaOutletComponent.instance.features={tools:{canDesign:!0}},yield(0,p.firstValueFrom)(e.schemaOutletComponent.instance.setConfig(u)),e._visible=!0})()}detachContent(){this.componentContainer.detach(),this._visible=!1}attachContent(){this.componentContainer.insert(this.schemaOutletComponent.hostView),this._visible=!0}}ne.\u0275fac=function(e){return new(e||ne)(s.\u0275\u0275directiveInject(xe.MAT_LEGACY_DIALOG_DATA),s.\u0275\u0275directiveInject(N.DOCUMENT))},ne.\u0275cmp=s.\u0275\u0275defineComponent({type:ne,selectors:[["crt-schema-modal"]],viewQuery:function(e,t){if(e&1&&s.\u0275\u0275viewQuery(Ya,7,s.ViewContainerRef),e&2){let r;s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(t.componentContainer=r.first)}},features:[s.\u0275\u0275ProvidersFeature([...$e,Xa,{provide:S.VIEW_EVENT_ZONE_NAME,useValue:T.NAVIGATION_ZONE_NAME},{provide:h.CRT_NAVIGATION_LOCK_TOKEN,deps:[S.VIEW_EVENT_ZONE_NAME,h.CrtZoneService,h.FEATURE_VALUES],useFactory:h.navigationLockFactory}])],decls:2,vars:0,consts:[["container",""]],template:function(e,t){e&1&&s.\u0275\u0275elementContainer(0,null,0)},styles:[`crt-schema-modal{display:flex;flex-direction:column;min-height:0;min-width:0;flex-grow:1}crt-schema-modal .flex-full-height{display:flex;flex-direction:column;min-height:0;min-width:0;flex-grow:1}.mat-dialog-container crt-schema-modal{display:flex!important}
`],encapsulation:2});let B=class{};B.\u0275fac=function(e){return new(e||B)},B.\u0275mod=s.\u0275\u0275defineNgModule({type:B}),B.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:T.LocationStrategy,useClass:T.HashLocationStrategy},T.AppendSchemaStateFromUrlService],imports:[N.CommonModule,x.MaskModule]}),B=(0,l.__decorate)([(0,i.CrtModule)({viewElements:[k,j,V]})],B),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(B,{declarations:[k,j,V],imports:[N.CommonModule,x.MaskModule,oe],exports:[k,j,V]})}();let qe=class{_createGetRecordUrl(e,t,r){return{type:"crt.7XRequest",action:"GetRecordUrl",$context:e,payload:{recordId:t,entityName:r}}}convert(e,t,r){var a=this;return(0,d.Z)(function*(){const{referenceSchemaName:o}=yield(0,S.getEntitySchemaAttribute)(t,r),c=a._createGetRecordUrl(t,e,o);return yield i.HandlerChainService.instance.process(c)})()}};qe=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.ToRecordLinkAsync"})],qe);let Ke=class{convert(e,t,r){return[r,e]}};Ke=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.ToKeyValuePair"})],Ke);let ze=class{convert(e,t){return Object.fromEntries(e)}};ze=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.ToObjectFromEntries"})],ze);let be=class{isEmptyCollection(e){return!(e?.length>0)}hasFilterValues(e){return e?e.some(t=>{try{t=JSON.parse(t)}catch{}return!(0,R.isEmpty)(t)}):!1}convert(e){const t=e.shift();return this.isEmptyCollection(t)&&!this.hasFilterValues(e)}};be=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.DataGridHasNoItems"})],be);let We=class extends be{convert(e){const t=e.shift();return this.isEmptyCollection(t)&&this.hasFilterValues(e)}};We=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.DataGridHasNoFilteredItems"})],We);let Je=class{convert(e,t){return e?.type==="specific"?e.selected?.length>0:e?.type==="all"}};Je=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.IsAnySelected"})],Je);var Qe=C(24821);let Xe=class{_getParametersExpression(e){return e.map(t=>new i.ParameterExpression({value:t}))}convert(e,t,r){if(!r||!e?.length)return{};const a=new i.InFilter(i.ComparisonType.Equal,new i.ColumnExpression({columnPath:r}),this._getParametersExpression(e));return(0,Qe.classToPlain)(a)}};Xe=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.ToInFilter"})],Xe);let we=class{constructor(e){this._entitySchemaQueryBuilder=e}_addDataSourceFilters(e,t,r){var a=this;return(0,d.Z)(function*(){const o=yield a._getDataSourceFilters(t,r);o&&e.add(o)})()}_addFilterBySelectedItems(e,t,r){const a=this._getInFilter(i.ComparisonType.Equal,r,t);a&&e.add(a)}_addFilterByUnselectedItems(e,t,r){const a=this._getInFilter(i.ComparisonType.Not_equal,r,t);a&&e.add(a)}_getInFilter(e,t,r){if(!t||!r?.length)return null;const a=new i.ColumnExpression({columnPath:t}),o=r.map(c=>new i.ParameterExpression({value:c}));return new i.InFilter(e,a,o)}_getDataSourceFilters(e,t){var r=this;return(0,d.Z)(function*(){const a=e.getBoundDataSchemaByAttributePath(t),o=e.getBoundDataSourceNameByAttributePath(t),c=yield e.getDataSourceLoadParameters(o);if(!c)return null;try{return(0,p.firstValueFrom)(r._entitySchemaQueryBuilder.build(a,[],c.parameters).pipe((0,p.map)(u=>u?.filters)))}catch{return null}})()}convert(e,t,r,a){var o=this;return(0,d.Z)(function*(){const c=t,u=c.getBoundDataSchemaByAttributePath(r).primaryAttributeName,m=a?.type==="specific"&&a?.selected?.length,_=a?.type==="all"&&a?.unselected?.length,f=new i.EntitySchemaQuery("tempTable");return m&&o._addFilterBySelectedItems(f.filters,a.selected,u),m||(yield o._addDataSourceFilters(f.filters,c,r)),_&&o._addFilterByUnselectedItems(f.filters,a.unselected,u),f.getMetadata().filters})()}};we=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.ToCollectionFilters"}),(0,l.__metadata)("design:paramtypes",[S.EntitySchemaQueryBuilder])],we);const Kr="count";class zr{constructor(e,t){this.queryExecutor=e,this.entitySchemaQueryBuilder=t}_getItemsCount(e,t,r,a){var o=this;return(0,d.Z)(function*(){const c=t.getBoundDataSourceNameByAttributePath(r),u=yield o.getLoadItemsCountParameters(e,c,t),m=o.getLoadItemsCountParametersAttributeName(r),_=yield t[m];if((0,R.isEqual)(_,u))return t.attributes[a];const f=t.dataSchemas[c],v=yield o._loadItemsCount(f,u);return t[m]=u,v})()}_loadItemsCount(e,t){var r=this;return(0,d.Z)(function*(){const a=yield r._createItemsCountQuery(e,t);return(yield(0,p.lastValueFrom)(r.queryExecutor.executeSelectQuery(a)))[0][Kr]})()}_createItemsCountQuery(e,t){const r=[{name:Kr,path:e.primaryAttributeName||"Id",caption:"count",type:"function",aggregationConfig:{aggregationFunction:i.AggregationFunction.Count},dataValueType:i.DataValueType.Integer,functionConfig:{aggregation:i.AggregationFunction.Count,aggregationEval:"distinct",type:"aggregation"}}];return(0,p.firstValueFrom)(this.entitySchemaQueryBuilder.build(e,r,t))}getLoadItemsCountParameters(e,t,r){return(0,d.Z)(function*(){return(yield r.getDataSourceLoadParameters(t)).parameters})()}convert(e,t,r,a){var o=this;return(0,d.Z)(function*(){try{return yield o._getItemsCount(e,t,r,a)}catch(c){return console.error(`Can't get items count for the '${r}': ${c}`),o.defaultItemsCount}})()}}let Ye=class extends zr{constructor(e,t){super(e,t),this.defaultItemsCount=1/0}_resetItemsCountLoadParameters(e,t){const r=this.getLoadItemsCountParametersAttributeName(e);t[r]=null}getLoadItemsCountParametersAttributeName(e){return(0,g.createTotalItemsCountLoadParametersAttributeName)(e)}convert(e,t,r,a){const[o,c]=e;return c?o.length===0?(this._resetItemsCountLoadParameters(r,t),Promise.resolve(0)):super.convert(e,t,r,a):t.attributes[a]}};Ye=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.ToCollectionItemsCount"}),(0,l.__metadata)("design:paramtypes",[Ce.QueryExecutor,S.EntitySchemaQueryBuilder])],Ye);let et=class extends zr{constructor(e,t){super(e,t),this.defaultItemsCount=0}_getLoadedUnselectedItems(e,t){return(0,d.Z)(function*(){return e?.length?(yield Promise.all(t.map(a=>e.findByPrimaryAttribute(a)))).filter(a=>a!==void 0):[]})()}_createExceptUnselectedItemsFilter(e,t,r){const o=r.dataSchemas[t]?.primaryAttributeName||"Id",c=new i.ColumnExpression({columnPath:o}),u=e.unselected.map(m=>new i.ParameterExpression({value:m}));return{type:i.ModelParameterType.Filter,value:new i.InFilter(i.ComparisonType.Not_equal,c,u)}}getLoadItemsCountParameters(e,t,r){var a=()=>super.getLoadItemsCountParameters,o=this;return(0,d.Z)(function*(){const[,c]=e,u=yield a().call(o,e,t,r),m=o._createExceptUnselectedItemsFilter(c,t,r);return u.push(m),u})()}getLoadItemsCountParametersAttributeName(e){return(0,g.createSelectedItemsCountLoadParametersAttributeName)(e)}convert(e,t,r,a){var o=()=>super.convert,c=this;return(0,d.Z)(function*(){const[u,m,_]=e??[];if((0,R.isNil)(_)||!m?.type)return 0;if(m.type==="specific")return m.selected?.length??0;const f=m.unselected??[];if(f.length===0||_===1/0)return _;const v=yield c._getLoadedUnselectedItems(u,f);return v.length===f.length?Math.max(0,_-v.length):o().call(c,e,t,r,a)})()}};et=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.ToCollectionSelectedItemsCount"}),(0,l.__metadata)("design:paramtypes",[Ce.QueryExecutor,S.EntitySchemaQueryBuilder])],et);let tt=class{_isSelectionStateEmpty(e){return e?.type?e.type==="all"?!1:e.type==="specific"?!e.selected?.length:!0:!0}convert(e,t,r){return this._isSelectionStateEmpty(r)?null:e}};tt=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.SkipIfSelectionEmpty"})],tt);let rt=class{convert(e,t,r,a=null){return e?r:a}};rt=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.BooleanToStringValue"})],rt);let at=class{convert(e,t,r){return!e&&!r}};at=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.NorCondition"})],at);let st=class{convert(e,t,...r){let a=e[0];for(let o=0,c=r.length;o<c;o++)a+=e[o+1]?r[o]:"";return a}};st=(0,l.__decorate)([(0,i.CrtConverter)({type:"crt.AppendConditionalParts"})],st);var Ee=C(61437);class Wr extends i.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){yield t.checkPressedKey(e),yield t.next?.handle(e)})()}}let Jr=class extends i.BaseRequest{constructor(){super(...arguments),this.type="crt.CanDiscardUnsavedDataRequest"}};Jr=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.CanDiscardUnsavedDataRequest"})],Jr);let ot=class extends i.BaseRequestHandler{constructor(e){super(),this._messageDialogProvider=e}_canDiscardChanges(){var e=this;return(0,d.Z)(function*(){const t=e._messageDialogProvider.open({data:{message:"Dialog.CanDiscardUnsavedData",actions:[g.DEFAULT_DIALOG_ACTIONS.NO,g.DEFAULT_DIALOG_ACTIONS.YES]}});return(yield(0,p.lastValueFrom)(t))===g.DEFAULT_DIALOG_ACTIONS.YES.key})()}_isContextChanged(e){return e instanceof S.BaseViewModelCollection?Promise.resolve(e.isChanged):e?.IsChanged}handle(e){var t=this;return(0,d.Z)(function*(){return(yield t._isContextChanged(e.$context))?t._canDiscardChanges():!0})()}};ot=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.CanDiscardUnsavedDataHandler",requestType:"crt.CanDiscardUnsavedDataRequest"}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider])],ot);function Qr(n){if(!Array.isArray(n))return null;const e=n.map(t=>t?.errorInfo).filter(Boolean);return{success:n.length===0||n.every(t=>t?.success),errorInfo:e.length===0?void 0:e.join(`
`),rowsAffected:n.reduce((t,r)=>t+r?.rowsAffected||0,0)}}function nt(n){if(!Array.isArray(n))return null;if(n.length===0||n.every(r=>r?.success))return{success:!0};const t=n.map(r=>r?.success===!0?void 0:r?.errorInfo).filter(Boolean);return{success:!1,errorInfo:t.length===0?void 0:t.join(`
`)}}function Xr(n){const e=n.dataSchemas||{};return Object.keys(e).filter(r=>e[r]?.dataSourceConfig?.type==="crt.EntityDataSource")[0]}function es(n){return n!==null&&typeof n=="string"}function ts(n,e,t,r){return it.apply(this,arguments)}function it(){return it=(0,d.Z)(function*(n,e,t,r){const o=n.dataSchemas[e].findAttributeByName(t);return o.dataValueType===i.DataValueType.Lookup&&es(r)?new D.ToLookupConverter().convert(r,n,o.referenceSchemaName):r}),it.apply(this,arguments)}function rs(n,e=[]){return e.length?!(n!==i.ModelInPageAction.Add&&n!==i.ModelInPageAction.Copy):!1}function Yr(n,e){return ct.apply(this,arguments)}function ct(){return ct=(0,d.Z)(function*(n,e){const{name:t,defaultValues:r}=e;let a=null;if(rs(i.ModelInPageAction.Add,r)){a={};for(const{attributeName:o,value:c}of r)if(!(0,R.isNil)(c)){let u=c;const m=n?.getViewModelAttributePath(t,o);m&&(u=yield ts(n,t,o,c),n[m]=u),a[o]=u}}return a}),ct.apply(this,arguments)}function ea(n,e){return lt.apply(this,arguments)}function lt(){return lt=(0,d.Z)(function*(n,e){const t=yield Yr(n,e),{name:r}=e;return yield(0,p.lastValueFrom)(n.create(r,t),{defaultValue:null}),{success:!0}}),lt.apply(this,arguments)}let dt=class extends i.BaseRequestHandler{constructor(e,t){super(),this._messageDialogProvider=e,this._maskService=t}_cancelPrimaryDataChanges(e){var t=this;return(0,d.Z)(function*(){const r={type:"crt.CancelPrimaryDataChangesRequest",$context:e.$context},a=yield t.handlerChain.process(r);return nt(a)})()}_reloadData(e,t){var r=this;return(0,d.Z)(function*(){try{return yield r.handlerChain.process({type:"crt.LoadDataRequest",$context:e,dataSourceName:t}),{success:!0}}catch(a){const o=a?.message;return{success:!1,errorInfo:o}}})()}_loadDefaultValues(e){const t=[],r=(0,S.getRootModels)(e),a=e.modelInitConfigs;for(const o of r){const c=e.getModelByName(o);if(c.mode===h.ModelMode.Create){const u=c.getDataSource(),m=a?.find(_=>_.name===u.dataSourceName&&_.action===i.ModelInPageAction.Add);m&&t.push(ea(e,m))}}return t}_cancelDataChanges(e){var t=this;return(0,d.Z)(function*(){const r=e.$context;yield r.waitAsyncTasksFinish();let a=[];(yield r.getPrimaryModelName())&&a.push(t._cancelPrimaryDataChanges(e)),r._getModelNamesByLoadType(h.DataSourceLoadingType.OnInit).forEach(m=>{a.push(t._reloadData(r,m))}),a=a.concat(t._loadDefaultValues(r));const u=yield Promise.all(a);return nt(u)})()}_displayErrorDialog(e){const t=e?.message;t&&this._messageDialogProvider.open({data:{message:t,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}handle(e){var t=this;return(0,d.Z)(function*(){const r="RECORD_CHANGES_CANCELING";yield t._maskService.showMask(r,e.$context);try{const a=yield t._cancelDataChanges(e);if(a.success===!0)return!0;throw new Error(a.errorInfo)}catch(a){return t._displayErrorDialog(a),!1}finally{t._maskService.hideMask(r,e.$context)}})()}};dt=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.CancelRecordChangesHandler",requestType:"crt.CancelRecordChangesRequest"}),(0,l.__param)(1,(0,i.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider,i.MaskService])],dt);let ut=class extends i.BaseRequestHandler{constructor(e,t){super(),this._messageDialogProvider=e,this._maskService=t}_cancelCollectionPrimaryDataChanges(e){var t=this;return(0,d.Z)(function*(){const r={type:"crt.CancelCollectionPrimaryDataChangesRequest",$context:e.$context,primaryAttributeValues:e.recordIds,collectionAttributeName:e.itemsAttributeName},a=yield t.handlerChain.process(r);return nt(a)})()}_displayErrorDialog(e){const t=e?.message;t&&this._messageDialogProvider.open({data:{message:t,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}handle(e){var t=this;return(0,d.Z)(function*(){const r="RECORDS_CHANGES_CANCELING_"+e.itemsAttributeName+"_"+(e.recordIds??[]).join("_");yield t._maskService.showMask(r,e.$context);try{const a=yield t._cancelCollectionPrimaryDataChanges(e);if(a.success===!0)return!0;throw new Error(a.errorInfo)}catch(a){return t._displayErrorDialog(a),!1}finally{t._maskService.hideMask(r,e.$context)}})()}};ut=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.CancelRecordsChangesHandler",requestType:"crt.CancelRecordsChangesRequest"}),(0,l.__param)(1,(0,i.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider,i.MaskService])],ut);let mt=class extends i.BaseRequestHandler{constructor(e){super(),this._closePageCommand=e}handle(e){var t=this;return(0,d.Z)(function*(){const a=yield e.$context[H];if(a===i.ModelInPageAction.Edit)return yield t.next?.handle(e);a===i.ModelInPageAction.Add||a===i.ModelInPageAction.Copy?t._closePageCommand.execute():yield t.next?.handle(e)})()}};mt=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.CardCancelRecordChangesHandler",requestType:"crt.CancelRecordChangesRequest",scopes:[S.Scopes.AllCards]}),(0,l.__param)(0,(0,i.CrtInject)(Re)),(0,l.__metadata)("design:paramtypes",[Object])],mt);class ta extends i.BaseRequestHandler{getEntityName(e){var t=this;return(0,d.Z)(function*(){const r=yield t.getPrimaryName(e);return e.$context.dataSchemas[r]?.dataSourceConfig?.config?.entitySchemaName})()}initDataViews(e,t={},r){var a=this;return(0,d.Z)(function*(){const o=yield a.getEntityName(e),c={...t,entityName:o};yield a.handlerChain.process({type:"crt.7XRequest",action:"InitDataViews",$context:r||e.$context,payload:c,scopes:e.scopes})})()}}let pt=class extends ta{constructor(e){super(),this._resourceFinderService=e}_getPrimaryDataSourceCaption(e){return!e||!e.caption?"":this._resourceFinderService.findLocalizableValue(e.caption)}_getHeaderCaption(e,t){var r=this;return(0,d.Z)(function*(){const a=yield e.getPrimaryDataSchema(),o=yield e.getPrimaryModelName(),c=e.getViewModelAttributePath(o,a?.primaryDisplayAttributeName),u=yield r._getDefaultCaption(t);if(t.attributeName===c){const m=t.value.trim();return Promise.resolve(m||u)}return Promise.resolve(null)})()}_updateCardCaption(e,t){var r=this;return(0,d.Z)(function*(){const a=yield r._getHeaderCaption(t,e);if(a&&e.$context[ee]!==a){e.$context[ee]=a;const o={caption:a,hidePageCaption:!0};yield r.initDataViews(e,o,t)}})()}_isCreateRecordState(e){return e===i.ModelInPageAction.Add||e===i.ModelInPageAction.Copy}_getDefaultCaption(e){var t=this;return(0,d.Z)(function*(){const r=yield e.$context.Resources?.Strings?.NewRecord,a=yield e.$context.Resources?.Strings?.Record,o=yield e.$context[H];return t._isCreateRecordState(o)?r:a})()}_setDefaultCaption(e,t){var r=this;return(0,d.Z)(function*(){let a;if(r._isCreateRecordState(e.value))a=yield e.$context.Resources?.Strings?.NewRecord;else{const c=yield t.getPrimaryDataSchema(),u=yield t.getPrimaryModelName(),m=t.getViewModelAttributePath(u,c?.primaryDisplayAttributeName);a=m?yield t[m]:r._getPrimaryDataSourceCaption(c)}e.$context[ee]=a;const o={caption:a,hidePageCaption:!0};yield r.initDataViews(e,o)})()}getPrimaryName(e){return(0,d.Z)(function*(){return yield e.$context.getPrimaryModelName()})()}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context;return e.attributeName===H?yield t._setDefaultCaption(e,r):e.attributeName&&(yield t._updateCardCaption(e,r)),yield t.next?.handle(e)})()}};pt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleViewModelAttributeChangeRequest",type:"crt.CardChangeAttributeHandler",scopes:[S.Scopes.AllCards]}),(0,l.__metadata)("design:paramtypes",[h.ResourceFinderService])],pt);let ke=class extends i.BaseRequestHandler{constructor(e){super(),this.messageDialogProvider=e}_getEntitySchemaName(e){const t=this._getDataSourceName(e);return e.$context.dataSchemas[t]?.dataSourceConfig?.config?.entitySchemaName}_getDataSourceName(e){return e.$context.getBoundDataSourceName(e.itemsAttributeName)}validateRequest(e){return!e.entityName&&!e.itemsAttributeName&&!e.entityPageName?(this.messageDialogProvider.open({data:{message:"InfoDialog.OpenPage.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}),!1):!0}handle(e){var t=this;return(0,d.Z)(function*(){if(!t.validateRequest(e))return;const r={type:"crt.7XRequest",action:"AddRecord",$context:e.$context,payload:{entityName:e.entityName??t._getEntitySchemaName(e),defaultValues:e.defaultValues,entityPageName:e.entityPageName}};yield t.handlerChain.process(r)})()}};ke=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.CreateRecordRequest",type:"crt.CreateRecordHandler"}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider])],ke);let ht=class extends ke{_saveRecord(e){var t=this;return(0,d.Z)(function*(){const r={type:"crt.SaveRecordRequest",preventCardClose:!1,$context:e},a=yield t.handlerChain.process(r);if(a){const o=yield e.getPrimaryModelName(),c=yield e.getPrimaryDataSchema(),u={type:"crt.LoadDataRequest",dataSourceName:o,parameters:[{type:"primaryColumnValue",value:c.primaryAttributeName}],$context:e};yield t.handlerChain.process(u)}return a})()}handle(e){var t=this;return(0,d.Z)(function*(){if(!t.validateRequest(e))return;const r=e.$context,a=yield r.IsChanged,o=e.skipUnsavedData;if(!a||o){yield t.next?.handle(e);return}(yield t._saveRecord(r))&&(yield t.next?.handle(e))})()}};ht=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.CreateRecordRequest",type:"crt.CardCreateRecordHandler",scopes:[S.Scopes.AllCards]})],ht);let gt=class extends i.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,a=r.modelInitConfigs||[];a&&a.length>0&&(r[H]=a[0].action),yield t.next?.handle(e)})()}};gt=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.CardInitHandler",requestType:"crt.HandleViewModelInitRequest",scopes:[S.Scopes.AllCards]})],gt);let _t=class extends i.BaseRequestHandler{_backHistoryState(e){var t=this;return(0,d.Z)(function*(){yield t.handlerChain.process({type:"crt.7XRequest",action:"BackHistoryState",$context:e})})()}handle(e){var t=this;return(0,d.Z)(function*(){const r=yield t.next?.handle(e),a=yield e.$context[H];return r&&!e.preventCardClose&&(a===i.ModelInPageAction.Add||a===i.ModelInPageAction.Copy)&&(yield t._backHistoryState(e.$context)),!(a===i.ModelInPageAction.Edit)&&r&&(e.$context[H]=i.ModelInPageAction.Edit),r})()}};_t=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.CardSaveRecordHandler",scopes:[S.Scopes.AllCards]})],_t);let St=class extends i.BaseRequestHandler{constructor(e){super(),this._messageDialogProvider=e}handle(e){var t=this;return(0,d.Z)(function*(){if(!e.entityName&&!e.itemsAttributeName||!e.recordId){t._messageDialogProvider.open({data:{message:"InfoDialog.OpenPage.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}});return}const r=yield e.$context.CardState;return e.trackUnsavedData==null&&(e.trackUnsavedData=r==null||r===i.ModelInPageAction.Edit),t.next?.handle(e)})()}};St=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.UpdateRecordRequest",type:"crt.CardUpdateRecordHandler",scopes:[S.Scopes.AllCards,S.Scopes.AllSections]}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider])],St);let ft=class extends i.BaseRequestHandler{constructor(e){super(),this._schemaService=e,this._selectionViewElementConfigProvider=new D.SelectionViewElementConfigProvider(e)}_cleanupSelectionState(e,t){const{scopes:r,modelName:a}=e;if(!a)return;const o=this._schemaService.findAttributeByDataSourceAttributePath(a);if(!o)return;const _=(this._schemaService.getViewConfigInfoByPropertyValues([`$${o}`])??[]).map(f=>f?.viewConfig).map(f=>{if(f.type==="crt.DataGrid"&&!f?._selectionOptions){const v=(0,R.cloneDeep)(f);v.selectionState??(v.selectionState=`$${(0,g.createDataGridSelectionStateAttributeName)(v)}`);const P=(0,g.createDataGridInitialSelectionOptions)(v);return P&&(v._selectionOptions=P),v}return f}).filter(f=>Boolean(f?._selectionOptions)).map(f=>f._selectionOptions).map(f=>this._selectionViewElementConfigProvider.getSourceSelectionStateAttributeName(f)).filter(Boolean).map(f=>this.handlerChain.process({type:"crt.ChangeViewModelAttributeValueRequest",scopes:r,$context:t,attributeName:f,attributeValue:null}));return Promise.all(_)}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context;if(!r.isDataSourceForCollection(e.modelName))return t.next?.handle(e);const a=e.modelEvent?.type;return(a===S.ModelEventType.Create||a===S.ModelEventType.Delete)&&(yield t._cleanupSelectionState(e,r)),t.next?.handle(e)})()}};ft=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.CleanupSelectionStateHandler",requestType:"crt.HandleModelEventRequest"}),(0,l.__metadata)("design:paramtypes",[D.SchemaService])],ft);const as="CleanupAllSelectionWhenReloadingData",ss="CleanupSpecificSelectionWhenReloadingData";let Ct=class extends i.BaseRequestHandler{constructor(e,t){super(),this._schemaService=t,this._isCleanupAllSelectionEnabled=Boolean(e?.[as]),this._isCleanupSpecificSelectionEnabled=Boolean(e?.[ss]),this._selectionViewElementConfigProvider=new D.SelectionViewElementConfigProvider(t)}_cleanupSelectionStates(e){const{$context:t,dataSourceName:r}=e;if(!r)return;const c=this._getViewElementsSelectionOptions(r).map(u=>this._selectionViewElementConfigProvider.getSourceSelectionStateAttributeName(u)).filter(Boolean).map(u=>this._cleanupSelectionState(u,t));return Promise.all(c)}_getViewElementsSelectionOptions(e){const t=this._schemaService.findAttributeByDataSourceAttributePath(e);return t?(this._schemaService.getViewConfigInfoByPropertyValues([`$${t}`])??[]).map(a=>a?.viewConfig).map(a=>{if(a.type==="crt.DataGrid"&&!a?._selectionOptions){const o=(0,R.cloneDeep)(a);o.selectionState??(o.selectionState=`$${(0,g.createDataGridSelectionStateAttributeName)(o)}`);const c=(0,g.createDataGridInitialSelectionOptions)(o);return c&&(o._selectionOptions=c),o}return a}).filter(a=>Boolean(a?._selectionOptions)).map(a=>a._selectionOptions):[]}_cleanupSelectionState(e,t){var r=this;return(0,d.Z)(function*(){if(!(yield r._isCleanupSelectionEnabled(e,t)))return;const o={type:"crt.ChangeViewModelAttributeValueRequest",$context:t,attributeName:e,attributeValue:null};return r.handlerChain.process(o)})()}_isCleanupSelectionEnabled(e,t){var r=this;return(0,d.Z)(function*(){const a=yield t[e];return a?.type==="all"?r._isCleanupAllSelectionEnabled:a?.type==="specific"?r._isCleanupSpecificSelectionEnabled:!1})()}handle(e){var t=this;return(0,d.Z)(function*(){return!t._isCleanupAllSelectionEnabled&&!t._isCleanupSpecificSelectionEnabled||(0,S.isDataReloading)(e)&&(yield t._cleanupSelectionStates(e)),t.next?.handle(e)})()}};Ct=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.CleanupSelectionStateWhenReloadingDataHandler",requestType:"crt.LoadDataRequest"}),(0,l.__param)(0,(0,s.Inject)(h.FEATURE_VALUES)),(0,l.__param)(0,(0,i.CrtInject)(h.FEATURE_VALUES)),(0,l.__metadata)("design:paramtypes",[h.FeatureValues,D.SchemaService])],Ct);let vt=class extends i.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const r={...e,preventCardClose:!0},a=yield t.next.handle(r);return a&&!e.preventCardClose&&(yield t.handlerChain.process({$context:e.$context,type:"crt.ClosePageRequest"})),a})()}};vt=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.SaveMiniPageHandler",requestType:"crt.SaveRecordRequest",scopes:[S.Scopes.AllMiniCards]})],vt);let yt=class extends i.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const r={type:"crt.ClosePageRequest",$context:e.$context,scopes:e.scopes};yield t.handlerChain.process(r)})()}};yt=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.CancelMiniPageChangesHandler",requestType:"crt.CancelRecordChangesRequest",scopes:[S.Scopes.AllMiniCards]})],yt);let Rt=class extends Wr{_cancelRecord(e){return(0,d.Z)(function*(){e.event.preventDefault(),yield e.$context.executeRequest({type:"crt.CancelRecordChangesRequest",$context:e.$context})})()}_saveRecord(e){return(0,d.Z)(function*(){e.event.preventDefault(),yield e.$context.executeRequest({type:"crt.SaveRecordRequest",$context:e.$context})})()}checkPressedKey(e){var t=this;return(0,d.Z)(function*(){if((0,h.escapePressed)(e.event))return t._cancelRecord(e);if((0,h.ctrlSPressed)(e.event))return t._saveRecord(e)})()}};Rt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleKeyboardHotkeysRequest",type:"crt.KeyboardHotkeysMiniPageHandler",scopes:[S.Scopes.AllMiniCards]})],Rt);let Oe=class extends i.BaseRequestHandler{constructor(e){super(),this._closePageCommand=e}handle(){return this._closePageCommand.execute(),Promise.resolve()}};(0,l.__decorate)([(0,S.CrtCanDiscardUnsavedData)(),(0,l.__metadata)("design:type",Function),(0,l.__metadata)("design:paramtypes",[]),(0,l.__metadata)("design:returntype",Promise)],Oe.prototype,"handle",null),Oe=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.ClosePageHandler",requestType:"crt.ClosePageRequest"}),(0,l.__param)(0,(0,i.CrtInject)(Re)),(0,l.__metadata)("design:paramtypes",[Object])],Oe);let Et=class extends i.BaseRequestHandler{constructor(e,t,r){super(),this._configurationDataService=e,this._userInfo=t,this._requireJs=r.get(h.REQUIRE_JS)}_addNewSchemaDescriptors(e){const t=Terrasoft.configuration.RootSchemaDescriptors;e.forEach(r=>{t[r.schemaName]={path:r.path}})}_getDescriptorsPaths(e){const t={};return e.forEach(r=>{t[r.schemaName]=N.Location.joinWithSlash((0,h.getWorkspaceBaseUrl)(),r.path)}),t}_registerPathInRequireJs(e){this._requireJs.config({paths:e})}_getResourcesPaths(e,t){const r={};if(e.length===0)return r;const a=this._userInfo.cultureInfo.sysCultureName,o=e.find(u=>u.cultureName===a);return o?(o.resources.filter(u=>t.includes(u.schemaName)).forEach(u=>{r[u.resourceSchemaName]=u.paths.map(m=>N.Location.joinWithSlash((0,h.getWorkspaceBaseUrl)(),m))}),r):(console.error(`Resources for culture ${a} not found, when registered schema resources`),r)}_getNewItems(e){const t=Terrasoft.configuration.RootSchemaDescriptors,r=Object.keys(t);return e.filter(a=>!r.includes(a.schemaName)).map(a=>a)}_sendUpdateLeftPanelRequest(e){var t=this;return(0,d.Z)(function*(){const r={type:"crt.NavigationPanelLoadDataRequest",scopes:e.scopes,$context:e.$context};yield t.handlerChain.process(r)})()}_addNewEntityStructure(){var e=this;return(0,d.Z)(function*(){yield(0,p.lastValueFrom)(e._getConfigurationData().pipe((0,p.tap)(t=>{if(t?.data?.entitiesStructure)return e._registerNewEntityStructure(t.data.entitiesStructure)})))})()}_getConfigurationData(){return this._configurationDataService.getData(!0)}_registerNewEntityStructure(e){Terrasoft.configuration.EntityStructure||(Terrasoft.configuration.EntityStructure=[]);const t=Terrasoft.configuration.EntityStructure;e.filter(a=>!t[a.entitySchemaName]).forEach(({entitySchemaName:a,page8x:o,typeColumnName:c,pages:u})=>{const m=u.map(_=>({UId:_.cardSchemaUId,cardSchemaName:_.cardSchemaName,miniPageSchema:_.miniPageSchemaName,schemaGroup:_.schemaGroup,typeColumnName:c}));t[a]={entitySchemaName:a,page8X:o,attribute:c,pages:m}})}_register(e){var t=this;return(0,d.Z)(function*(){const r=e.data,a=r?.schemaPaths;if(!a||a.length===0)return Promise.resolve();Terrasoft.configuration.RootSchemaDescriptors||(Terrasoft.configuration.RootSchemaDescriptors={});const o=t._getNewItems(a);if(o.length===0)return Promise.resolve();const c=r.schemaResourcesPaths||[],u=t._getResourcesPaths(c,o.map(_=>_.schemaName)),m=t._getDescriptorsPaths(o);t._registerPathInRequireJs({...u,...m}),t._addNewSchemaDescriptors(o),yield t._addNewEntityStructure(),yield t._sendUpdateLeftPanelRequest(e)})()}handle(e){var t=this;return(0,d.Z)(function*(){e.data&&(yield t._register(e)),yield t.next?.handle(e)})()}};Et=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.ConfigurationStructureChangeRequest",type:"crt.ConfigurationStructureChangeRequestHandler",scopes:[]}),(0,l.__metadata)("design:paramtypes",[y.ConfigurationDataService,h.UserInfo,s.Injector])],Et);let Tt=class extends i.BaseRequest{};Tt=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.7XRequest"})],Tt);let Dt=class extends i.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,a=r.dataSchemas,o=Object.entries(a).filter(([,c])=>c.dataSourceConfig?.config?.entitySchemaName===e.entitySchemaName).map(([c])=>c);for(const c of o)yield t.handlerChain.process({type:"crt.HandleModelEventRequest",$context:r,modelName:c,modelEvent:e.modelEvent});return t.next?.handle(e)})()}};Dt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.7XHandleModelEventRequest",type:"crt.CrtModelEventHandler"})],Dt);const ra="ConfigurationStructureUpdateSubscriptionAttribute";let Pt=class extends i.BaseRequestHandler{constructor(e){super(),this._serverClientOperationNotificationReceiver=e}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,{scopes:a,$context:o}=e;r[ra]=t._serverClientOperationNotificationReceiver.getNotifications("ConfigurationStructureChanged").subscribe(c=>{const u={type:"crt.ConfigurationStructureChangeRequest",data:c,scopes:a,$context:o};t.handlerChain.process(u)}),yield t.next?.handle(e)})()}};Pt=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.ConfigurationStructureUpdateHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["MainShell"]}),(0,l.__metadata)("design:paramtypes",[y.ServerClientOperationNotificationReceiver])],Pt);let At=class extends i.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){e.$context[ra]?.unsubscribe(),yield t.next?.handle(e)})()}};At=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.ConfigurationStructureUpdateDestroyHandler",requestType:"crt.HandleViewModelDestroyRequest",scopes:["MainShell"]})],At);let It=class extends i.BaseRequestHandler{constructor(e,t){super(),this._navigationService=e,this._messageDialogProvider=t}_convertValue(e,t){return typeof e=="object"&&e?.value?{attributeName:t,value:{displayValue:e.displayValue,primaryColorValue:e.primaryColorValue,value:e.value}}:{attributeName:t,value:e}}_getDefaultValuesByModel(e,t,r,a){const o=[];return a&&Object.entries(a).forEach(([c,u])=>{const m=t[c],_=u.modelConfig?.path,f=r?.find(P=>`${e}.${P.path}`===_);if(!m||!_||!f?.name)return;const v=this._convertValue(m,f.name);o.push(v)}),o}_generateModelInitConfigs(e,t,r){const a=(0,R.cloneDeep)(e.modelInitConfigs?.filter(m=>m.name!==t)||[]),o=e.modelInitConfigs?.find(m=>m.name===t);return[{defaultValues:this._mergeDefaultValues(o?.defaultValues,r)||[],action:o?.action,recordId:o?.recordId},...a.filter(Boolean)]}_showErrorMessage(){this._messageDialogProvider.open({data:{message:"InfoDialog.OpenPage.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}_mergeDefaultValues(e,t){if((0,R.isEmpty)(e))return t||[];const r=(0,R.cloneDeep)(e);return t.forEach(a=>{const o=r.find(c=>c.attributeName===a.attributeName);o?o.value=a.value:r.push(a)}),r}handle(e){var t=this;return(0,d.Z)(function*(){try{const r=e.$context,a=yield r.getPrimaryModelName(),o=yield r.getPrimaryDataSchema(),c=o.name,u=t._getDefaultValuesByModel(a,r.attributes,o.attributes,r.viewModelConfig.attributes),m=u?.slice(-1),_=yield T.NavigationUtils.getPageForActionAsync({entityName:c,defaultValues:m});if((0,R.isEmpty)(_?.cardSchema)){t._showErrorMessage();return}const f=t._generateModelInitConfigs(r,a,u),v=new T.SchemaNavigationOptions(_.cardSchema);v.modelInitConfigs=f;const P={mode:T.NavigationMode.Replace,options:v};return yield t._navigationService.navigate(P),t.next?.handle(e)}catch(r){const a=r.message;console.error(a);return}})()}};It=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.ContinueInOtherPageRequest",type:"crt.ContinueInOtherPageHandler"}),(0,l.__metadata)("design:paramtypes",[T.CrtNavigationService,g.MessageDialogProvider])],It);let aa=class extends i.BaseRequest{constructor(){super(...arguments),this.type="crt.CopyRecordRequest"}};aa=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.CopyRecordRequest"})],aa);let Ve=class extends i.BaseRequestHandler{_getEntitySchemaName(e){var t=this;return(0,d.Z)(function*(){const r=yield t._getDataSourceName(e);return e.$context.dataSchemas[r]?.dataSourceConfig?.config?.entitySchemaName})()}_getDataSourceName(e){const t=e.$context.getBoundDataSourceName(e.itemsAttributeName);return t||e.$context.getPrimaryModelName()}handle(e){var t=this;return(0,d.Z)(function*(){const r=yield t._getEntitySchemaName(e),a={type:"crt.7XRequest",action:"CopyRecord",$context:e.$context,payload:{entityName:e.entityName??r,recordId:e.recordId}};yield t.handlerChain.process(a)})()}};(0,l.__decorate)([(0,S.CrtCanDiscardUnsavedData)(),(0,l.__metadata)("design:type",Function),(0,l.__metadata)("design:paramtypes",[Object]),(0,l.__metadata)("design:returntype",Promise)],Ve.prototype,"handle",null),Ve=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.CopyRecordRequest",type:"crt.CopyRecordHandler",scopes:[]})],Ve);let Nt=class extends i.BaseRequestHandler{constructor(e){super(),this._dataSchemaRepository=e}handle(e){var t=this;return(0,d.Z)(function*(){const r=yield(0,p.firstValueFrom)(t._dataSchemaRepository.get(e.schemaName)),a={type:"crt.7XRequest",action:"AddRecordFromEditLookupCell",$context:e.$context,payload:{attributeName:e.attributeName,entityName:r.name,displayValue:e.detail?.searchValue||"",displayColumn:r.primaryDisplayAttributeName}};yield t.handlerChain.process(a)})()}};Nt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.CreateRecordFromEditLookupCellRequest",type:"crt.CreateRecordFromEditLookupCellHandler"}),(0,l.__metadata)("design:paramtypes",[S.DataSchemaRepositoryService])],Nt);let Mt=class extends i.BaseRequestHandler{constructor(e,t){super(),this._window=e,this._environmentInjector=t}_getDataSchema(e){const t=this._getDataSourceName(e);return e.$context.dataSchemas[t]}_getDataSourceName(e){return e.$context.getBoundDataSourceName(e.itemsAttributeName)}handle(e){var t=this;return(0,d.Z)(function*(){(0,R.get)(t._window,"Terrasoft")?.isAngularHost||t._environmentInjector.get(E.Lu,null,{optional:!0})?.closeModals();const r=t._getDataSchema(e),a={type:"crt.7XRequest",action:"AddRecordFromLookup",$context:e.$context,payload:{attributeName:e.attributeName,entityName:e.schemaName??r?.name,displayValue:e.detail?.searchValue||"",displayColumn:r?.primaryDisplayAttributeName,defaultValues:e?.defaultValues}};yield t.handlerChain.process(a)})()}};Mt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.CreateRecordFromLookupRequest",type:"crt.CreateRecordFromLookupHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards,S.Scopes.AllLookupSelectionWindows]}),(0,l.__param)(0,(0,i.CrtInject)(I.WINDOW_TOKEN)),(0,l.__metadata)("design:paramtypes",[Window,s.EnvironmentInjector])],Mt);let xt=class extends i.BaseRequestHandler{constructor(e,t){super(),this._customEventService=e,this._window=t}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context;return(0,R.get)(t._window,"Terrasoft")?.isAngularHost&&(t._subscription=t._subscribeOnCardModuleResponse(e),r._subscriptions.add(t._subscription)),yield t.next?.handle(e),t._subscription})()}_subscribeOnCardModuleResponse(e){const t=e.$context;return this._customEventService.subscribe("CardModuleResponse").pipe((0,M.switchMap)(r=>{const a=r.action==="edit"?S.ModelEventType.Update:S.ModelEventType.Create;return i.HandlerChainService.instance.process({type:"crt.7XHandleModelEventRequest",$context:t,entitySchemaName:r.entitySchemaName,modelEvent:{type:a,payload:{primaryAttributesValues:[[{value:r.uId,name:r.primaryColumnName}]]}}})})).subscribe()}};xt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleViewModelInitRequest",type:"crt.CreateUpdateRecordFrom7XHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards,S.Scopes.AllLookupSelectionWindows]}),(0,l.__param)(1,(0,i.CrtInject)(I.WINDOW_TOKEN)),(0,l.__metadata)("design:paramtypes",[I.CustomEventService,Window])],xt);var os=C(83232),ns=C(23074);let bt=class extends i.BaseRequestHandler{constructor(e,t){super(),this._workspaceExplorerService=e,this._schemaCacheService=t}handle(e){return(0,p.lastValueFrom)(this._workspaceExplorerService.delete([{type:os.WorkspaceItemType.ClientUnitSchema,uId:e.schemaUid}]).pipe((0,p.tap)(t=>{t.success&&this._schemaCacheService.invalidateClientUnitSchema(e.schemaName)})))}};bt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.DeleteClientUnitSchemaRequest",type:"crt.DeleteClientUnitSchemaHandler"}),(0,l.__metadata)("design:paramtypes",[ns.WorkspaceExplorerService,D.SchemaCacheService])],bt);let wt=class extends i.BaseRequestHandler{_getDataSourceName(e){return(0,d.Z)(function*(){const t=e.$context,r=t.getBoundDataSourceName(e.itemsAttributeName);if(r)return r;const a=yield t.getPrimaryModelName();return a||Xr(t)})()}handle(e){var t=this;return(0,d.Z)(function*(){const r=yield t._getDataSourceName(e);return t.handlerChain.process({type:"crt.DeleteRecordsRequest",$context:e.$context,dataSourceName:r,recordIds:[e.recordId],scopes:e.scopes})})()}};wt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.DeleteRecordRequest",type:"crt.DeleteRecordHandler"})],wt);let kt=class extends i.BaseRequestHandler{constructor(e,t,r,a,o,c){super(),this._messageDialogProvider=e,this._translateService=t,this._multiDeleteService=r,this._notifyService=a,this._userInfo=o,this._maskService=c}_getTaskName(e){return"DELETING_"+e.dataSourceName+"_RECORDS"}_openInfoDialog(e){var t=this;return(0,d.Z)(function*(){yield(0,p.lastValueFrom)(t._messageDialogProvider.open({data:{message:e,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}))})()}_displayErrorDialog(e){const t=e?.message;t&&this._notifyService.error({message:t,translate:!1})}_validateRequest(e){const{filters:t,recordIds:r}=e??{};if(t&&r?.length)throw new Error('Cannot delete records: concurrently set "filters" and "recordIds" are not supported.');if(!t&&!r?.length)throw new Error(this._translateService.instant("InfoDialog.SelectRecordsToDelete"))}_canDelete(e,t){return(0,d.Z)(function*(){const r=e.dataSourceName;return(yield e.$context.canDelete(r,{primaryColumnValue:t}))?.result})()}_tryDeleteRecords(e){var t=this;return(0,d.Z)(function*(){yield t._maskService.showMask(t._getTaskName(e),e.$context);try{const{success:r,error:a}=yield t._deleteRecords(e);yield t._maskService.hideMask(t._getTaskName(e),e.$context),!r&&a&&(yield t._openInfoDialog(a))}catch{yield t._maskService.hideMask(t._getTaskName(e),e.$context),yield t._openInfoDialog("InfoDialog.UnableToDeleteSelectedRecord")}})()}_deleteRecords(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,a=r.dataSchemas[e.dataSourceName],o=t._createDeleteRecordsConfig(e,a),c=t._createMultiDeleteStartRequest(o,a,r);return yield t.handlerChain.process(c),(0,p.firstValueFrom)(t._multiDeleteService.deleteRecords(o))})()}_createDeleteRecordsConfig(e,t){const{filters:r,recordIds:a}=e,o=t?.dataSourceConfig?.config?.entitySchemaName;return{operationKey:(0,i.generateGuid)(),entitySchemaName:o,filters:r instanceof i.FilterGroup?(0,Qe.classToPlain)(r):r,primaryColumnValues:a}}_createMultiDeleteStartRequest(e,t,r){const{operationKey:a,entitySchemaName:o,primaryColumnValues:c}=e,u=c?.length?c.map(m=>({name:t.primaryAttributeName,value:m})):null;return{type:"crt.7XRequest",action:"MultiDeleteStart",$context:r,payload:{operationKey:a,entitySchemaName:o,removedDataInfo:u}}}_showInsufficientRightsDialog(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,a=r.dataSchemas[e.dataSourceName];yield t._maskService.hideMask(t._getTaskName(e),r);const o=a?.caption,u=t._translateService.instant("InfoDialog.RightLevelWarningMessage").replace("{0}",o);yield t._openInfoDialog(u)})()}_confirmRecordsDelete(e){var t=this;return(0,d.Z)(function*(){const r=e?"ConfirmationDialog.DeleteRecordConfirmation":"ConfirmationDialog.DeleteRecordsConfirmation",a=t._messageDialogProvider.open({data:{message:r,actions:[g.DEFAULT_DIALOG_ACTIONS.NO,g.DEFAULT_DIALOG_ACTIONS.YES]}});return(yield(0,p.lastValueFrom)(a))===g.DEFAULT_DIALOG_ACTIONS.YES.key})()}handle(e){var t=this;return(0,d.Z)(function*(){try{t._validateRequest(e);const r=e.recordIds?.length===1;yield t._maskService.showMask(t._getTaskName(e),e.$context);const a=yield t._canDelete(e,r?e.recordIds[0]:null);return yield t._maskService.hideMask(t._getTaskName(e),e.$context),a?(yield t._confirmRecordsDelete(r))?t._tryDeleteRecords(e):void 0:t._showInsufficientRightsDialog(e)}catch(r){t._displayErrorDialog(r)}finally{yield t._maskService.hideMask(t._getTaskName(e),e.$context)}})()}};kt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.DeleteRecordsRequest",type:"crt.DeleteRecordsHandler"}),(0,l.__param)(5,(0,i.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider,w.TranslateService,y.MultiDeleteService,x.NotifyService,h.UserInfo,i.MaskService])],kt);let sa=class extends i.BaseRequest{};sa=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.DownloadEntityFileRequest"})],sa);let Ot=class extends i.BaseRequestHandler{constructor(e){super(),this.fileApiService=e}handle(e){var t=this;return(0,d.Z)(function*(){return yield t.fileApiService.download(e.detail.file.url,e.detail.file.displayValue)})()}};Ot=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.DownloadEntityFileRequest",type:"crt.DownloadEntityFileHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards]}),(0,l.__metadata)("design:paramtypes",[h.FileApiService])],Ot);let Vt=class extends i.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,{referenceSchemaName:a}=yield(0,S.getEntitySchemaAttribute)(r,e.primaryAttributeName),o={type:"crt.7XRequest",action:"HandleEmailLinkClick",$context:r,$initialEvent:{...e.$initialEvent,recordId:e.recordId,primaryDisplayName:e.primaryDisplayName,entitySchemaName:a,emailAddress:e.emailAddress}};return yield t.handlerChain.process(o)})()}};Vt=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.EmailLinkClickHandler",requestType:"crt.EmailLinkClickRequest",scopes:[]})],Vt);var is=C(42378),cs=C.n(is);class Fe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Fe.prototype)}}class He extends Error{constructor(e){super(e),Object.setPrototypeOf(this,He.prototype)}}let Be=class extends i.BaseRequestHandler{constructor(e,t,r,a,o,c,u,m,_){var f;super(),f=this,this._rightsService=e,this._messageDialogProvider=t,this._exportToExcelService=r,this._resourceFinderService=a,this._entitySchemaQueryBuilder=o,this._translateService=c,this._dataSchemaToDataSourceAttributeConverter=u,this._dateTimeFormatToken=m,this._maskService=_,this._exportEntityOperationName="Export",this._exportOperationCode="CanExportGrid",this._maximumFileNameLength=76,this._defaultDateTimePattern="DD_MM_YYYY_HH_mm",this._isCanExecuteExportExcelOperation=(0,d.Z)(function*(){return(0,p.firstValueFrom)(f._rightsService.getCanExecuteOperation(f._exportOperationCode))}),this._isCanExecuteEntityExportOperation=function(){var v=(0,d.Z)(function*(P){return(0,p.firstValueFrom)(f._rightsService.getCanExecuteEntityOperation(P,f._exportEntityOperationName))});return function(P){return v.apply(this,arguments)}}(),this._isCanExportToExcel=function(){var v=(0,d.Z)(function*(P){return(yield f._isCanExecuteExportExcelOperation())||(yield f._isCanExecuteEntityExportOperation(P.name))});return function(P){return v.apply(this,arguments)}}(),this._handleError=v=>this._messageDialogProvider.open({data:{message:this._getDialogErrorMessage(v),actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}),this.getItemsAttributeName=v=>v?.items.toString().split("$").pop()}_searchAttributeInDataSchema(e,t){const r=e.attributes?.find(a=>a.name===t);return r?this._dataSchemaToDataSourceAttributeConverter.create(r.attributeType).convert(r):null}_buildColumnAttribute(e,t,r,a){var o=this;return(0,d.Z)(function*(){let c,u;if(typeof e=="string")c=e;else{const f=r[e.code]??{};(0,S.isModelAttributeConfig)(f)&&(c=f?.modelConfig?.path?.split(".")?.slice(1)?.join(".")??""),u=e.caption}const m=o._searchAttributeInDataSchema(t,c),_=yield o._resourceFinderService.findViewModelResourceValue(u,a);return m?{...m,path:m.path||c,caption:_||null}:{type:"default",path:c,name:c,caption:_||null}})()}_createColumns(e,t,r,a){var o=this;return(0,d.Z)(function*(){const c=[];if(!e.columns)return c;for(const u of e.columns){const m=yield o._buildColumnAttribute(u,t,r,a.$context.Resources);c.push(m)}return c})()}_buildEsq(e,t){var r=this;return(0,d.Z)(function*(){const a=e.$context,o=r.getViewConfig(e),c=r.getItemsAttributeName(o),u=a.getBoundDataSourceNameByAttributePath(c),m=yield a.getDataSourceLoadParameters(u);m||r.throwSettingsExportError();const _=a.getAttributeViewModelConfig(c),f=yield r._createColumns(o,t,_,e),v={pagingConfig:m.options.pagingConfig,sortingConfig:m.options.sortingConfig};return(0,p.firstValueFrom)(r._entitySchemaQueryBuilder.build(t,f,m.parameters,v))})()}_buildFileName(e){const t=this._getDateTimePattern(),r=cs()(new Date).format(t),a=this.getExportedViewTitle(e);return`${this._formattingFileName(a,r.length)}_${r}`}_getDateTimePattern(){if(!this._dateTimeFormatToken)return this._defaultDateTimePattern;const e=this._dateTimeFormatToken.shortDatePattern,t=this._dateTimeFormatToken.shortTimePattern;return`${e}_${t}`.replace(/[^\w]/gi,"_")}_formattingFileName(e,t){const r=this._maximumFileNameLength-t;return(0,h.stripFileName)(e).substring(0,r)}_export(e){var t=this;return(0,d.Z)(function*(){const r=t.getDataSchema(e);if(!(yield t._isCanExportToExcel(r)))throw new Fe;const a=yield t._buildEsq(e,r),o=t.getFilters(e);o&&(a.clearFilters(),Object.entries(o.items).forEach(([u,m])=>{a.filters.add(m,u)}));const c=t._buildFileName(e);return(0,p.firstValueFrom)(t._exportToExcelService.exportRecordsFromEsqToExcel(a?.getMetadata(),c).pipe((0,M.map)(u=>{if(!u?.GetExportToExcelKeyResult?.success)throw new Error(u.GetExportToExcelKeyResult.errorInfo.message)})))})()}_getDialogErrorMessage(e){return e instanceof Fe?this._translateService.instant("InfoDialog.ExportToExcel.PermissionsErrorMessage"):e instanceof He?this._translateService.instant("InfoDialog.SettingsErrorMessage"):e.message}throwSettingsExportError(){throw new He}getDataSchema(e){const t=e.$context,r=this.getViewItemsAttributeName(e),a=t.getBoundDataSchemaByAttributePath(r);return a||this.throwSettingsExportError(),a}getFilters(e){return null}handle(e){var t=this;return(0,d.Z)(function*(){const r=t.getTaskName(e);try{return t._maskService.showMask(r,e.$context),yield t._export(e)}catch(a){t._handleError(a)}finally{t._maskService.hideMask(r,e.$context)}})()}};Be=(0,l.__decorate)([(0,l.__param)(6,(0,s.Inject)(S.DATA_SCHEMA_TO_DATA_SOURCE_ATTRIBUTE_CONVERTER_FACTORY)),(0,l.__param)(7,(0,s.Inject)(h.DATE_TIME_FORMAT_INFO)),(0,l.__param)(8,(0,s.Inject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[y.RightsService,g.MessageDialogProvider,y.ExportToExcelService,h.ResourceFinderService,S.EntitySchemaQueryBuilder,w.TranslateService,I.Factory,Object,i.MaskService])],Be);let Ft=class extends Be{getViewConfig(e){return{columns:(Array.isArray(e.columns),e.columns),items:`$${this.getViewItemsAttributeName(e)}`}}getViewItemsAttributeName(e){return e.viewModelAttributeName}getExportedViewTitle(e){return e.fileName}getTaskName(e){return"EXPORT_CHART_DATA_GRID_TO_EXCEL_"+e.fileName}constructor(e,t,r,a,o,c,u,m,_){super(e,t,r,a,o,c,u,m,_)}};Ft=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.ExportChartDataGridToExcelRequest",type:"crt.ExportChartDataGridToExcelHandler"}),(0,l.__param)(6,(0,i.CrtInject)(S.DATA_SCHEMA_TO_DATA_SOURCE_ATTRIBUTE_CONVERTER_FACTORY)),(0,l.__param)(7,(0,i.CrtInject)(h.DATE_TIME_FORMAT_INFO)),(0,l.__param)(8,(0,i.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[y.RightsService,g.MessageDialogProvider,y.ExportToExcelService,h.ResourceFinderService,S.EntitySchemaQueryBuilder,w.TranslateService,I.Factory,Object,i.MaskService])],Ft);let Ht=class extends Be{getFilters(e){return e.filters}getViewConfig(e){return this._schemaService.getViewConfigInfoByName(e.viewName)?.viewConfig}getViewItemsAttributeName(e){const t=this.getViewConfig(e);return t?.items||this.throwSettingsExportError(),this.getItemsAttributeName(t)}getExportedViewTitle(e){const t=this.getDataSchema(e);return(0,h.getLocalizableStringValue)(t.caption,this._translateService.currentLang)}getTaskName(e){return"EXPORT_DATA_GRID_TO_EXCEL_"+e.viewName}constructor(e,t,r,a,o,c,u,m,_,f){super(e,t,r,a,o,c,u,m,_),this._schemaService=f}};Ht=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.ExportDataGridToExcelRequest",type:"crt.ExportDataGridToExcelHandler"}),(0,l.__param)(6,(0,i.CrtInject)(S.DATA_SCHEMA_TO_DATA_SOURCE_ATTRIBUTE_CONVERTER_FACTORY)),(0,l.__param)(7,(0,i.CrtInject)(h.DATE_TIME_FORMAT_INFO)),(0,l.__param)(8,(0,i.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[y.RightsService,g.MessageDialogProvider,y.ExportToExcelService,h.ResourceFinderService,S.EntitySchemaQueryBuilder,w.TranslateService,I.Factory,Object,i.MaskService,D.SchemaService])],Ht);class oa extends i.BaseRequestHandler{_getOpenLookupPageRequestConfig(e){const t=e.$context;return{type:"crt.OpenLookupPageRequest",$context:t,scopes:e.scopes,features:this.getLookupPageFeatures(),entitySchemaName:this.getLookupPageEntitySchemaName(e),caption:this.getLookupPageCaption(e),filtersConfig:this._getLookupPageFiltersConfig(e),afterClosed:r=>this._afterClosedLookupPageAction(e,r)}}_getLookupPageFiltersConfig(e){const t=this.getLookupPageFilter(e);if(!t)return;const r="lookup_page_filter";return{filterAttributes:[{name:r,loadOnChange:!1}],attributesConfig:{[r]:{value:t}}}}_afterClosedLookupPageAction(e,t){this.maskService.showMask(this.getMaskTaskName(e),e.$context),this.runServiceAction(e,t).pipe((0,p.tap)(()=>{this.maskService.hideMask(this.getMaskTaskName(e),e.$context)})).subscribe(r=>{this._processServiceResult(e,r)})}_processServiceResult(e,t){const r={message:t.message,translate:!1};if(t.success){this.showSuccessNotification(e,r);return}this.notifyService.error(r)}_validateRequest(e){return this._validateRequestDataSource(e)&&this._validateRequestFilters(e)}_validateRequestDataSource(e){return e.dataSourceName?!0:(this.messageDialogProvider.open({data:{message:"InfoDialog.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}),!1)}_validateRequestFilters(e){return this._isValidFilters(e.filters)?!0:(this.notifyService.error({message:this.invalidErrorMessageForSelectRecordsValidator,translate:!0}),!1)}_isValidFilters(e){return(0,R.isObject)(e)&&"items"in e&&!(0,R.isEmpty)(e.items)}constructor(e){super(),this.injector=e,this.notifyService=e.get(x.NotifyService),this.maskService=e.get(i.MaskService),this.messageDialogProvider=e.get(g.MessageDialogProvider)}getLookupPageFeatures(){return{create:{enabled:!1},select:{multiple:!0,selectAll:!1,resultType:A.pb.Filter}}}getLookupPageFilter(e){return null}showSuccessNotification(e,t){this.notifyService.show(t)}getRelatedRecordsSchemaName(e){return e.$context.dataSchemas[e.dataSourceName]?.name}runServiceAction(e,t){const r=this.createServiceData(e,t);return this.openLookupPageMode==="AddRecords"?this.addRecordsServiceAction(r):this.removeRecordsServiceAction(r)}addRecordsServiceAction(e){return this.baseRelatedInMainRecordsService.addRelatedRecords(e)}removeRecordsServiceAction(e){return this.baseRelatedInMainRecordsService.removeRelatedRecords(e)}initializeData(e){}handle(e){var t=this;return(0,d.Z)(function*(){if(!t._validateRequest(e))return;yield t.initializeData(e);const r=t._getOpenLookupPageRequestConfig(e);yield t.handlerChain.process(r)})()}}class na extends oa{get invalidErrorMessageForSelectRecordsValidator(){return`InfoDialog.RecordsInStaticFolders.SelectRecordsTo${this.openLookupPageMode}Message`}_updateStaticFolderDataSource(e){var t=this;if(!e.$context.isDataSourceForCollection(e.dataSourceName))return;const a={type:"crt.LoadDataRequest",$context:e.$context,dataSourceName:e.dataSourceName,config:{loadType:i.DataSourceLoadType.Reload}};setTimeout((0,d.Z)(function*(){yield t.handlerChain.process(a)}))}constructor(e){super(e),this.injector=e,this.baseRelatedInMainRecordsService=e.get(E.N1)}showSuccessNotification(e,t){super.showSuccessNotification(e,t),this._updateStaticFolderDataSource(e)}createServiceData(e,t){const r=this.getRelatedRecordsSchemaName(e);return{relatedRecordsSchemaName:r,relatedRecordColumnName:this._oldInFolderColumnSchemaName,relatedRecordsFilters:e.filters,relatedInMainRecordsSchemaName:(0,g.getOldInFolderEntitySchemaName)(r),mainRecordsSchemaName:(0,g.getOldFolderEntitySchemaName)(r),mainRecordColumnName:g.STATIC_FOLDER_COLUMN_NAME,mainRecordsFilters:t}}getLookupPageEntitySchemaName(e){const t=e.$context.dataSchemas[e.dataSourceName]?.name;return(0,g.getOldFolderEntitySchemaName)(t)}getLookupPageCaption(e){}getLookupPageFilter(e){const t=new i.FilterGroup;return t.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"FolderType",g.STATIC_FOLDER_TYPE_ID,"StaticFolderTypeFilter"),t}getMaskTaskName(e){return`RecordsInStaticFolders_${this.getRelatedRecordsSchemaName(e)}`}initializeData(e){var t=this;return(0,d.Z)(function*(){const r=t.getRelatedRecordsSchemaName(e);t._oldInFolderColumnSchemaName=yield(0,g.getOldInFolderReferenceColumnName)(r)})()}}let Bt=class extends na{constructor(e){super(e),this._injector=e,this.openLookupPageMode="AddRecords"}};Bt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.AddRecordsInStaticFoldersRequest",type:"crt.AddRecordsInStaticFoldersHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Bt);let Lt=class extends na{constructor(e){super(e),this._injector=e,this.openLookupPageMode="RemoveRecords"}};Lt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.RemoveRecordsInStaticFoldersRequest",type:"crt.RemoveRecordsInStaticFoldersHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Lt);let Ut=class extends i.BaseRequestHandler{_buildImportManagerUrl(e){const t=(0,h.getWorkspaceBaseUrl)(),r="NUI",a="ViewModule.aspx?isFreedomUI=true&vm=FileImportWizard#FileImportModule/FileImportStartPage",o=(0,i.generateGuid)(),c=e.entitySchemaName||"";return(0,h.joinPath)(t,r,a,o,c)}_openImportManager(e){const t=this._buildImportManagerUrl(e);this._window.open(t,"_blank")}_showOperationProhibitionDialog(){var e=this;return(0,d.Z)(function*(){return(0,p.firstValueFrom)(e._dialogService.openOperationPermissionsErrorDialog(e._importOperationName))})()}_isCanImportFromExcel(){var e=this;return(0,d.Z)(function*(){return(0,p.firstValueFrom)(e._rightsService.getCanExecuteOperation(e._importOperationName))})()}constructor(e,t,r){super(),this._rightsService=e,this._dialogService=t,this._window=r,this._importOperationName="CanImportFromExcel"}handle(e){var t=this;return(0,d.Z)(function*(){if(!(yield t._isCanImportFromExcel())){yield t._showOperationProhibitionDialog();return}t._openImportManager(e)})()}};Ut=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.ImportDataRequest",type:"crt.ImportDataHandler"}),(0,l.__param)(2,(0,i.CrtInject)(I.WINDOW_TOKEN)),(0,l.__metadata)("design:paramtypes",[y.RightsService,x.DialogService,Object])],Ut);let ia=class extends i.BaseRequest{};ia=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.LoadRightsModuleRequest"})],ia);let Gt=class extends i.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,a={type:"crt.7XRequest",action:"LoadRightsModule",$context:r,payload:{...e.payload}};return yield t.handlerChain.process(a)})()}};Gt=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.LoadRightsModuleHandler",requestType:"crt.LoadRightsModuleRequest",scopes:[]})],Gt);let $t=class extends i.BaseRequestHandler{constructor(){super(...arguments),this._emptySelectionState={type:"specific",selected:[]}}_getSelectedRowsCount(e){return e.type==="specific"?e.selected.length:null}handle(e){var t=this;return(0,d.Z)(function*(){const r=`${e.itemsAttributeName}_${g.GRID_SELECTION_STATE_ATTRIBUTE_NAME}`,a=(yield e.$context[r])??t._emptySelectionState,o=new D.SelectionStateModel(a,!0),c=o.isSelected(e.rowId),u=t._getSelectedRowsCount(a);c&&u===1||(o.toggleSelection(e.rowId),e.$context[r]=o.state),(!c&&u===0||c&&u===1)&&(yield i.HandlerChainService.instance.process({type:"crt.SelectLookupPageRequest",$context:e.$context,scopes:[...e.scopes]}))})()}};$t=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.LookupPageDataGridRowDoubleClickHandler",requestType:"crt.LookupPageDataGridRowDoubleClickRequest",scopes:["BaseLookupPageTemplate"]})],$t);let jt=class extends Wr{_cancelRecord(e){return(0,d.Z)(function*(){e.event.preventDefault(),yield e.$context.executeRequest({type:"crt.ClosePageRequest",$context:e.$context})})()}checkPressedKey(e){var t=this;return(0,d.Z)(function*(){if((0,h.escapePressed)(e.event))return t._cancelRecord(e)})()}};jt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleKeyboardHotkeysRequest",type:"crt.LookupPageKeyboardHotkeysHandler",scopes:["BaseLookupPageTemplate"]})],jt);let Zt=class extends i.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const r=yield t.next?.handle(e),a=`${Z}_${g.GRID_SELECTION_STATE_ATTRIBUTE_NAME}`,o=yield e.$context[a],c=o?.selected??[],u=(yield e.$context[Ie])??!1,m=e.primaryAttributeValue?.value;c.includes(m)||(e.$context[a]={type:o?.type??"specific",selected:u?c.concat(...r):[...r]})})()}};Zt=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.LookupPageSetDataGridSelectionStateHandler",requestType:"crt.SetTopRecordRequest",scopes:[S.Scopes.AllLookupSelectionWindows]})],Zt);var ca=C(8785);let qt=class extends i.BaseRequestHandler{constructor(e){super(),this._injector=e,this._pageLookupData=this._injector.get(A.HO)}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,a=yield r[ee];r[ee]=ca.String.format(t._pageLookupData.header,a),yield t.next?.handle(e)})()}};qt=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.LookupPageViewModelInitHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["BaseLookupPageTemplate"]}),(0,l.__metadata)("design:paramtypes",[s.Injector])],qt);let Kt=class extends i.BaseRequestHandler{constructor(e){super(),this._notifyService=e}handle(e){var t=this;return(0,d.Z)(function*(){yield t._notifyService.show({message:e.message,translate:e.translate,closeOnClickOutside:!1,duration:e.duration})})()}};Kt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.NotificationRequest",type:"crt.NotificationHandler"}),(0,l.__metadata)("design:paramtypes",[x.NotifyService])],Kt);let zt=class extends i.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){if(!e.entityName)return;const r={type:"crt.7XRequest",action:"OpenDuplicatesPage",$context:e.$context,payload:{entityName:e.entityName,schemaName:"LazyDuplicatesPageV2"}};yield t.handlerChain.process(r)})()}};zt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.OpenDuplicatesPageRequest",type:"crt.OpenDuplicatesPageHandler"})],zt);var Le=C(65181);class ie{constructor(e,t){this._pageLookupData=e,this._featureService=t,this._typedPagesFeatureName="DisableTypedPagesForSelectionWindow"}_setupForMenuMode(e){e?.menuItems?.forEach(t=>{t.clicked.request="crt.CreateRecordFromLookupRequest",t.clicked.params?.defaultValues?.length&&(t.clicked.params={schemaName:this._pageLookupData.entitySchemaName,attributeName:Ae,defaultValues:[...t.clicked.params.defaultValues]})})}_setupForDefaultMode(e){const t=e.clicked.params?.defaultValues;e.clicked={request:"crt.CreateRecordFromLookupRequest",params:{schemaName:this._pageLookupData.entitySchemaName,attributeName:Ae}},t?.length&&(e.clicked.params.defaultValues=[...t])}_setupAddNewButton(e){this._getNewButtons(e).forEach(({viewConfig:r})=>r.clickMode==="menu"?this._setupForMenuMode(r):this._setupForDefaultMode(r))}_getNewButtons(e){const t=h.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig),r="NewButton";return t.filter(({viewConfig:a})=>a.name===r||a?.clicked?.request==="crt.CreateRecordRequest")}_setupButtonEntityNameParameter(e){this._getNewButtons(e).forEach(({viewConfig:r})=>{if(r.visible=`$${Pe}`,this._pageLookupData?.features?.create?.enabled){if(!r.clicked){r.clicked={params:{entityName:this._pageLookupData.entitySchemaName}};return}r.clicked.params={...r.clicked?.params??{},entityName:this._pageLookupData.entitySchemaName}}})}_setupAddNewButtonWithoutTypedPages(e){this._getNewButtons(e).forEach(({viewConfig:r})=>{r.visible=`$${Pe}`,this._pageLookupData?.features?.create?.enabled&&(r.clicked={request:"crt.CreateRecordFromLookupRequest",params:{schemaName:this._pageLookupData.entitySchemaName,attributeName:Ae}})})}crtGetIsPreventCaching(){return Promise.resolve(!0)}crtOnMetaDataInit(e){var t=this;return(0,d.Z)(function*(){const r=e,a=r.viewModelConfig.attributes;return a[Pe]={value:t._pageLookupData?.features?.create?.enabled??!1},t._typedPagesFeatureEnabled=!(yield(0,p.lastValueFrom)(t._featureService.getFeatureState(t._typedPagesFeatureName))),t._typedPagesFeatureEnabled?t._setupButtonEntityNameParameter(r):t._setupAddNewButtonWithoutTypedPages(r),Promise.resolve(e)})()}crtOnViewModelInit(e,t,r){const a=e;return this._pageLookupData?.features?.create?.enabled&&this._typedPagesFeatureEnabled&&this._setupAddNewButton(a),Promise.resolve(e)}}ie.\u0275fac=function(e){return new(e||ie)(s.\u0275\u0275inject(A.HO,8),s.\u0275\u0275inject(y.FeatureService))},ie.\u0275prov=s.\u0275\u0275defineInjectable({token:ie,factory:ie.\u0275fac});class ce{constructor(e,t){this._pageLookupData=e,this._entitySchemaService=t}_setDataSourcesConfig(e){const a=e.modelConfig.dataSources[ve].config;a.entitySchemaName=this._pageLookupData.entitySchemaName,a.useRecordDeactivation=!this._pageLookupData.features?.showDeactivatedRecords}_setAttribute(e,t){if(!t)return;const r=ve+"_"+t,a=ve+"."+t;e[r]?e[r].modelConfig.path=a:e[r]={modelConfig:{path:a}}}_setAttributesPath(e,t){const o=e.viewModelConfig.attributes[Z].viewModelConfig?.attributes,c=t.getPrimaryColumn();this._setAttribute(o,c?.name);const u=t.getPrimaryDisplayColumn();this._setAttribute(o,u?.name);const m=t.getPrimaryColorColumn();this._setAttribute(o,m?.name)}_setPredefinedFilter(e){const t=this._pageLookupData.filtersConfig;if(t){const r=e.viewModelConfig,a=r.attributes[Z],o=a.modelConfig.filterAttributes;a.modelConfig.filterAttributes=[...o,...t.filterAttributes],Object.assign(r.attributes,t.attributesConfig)}}_getEntitySchema(){var e=this;return(0,d.Z)(function*(){return(yield(0,p.lastValueFrom)(e._entitySchemaService.getEntitySchemaByName(e._pageLookupData.entitySchemaName))).entitySchema})()}_setDataGridPrimaryDisplayColumn(e,t){const r=(0,z.getDataGridViewConfigs)(e,["crt.DataGrid"]).find(u=>u.name===Z),a=t.getPrimaryDisplayColumn(),o=ve+"_"+a.name,c=r.columns;c.length===0&&c.push({id:(0,i.generateGuid)(),caption:`#ResourceString(${o})#`,code:o,dataValueType:a.dataValueType})}_getViewNames(e){const{viewConfig:t}=e;return h.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.Button"],t).filter(r=>{const a=r?.viewConfig?.clicked;return a?.request==="crt.SelectLookupPageRequest"&&a?.params?.viewName}).map(r=>r?.viewConfig?.clicked?.params?.viewName)}_addRowDoubleClickRequests(e){this._getViewNames(e).forEach(r=>{const a=(0,z.getDataGridViewConfigs)(e,["crt.DataGrid"]).find(o=>o.name===r);if(!a?.rowDoubleClick){const o={request:"crt.LookupPageDataGridRowDoubleClickRequest",params:{itemsAttributeName:r,rowId:"@event.rowId"}};a.rowDoubleClick=o}})}crtGetIsPreventCaching(){return Promise.resolve(!0)}crtOnMetaDataInit(e){var t=this;return(0,d.Z)(function*(){if(t._pageLookupData){t._setDataSourcesConfig(e);const r=yield t._getEntitySchema();t._setAttributesPath(e,r),t._setDataGridPrimaryDisplayColumn(e,r),t._setPredefinedFilter(e),t._addRowDoubleClickRequests(e)}return e})()}}ce.\u0275fac=function(e){return new(e||ce)(s.\u0275\u0275inject(A.HO,8),s.\u0275\u0275inject(h.EntitySchemaService))},ce.\u0275prov=s.\u0275\u0275defineInjectable({token:ce,factory:ce.\u0275fac});class le{constructor(e){this._pageLookupData=e,this._features=e.features,this._dataGridFeatures={rows:{selection:{enable:!0,multiple:this._features?.select?.multiple??!1,selectAll:this._features?.select?.selectAll??!1}}}}_getMainDataGridViewConfig(e){return(0,z.getDataGridViewConfigs)(e,["crt.DataGrid"]).find(({name:r})=>r===Z)}_setupDataGridFeaturesInViewConfig(e,t){e.features=(0,R.merge)({},e.features,this._dataGridFeatures);const r=e.features?.rows?.selection;t.attributes[Ie]={value:r?.multiple??!1}}_setupDataGridSelectionState(e,t){const r=this._pageLookupData.selectionState,a=e.selectionState.slice(1);r&&(t.attributes[a].value=r)}_setupDataGridFeaturesInViewModelAttribute(e,t){var r=this;return(0,d.Z)(function*(){const a=yield e[t],o=(0,R.merge)({},a,r._dataGridFeatures);e[t]=o;const c=o?.rows?.selection;e[Ie]=c?.multiple??!1})()}crtGetIsPreventCaching(){return Promise.resolve(!0)}crtOnMetaDataInit(e){const t=e,r=t.viewModelConfig,a=this._getMainDataGridViewConfig(t);return(0,D.isBindingExpression)(a.features)||this._setupDataGridFeaturesInViewConfig(a,r),this._setupDataGridSelectionState(a,r),Promise.resolve(e)}crtOnViewModelInit(e,t,r){var a=this;return(0,d.Z)(function*(){const o=e,c=a._getMainDataGridViewConfig(o);if((0,D.isBindingExpression)(c.features)){const u=c.features.slice(1);yield a._setupDataGridFeaturesInViewModelAttribute(r,u)}return e})()}}le.\u0275fac=function(e){return new(e||le)(s.\u0275\u0275inject(A.HO,8))},le.\u0275prov=s.\u0275\u0275defineInjectable({token:le,factory:le.\u0275fac});class de{constructor(e,t){this._pageLookupData=e,this._searchFilterPreprocessorService=t}crtOnViewModelInit(e,t,r){var a=this;return(0,d.Z)(function*(){const{defaultSearchValue:o}=a._pageLookupData;if(!o)return e;const c=yield a._searchFilterPreprocessorService.getColumnsModelByAttributeName(e,r,Z),u=c.columns.map(m=>m.name);return r[Br]=o,r[Lr]=[{group:c.viewName,columns:u}],e})()}}de.\u0275fac=function(e){return new(e||de)(s.\u0275\u0275inject(A.HO,8),s.\u0275\u0275inject(Le.SearchFilterPreprocessorService))},de.\u0275prov=s.\u0275\u0275defineInjectable({token:de,factory:de.\u0275fac});var ls=C(70806);class ue{constructor(e){this._oldTagMiniPageData=e}_setDataSourcesConfig(e){const t=e.modelConfig,r=t.primaryDataSourceName,a=t.dataSources[r];(0,R.set)(a.config,"entitySchemaName",this._oldTagMiniPageData.entitySchemaName)}crtGetIsPreventCaching(){return Promise.resolve(!0)}crtOnMetaDataInit(e){return!!this._oldTagMiniPageData&&(0,ls.isNotEmpty)(this._oldTagMiniPageData.entitySchemaName)&&this._setDataSourcesConfig(e),Promise.resolve(e)}}ue.\u0275fac=function(e){return new(e||ue)(s.\u0275\u0275inject(Me,8))},ue.\u0275prov=s.\u0275\u0275defineInjectable({token:ue,factory:ue.\u0275fac});class me{_addTagTypeFilterIfNeed(e){var t=this;return(0,d.Z)(function*(){const r=t._getTagTypeAttributesNames(e);!r.length||(yield t._prepareAllowedOldTagOperations(),t._createAndAddTagTypeFilterAttribute(e),t._addTagTypeFilterAttributeToTypesAttributes(e,r))})()}_getTagTypeAttributesNames(e){const t=[],r=this._getViewModuleAttributes(e);return(0,R.forOwn)(r,(a,o)=>{!a.isCollection||this._getAttributeEntitySchemaName(e,a)!==g.OLD_TAG_TYPE_SOURCE_SCHEMA||t.push(o)}),t}_getAttributeEntitySchemaName(e,t){const r=this._getAttributeEntitySchemaNameFromEmbeddedModel(t);return r||this._getAttributeEntitySchemaNameFromDataSource(e,t)}_getAttributeEntitySchemaNameFromEmbeddedModel(e){return this._getEntitySchemaNameFromDataSourceConfig(e.embeddedModel?.config)}_getEntitySchemaNameFromDataSourceConfig(e){return e?.config?.entitySchemaName}_getAttributeEntitySchemaNameFromDataSource(e,t){const r=this._getAttributeDataSourceName(t);if(!r)return;const a=this._getDataSourceConfigByName(e,r);return this._getEntitySchemaNameFromDataSourceConfig(a)}_getAttributeDataSourceName(e){return e.modelConfig?.path}_getDataSourceConfigByName(e,t){return e.modelConfig.dataSources[t]}_prepareAllowedOldTagOperations(){var e=this;return(0,d.Z)(function*(){e._allowedOldTagOperation=yield(0,g.getAllowedOldTagOperations)(e._rightsService)})()}_createAndAddTagTypeFilterAttribute(e){const t=(0,g.createOldTagTypeFilter)(this._allowedOldTagOperation),r=this._getViewModuleAttributes(e);!r||r[this._typeFilterAttributeName]||(r[this._typeFilterAttributeName]={value:t})}_addTagTypeFilterAttributeToTypesAttributes(e,t){const r=this._getViewModuleAttributes(e);!r||t.forEach(a=>{const o=r[a],c=o.modelConfig||{},u=c.filterAttributes||[];u.find(_=>_.name===this._typeFilterAttributeName)||(u.push({name:this._typeFilterAttributeName,loadOnChange:!0}),c.filterAttributes=u,o.modelConfig=c)})}_getViewModuleAttributes(e){return e.viewModelConfig?.attributes}constructor(e){this._rightsService=e,this._typeFilterAttributeName="Old_Tag_Type_Dynamic_Filter",this._allowedOldTagOperation={canManageCorporateTags:!1,canManagePublicTags:!1}}crtOnModelInit(e,t){var r=this;return(0,d.Z)(function*(){return yield r._addTagTypeFilterIfNeed(e),e})()}}me.\u0275fac=function(e){return new(e||me)(s.\u0275\u0275inject(y.RightsService))},me.\u0275prov=s.\u0275\u0275defineInjectable({token:me,factory:me.\u0275fac});class pe{crtOnMetaDataInit(e){const t=e,r=(0,U.getRequestBindingConfigs)(t.viewConfig,"crt.RunBusinessProcessRequest");for(const a of r){const o=a.params.filters;if(!o)continue;const c=o.split("|")[1]?.split(":")??[];if(c[0]?.trim()!=="crt.ToCollectionFilters")continue;const u=c.find(f=>f.indexOf("SelectionState")>=0)?.trim(),m=h.MetadataSchemaUtils.getViewConfigInfoByProperty("selectionState",u,t.viewConfig);if(m.length===0)continue;const _=m[0].viewConfig;a.params.activeRow=_.activeRow}return Promise.resolve(e)}}pe.\u0275fac=function(e){return new(e||pe)},pe.\u0275prov=s.\u0275\u0275defineInjectable({token:pe,factory:pe.\u0275fac});var ds=C(82515);const us=[{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:ce,deps:[A.HO,h.EntitySchemaService],multi:!0},{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:ie,deps:[A.HO,y.FeatureService],multi:!0},{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:le,deps:[A.HO],multi:!0},{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:de,deps:[A.HO,Le.SearchFilterPreprocessorService],multi:!0}];let Wt=class extends i.BaseRequestHandler{constructor(e){super(),this._injector=e,this._modalService=e.get(ye.L),this._entitySchemaService=e.get(h.EntitySchemaService),this._resourceFinderService=e.get(h.ResourceFinderService),this._featureValues=e.get(h.FEATURE_VALUES)}_getDataSchema(e){const t=this._getDataSourceName(e);return e.$context.dataSchemas[t]}_getDataSourceName(e){return e.$context.getBoundDataSourceName(e.itemsAttributeName)}_getEntitySchemaName(e){return e.entitySchemaName?e.entitySchemaName:this._getDataSchema(e).name}_getCaption(e,t){return e.caption?Promise.resolve(this._resourceFinderService.findLocalizableValue(e.caption)):this._getCaptionTemplate(e,t)}_getCaptionTemplate(e,t){var r=this;return(0,d.Z)(function*(){let a="";const o=e.$context;if(e.itemAttributeName&&e.itemAttributeName in o.Resources.Strings)a=yield o.Resources.Strings[e.itemAttributeName];else{const c=yield(0,p.firstValueFrom)(r._entitySchemaService.getEntitySchemaByName(t));if(!c.success)throw new Error(`Entity with name ${t} not found`);a=r._resourceFinderService.findLocalizableValue(c.entitySchema.caption)}return`{0} ${a}`})()}_createModalInjector(e){var t=this;return(0,d.Z)(function*(){const r=t._getEntitySchemaName(e),a=yield t._getCaption(e,r),o=yield e.$context[e.itemAttributeName],c=typeof o=="string"?o:null;return s.Injector.create({parent:t._injector,providers:[{provide:A.HO,useValue:{header:a,entitySchemaName:r,defaultSearchValue:c,filtersConfig:e.filtersConfig,features:e.features,selectionState:e.selectionState,returnEmptyValue:e.returnEmptyValue},deps:[]},{provide:h.EntitySchemaService,useClass:h.EntitySchemaService},...us,{provide:D.AbstractProfileSchemaProvider,useClass:ds.a,deps:[y.UserSchemaProfileService,A.HO]},{provide:D.ProfileSchemaLoaderService,useClass:D.ProfileSchemaLoaderService},{provide:D.ProfileSchemaLocalizationService,useClass:D.ProfileSchemaLocalizationService},D.SCHEMA_LOCALIZATION_SERVICE_FACTORY_PROVIDER,{provide:Le.SearchFilterPreprocessorService,useClass:Le.SearchFilterPreprocessorService}]})})()}_openLookupPage(e){var t=this;return(0,d.Z)(function*(){const r=yield t._createModalInjector(e),a=e.$context,o=e.schemaName||"BaseLookupPageTemplate";(yield t._modalService.show({schemaName:o},{injector:r})).afterClosed().pipe((0,M.take)(1),(0,p.filter)(u=>u)).subscribe(u=>{e.itemAttributeName&&(a[e.itemAttributeName]=u),e?.afterClosed?.(u)})})()}handle(e){var t=this;return(0,d.Z)(function*(){t._featureValues.DisableOpenLookupPageHandlerInZone?yield t._openLookupPage(e):yield t._injector.get(s.NgZone).run(()=>t._openLookupPage(e)),yield t.next?.handle(e)})()}};Wt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.OpenLookupPageRequest",type:"crt.OpenLookupPageHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Wt);let la=class extends i.BaseRequest{};la=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.OpenLookupPageRequest"})],la);let Jt=class extends i.BaseRequestHandler{_getDataSchema(e){const t=this._getDataSourceName(e);return e.$context.dataSchemas[t]}_getDataSourceName(e){return e.$context.getBoundDataSourceName(e.itemsAttributeName)}handle(e){var t=this;return(0,d.Z)(function*(){const r=t._getDataSchema(e),a={type:"crt.7XRequest",action:"OpenLookupSource",$context:e.$context,payload:{entitySchemaName:e.schemaName??r?.name,displayValue:r?.caption.toString()}};yield t.handlerChain.process(a)})()}};Jt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.OpenLookupSourceRequest",type:"crt.OpenLookupSourceHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards]})],Jt);let Qt=class extends i.BaseRequestHandler{constructor(e){super(),this._messageDialogProvider=e}handle(e){var t=this;return(0,d.Z)(function*(){if(!e.schemaName){t._messageDialogProvider.open({data:{message:"InfoDialog.OpenPage.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}});return}const r={type:"crt.7XRequest",action:"OpenPage",$context:e.$context,payload:{schemaName:e.schemaName,modelInitConfigs:(0,R.cloneDeep)(e.modelInitConfigs),parameters:(0,R.cloneDeep)(e.parameters)}};return t.handlerChain.process(r)})()}};Qt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.OpenPageRequest",type:"crt.OpenPageHandler"}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider])],Qt);var ms=C(66219);let Xt=class extends i.BaseRequestHandler{constructor(e){super(),this.injector=e,this.alignModalFunc=(t,r,a)=>{t.forEach(o=>{o.contentRect.height>0&&o.contentRect.width>0&&this._positionDialog(this._dialogRef,r,a)})},this._modalService=e.get(E.Lu),this._router=e.get(T.CrtRouter)}_createModalInjector(e){return s.Injector.create({parent:this.injector,providers:[{provide:h.EntitySchemaService,useClass:h.EntitySchemaService},{provide:D.ProfileSchemaLoaderService,useClass:D.ProfileSchemaLoaderService},{provide:D.ProfileSchemaLocalizationService,useClass:D.ProfileSchemaLocalizationService},D.SCHEMA_LOCALIZATION_SERVICE_FACTORY_PROVIDER]})}_closeDialog(e){this._resizeObserver.disconnect(),e?.close(),this._dialogRef=null}_positionDialog(e,t,r){let a=t,o=r;const c=e?.componentInstance?.componentContainer?.element?.nativeElement?.parentElement?.parentElement;t+c?.offsetWidth>window.innerWidth&&(a=t-c?.offsetWidth),r+c?.offsetHeight>window.innerHeight&&(o=window.innerHeight-c?.offsetHeight),e.updatePosition({left:`${a}px`,top:`${o}px`}),c.style.visibility="visible"}handle(e){var t=this;return(0,d.Z)(function*(){const r=t._createModalInjector(e);t._dialogRef&&t._closeDialog(t._dialogRef),t._dialogRef=yield t._modalService.show({schemaName:e.schemaName,recordId:e.recordId,action:i.ModelInPageAction.Edit},{injector:r}),t._resizeObserver=new ms.Z(o=>t.alignModalFunc(o,e.offsetX,e.offsetY));const a=t._dialogRef?.componentInstance?.componentContainer?.element?.nativeElement?.parentElement?.parentElement;a.style.visibility="hidden",a.style.zIndex=9999,t._dialogRef.afterOpened().subscribe(()=>{t._resizeObserver.observe(a)}),t._dialogRef.backdropClick().subscribe(o=>t._closeDialog(t._dialogRef)),t._router.navigateStart$.subscribe(o=>t._closeDialog(t._dialogRef)),yield t.next?.handle(e)})()}};Xt=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.OpenPositionedPageRequest",type:"crt.OpenPositionedPageHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Xt);let Yt=class extends i.BaseRequestHandler{_getDSPrimaryAttributeName(e,t){const r=e.dataSchemas[t];return e.getViewModelAttributePath(t,r.primaryAttributeName)}_setAttributeValue(e,t,r,a=!1){e[t]=r,a&&e.getControl(t).formControl.markAsPristine()}_loadDataSource(e,t,r=[]){var a=this;return(0,d.Z)(function*(){yield a.handlerChain.process({type:"crt.LoadDataRequest",$context:t,dataSourceName:e,parameters:r})})()}_loadDS(e,t){var r=this;return(0,d.Z)(function*(){const a=t.name,o=e.dataSchemas[a],c=e.getViewModelAttributePath(a,o.primaryAttributeName);yield r._loadDataSource(a,e,[{type:i.ModelParameterType.PrimaryColumnValue,value:c}])})()}_copyDS(e,t,r,a){var o=this;return(0,d.Z)(function*(){yield o.handlerChain.process({type:"crt.CopyDataRequest",$context:e,dataSourceName:t,recordId:r,copiedValues:a})})()}_initModelInEditModeAsync(e,t){var r=this;return(0,d.Z)(function*(){const{name:a,recordId:o}=t,c=r._getDSPrimaryAttributeName(e,a);r._setAttributeValue(e,c,o,!0),yield r._loadDS(e,t)})()}_initModelInAddingModeAsync(e,t){return(0,d.Z)(function*(){yield ea(e,t)})()}_initModelInCopyModeAsync(e,t){var r=this;return(0,d.Z)(function*(){const{name:a,recordId:o}=t,c=yield Yr(e,t);yield r._copyDS(e,a,o,c)})()}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,a=r.modelInitConfigs||[],o=yield r.getPrimaryModelName(),c=r._getModelNamesByLoadType(h.DataSourceLoadingType.OnInit);a.forEach(u=>{const m=u.action;if(u.name=u.name||o,!u.name)return;m===i.ModelInPageAction.Edit?t._initModelInEditModeAsync(r,u):m===i.ModelInPageAction.Add?t._initModelInAddingModeAsync(r,u):m===i.ModelInPageAction.Copy?t._initModelInCopyModeAsync(r,u):t._loadDataSource(u.name,r);const _=c.indexOf(u.name);_>-1&&c.splice(_,1)}),c.forEach(u=>{t._loadDataSource(u,r)}),yield t.next?.handle(e)})()}};Yt=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.PageInitHandler",requestType:"crt.HandleViewModelInitRequest"})],Yt);let er=class extends i.BaseRequestHandler{constructor(e){super(),this._customEventService=e}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.phoneNumber;return t._customEventService.createOutboundChannel("PhoneLinkClick").next(r),t.next?.handle(e)})()}};er=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.PhoneLinkClickHandler",requestType:"crt.PhoneLinkClickRequest",scopes:[]}),(0,l.__metadata)("design:paramtypes",[I.CustomEventService])],er);let tr=class extends i.BaseRequestHandler{_setTopRecord(e,t,r,a,o){var c=this;return(0,d.Z)(function*(){yield c._actionToCurrentDataSourceCollection(e,t,function(){var u=(0,d.Z)(function*(m,_){if(a===S.MoveNewRecordTo.Begin){const f=_.find(v=>v.attributes[v.primaryAttributeName]===r.value);_.moveTo(f,0)}yield c._processSetTopRecordRequest(e,m,r,o)});return function(m,_){return u.apply(this,arguments)}}())})()}_actionToCurrentDataSourceCollection(e,t,r){return(0,d.Z)(function*(){for(const[a,o]of Object.entries(e.attributes))o instanceof S.BaseViewModelCollection&&e.getBoundDataSourceNameByAttributePath(a)===t&&(yield r(a,o))})()}_checkIfRecordExists(e,t,r){var a=this;return(0,d.Z)(function*(){let o=!1;return yield a._actionToCurrentDataSourceCollection(e,t,function(){var c=(0,d.Z)(function*(u,m){const _=r.value;o=(yield m.findByPrimaryAttribute(_))!==void 0});return function(u,m){return c.apply(this,arguments)}}()),o})()}_processSetTopRecordRequest(e,t,r,a){var o=this;return(0,d.Z)(function*(){const c={type:"crt.SetTopRecordRequest",$context:e,itemsAttributeName:t,primaryAttributeValue:r,scopes:a??e._scopes};yield o.handlerChain.process(c)})()}_onRecordUpdated(e,t,r,a=null){var o=this;return(0,d.Z)(function*(){return yield o.handlerChain.process({type:"crt.LoadDataRequest",$context:e,dataSourceName:t,parameters:[{type:i.ModelParameterType.PrimaryColumnValue,value:"@requestPayload.primaryColumnValue"}],config:{loadType:i.DataSourceLoadType.Load,doNotUpdateLastLoadParameters:!0,payload:{primaryColumnValue:r,attributes:a}}})})()}_onRecordCreated(e,t,r,a,o,c=S.MoveNewRecordTo.Begin){var u=this;return(0,d.Z)(function*(){(yield u._onRecordUpdated(e,t,r))?.[0]?.[a.primaryAttributeName]===r.value&&(yield u._setTopRecord(e,t,r,c,o))})()}_refreshPageData(e,t,r,a){var o=this;return(0,d.Z)(function*(){const c=e.dataSchemas[t],u=r.modelEvent.payload?.changedAttributes||[];if(u.length===0||r.modelEvent.type!==S.ModelEventType.Update)return Promise.resolve(null);if(a)for(const m of a){const _=m.find(f=>f.name===c.primaryAttributeName);yield o._onRecordUpdated(e,t,_,u)}else yield o._onRecordUpdated(e,t,null,u)})()}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,a=e.modelEvent.payload?.primaryAttributesValues,o=e.modelName;if(!r.getModelByName(o).isLoaded)return t.next?.handle(e);if(!r.isDataSourceForCollection(o))return yield t._refreshPageData(r,o,e,a),t.next?.handle(e);if([S.ModelEventType.Create,S.ModelEventType.Update].includes(e.modelEvent.type)){const u=r.dataSchemas[o];for(const m of a){const _=m.find(v=>v.name===u.primaryAttributeName),f=yield t._checkIfRecordExists(r,o,_);e.modelEvent.type===S.ModelEventType.Create&&!f?yield t._onRecordCreated(r,o,_,u,e.scopes,e.moveNewRecordTo):yield t._onRecordUpdated(r,o,_)}}return t.next?.handle(e)})()}};tr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleModelEventRequest",type:"crt.ViewModelCollectionRecordChangedHandler"})],tr);let rr=class extends i.BaseRequestHandler{constructor(e,t){super(),this._processEngineService=e,this._notifyService=t}_getPrimaryDsId(e){return(0,d.Z)(function*(){const t=e.$context,r=yield t.getPrimaryModelName(),a=t.dataSchemas[r];if(!a||!r)return;const o=t.getViewModelAttributePath(r,a.primaryAttributeName);return e.$context[o]})()}_applyRecordIdToProcessParameters(e){var t=this;return(0,d.Z)(function*(){if(e.recordIdProcessParameterName){const r=yield t._getPrimaryDsId(e);if(r){const a=(0,R.cloneDeep)(e.processParameters)??{};return a[e.recordIdProcessParameterName]=r,a}}return e.processParameters})()}_getSortingColumns(e){return e?.sorting?e.sorting.reduce((t,{columnName:r,direction:a})=>(t[r]=a,t),{}):null}_showNotification(e){var t=this;return(0,d.Z)(function*(){if(e.showNotification){const r=e.notificationText??"RunProcessHandler.ProcessHasStarted";yield t._notifyService.show({message:r,translate:!e.notificationText})}})()}_handleRequest(e,t){var r=this;return(0,d.Z)(function*(){const a=e.processName;let o;if(e.processRunType===S.RunProcessType.ForTheSelectedRecords){const m=e.$context.dataSchemas[e.dataSourceName];if(!e.filters){const v=e.activeRow;if(v){const P=new i.FilterGroup;P.addPrimarySchemaColumnInFilter([v],"activeRowFilter"),e={...e,filters:P.toJson()}}else return yield r._notifyService.show({message:"RunProcessHandler.CannotRunProcess.NoRecordsSelected"}),null}let _=null;e.parameterMappings&&(_=Object.keys(e.parameterMappings)[0]);const f={processName:a,entitySchemaName:m.name,filterConfig:e.filters,sortingColumns:r._getSortingColumns(e),inputParameterName:_};o=r._processEngineService.executeProcessForMatchingRecords(f)}else o=r._processEngineService.executeProcessByName(a,t,e.resultParameterNames);const c=yield(0,p.lastValueFrom)(o);return c?.success?yield r._showNotification(e):yield r._notifyService.error({message:c.errorInfo?.message??"Failed to start process"}),c})()}handle(e){var t=this;return(0,d.Z)(function*(){const r=yield t._applyRecordIdToProcessParameters(e);return t._handleRequest(e,r)})()}};rr=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.RunBusinessProcessHandler",requestType:"crt.RunBusinessProcessRequest"}),(0,l.__metadata)("design:paramtypes",[y.ProcessEngineService,x.NotifyService])],rr);let da=class extends i.BaseRequest{constructor(){super(...arguments),this.type="crt.SaveAttributeToProfileRequest"}};da=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.SaveAttributeToProfileRequest"})],da);let ar=class extends i.BaseRequestHandler{constructor(e){super(),this._schemaPartsService=e}handle(e){var t=this;return(0,d.Z)(function*(){const{profileAttributeName:r}=e;if(!r)return;const a=yield e.$context[r];yield t._schemaPartsService.apply(([o])=>{const c={attribute:r,config:{value:a}};return o.setViewModelAttribute(c.attribute,c.config),Promise.resolve()}),yield t._schemaPartsService.commit()})()}};ar=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.SaveAttributeToProfileHandler",requestType:"crt.SaveAttributeToProfileRequest"}),(0,l.__metadata)("design:paramtypes",[D.SchemaPartsService])],ar);let sr=class extends i.BaseRequestHandler{constructor(e,t){super(),this._notifyService=e,this._maskService=t}_savePrimaryData(e){var t=this;return(0,d.Z)(function*(){const r={type:"crt.SavePrimaryDataRequest",$context:e.$context,scopes:e.scopes},a=yield t.handlerChain.process(r);return Qr(a)})()}_sendCardResponse(e,t){var r=this;return(0,d.Z)(function*(){const a=yield e.getPrimaryModelName();if(!a)return;const o=yield e.getPrimaryDataSchema();if(!o?.primaryAttributeName)return;const c=e.getViewModelAttributePath(a,o.primaryAttributeName),u=e.getViewModelAttributePath(a,o.primaryDisplayAttributeName),m={type:"crt.7XRequest",action:"CardResponse",payload:{action:e[H],success:t,primaryDisplayColumnName:o.primaryDisplayAttributeName,uId:yield e[c],primaryColumnValue:yield e[c],primaryDisplayColumnValue:yield e[u],referenceSchemaName:e.dataSchemas[a]?.dataSourceConfig?.config?.entitySchemaName},$context:e};return r.handlerChain.process(m)})()}_displayErrorDialog(e){const t=e?.message;t&&this._notifyService.show({message:t,translate:!1})}handle(e){var t=this;return(0,d.Z)(function*(){const r="RECORD_SAVING";yield t._maskService.showMask(r,e.$context);try{const a=yield t._savePrimaryData(e);if(!a.success)throw new Error(a.errorInfo);return yield t._sendCardResponse(e.$context,!0),e.$context.IsChanged=!1,!0}catch(a){return t._displayErrorDialog(a),!1}finally{t._maskService.hideMask(r,e.$context),yield t.next?.handle(e)}})()}};sr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.SaveRecordHandler"}),(0,l.__param)(1,(0,i.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[x.NotifyService,i.MaskService])],sr);let or=class extends i.BaseRequestHandler{constructor(e,t){super(),this._notifyService=e,this._maskService=t}_saveCollectionPrimaryDataResult(e){var t=this;return(0,d.Z)(function*(){const r={type:"crt.SaveCollectionPrimaryDataRequest",$context:e.$context,primaryAttributeValues:e.recordIds,collectionAttributeName:e.itemsAttributeName};return yield t.handlerChain.process(r)})()}_displayErrorDialog(e){const t=e?.message;t&&this._notifyService.show({message:t,translate:!1})}_getFirstErrorInfoFromSaveDataResult(e){return e.find(t=>!t.success).errorInfo}_reloadDependentModels(e){const t=e.$context,r=t.getBoundDataSourceNameByAttributePath(e.itemsAttributeName),a=t.getModelByName(r);a&&t._reloadDependentModels(a,[])}handle(e){var t=this;return(0,d.Z)(function*(){const r="RECORDS_SAVING_"+e.itemsAttributeName+"_"+(e.recordIds??[]).join("_");yield t._maskService.showMask(r,e.$context);try{const a=yield t._saveCollectionPrimaryDataResult(e);if(Qr(a).success)return t._reloadDependentModels(e),!0;const c=t._getFirstErrorInfoFromSaveDataResult(a);throw new Error(c)}catch(a){return t._displayErrorDialog(a),!1}finally{t._maskService.hideMask(r,e.$context)}})()}};or=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SaveRecordsRequest",type:"crt.SaveRecordsHandler"}),(0,l.__param)(1,(0,i.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[x.NotifyService,i.MaskService])],or);class ua extends i.BaseRequestHandler{_isNotAllowedTarget(e){return(0,R.isEmpty)(e)||!e.columns||!(0,R.isEmpty)(e)&&Array.isArray(e.columns)&&e.columns.length!==1}_getFilteredColumnFromTarget(e,t){const r=e.getBoundDataSchemaByAttributePath(t.viewAttributeName),a=t.columns.slice().shift();let o;if(typeof a=="string")o=a;else{const u=e.getAttributeViewModelConfig(t.viewAttributeName);o=this.getAttributeNameByColumn(u,a)}const c=this.findAttributeInDataSchema(r,o);return(0,h.isAllowedTypeSearchColumn)(c)?o:g.VIRTUAL_ALL_OPTION_ID}findAttributeInDataSchema(e,t){return e.attributes?.find(r=>r.name===t)}getFilteredColumnFromTarget(e,t){return this._isNotAllowedTarget(t)?g.VIRTUAL_ALL_OPTION_ID:this._getFilteredColumnFromTarget(e,t)}getAttributeNameByColumn(e,t){const r=e[t.code]??{};return(0,S.isModelAttributeConfig)(r)?r?.modelConfig?.path?.split(".").slice(1).join(".")??"":""}}let nr=class extends ua{_getFilteredColumnFromRequest(e,t){const r=this._getSearchFilterTargetFromRequest(t);return this.getFilteredColumnFromTarget(e,r)}_getSearchFilterTargetFromRequest(e){return this._createSearchFilterTargets(e.searchFilterGroups,e.searchFilterColumnsGroups).slice().shift()}_createSearchFilterTargets(e,t){return e.map(r=>({filterAttributeName:r.filterAttributeName,viewAttributeName:r.viewAttributeName,columns:t.find(a=>a.group===r.viewAttributeName)?.columns||[]}))}handle(e){const t=e.$context;return(0,p.lastValueFrom)(t.setValue({[e.searchValueAttributeName]:e.value,[e.searchFilteredColumnAttributeName]:this._getFilteredColumnFromRequest(t,e),[e.searchFilteredColumnsGroupsAttributeName]:e.searchFilterColumnsGroups}))}};nr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SearchFilterColumnsGroupsRequest",type:"crt.SearchFilterColumnsGroupsHandler"})],nr);let ir=class extends ua{constructor(e){super(),this._searchFilterBuilder=e}_buildFiltersAndSet(e,t){var r=this;return(0,d.Z)(function*(){const a=[];for(const o of t.searchFilterTargets)!o.columns||a.push(e.setValue({[o.filterAttributeName]:yield r._searchFilterBuilder.buildFilter(e,t.value,o.columns,o.viewAttributeName)}));return Promise.all(a)})()}_setSearchFilterValueToAttribute(e,t){return(0,d.Z)(function*(){const r=t.searchValueAttributeName;!r||(yield(0,p.firstValueFrom)(e.setValue({[r]:t.value})))})()}_setSearchFilteredColumnToAttribute(e,t){var r=this;return(0,d.Z)(function*(){const a=t.searchFilteredColumnAttributeName;!a||(yield(0,p.firstValueFrom)(e.setValue({[a]:r._getFilteredColumnFromRequest(e,t)})))})()}_getFilteredColumnFromRequest(e,t){const r=t.searchFilterTargets.slice().shift();return this.getFilteredColumnFromTarget(e,r)}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context;return yield t._setSearchFilterValueToAttribute(r,e),yield t._setSearchFilteredColumnToAttribute(r,e),t._buildFiltersAndSet(r,e)})()}};ir=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SearchFilterRequest",type:"crt.SearchFilterHandler"}),(0,l.__metadata)("design:paramtypes",[g.SearchFilterBuilderService])],ir);let cr=class extends ta{constructor(e,t){super(),this._configurationDataService=e,this._navigationService=t}_getModuleCaption(){var e=this;return(0,d.Z)(function*(){const t=yield(0,p.lastValueFrom)(e._configurationDataService.getData()),r=e._navigationService.getActiveRouteInfo();return e._getModuleStructureBySectionSchema(r.schemaName,t?.data)?.moduleCaption})()}_getModuleStructureBySectionSchema(e,t){return Object.values(t.modulesStructure).find(r=>r.sectionSchema===e)}getPrimaryName(e){const t=Xr(e.$context);return Promise.resolve(t)}initDataViews(e){var t=()=>super.initDataViews,r=this;return(0,d.Z)(function*(){const a=yield r._getModuleCaption();return a&&(e.$context[ee]=a),t().call(r,e)})()}handle(e){var t=this;return(0,d.Z)(function*(){return yield t.initDataViews(e),t.next?.handle(e)})()}};cr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleViewModelInitRequest",type:"crt.SectionInitHandler",scopes:[S.Scopes.AllSections]}),(0,l.__metadata)("design:paramtypes",[y.ConfigurationDataService,T.CrtNavigationService])],cr);let lr=class extends i.BaseRequestHandler{constructor(e,t,r){super(),this._window=e,this._fileProcessingService=t,this._messageDialogProvider=r}_checkErrorsAndShowMessage(e){const t=this._fileProcessingService.createFileErrorMessageForLogs(e);t&&this._messageDialogProvider.open({data:{message:t,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}_onFileSelected(e,t){var r=this;return(0,d.Z)(function*(){const a=yield r._fileProcessingService.processSelectedFiles(e,t.maximumAllowedFileSize);return t.displayErrors&&a.errors&&r._checkErrorsAndShowMessage(a.errors),a})()}_createInputElement(e,t){const r=e.createElement("input");return r.id="file-upload-input",r.type="file",r.multiple=t.multiple??!1,r.accept=t.allowedFileTypes??"",r.setAttribute("style","display: none"),r}_removeInputElement(e,t){setTimeout(()=>{delete t.onchange,e.documentElement.removeChild(t)},1e3)}handle(e){const t=this._window.document,r=this._createInputElement(t,e),a=new Promise(o=>{r.onchange=c=>{o(this._onFileSelected(Array.from(c.target.files),e))},r.oncancel=()=>{o({files:[],errors:[]})}});return t.documentElement.appendChild(r),setTimeout(()=>{r.click()},70),this._removeInputElement(t,r),a}};lr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SelectFileRequest",type:"crt.SelectFileHandler"}),(0,l.__param)(0,(0,i.CrtInject)(I.WINDOW_TOKEN)),(0,l.__metadata)("design:paramtypes",[Object,E.dO,g.MessageDialogProvider])],lr);let dr=class extends i.BaseRequestHandler{constructor(e,t,r){super(),this._dialogRef=e,this._pageLookupData=t,this._injector=r}_instantiate(e){return(0,i.instantiate)(e,t=>this._injector.get(t))}_getLookupValues(e,t,r){if(!t)return Promise.resolve([]);if(this._pageLookupData.features?.select?.selectAll===!0||t.type==="all")throw new Error("Opening lookup page with features { resultType: 'lookupValues', selectAll: true, ... } is not supported. Use { resultType: 'lookupValues', selectAll: false, ... } or { resultType: 'filter', selectAll: true, ... } instead.");const a=this._instantiate(D.ToLookupConverter),o=e.getBoundDataSchemaByAttributePath(r);return a.convert(t.selected,e,o.name)}_getFilters(e,t,r){var a=this;return(0,d.Z)(function*(){if(!t||t.type==="specific"&&!t.selected?.length)return a._pageLookupData.returnEmptyValue?{isEmpty:!0}:void 0;const o=yield e[r];return a._instantiate(we).convert(o,e,r,t)})()}handle(e){var t=this;return(0,d.Z)(function*(){let r;const a=e.$context,o=e.viewName||Z,c=`${o}_${g.GRID_SELECTION_STATE_ATTRIBUTE_NAME}`,u=yield a[c],m=t._pageLookupData.features?.select?.resultType;if(!m||m===A.pb.LookupValues){const _=yield t._getLookupValues(a,u,o);r=t._pageLookupData.features?.select?.multiple?_:_[0]}else if(m===A.pb.Filter)r=yield t._getFilters(a,u,o);else{const _=[A.pb.LookupValues,A.pb.Filter].join(", ");throw new Error(`Invalid lookup page resultType ${m}. Available values: ${_}`)}yield t.next?.handle(e),t._dialogRef.close(r)})()}};dr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SelectLookupPageRequest",type:"crt.SelectLookupPageHandler",scopes:["BaseLookupPageTemplate"]}),(0,l.__param)(1,(0,i.CrtInject)(A.HO)),(0,l.__metadata)("design:paramtypes",[xe.MatLegacyDialogRef,Object,s.Injector])],dr);let ur=class extends i.BaseRequestHandler{constructor(e,t){super(),this._messageDialogProvider=e,this._modalProvider=t,this._maskName="SetRecordRightsHandlerMask"}_getDataSchemaAttributeValue(e,t){return(0,d.Z)(function*(){const r=yield e.getPrimaryModelName(),a=e.getViewModelAttributePath(r,t);return e[a]})()}_getLoadRightsModuleParameters(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,a=yield r.getPrimaryDataSchema();return{primaryColumnValue:yield t._getDataSchemaAttributeValue(r,a.primaryAttributeName),primaryDisplayColumnValue:yield t._getDataSchemaAttributeValue(r,a.primaryDisplayAttributeName),entitySchemaName:a.name,hideAdditionalLookupButtons:e.openInModalWindow}})()}_saveViewModelIfNeed(e){var t=this;return(0,d.Z)(function*(){const{$context:r,scopes:a}=e;if((yield r[H])===i.ModelInPageAction.Edit&&!e.openInModalWindow)return!0;const c={type:"crt.SaveRecordRequest",preventCardClose:e.openInModalWindow,scopes:a,$context:r};return t.handlerChain.process(c)})()}_showSettingsErrorDialog(){var e=this;return(0,d.Z)(function*(){yield(0,p.firstValueFrom)(e._messageDialogProvider.open({data:{message:"InfoDialog.SetRecordRights.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}))})()}_isHasPrimaryDataSource(e){return(0,d.Z)(function*(){return!!(yield e.$context.getPrimaryModelName())})()}_openLoadRightsModule(e){var t=this;return(0,d.Z)(function*(){const r=yield t._getLoadRightsModuleParameters(e),{$context:a,scopes:o}=e,c={type:"crt.LoadRightsModuleRequest",scopes:o,$context:a,payload:r};return t.handlerChain.process(c)})()}_openModalWindowRightsModule(e){var t=this;return(0,d.Z)(function*(){const r=yield t._getLoadRightsModuleParameters(e);t._modalProvider.open(g.CrtRightsComponent,{data:r,panelClass:"crt-rights-modal",disableClose:!0})})()}handle(e){var t=this;return(0,d.Z)(function*(){if(!(yield t._isHasPrimaryDataSource(e))){t._showSettingsErrorDialog();return}if(!!(yield t._saveViewModelIfNeed(e)))return e.openInModalWindow?t._openModalWindowRightsModule(e):t._openLoadRightsModule(e)})()}};ur=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SetRecordRightsRequest",type:"crt.SetRecordRightsRequest"}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider,g.ModalProvider])],ur);let ma=class extends i.BaseRequest{};ma=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.ShowDialogRequest"})],ma);let mr=class extends i.BaseRequestHandler{constructor(e){super(),this._messageDialogProvider=e}handle(e){return(0,p.firstValueFrom)(this._messageDialogProvider.open(e.dialogConfig))}};mr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.ShowDialogRequest",type:"crt.ShowDialogHandler"}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider])],mr);let pr=class extends i.BaseRequestHandler{_isValidRequiredRequestParameters(e){return!!e.tagIds?.length&&!!e.recordId&&((0,g.isOldStructure)(e)||!!e.recordSchemaName)}_insertTagsInRecordModel(e){var t=this;return(0,d.Z)(function*(){const r=yield(0,p.lastValueFrom)(t._createTagInRecordModel(e));return t._createInsertDtoArray(e).map(a=>r.insert(a))})()}_createTagInRecordModel(e){return(0,g.isOldStructure)(e)?S.Model.create(e.tagInRecordSourceSchemaName):S.Model.create(g.DEFAULT_TAG_IN_RECORD_SOURCE_SCHEMA_NAME)}_createInsertDtoArray(e){return e.tagIds.map(t=>({Tag:t})).map(t=>this._getCreateDtoFunction(e)(e,t))}_getCreateDtoFunction(e){return(0,g.isOldStructure)(e)?this._createOldStructureDto:this._createNewStructureDto}_createOldStructureDto(e,t){return{...t,[g.OLD_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA]:e.recordId}}_createNewStructureDto(e,t){return{...t,[g.DEFAULT_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA]:e.recordId,RecordSchemaName:e.recordSchemaName}}handle(e){var t=this;return(0,d.Z)(function*(){if(!t._isValidRequiredRequestParameters(e))return;const r=e.$context;return(0,p.lastValueFrom)((0,p.forkJoin)(yield t._insertTagsInRecordModel(e)).pipe((0,p.switchMap)(()=>r.load(e.dataSourceName,[],{loadType:i.DataSourceLoadType.Reload})),(0,p.catchError)(()=>(0,p.of)())),{defaultValue:null})})()}};pr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.AddTagsInRecordRequest",type:"crt.AddTagsInRecordHandler"})],pr);let hr=class extends i.BaseRequestHandler{handle(e){return(0,d.Z)(function*(){const t=e.$context;return yield(0,p.lastValueFrom)(t.delete(e.dataSourceName,[{type:i.ModelParameterType.PrimaryColumnValue,value:e.id}]).pipe((0,p.catchError)(()=>(0,p.of)()))),(0,p.lastValueFrom)(t.load(e.dataSourceName,[],{loadType:i.DataSourceLoadType.Reload}))})()}};hr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.DeleteTagInRecordRequest",type:"crt.DeleteTagInRecordHandler"})],hr);let gr=class extends i.BaseRequestHandler{handle(e){if(e.action!=="InitDataViews")return this.next?.handle(e)}};gr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.7XRequest",type:"crt.OldTag7XRequestHandler",scopes:[g.TAG_OLD_MINI_PAGE_SCHEMA_NAME]})],gr);const ps=[{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:ue,deps:[Me],multi:!0},{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:me,deps:[y.RightsService],multi:!0}];let _r=class extends i.BaseRequestHandler{constructor(e){super(),this._injector=e,this._schemaModalService=e.get(E.Lu)}_createModalInjector(e){return s.Injector.create({parent:this._injector,providers:[{provide:Me,useValue:{entitySchemaName:e.entitySchemaName},deps:[]},...ps]})}_createSchemaModalConfig(e){return{schemaName:g.TAG_OLD_MINI_PAGE_SCHEMA_NAME,action:e.action,recordId:e.recordId,defaultValues:e.defaultValues,parameters:e.parameters}}handle(e){var t=this;return(0,d.Z)(function*(){const r=t._createModalInjector(e),a=t._createSchemaModalConfig(e);yield t._schemaModalService.show(a,{injector:r}),yield t.next?.handle(e)})()}};_r=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.OpenOldTagMiniPageHandler",requestType:"crt.OpenOldTagMiniPageRequest"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],_r);let Sr=class extends i.BaseRequestHandler{_isNewTagRecord(e){return(0,d.Z)(function*(){const t=yield e[H];return[i.ModelInPageAction.Add,i.ModelInPageAction.Copy].includes(t)})()}_insertTagInSchemaRecord(e){var t=this;return(0,d.Z)(function*(){const r=yield(0,p.lastValueFrom)(S.Model.create(g.DEFAULT_TAG_IN_SCHEMA_SCHEMA_NAME)),a=yield t._getPrimaryAttributeValue(e),o=yield e[g.TAG_ENTITY_SCHEMA_NAME_PAGE_ATTRIBUTE_NAME];if(!a||!o)return!1;const c=yield(0,p.lastValueFrom)(r.insert({Tag:a,EntitySchemaName:o}));return c.success&&(yield t._notifyTagChange(e,a)),c.success})()}_getPrimaryAttributeValue(e){var t=this;return(0,d.Z)(function*(){const r=yield e.getPrimaryModelName();if(!r)return;const a=yield t._getPrimaryDataSchemaPrimaryAttributeName(e);if(!a)return;const o=e.getViewModelAttributePath(r,a);return e[o]})()}_getPrimaryDataSchemaPrimaryAttributeName(e){return(0,d.Z)(function*(){return(yield e.getPrimaryDataSchema())?.primaryAttributeName})()}_notifyTagChange(e,t){var r=this;return(0,d.Z)(function*(){const a=yield r._getPrimaryDataSchemaPrimaryAttributeName(e);S.ModelEventNotificationService.instance.notify({modelId:(0,i.generateGuid)(),dataSchemaName:g.DEFAULT_TAG_SOURCE_SCHEMA_NAME,type:S.ModelEventType.Update,payload:{primaryAttributesValues:[[{name:a,value:t}]]}})})()}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,a=yield t._isNewTagRecord(r),o=yield t.next?.handle(e);return a&&o?t._insertTagInSchemaRecord(r):o})()}};Sr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.TagMiniPageSaveRecordHandler",scopes:[g.TAG_DEFAULT_MINI_PAGE_SCHEMA_NAME]})],Sr);let fr=class extends i.BaseRequestHandler{_isNeedUpdateTagInRecordDataSource(e){const t=e.modelName;return[S.ModelEventType.Update,S.ModelEventType.Delete].includes(e.modelEvent.type)&&this._isTagSelectListItemsDataSourceName(t)}_isTagSelectListItemsDataSourceName(e){return e?.endsWith("_List_Items_DS")}_updateTagInRecordDataSource(e){var t=this;const r=e.$context,a=this._getTagSelectItemsDataSourceName(e.modelName);if(!r.isDataSourceForCollection(a))return;const o={type:"crt.LoadDataRequest",$context:e.$context,dataSourceName:a,config:{loadType:i.DataSourceLoadType.Reload}};setTimeout((0,d.Z)(function*(){yield t.handlerChain.process(o)}))}_getTagSelectItemsDataSourceName(e){return e.replace("_List_","_")}handle(e){var t=this;return(0,d.Z)(function*(){const r=yield t.next?.handle(e);return t._isNeedUpdateTagInRecordDataSource(e)&&(yield t._updateTagInRecordDataSource(e)),r})()}};fr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleModelEventRequest",type:"crt.TagModelChangedHandler"})],fr);class pa extends oa{get invalidErrorMessageForSelectRecordsValidator(){return`InfoDialog.TagsInRecords.SelectRecordsTo${this.openLookupPageMode}Message`}_getRecordColumnName(e){return(0,g.isOldStructure)(e)?g.OLD_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA:g.DEFAULT_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA}_createDefaultValuesForTaggingIfNeed(e,t){return this._isOldTag(e)?null:{RecordSchemaName:t}}_isOldTag(e){return e!==g.DEFAULT_TAG_SOURCE_SCHEMA_NAME}_prepareDataForList(e){var t=this;return(0,d.Z)(function*(){t._tagColumnSchemaName=(yield t._getTagColumnFromTagInRecordSchema(e)).referenceSchemaName,!(0,g.isOldStructure)(e)&&(yield t._prepareAllowedTagAccessesForTagging())})()}_getTagColumnFromTagInRecordSchema(e){var t=this;return(0,d.Z)(function*(){return(yield(0,p.lastValueFrom)(t.entitySchemaRepository.getSchemaByName(t._getTagInRecordSourceSchemaName(e)))).columns.find(a=>a.name===g.DEFAULT_TAG_COLUMN_NAME_TAG_IN_RECORD_SCHEMA)})()}_getTagInRecordSourceSchemaName(e){return(0,g.isOldStructure)(e)?e.tagInRecordSourceSchemaName:g.DEFAULT_TAG_IN_RECORD_SOURCE_SCHEMA_NAME}_prepareAllowedTagAccessesForTagging(){var e=this;return(0,d.Z)(function*(){e._allowedTagAccessesForTaggingIds=yield(0,g.getAllowedTagAccessesForTagging)(e.tagRightsService)})()}_getLookupPageFiltersForOldStructure(){return(0,g.createOldTagListFilter)(this.userInfo)}_getLookupPageFiltersForNewStructure(e){return(0,g.createTagListFilter)([e],this._allowedTagAccessesForTaggingIds)}constructor(e){super(e),this.injector=e,this._allowedTagAccessesForTaggingIds=[],this.entitySchemaRepository=e.get(h.EntitySchemaRepository),this.translateService=e.get(w.TranslateService),this.baseRelatedInMainRecordsService=e.get(E.FL),this.tagRightsService=e.get(g.TagRightsService),this.userInfo=e.get(h.UserInfo)}createServiceData(e,t){return{relatedRecordsSchemaName:this.getRelatedRecordsSchemaName(e),relatedRecordColumnName:this._getRecordColumnName(e),relatedRecordsFilters:e.filters,relatedInMainRecordsSchemaName:this._getTagInRecordSourceSchemaName(e),mainRecordsSchemaName:this._tagColumnSchemaName,mainRecordColumnName:g.DEFAULT_TAG_COLUMN_NAME_TAG_IN_RECORD_SCHEMA,mainRecordsFilters:t}}addRecordsServiceAction(e){const t=e.relatedRecordsSchemaName;return e.defaultValues=this._createDefaultValuesForTaggingIfNeed(this._tagColumnSchemaName,t),super.addRecordsServiceAction(e)}getLookupPageEntitySchemaName(e){return this._tagColumnSchemaName}getLookupPageCaption(e){const t=this.openLookupPageMode==="AddRecords"?"AddTagCaption":"RemoveTagCaption";return this.translateService.instant(`OpenTagLookupPage.${t}`)}getLookupPageFilter(e){const r=e.$context.dataSchemas[e.dataSourceName]?.name;return this._isOldTag(this._tagColumnSchemaName)?this._getLookupPageFiltersForOldStructure():this._getLookupPageFiltersForNewStructure(r)}getMaskTaskName(e){return`TAGGING_${this.getRelatedRecordsSchemaName(e)}_RECORDS`}initializeData(e){var t=this;return(0,d.Z)(function*(){yield t._prepareDataForList(e)})()}}let Cr=class extends pa{constructor(e){super(e),this._injector=e,this.openLookupPageMode="AddRecords"}};Cr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.AddTagsInRecordsRequest",type:"crt.AddTagsInRecordsHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Cr);let vr=class extends pa{constructor(e){super(e),this._injector=e,this.openLookupPageMode="RemoveRecords"}};vr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.RemoveTagsInRecordsRequest",type:"crt.RemoveTagsInRecordsHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],vr);let Ue=class extends i.BaseRequestHandler{constructor(e,t,r){super(),this._messageDialogProvider=e,this._customEventService=t,this._isAngularHost=r}_getEntitySchemaName(e){var t=this;return(0,d.Z)(function*(){const r=yield t._getDataSourceName(e);return e.$context.dataSchemas[r]?.dataSourceConfig?.config?.entitySchemaName})()}_getDataSourceName(e){const t=e.$context.getBoundDataSourceName(e.itemsAttributeName);return t||e.$context.getPrimaryModelName()}_subscribeOnCardModuleResponse(e){return this._customEventService.subscribe("CardModuleResponse").pipe((0,M.switchMap)(t=>this._updateLookups(e,t))).subscribe()}_setAttributesValue(e,t,r,a){return(0,d.Z)(function*(){const o=r?.attributes.filter(c=>c.referenceSchemaName===a.entitySchemaName);for(const c of o||[]){const u=e.getViewModelAttributePath(t,c.name);u&&(yield e[u])?.value===a.primaryColumnValue&&(yield e.set(u,{value:a.primaryColumnValue,displayValue:a.primaryDisplayColumnValue},{silent:!0}))}})()}_isModelLoaded(e,t){const r=e.getBoundDataSourceNameByAttributePath(t);return e.getModelByName(r)?.isLoaded}_updateLookups(e,t){var r=this;return(0,d.Z)(function*(){const a=e.$context,o=yield r._getDataSourceName(e),c=a.dataSchemas[o];yield r._setAttributesValue(a,o,c,t);for(const[u,m]of Object.entries(a.attributes))if(m instanceof S.BaseViewModelCollection&&r._isModelLoaded(a,u)){const _=yield a[u];for(const f of _||[]){const v=Object.entries(f.dataSchemas);for(const[P,fe]of v||[])yield r._setAttributesValue(f,P,fe,t)}}})()}handle(e){var t=this;return(0,d.Z)(function*(){if(!e.entityName&&!e.itemsAttributeName||!e.recordId){t._messageDialogProvider.open({data:{message:"InfoDialog.OpenPage.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}});return}const r=e.entityName?e.entityName:yield t._getEntitySchemaName(e),a={type:"crt.7XRequest",action:"EditRecord",$context:e.$context,payload:{recordId:e.recordId,entityName:r,replaceHistoryState:e.replaceHistoryState}};if(t._isAngularHost){const o=t._subscribeOnCardModuleResponse(e);e.$context?._subscriptions.add(o)}return t.handlerChain.process(a)})()}};(0,l.__decorate)([(0,S.CrtCanDiscardUnsavedData)(),(0,l.__metadata)("design:type",Function),(0,l.__metadata)("design:paramtypes",[Object]),(0,l.__metadata)("design:returntype",Promise)],Ue.prototype,"handle",null),Ue=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.UpdateRecordRequest",type:"crt.UpdateRecordHandler"}),(0,l.__param)(2,(0,i.CrtInject)(h.IS_ANGULAR_HOST)),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider,I.CustomEventService,Boolean])],Ue);let ha=class extends i.BaseRequest{};ha=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.UploadDataAttributeFileRequest"})],ha);let yr=class extends i.BaseRequestHandler{constructor(e){super(),this.fileApiService=e}handle(e){var t=this;return(0,d.Z)(function*(){const r={...e.detail.file,fileEntitySchemaName:"SysFile"};return yield(0,p.lastValueFrom)(t.fileApiService.uploadAsColumn(r),{defaultValue:null})})()}};yr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.UploadDataAttributeFileRequest",type:"crt.UploadDataAttributeFileHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards]}),(0,l.__metadata)("design:paramtypes",[h.FileApiService])],yr);let ga=class extends i.BaseRequest{};ga=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.UploadEntityFileRequest"})],ga);let Rr=class extends i.BaseRequestHandler{constructor(e){super(),this.fileApiService=e}_getDataSchema(e){const t=this._getDataSourceName(e);return e.$context.models.find(r=>r.dataSource.dataSourceName===t)}_getDataSourceName(e){return e.$context.getBoundDataSourceName(e.filesAttributeName)}handle(e){var t=this;return(0,d.Z)(function*(){const a=t._getDataSchema(e)?.dataSource?.initialConfig,o=a.storageSchemaName,c=a.recordSchemaName,u=a.recordColumnName,m=e.$context.attributes[e.recordAttributeName],_={...e.detail.file,fileEntitySchemaName:o,recordEntitySchemaName:c,recordColumnName:u,recordId:m?.value||m};return a.storageSchemaName===a.entitySchemaName?yield(0,p.lastValueFrom)(t.fileApiService.upload(_),{defaultValue:null}):yield(0,p.lastValueFrom)(t.fileApiService.uploadAndAttach(_),{defaultValue:null})})()}};Rr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.UploadEntityFileRequest",type:"crt.UploadEntityFileHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards]}),(0,l.__metadata)("design:paramtypes",[h.FileApiService])],Rr);let Er=class extends i.BaseRequestHandler{_removedItemIndex(e,t,r){return(0,d.Z)(function*(){for(let a=0;a<e.length;a++){const o=e[a],c=o.getViewModelAttributePath(t,r.name);if((yield o[c])===r.value)return a}return-1})()}_onRecordDeleted(e,t,r){var a=this;return(0,d.Z)(function*(){for(const[o,c]of Object.entries(e.attributes))if(c instanceof S.BaseViewModelCollection&&e.getBoundDataSourceNameByAttributePath(o)===t){const u=c,m=yield a._removedItemIndex(u,t,r);if(m>=0){const _=u[m];u.removeChildModel(_),u.splice(m,1)}}})()}_removeDeletedItemsFromCollection(e,t){const r=e.$context,a=e.modelName,o=r.dataSchemas[a];t.filter(u=>u.name===o.primaryAttributeName).forEach(u=>this._onRecordDeleted(r,a,u))}_reloadData(e,t){return this.handlerChain.process({type:"crt.LoadDataRequest",$context:t,dataSourceName:e,config:{loadType:i.DataSourceLoadType.Reload}})}_refreshData(e){var t=this;return(0,d.Z)(function*(){const r=e.$context,a=e.modelEvent.payload?.primaryAttributesValues;a?.length||(yield t._reloadData(e.modelName,r));for(const o of a)Array.isArray(o)&&(yield t._removeDeletedItemsFromCollection(e,o))})()}handle(e){var t=this;return(0,d.Z)(function*(){return e.$context.isDataSourceForCollection(e.modelName)&&e.modelEvent.type===S.ModelEventType.Delete&&(yield t._refreshData(e)),t.next?.handle(e)})()}};Er=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleModelEventRequest",type:"crt.ViewModelRecordsDeletedHandler"})],Er);let _a=class extends i.BaseRequest{constructor(){super(...arguments),this.type="crt.ParametersChangeRequest"}};_a=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.ParametersChangeRequest"})],_a);let Tr=class extends i.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const{$context:r,entries:a}=e||{},o=[];for(const c of Object.values(a)){const{params:u,request:m}=c,_={type:m,scopes:e.scopes,$context:r,...u};o.push(t.handlerChain.process(_))}return o.length>0&&(yield Promise.all(o)),Promise.resolve()})()}};Tr=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.ParametersChangeRequestHandler",requestType:"crt.ParametersChangeRequest"})],Tr);let Sa=class extends i.BaseRequest{constructor(){super(...arguments),this.type="crt.SetViewModelAttributeRequest"}};Sa=(0,l.__decorate)([(0,i.CrtRequest)({type:"crt.SetViewModelAttributeRequest"})],Sa);let Dr=class extends i.BaseRequestHandler{handle(e){const{$context:t,attributeName:r,value:a}=e||{};return a&&(t[r]=a),Promise.resolve()}};Dr=(0,l.__decorate)([(0,i.CrtRequestHandler)({type:"crt.SetViewModelAttributeRequestHandler",requestType:"crt.SetViewModelAttributeRequest"})],Dr);let Pr=class extends i.BaseRequestHandler{constructor(e,t,r,a){super(),this._schemaService=e,this._notifyService=t,this._translateService=r,this._printablesService=a,this._translatePrefix="PrintablesHandler"}_getRecordIdByPrimaryDataSource(e){return(0,d.Z)(function*(){const{dataSourceName:t,$context:r}=e,a=yield r.getPrimaryModelName();if(t===a){const o=yield r.getPrimaryDataSchema(),c=r.getViewModelAttributePath(a,o.primaryAttributeName);return r[c]}return null})()}_getRecordId(e){var t=this;return(0,d.Z)(function*(){const r=yield t._getRecordIdByPrimaryDataSource(e);if(r)return r;const a=e.$context.getCollectionViewModelAttributePath(e.dataSourceName),o=t._schemaService.getViewConfigInfoByPropertyValues([`$${a}`]).map(m=>m.viewConfig).filter(m=>["crt.DataGrid","crt.FileList","crt.ApprovalList","crt.ChartWidget","crt.IndicatorWidget","crt.GaugeWidget","crt.Gallery","crt.Calendar"].includes(m.type));if(o.length>1)throw new Error("Several view elements are bound to specified in the request datasource.");const u=`${o?.[0].name}_ActiveRow`;return e.$context[u]})()}_getFilters(e){return e instanceof i.FilterGroup?(0,Qe.classToPlain)(e):e}_isRequestValid(e){return!(!e||!e.templateId||!e.dataSourceName||!e.printableCaption)}_showInfoMessage(e){var t=this;return(0,d.Z)(function*(){const r=t._translateService.instant(`${t._translatePrefix}.${e}`);yield t._notifyService.show({message:r})})()}handle(e){var t=this;return(0,d.Z)(function*(){if(!t._isRequestValid(e))return t._showInfoMessage("InvalidRequestCaption");const a=t._getFilters(e.filters);if(a){const m={templateId:e.templateId,filtersConfig:JSON.stringify(a),convertInPDF:e.convertInPDF};return t._printablesService.generatePrintablesByFilter(m,e.printableCaption)}if((yield e.$context[H])===i.ModelInPageAction.Add)return t._showInfoMessage("PrintForUnsavedRecordCaption");const u=yield t._getRecordId(e);if(u){const m={templateId:e.templateId,recordIds:[u],convertInPDF:e.convertInPDF};return t._printablesService.generatePrintables(m,e.printableCaption)}return t._showInfoMessage("SelectRecord")})()}};Pr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.PrintablesRequest",type:"crt.PrintablesHandler"}),(0,l.__metadata)("design:paramtypes",[D.SchemaService,x.NotifyService,w.TranslateService,y.PrintablesService])],Pr);let Ar=class extends i.BaseRequestHandler{constructor(e){super(),this._injector=e,this._viewModelDataDelayerService=this._injector.get(E.Wn,null,{optional:!0})}handle(e){var t=this;return(0,d.Z)(function*(){t._viewModelDataDelayerService?.setState(e.$context,S.ViewModelStates.Paused),yield t.next?.handle(e)})()}};Ar=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleViewModelPauseRequest",type:"crt.SetViewModelPauseStateRequestHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Ar);let Ir=class extends i.BaseRequestHandler{constructor(e){super(),this._injector=e,this._viewModelDataDelayerService=this._injector.get(E.Wn,null,{optional:!0})}handle(e){var t=this;return(0,d.Z)(function*(){t._viewModelDataDelayerService?.setState(e.$context,S.ViewModelStates.Active),yield t.next?.handle(e)})()}};Ir=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleViewModelResumeRequest",type:"crt.SetViewModelResumeStateRequestHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Ir);const fa=/#ResourceString\((.*)\)#/;let Nr=class extends i.BaseRequestHandler{constructor(e,t){super(),this._featureValues=e,this._schemaPartsService=t}_getResourceKeys(e){return(0,R.isEmpty)(e)?null:typeof e=="string"?fa.test(e)?[e.replace(fa,"$1")]:[]:typeof e=="object"?Object.values(e).map(t=>this._getResourceKeys(t)).flat():Array.isArray(e)?e.map(t=>this._getResourceKeys(t)).flat():null}_removeResources(e,t){var r=this;return(0,d.Z)(function*(){if(!r._featureValues.CleanupProfileResourcesWhenRemovingViewElement)return;const{viewConfig:a}=e;if(!a)return;const o=yield t.loadResources();if((0,R.isEmpty)(o?.localizableStrings))return;const c=Object.keys(o.localizableStrings),u=Object.values(a).map(_=>r._getResourceKeys(_)).flat().filter(_=>Boolean(_)&&c.includes(_));if(!u.length)return;const m=(0,R.cloneDeep)(o);u.forEach(_=>m.localizableStrings[_]=void 0),yield t.upsertResources(m)})()}_removeViewElement(e,t){const{index:r,parentName:a,parentPropertyName:o}=e;if(!a||r==null||r<0)return;((t.getViewConfigInfoByName(a)?.viewConfig||{})?.[o]??[]).splice(r,1)}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.name;return r&&(yield t._schemaPartsService.apply(function(){var a=(0,d.Z)(function*([o,c]){const u=o.getViewConfigInfoByName(r);!u||(t._removeViewElement(u,o),yield t._removeResources(u,c))});return function(o){return a.apply(this,arguments)}}()),yield t._schemaPartsService.commit({silent:!1})),t.next?.handle(e)})()}};Nr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.RemoveViewElementRequest",type:"crt.RemoveViewElementHandler"}),(0,l.__param)(0,(0,s.Inject)(h.FEATURE_VALUES)),(0,l.__param)(0,(0,i.CrtInject)(h.FEATURE_VALUES)),(0,l.__metadata)("design:paramtypes",[h.FeatureValues,D.SchemaPartsService])],Nr);const hs=JSON.parse(`{"ConfirmationDialog":{"DeleteRecordConfirmation":"Are you sure that you want to delete the selected record?","DeleteRecordsConfirmation":"Are you sure that you want to delete the selected records?","SaveDataGridConfigsForAllUsers":"Save list settings for all users?","ResetDataGridConfigsToDefault":"Restore default list settings?","SaveSummariesForAll":"Save summaries settings for all users?","ResetSummaries":"Restore default summaries settings?"},"InfoDialog":{"RightLevelWarningMessage":"Insufficient rights to delete records in the '{0}' object","UnableToDeleteSelectedRecord":"Unable to delete selected record","SelectRecordsToDelete":"Select records to delete","SettingsErrorMessage":"Unable to execute the action.\\n\\rSystem administrator must check the button settings in the Freedom UI Designer.","ExportToExcel":{"PermissionsErrorMessage":"You do not have permission to perform this operation.\\nPlease contact your system administrator. Check access to the export object and permission to perform the system operation."},"FileUpload":{"SizeValidationMessage":"{0} MB maximum file size limit exceeded.\\n\\r\\n\\r Files:\\n- {1}","NoConnectedFileList":"The file upload destination is not set.\\n\\rPlease choose the destination in the button settings.","InvalidRequestParams":"Unable to upload the file(s) as the page component has not been set up yet. The system administrator can finish the setup in the Freedom UI designer.","ChangeFileSizeInfoMessage":"You can increase the maximum file size in the \\"Attachment max size\\" system setting.","FileListHeader":"Files","MaxFileSizeExceededExceptionMessage":"{0} MB maximum file size limit exceeded.","UnknownServerError":"Something went wrong.\\n\\rPlease try uploading the file again.","AttachedToUnsavedRecord":"Unable to attach the files to the record that has not been created yet. Please create the record before uploading the files","InvalidExtension":{"Deny":"The [{0}] file extension is forbidden by security settings. If you need to work with such files, please contact your system administrator to remove the extension from the [File extensions DenyList] (FileExtensionsDenyList) system setting","Allow":"The [{0}] file extension is forbidden by security settings. If you need to work with such files, please contact your system administrator to add the extension to the [File extensions AllowList] (FileExtensionsAllowList) system setting"}},"ImageUpload":{"MaxFileSizeExceededExceptionMessage":"{0} MB maximum file size limit exceeded.","UnknownUploadError":"Unknown upload error. Please contact the system administrator."},"SetRecordRights":{"SettingsErrorMessage":"Action error.\\nContact your system administrator. Check the action settings in System Designer."},"OpenPage":{"SettingsErrorMessage":"Action error.\\nContact your system administrator. Check the action settings in System Designer."},"TagsInRecords":{"SelectRecordsToAddRecordsMessage":"Select records to add tags","SelectRecordsToRemoveRecordsMessage":"Select records to remove tags"},"RecordsInStaticFolders":{"SelectRecordsToAddRecordsMessage":"Select records to add to the static folder","SelectRecordsToRemoveRecordsMessage":"Select records to remove from the static folder"}},"OpenTagLookupPage":{"AddTagCaption":"Add tag","RemoveTagCaption":"Remove tag"},"PrintablesHandler":{"PrintForUnsavedRecordCaption":"The report can not be printed for unsaved record.","InvalidRequestCaption":"Action is not valid. Please check print settings.","SelectRecord":"Select record for printing report"}}`),gs=JSON.parse(`{"ConfirmationDialog":{"DeleteRecordConfirmation":"\u0412\u044B \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u044C\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u044B\u0434\u0435\u043B\u0435\u043D\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C?","DeleteRecordsConfirmation":"\u0412\u044B \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u044C\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u044B\u0434\u0435\u043B\u0435\u043D\u043D\u044B\u0435 \u0437\u0430\u043F\u0438\u0441\u0438?","SaveDataGridConfigsForAllUsers":"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0441\u043F\u0438\u0441\u043A\u0430 \u0434\u043B\u044F \u0432\u0441\u0435\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439?","ResetDataGridConfigsToDefault":"\u0412\u0435\u0440\u043D\u0443\u0442\u044C \u0434\u043B\u044F \u0441\u043F\u0438\u0441\u043A\u0430 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E?","SaveSummariesForAll":"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0438\u0442\u043E\u0433\u043E\u0432 \u0434\u043B\u044F \u0432\u0441\u0435\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439?","ResetSummaries":"\u0412\u0435\u0440\u043D\u0443\u0442\u044C \u0434\u043B\u044F \u0438\u0442\u043E\u0433\u043E\u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E?"},"InfoDialog":{"RightLevelWarningMessage":"\u041D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u043F\u0440\u0430\u0432 \u0434\u043B\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0437\u0430\u043F\u0438\u0441\u0438 \u0432 \u043E\u0431\u044A\u0435\u043A\u0442\u0435 '{0}'","UnableToDeleteSelectedRecord":"\u0412\u044B\u0434\u0435\u043B\u0435\u043D\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C \u043D\u0435 \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u043E\u0441\u044C \u0443\u0434\u0430\u043B\u0438\u0442\u044C","SelectRecordsToDelete":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0434\u043B\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F","SettingsErrorMessage":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F.\\n\\r\u0421\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u043F\u0440\u043E\u0432\u0435\u0440\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043A\u043D\u043E\u043F\u043A\u0438 \u0432  \u0434\u0438\u0437\u0430\u0439\u043D\u0435\u0440\u0435 Freedom UI.","ExportToExcel":{"PermissionsErrorMessage":"\u0423 \u0432\u0430\u0441 \u043D\u0435\u0442 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043D\u0438\u044F \u043D\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u0435 \u044D\u0442\u043E\u0439 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0438.\\n\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443. \u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0434\u043E\u0441\u0442\u0443\u043F \u043A \u043E\u0431\u044A\u0435\u043A\u0442\u0443 \u044D\u043A\u0441\u043F\u043E\u0440\u0442\u0430 \u0438 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043D\u0438\u0435 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0439 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0438."},"FileUpload":{"SizeValidationMessage":"\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430: {0} \u041C\u0411.\\n\\r\\n\\r \u0424\u0430\u0439\u043B\u044B:\\n- {1}","NoConnectedFileList":"\u0421\u043F\u0438\u0441\u043E\u043A, \u043A\u0443\u0434\u0430 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044C \u0444\u0430\u0439\u043B\u044B, \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D.\\n\\r\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0434\u043B\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0444\u0430\u0439\u043B\u043E\u0432 \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u044D\u0442\u043E\u0439 \u043A\u043D\u043E\u043F\u043A\u0438.","InvalidRequestParams":"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u0430\u0439\u043B(\u044B), \u0442\u0430\u043A \u043A\u0430\u043A \u0434\u0430\u043D\u043D\u044B\u0439 \u043A\u043E\u043C\u043F\u043E\u043D\u0435\u043D\u0442 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u044B \u0435\u0449\u0435 \u043D\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043D. \u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440 \u0441\u0438\u0441\u0442\u0435\u043C\u044B \u043C\u043E\u0436\u0435\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0443 \u043A\u043E\u043C\u043F\u043E\u043D\u0435\u043D\u0442\u0430 \u0432 \u0434\u0438\u0437\u0430\u0439\u043D\u0435\u0440\u0435 Freedom UI.","ChangeFileSizeInfoMessage":"\u0423\u0432\u0435\u043B\u0438\u0447\u0438\u0442\u044C \u044D\u0442\u043E \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043C\u043E\u0436\u043D\u043E \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0439 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0435 \xAB\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430\xBB.","FileListHeader":"\u0424\u0430\u0439\u043B\u044B","MaxFileSizeExceededExceptionMessage":"\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 {0} \u041C\u0411.","UnknownServerError":"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A.\\n\\r\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437.","AttachedToUnsavedRecord":"\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0444\u0430\u0439\u043B\u044B \u043A \u0435\u0449\u0435 \u043D\u0435 \u0441\u043E\u0437\u0434\u0430\u043D\u043D\u043E\u0439 \u0437\u0430\u043F\u0438\u0441\u0438. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0441\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u044C \u043F\u0435\u0440\u0435\u0434 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u043E\u0439 \u0444\u0430\u0439\u043B\u043E\u0432","InvalidExtension":{"Deny":"\u0424\u0430\u0439\u043B\u044B \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435\u043C [{0}] \u0437\u0430\u043F\u0440\u0435\u0449\u0435\u043D\u044B \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u043C\u0438 \u0431\u0435\u0437\u043E\u043F\u0430\u0441\u043D\u043E\u0441\u0442\u0438. \u0415\u0441\u043B\u0438 \u0432\u0430\u043C \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C \u0441 \u0444\u0430\u0439\u043B\u0430\u043C\u0438 \u0442\u0430\u043A\u043E\u0433\u043E \u0442\u0438\u043F\u0430, \u043F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430 \u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043C\u044B, \u0434\u043B\u044F \u0442\u043E\u0433\u043E \u0447\u0442\u043E\u0431\u044B \u0443\u0431\u0440\u0430\u0442\u044C \u0434\u0430\u043D\u043D\u043E\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0439 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 [\u0421\u043F\u0438\u0441\u043E\u043A \u0437\u0430\u043F\u0440\u0435\u0449\u0435\u043D\u043D\u044B\u0445 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0439 \u0444\u0430\u0439\u043B\u043E\u0432] (FileExtensionsDenyList)","Allow":"\u0424\u0430\u0439\u043B\u044B \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435\u043C [{0}] \u0437\u0430\u043F\u0440\u0435\u0449\u0435\u043D\u044B \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u043C\u0438 \u0431\u0435\u0437\u043E\u043F\u0430\u0441\u043D\u043E\u0441\u0442\u0438. \u0415\u0441\u043B\u0438 \u0432\u0430\u043C \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C \u0441 \u0444\u0430\u0439\u043B\u0430\u043C\u0438 \u0442\u0430\u043A\u043E\u0433\u043E \u0442\u0438\u043F\u0430, \u043F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430 \u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043C\u044B, \u0434\u043B\u044F \u0442\u043E\u0433\u043E \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u043E\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u0443\u044E \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0443 [\u0421\u043F\u0438\u0441\u043E\u043A \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043D\u043D\u044B\u0445 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0439 \u0444\u0430\u0439\u043B\u043E\u0432] (FileExtensionsAllowList)"}},"ImageUpload":{"MaxFileSizeExceededExceptionMessage":"\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 {0} \u041C\u0411.","UnknownUploadError":"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043C\u044B."},"SetRecordRights":{"SettingsErrorMessage":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F.\\n\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443. \u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0430 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F \u0432 System Designer."},"OpenPage":{"SettingsErrorMessage":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F.\\n\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443. \u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0430 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F \u0432 System Designer."},"TagsInRecords":{"SelectRecordsToAddRecordsMessage":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0434\u043B\u044F \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u044F \u0442\u0435\u0433\u0430","SelectRecordsToRemoveRecordsMessage":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0434\u043B\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0442\u0435\u0433\u0430"},"RecordsInStaticFolders":{"SelectDataToAddRecordsMessage":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0434\u043B\u044F \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u044F \u0432 \u0441\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0443\u044E \u0433\u0440\u0443\u043F\u043F\u0443","SelectDataToRemoveRecordsMessage":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0434\u043B\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0438\u0437 \u0441\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u043E\u0439 \u0433\u0440\u0443\u043F\u043F\u044B"}},"OpenTagLookupPage":{"AddTagCaption":"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0435\u0433","RemoveTagCaption":"\u0423\u0431\u0440\u0430\u0442\u044C \u0442\u0435\u0433"},"PrintablesHandler":{"PrintForUnsavedRecordCaption":"\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043E\u0442\u0447\u0435\u0442 \u043F\u043E\u043A\u0430 \u0437\u0430\u043F\u0438\u0441\u044C \u043D\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0430.","InvalidRequestCaption":"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u043E. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0443 \u043F\u0435\u0447\u0430\u0442\u0438.","SelectRecord":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u044C \u0434\u043B\u044F \u043F\u0435\u0447\u0430\u0442\u0438 \u043E\u0442\u0447\u0435\u0442\u0430"}}`),_s={["en-US"]:hs,["ru-RU"]:gs};let Mr=class extends i.BaseRequestHandler{constructor(e){super(),this._schemaPartsService=e}_saveToProfile(e,t){var r=this;return(0,d.Z)(function*(){(0,R.isEmpty)(e)||(yield r._schemaPartsService.apply(function(){var a=(0,d.Z)(function*([o]){yield o.setViewModelAttribute(e,t)});return function(o){return a.apply(this,arguments)}}()),yield r._schemaPartsService.commit())})()}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context;return yield t._saveToProfile(e.valueAttributeName,{value:e.value}),(0,p.lastValueFrom)(r.setValue({[e.valueAttributeName]:e.value}))})()}};Mr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.QuickFilterRequest",type:"crt.QuickFilterHandler"}),(0,l.__metadata)("design:paramtypes",[D.SchemaPartsService])],Mr);let xr=class extends i.BaseRequestHandler{constructor(e){super(),this._featureService=e,this._synchronize=null}_isValid(e,t,r){return!(r._getAttributeDataValueTypeName(e)==="Color"&&!t)}handle(e){var t=this;return(0,d.Z)(function*(){const r=e.$context;if(t._synchronize=t._synchronize??!(yield(0,p.firstValueFrom)(t._featureService.getFeatureState("DisableModelBindAttributeSynchronization"))),t._synchronize){const a=e.attributeName,o=r._getBoundAttributesNames(a);for(const c of o??[]){const u=e.value;(yield r[c])!==u&&t._isValid(a,u,r)&&(r[c]=u)}}return t.next?.handle(e)})()}};xr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleViewModelAttributeChangeRequest",type:"crt.SynchronizeAttributesHandler"}),(0,l.__metadata)("design:paramtypes",[y.FeatureService])],xr);const Ca="Type.Id";let br=class extends i.BaseRequestHandler{constructor(e,t,r){super(),this._rightsService=e,this._translateService=t,this._messageDialogProvider=r}_getOldTagDataSchema(e){return e.$context.getBoundDataSchemaByAttributePath(e.itemsAttributeName)}_getOldTagTypeId(e,t){return(0,d.Z)(function*(){const a=yield(yield i.Model.create(e)).load({attributes:[Ca],parameters:[{type:i.ModelParameterType.PrimaryColumnValue,value:t}]});return Promise.resolve((0,R.get)((0,R.first)(a),Ca))})()}_isCanDeleteOldTag(e){var t=this;return(0,d.Z)(function*(){return Promise.resolve(t._isNotPublicOldTagTypes(e)||(yield t._canDeletePublicOldTagTypes(e)))})()}_isNotPublicOldTagTypes(e){return e!==g.OLD_PUBLIC_TAG_TYPE_ID&&e!==g.OLD_CORPORATE_TAG_TYPE_ID}_canDeletePublicOldTagTypes(e){var t=this;return(0,d.Z)(function*(){const r=yield t._getAllowedOldTagOperations();return e===g.OLD_PUBLIC_TAG_TYPE_ID&&r.canManagePublicTags||e===g.OLD_CORPORATE_TAG_TYPE_ID&&r.canManageCorporateTags})()}_getAllowedOldTagOperations(){return(0,g.getAllowedOldTagOperations)(this._rightsService)}_deleteOldTag(e){return this.handlerChain.process({...e,type:"crt.DeleteRecordRequest"})}_showInsufficientRightsDialog(e){var t=this;return(0,d.Z)(function*(){const r=t._getInsufficientRightsErrorMessage(e);yield t._openInfoDialog(r)})()}_getInsufficientRightsErrorMessage(e){const t=this._getDataSchemaCaption(e),r="InfoDialog.RightLevelWarningMessage";return this._translateService.instant(r).replace("{0}",t)}_getDataSchemaCaption(e){return(0,h.getLocalizableStringValue)(e.caption,this._translateService.currentLang)}_openInfoDialog(e){var t=this;return(0,d.Z)(function*(){yield(0,p.lastValueFrom)(t._messageDialogProvider.open({data:{message:e,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}))})()}handle(e){var t=this;return(0,d.Z)(function*(){const r=t._getOldTagDataSchema(e),a=yield t._getOldTagTypeId(r.name,e.recordId);return(yield t._isCanDeleteOldTag(a))?t._deleteOldTag(e):t._showInsufficientRightsDialog(r)})()}};br=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.DeleteOldTagRecordRequest",type:"crt.DeleteOldTagRecordHandler"}),(0,l.__metadata)("design:paramtypes",[y.RightsService,w.TranslateService,g.MessageDialogProvider])],br);let wr=class extends i.BaseRequestHandler{constructor(e,t,r,a,o,c,u){super(),this._fileApiService=e,this._fileProcessingService=t,this._fileReaderService=r,this._messageDialogProvider=a,this._translateService=o,this._notifyService=c,this._maskService=u}_uploadFile(e,t,r){const a=[...e],o=[...t];let c=0;const u="UPLOAD_FILE_"+a.map(m=>m.name).join("_");this._maskService.showMask(u,r.$context),(0,p.from)(a).pipe((0,M.mergeMap)(m=>this._fileReaderService.read(m)),(0,M.map)(m=>{const _=(0,i.generateGuid)();return{...m,id:_,recordColumnName:r.recordColumnName,fileEntitySchemaName:r.fileEntitySchemaName,recordEntitySchemaName:r.recordEntitySchemaName,recordId:r.recordId,fileGroup:r.fileGroup,tag:r.tag}}),(0,M.concatMap)(m=>this._fileApiService.upload(m).pipe((0,M.tap)(()=>{this._addFileToCollection(m)}),(0,p.catchError)(_=>{const f=_?.status===400,v=_.error?.error||this._translateService.instant("InfoDialog.FileUpload.UnknownServerError"),P=f?v:_.errorCode,fe=f?v:_.message;return o.push((0,h.createFileErrorLogItem)(_.file,P,fe)),(0,p.of)(null)})))).subscribe({next:()=>{c++,c>=a.length&&(this._maskService.hideMask(u,r.$context),this._checkErrorsAndShowMessage(o))},complete:()=>{a.length===0&&this._checkErrorsAndShowMessage(o),this._maskService.hideMask(u,r.$context)}})}_checkErrorsAndShowMessage(e){const t=this._fileProcessingService.createFileErrorMessageForLogs(e);t&&this._messageDialogProvider.open({data:{message:t,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}_processFilesFromRequst(e){var t=this;return(0,d.Z)(function*(){const{files:r,errors:a}=yield t._fileProcessingService.processSelectedFiles(e.files,e.maximumAllowedFileSize);t._uploadFile(r,a,e)})()}_processFilesWithSelection(e){var t=this;return(0,d.Z)(function*(){const{maximumAllowedFileSize:r,allowedFileTypes:a}=e,o={type:"crt.SelectFileRequest",maximumAllowedFileSize:r,allowedFileTypes:a,multiple:!0,displayErrors:!1,$context:e.$context},{files:c,errors:u}=yield t.handlerChain.process(o);t._uploadFile(c,u,e)})()}_addFileToCollection(e){var t=this;return(0,d.Z)(function*(){if(!t._itemsCollection||e.file?.size===0)return null;const r=yield t._itemsCollection.createItem({index:0,initialModelValues:{Id:e.id,Name:e.file.name,Size:e.file.size}});r?.formApiModel?.markAsDirty(),r?.markPrimaryModelFor(h.ModelMode.Update)})()}checkTargetSchema(e){let t=!0;const r=e.$context;if(e.fileEntitySchemaName!=="SysFile"&&r.PrimaryModelMode===h.ModelMode.Create){t=!1;const a=this._translateService.instant("InfoDialog.FileUpload.AttachedToUnsavedRecord");this._notifyService.show({message:a})}return t}checkRequestParams(e){const t=e.recordId;return t?.value&&(e.recordId=t.value),e.recordId instanceof S.BaseViewModel&&(e.recordId=null),this.validateRequest(e)}validateRequest(e){return!e.recordId||!e.recordColumnName||!e.fileEntitySchemaName?(this._messageDialogProvider.open({data:{message:"InfoDialog.FileUpload.InvalidRequestParams",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}),!1):!0}handle(e){var t=this;return(0,d.Z)(function*(){if(!!t.checkRequestParams(e)&&!!t.checkTargetSchema(e)){if(t._itemsCollection=yield e.$context[e.itemsAttributeName],e.files){yield t._processFilesFromRequst(e);return}yield t._processFilesWithSelection(e)}})()}};wr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.UploadFileRequest",type:"crt.UploadFileHandler"}),(0,l.__param)(6,(0,i.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[h.FileApiService,E.dO,h.FileReaderService,g.MessageDialogProvider,w.TranslateService,x.NotifyService,i.MaskService])],wr);let kr=class extends i.BaseRequestHandler{constructor(e,t,r,a){super(),this._imageApiService=e,this._translateService=t,this._sysSettingsService=r,this._messageDialogProvider=a}_openInfoDialog(e){this._messageDialogProvider.open({data:{message:e,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}_processImageUploadResponse(e,t,r){if(t.error){this._openInfoDialog(t.error);return}if(!e.imageAttributeName)return;const a=e.$context,o={value:r,displayValue:e.details.file.name};a[e.imageAttributeName]=o,a.formApiModel.controls[e.imageAttributeName].markAsDirty()}_uploadImage(e){const t=(0,i.generateGuid)();return(0,p.lastValueFrom)(this._imageApiService.upload(t,e.details.file).pipe((0,p.tap)(r=>this._processImageUploadResponse(e,r,t)),(0,p.map)(()=>t),(0,p.catchError)(r=>(this._openInfoDialog("InfoDialog.ImageUpload.UnknownUploadError"),console.error(r),(0,p.of)(null)))))}_updloadImageAsync(e){const t=(0,i.generateGuid)();this._imageApiService.upload(t,e.details.file).subscribe({next:r=>this._processImageUploadResponse(e,r,t),error:r=>{this._openInfoDialog("InfoDialog.ImageUpload.UnknownUploadError"),console.error(r)}})}validateFile(e){var t=this;return(0,d.Z)(function*(){const r=e.details.file,a=yield(0,p.lastValueFrom)(t._sysSettingsService.getByCode("MaxImageSize")),o=e.details.maxFileSize,c=a?.value||0,u=o?Math.min(c,e.details.maxFileSize):c,m=u*h.BYTES_IN_MEGABYTE;if(r.size>m){const _=ca.String.Format(t._translateService.instant("InfoDialog.ImageUpload.MaxFileSizeExceededExceptionMessage"),u);return t._openInfoDialog(_),!1}return!0})()}handle(e){var t=this;return(0,d.Z)(function*(){if(e.details?.file&&(yield t.validateFile(e))){if(e.awaitResponse)return t._uploadImage(e);t._updloadImageAsync(e)}return(0,p.lastValueFrom)((0,p.of)(null))})()}};kr=(0,l.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.UploadImageRequest",type:"crt.UploadImageHandler"}),(0,l.__metadata)("design:paramtypes",[h.ImageApiService,w.TranslateService,y.SysSettingsService,g.MessageDialogProvider])],kr);class _e extends O.DataSourceStructureExplorerService{constructor(e,t,r,a){super(),this._dataSourceRepository=e,this._dataSchemaRepository=t,this._entityBackwardReferenceService=r,this._featureValues=a}getDataSchemaAttributeByPath(e){return(0,p.throwError)(new Error("Method not implemented"))}getDataSchemaByName(e){return this._dataSchemaRepository.get(e)}getDataSourceByName(e){return(0,p.of)(this._dataSourceRepository.get(e))}getDataSources(){return(0,p.of)(this._dataSourceRepository.getAll())}getDataSchemaBackReference(e){return this._featureValues.UseBackwardReferencesInStructureExplorer?this._entityBackwardReferenceService.getBackwardReferences(e):(0,p.of)([])}}_e.\u0275fac=function(e){return new(e||_e)(s.\u0275\u0275inject(E.jW),s.\u0275\u0275inject(S.DataSchemaRepositoryService),s.\u0275\u0275inject(O.EntityBackwardReferenceService),s.\u0275\u0275inject(h.FEATURE_VALUES))},_e.\u0275prov=s.\u0275\u0275defineInjectable({token:_e,factory:_e.\u0275fac});class q{}q.\u0275fac=function(e){return new(e||q)},q.\u0275mod=s.\u0275\u0275defineNgModule({type:q}),q.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:O.DataSourceStructureExplorerService,useClass:_e}],imports:[O.DataSourceStructureExplorerModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(q,{imports:[O.DataSourceStructureExplorerModule]})}();const Ss=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"TaggingService":{"NotValidParametersMessage":"Not valid parameters","TaggingResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time","ErrorMessage":"An error occurred. Please contact the system administrator"}}}'),fs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Oldal szerkeszt\xE9se","ExpandButtonTitle":"Kibont\xE1s","CollapseButtonTitle":"\xD6sszez\xE1r"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Cs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"}}'),vs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\u9009\u62E9\u684C\u9762","EditDesktop":"\u7F16\u8F91\u684C\u9762"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),ys=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Rs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Es=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Ts=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Ds=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"P\xEBrzgjidh desktopin","EditDesktop":"Modifiko desktopin"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Ps=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Selecteaz\u0103 desktop-ul","EditDesktop":"Editeaz\u0103 desktop-ul"},"BasePage":{"DesignButtonHint":"Pagina editare","ExpandButtonTitle":"Extinde","CollapseButtonTitle":"Restr\xE2nge"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),As=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Selecionar desktop","EditDesktop":"Editar desktop"},"BasePage":{"DesignButtonHint":"Editar p\xE1gina","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Is=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Selecionar a \xE1rea de trabalho","EditDesktop":"Editar o desktop"},"BasePage":{"DesignButtonHint":"P\xE1gina de edi\xE7\xE3o","ExpandButtonTitle":"Expandir","CollapseButtonTitle":"Recolher"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Par\xE2metros inv\xE1lidos","ServiceResult":{"ErrorMessage":"Ocorreu um erro. Favor, entrar em contato com o administrador do sistema"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Etiquetados {{ count }} item(ns)","RemoveTagsMessage":"Removidas as etiquetas de {{ count }} item(ns)","AddTagsSuccessfulRunProcess":"Processo de etiquetagem em massa iniciado para o(s) item(ns) escolhido(s). Isto poder\xE1 levar algum tempo","RemoveTagsSuccessfulRunProcess":"Processo de remo\xE7\xE3o em massa de etiquetas iniciado para o(s) item(ns) escolhido(s). Isto poder\xE1 levar algum tempo"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Adicionado(s) {{ count }} registro(s) na(s) pasta(s)","RemoveRecordsMessage":"Removido(s) {{ count }} registro(s) da(s) pasta(s)"}}}'),Ns=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Ms=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),xs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),bs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\u306E\u9078\u629E","EditDesktop":"\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\u306E\u7DE8\u96C6"},"BasePage":{"DesignButtonHint":"\u30DA\u30FC\u30B8\u306E\u7DE8\u96C6","ExpandButtonTitle":"\u5C55\u958B","CollapseButtonTitle":"\u6298\u308A\u305F\u305F\u3080"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),ws=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),ks=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Os=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\u05D1\u05D7\u05E8 \u05E9\u05D5\u05DC\u05D7\u05DF \u05E2\u05D1\u05D5\u05D3\u05D4","EditDesktop":"\u05E2\u05E8\u05D5\u05DA \u05E9\u05D5\u05DC\u05D7\u05DF \u05E2\u05D1\u05D5\u05D3\u05D4"},"BasePage":{"DesignButtonHint":"\u05E2\u05E8\u05D5\u05DA \u05D3\u05E3","ExpandButtonTitle":"Expand","CollapseButtonTitle":"\u05E6\u05DE\u05E6\u05DD"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Vs=JSON.parse(`{"DesktopSelector":{"ShowDesktopSelector":"S\xE9lectionner le poste de travail","EditDesktop":"Editer le poste de travail"},"BasePage":{"DesignButtonHint":"Modifier page","ExpandButtonTitle":"D\xE9velopper","CollapseButtonTitle":"R\xE9duire"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Param\xE8tres invalides","ServiceResult":{"ErrorMessage":"Une erreur s'est produite. Veuillez contacter l'administrateur du syst\xE8me"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"\xC9l\xE9ment(s) tagg\xE9(s) {{ count }}","RemoveTagsMessage":"\xC9l\xE9ment(s) non tagg\xE9(s) {{ count }}","AddTagsSuccessfulRunProcess":"Le processus de tag en masse a commenc\xE9 pour le(s) \xE9l\xE9ment(s) s\xE9lectionn\xE9(s). Cela peut prendre quelque temps","RemoveTagsSuccessfulRunProcess":"Le processus de suppression en masse des tags a commenc\xE9 pour le(s) \xE9l\xE9ment(s). Cela peut prendre quelque temps"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Ajout de {{ count }} enregistrements dans le(s) dossier(s)","RemoveRecordsMessage":"Suppression de {{ count }} enregistrements dans le(s) dossier(s)"}}}`),Fs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Seleccionar escritorio","EditDesktop":"Editar escritorio"},"BasePage":{"DesignButtonHint":"Editar p\xE1gina","ExpandButtonTitle":"Expandir","CollapseButtonTitle":"Colapsar"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Hs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"}}'),Bs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Ls=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Us=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"}}'),Gs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),$s=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}},"RunProcessHandler":{"ProcessHasStarted":"The action has successfully started","CannotRunProcess":{"NoRecordsSelected":"This action needs at least one record to run. Please select the records you want to apply it to and try again"}}}'),js=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u0440\u0430\u0431\u043E\u0447\u0438\u0439 \u0441\u0442\u043E\u043B","EditDesktop":"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0440\u0430\u0431\u043E\u0447\u0438\u0439 \u0441\u0442\u043E\u043B"},"BasePage":{"DesignButtonHint":"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443","ExpandButtonTitle":"\u0420\u0430\u0437\u0432\u0435\u0440\u043D\u0443\u0442\u044C","CollapseButtonTitle":"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"\u041D\u0435\u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B","ServiceResult":{"ErrorMessage":"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0441\u0432\u044F\u0436\u0438\u0442\u0435\u0441\u044C \u0441 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u044B\u043C \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"\u0412\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u043C {{ count }} \u0437\u0430\u043F\u0438\u0441\u044F\u043C \u0431\u044B\u043B\u0438 \u043F\u0440\u043E\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u044B \u0442\u0435\u0433\u0438","RemoveTagsMessage":"\u0412\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u043C {{ count }} \u0437\u0430\u043F\u0438\u0441\u044F\u043C \u0431\u044B\u043B\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u044B \u0442\u0435\u0433\u0438","AddTagsSuccessfulRunProcess":"\u041F\u0440\u043E\u0446\u0435\u0441\u0441 \u043C\u0430\u0441\u0441\u043E\u0432\u043E\u0433\u043E \u0442\u0435\u0433\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F \u0437\u0430\u043F\u0443\u0449\u0435\u043D \u0434\u043B\u044F \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445 \u0437\u0430\u043F\u0438\u0441\u0435\u0439. \u042D\u0442\u043E \u043C\u043E\u0436\u0435\u0442 \u0437\u0430\u043D\u044F\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0438\u043D\u0443\u0442","RemoveTagsSuccessfulRunProcess":"\u041F\u0440\u043E\u0446\u0435\u0441\u0441 \u043C\u0430\u0441\u0441\u043E\u0432\u043E\u0433\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0442\u0435\u0433\u043E\u0432 \u0437\u0430\u043F\u0443\u0449\u0435\u043D \u0434\u043B\u044F \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445 \u0437\u0430\u043F\u0438\u0441\u0435\u0439. \u042D\u0442\u043E \u043C\u043E\u0436\u0435\u0442 \u0437\u0430\u043D\u044F\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0438\u043D\u0443\u0442"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E {{ count }} \u0437\u0430\u043F\u0438\u0441\u0435\u0439 \u0432 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u0433\u0440\u0443\u043F\u043F\u044B","RemoveRecordsMessage":"\u0423\u0434\u0430\u043B\u0435\u043D\u043E {{ count }} \u0437\u0430\u043F\u0438\u0441\u0435\u0439 \u0438\u0437 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445 \u0433\u0440\u0443\u043F\u043F"}},"RunProcessHandler":{"ProcessHasStarted":"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0437\u0430\u043F\u0443\u0449\u0435\u043D\u043E","CannotRunProcess":{"NoRecordsSelected":"\u0414\u043B\u044F \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u044D\u0442\u043E\u0433\u043E \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u0445\u043E\u0442\u044F \u0431\u044B \u043E\u0434\u043D\u0443 \u0437\u0430\u043F\u0438\u0441\u044C. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0438 \u043F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u043F\u044B\u0442\u043A\u0443"}}}'),Zs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u0440\u043E\u0431\u043E\u0447\u0438\u0439 \u0441\u0442\u0456\u043B","EditDesktop":"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0440\u043E\u0431\u043E\u0447\u0438\u0439 \u0441\u0442\u0456\u043B"},"BasePage":{"DesignButtonHint":"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0441\u0442\u043E\u0440\u0456\u043D\u043A\u0443","ExpandButtonTitle":"\u0420\u043E\u0437\u0433\u043E\u0440\u043D\u0443\u0442\u0438","CollapseButtonTitle":"\u0417\u0433\u043E\u0440\u043D\u0443\u0442\u0438"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"\u041D\u0435\u043F\u0440\u0438\u043F\u0443\u0441\u0442\u0438\u043C\u0456 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u0438","ServiceResult":{"ErrorMessage":"\u0421\u0442\u0430\u043B\u0430\u0441\u044F \u043F\u043E\u043C\u0438\u043B\u043A\u0430. \u0411\u0443\u0434\u044C \u043B\u0430\u0441\u043A\u0430, \u0437\u0432\u0435\u0440\u043D\u0456\u0442\u044C\u0441\u044F \u0434\u043E \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0433\u043E \u0430\u0434\u043C\u0456\u043D\u0456\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0430"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"\u0412\u0438\u0431\u0440\u0430\u043D\u0438\u043C {{ count }} \u0437\u0430\u043F\u0438\u0441\u0430\u043C \u0431\u0443\u043B\u0438 \u043F\u0440\u043E\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u0456 \u0442\u0435\u0433\u0438","RemoveTagsMessage":"\u0412\u0438\u0431\u0440\u0430\u043D\u0438\u043C {{ count }} \u0437\u0430\u043F\u0438\u0441\u0430\u043C \u0431\u0443\u043B\u0438 \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u0456 \u0442\u0435\u0433\u0438","AddTagsSuccessfulRunProcess":"\u041F\u0440\u043E\u0446\u0435\u0441 \u043C\u0430\u0441\u043E\u0432\u043E\u0433\u043E \u0442\u0435\u0433\u0443\u0432\u0430\u043D\u043D\u044F \u0437\u0430\u043F\u0443\u0449\u0435\u043D\u043E \u0434\u043B\u044F \u0432\u0438\u0431\u0440\u0430\u043D\u0438\u0445 \u0437\u0430\u043F\u0438\u0441\u0456\u0432. \u0426\u0435 \u043C\u043E\u0436\u0435 \u0437\u0430\u0439\u043D\u044F\u0442\u0438 \u043A\u0456\u043B\u044C\u043A\u0430 \u0445\u0432\u0438\u043B\u0438\u043D","RemoveTagsSuccessfulRunProcess":"\u041F\u0440\u043E\u0446\u0435\u0441 \u043C\u0430\u0441\u043E\u0432\u043E\u0433\u043E \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u043D\u044F \u0442\u0435\u0433\u0456\u0432 \u0437\u0430\u043F\u0443\u0449\u0435\u043D\u043E \u0434\u043B\u044F \u0432\u0438\u0431\u0440\u0430\u043D\u0438\u0445 \u0437\u0430\u043F\u0438\u0441\u0456\u0432.. \u0426\u0435 \u043C\u043E\u0436\u0435 \u0437\u0430\u0439\u043D\u044F\u0442\u0438 \u043A\u0456\u043B\u044C\u043A\u0430 \u0445\u0432\u0438\u043B\u0438\u043D"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"\u0414\u043E\u0434\u0430\u043D\u043E {{ count }} \u0437\u0430\u043F\u0438\u0441\u0456\u0432 \u0443 \u0432\u0438\u0431\u0440\u0430\u043D\u0456 \u0433\u0440\u0443\u043F\u0438","RemoveRecordsMessage":"\u0412\u0438\u0434\u0430\u043B\u0435\u043D\u043E {{ count }} \u0437\u0430\u043F\u0438\u0441\u0456\u0432 \u0456\u0437 \u0432\u0438\u0431\u0440\u0430\u043D\u0438\u0445 \u0433\u0440\u0443\u043F"}},"RunProcessHandler":{"ProcessHasStarted":"\u0414\u0456\u044F \u0443\u0441\u043F\u0456\u0448\u043D\u043E \u0437\u0430\u043F\u0443\u0449\u0435\u043D\u0430","CannotRunProcess":{"NoRecordsSelected":"\u0414\u043B\u044F \u0432\u0438\u043A\u043E\u043D\u0430\u043D\u043D\u044F \u0446\u0456\u0454\u0457 \u0434\u0456\u0457 \u043F\u043E\u0442\u0440\u0456\u0431\u043D\u043E \u0432\u0438\u0431\u0440\u0430\u0442\u0438 \u043F\u0440\u0438\u043D\u0430\u0439\u043C\u043D\u0456 \u043E\u0434\u0438\u043D \u0437\u0430\u043F\u0438\u0441. \u0411\u0443\u0434\u044C \u043B\u0430\u0441\u043A\u0430, \u043F\u043E\u0437\u043D\u0430\u0447\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0442\u0430 \u0441\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437"}}}'),qs={"lv-LV":Ss,"hu-HU":fs,"zh-TW":Cs,"zh-CN":vs,"vi-VN":ys,"tr-TR":Rs,"th-TH":Es,"sv-SE":Ts,"sq-AL":Ds,"ro-RO":Ps,"pt-PT":As,"pt-BR":Is,"pl-PL":Ns,"nl-NL":Ms,"ko-KR":xs,"ja-JP":bs,"it-IT":ws,"id-ID":ks,"he-IL":Os,"fr-FR":Vs,"es-ES":Fs,"en-GB":Hs,"de-DE":Bs,"cs-CZ":Ls,"bg-BG":Us,"ar-SA":Gs,"en-US":$s,"uk-UA":Zs,"ru-RU":js};let K=class{};K.\u0275fac=function(e){return new(e||K)},K.\u0275mod=s.\u0275\u0275defineNgModule({type:K}),K.\u0275inj=s.\u0275\u0275defineInjector({providers:[g.ChangeComposerService,y.PACKAGE_INFO_INITIALIZER_PROVIDER,y.HANDLER_CHAIN_ADAPTER_APP_INITIALIZER_PROVIDER,y.HandlerChainAdapter,h.REQUIRE_JS_PATH_REGISTER_PROVIDER,S.REQUEST_HANDLER_REGISTER_SERVICE_APP_INITIALIZER_PROVIDER,S.MODEL_LIVE_EDITING_NOTIFICATION_APP_INITIALIZER_PROVIDER,{provide:g.DATA_GRID_STATE_HANDLER,useClass:Ee.ex},z.DATA_GRID_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,{provide:g.DataGridColumnSelectionService,useFactory:n=>new z.SchemaDataGridColumnSelectionService(n),deps:[z.StructureExplorerDataGridColumnSelectionService]},z.StructureExplorerDataGridColumnSelectionService,{provide:S.DataSourceFactoryService,useClass:E.Q1},h.FileReaderService,h.FileApiService,y.FEATURE_VALUES_APP_INITIALIZER_PROVIDER,y.FEATURE_VALUES_PROVIDER,{provide:g.DATA_GRID_COLUMN_EDIT_HANDLER,useClass:z.SchemaDataGridColumnEditHandler},h.DATA_SERVICE_URI_PROVIDER,h.USER_INFO_PROVIDER,{provide:Ce.DataServiceQueryExecutor,useExisting:Ce.QueryExecutor},{provide:Hr.RemoteEntryLoader,useFactory:Hr.getGlobalRemoteEntryLoader},{provide:U.JIT_MODULES,useValue:[g.CrtComponentsModule,Ee.vq,q,g.CrtActionDashboardModule,g.CrtCampaignViewerModule,b.CrtChartWidgetModule,b.CrtGaugeWidgetModule,b.CrtFunnelWidgetModule,b.CrtIndicatorWidgetModule,O.CdkModule,B]},{provide:h.APPEARANCE_SETTINGS_LOADER,useClass:y.AppearanceSettingsApiService},{provide:h.APPEARANCE_SETTINGS_DEFAULT_LOADER,useClass:E.jZ},{provide:E.F$,useValue:ne},E.FL,E.N1,{provide:S.CRT_METADATA_PREPROCESSOR,useClass:se,multi:!0},{provide:S.CRT_METADATA_PREPROCESSOR,useClass:pe,multi:!0}],imports:[Vr.BrowserAnimationsModule,b.CrtChartWidgetModule,b.CrtGaugeWidgetModule,N.CommonModule,g.CrtComponentsModule,x.DialogModule,De.FormsModule,b.CrtFunnelWidgetModule,b.CrtIndicatorWidgetModule,S.ModelModule,De.ReactiveFormsModule,F.SchemaModule,q,Ee.vq,U.ViewModule,Ge.HttpClientXsrfModule.withOptions({cookieName:"BPMCSRF",headerName:"BPMCSRF"}),w.TranslateModule.forRoot({defaultLanguage:"en-US",loader:{provide:w.TranslateLoader,useFactory:(n,e)=>new va.TranslateHttpLoader(n,e+"ClientApp/assets/i18n/"),deps:[Ge.HttpClient,N.APP_BASE_HREF]}}),I.CrtLibTranslateModule.forRoot({i18n:(0,R.merge)({},qs,_s)}),Fr.StructureExplorerModule,B,h.SaveScrollPositionModule,O.CheckOperationPermissionPipeModule]}),K=(0,l.__decorate)([(0,i.CrtModule)({includes:[g.CrtComponentsModule,b.CrtChartWidgetModule,b.CrtFunnelWidgetModule,b.CrtIndicatorWidgetModule,b.CrtGaugeWidgetModule,S.ModelModule,Ee.vq,B],converters:[st,rt,We,be,Je,at,Xe,we,Ye,et,tt,qe,Ke,ze],requestHandlers:[pr,Cr,Bt,ot,yt,dt,ut,mt,pt,ht,gt,_t,St,ft,Ct,Oe,Et,At,Pt,It,Ve,Nt,Mt,ke,xt,Dt,bt,wt,kt,hr,br,Ot,Vt,Ft,Ht,Ut,Rt,Gt,$t,jt,Zt,qt,Kt,gr,zt,Wt,Jt,_r,Qt,Xt,Yt,er,Mr,vr,Lt,rr,ar,vt,sr,or,nr,ir,cr,lr,dr,ur,mr,xr,Sr,fr,Ue,yr,Rr,wr,kr,Er,tr,Tr,Dr,Pr,Ar,Ir,Nr],handlerChainServices:[h.ApplicationInfoService,Ce.DataServiceQueryExecutor,y.FeatureService,y.HttpClientService,x.MaskService,S.ModelGenerator,y.RightsService,y.SysSettingsService,h.CrtZoneService]})],K),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(K,{declarations:[te,J,Q,X,re,ge,ne,$,G],imports:[Vr.BrowserAnimationsModule,b.CrtChartWidgetModule,b.CrtGaugeWidgetModule,N.CommonModule,g.CrtComponentsModule,x.DialogModule,De.FormsModule,b.CrtFunnelWidgetModule,b.CrtIndicatorWidgetModule,S.ModelModule,De.ReactiveFormsModule,F.SchemaModule,q,Ee.vq,U.ViewModule,Ge.HttpClientXsrfModule,w.TranslateModule,I.CrtLibTranslateModule,Fr.StructureExplorerModule,B,h.SaveScrollPositionModule,O.CheckOperationPermissionPipeModule],exports:[k]})}();class Se extends A.aK{constructor(e){super(),this._schemaModalService=e,this._dialogList=new Map}_showSegments(e=[]){var t=this;return(0,d.Z)(function*(){for(const r of e){const a=t._getSegmentKey(r);if(!t._dialogList.has(a)){const o=yield t._schemaModalService.show({...r,preventDefaultCloseCommand:!0});t._dialogList.set(a,o)}yield t._showSegments(r.children)}})()}_getNeedToCloseSegmentKeys(e){const t=Array.from(this._dialogList.keys()),r=this._getFlatSegments(e);return t.filter(o=>!r.some(c=>o===this._getSegmentKey(c)))}_getSegmentKey(e){return`${e.contextName}_${e.schemaName}_${e.action}_${e.recordId}`}_getFlatSegments(e){let t=[];return e.forEach(r=>{if(t.push(r),r.children){const a=this._getFlatSegments(r.children);t=t.concat(a)}}),t}applySegments(e){var t=this;return(0,d.Z)(function*(){t._getNeedToCloseSegmentKeys(e).forEach(a=>{t._dialogList.get(a).close(),t._dialogList.delete(a)}),yield t._showSegments(e)})()}getTarget(){return T.CHILD_NAVIGATION_TARGETS.Modal}}Se.\u0275fac=function(e){return new(e||Se)(s.\u0275\u0275inject(ye.L))},Se.\u0275prov=s.\u0275\u0275defineInjectable({token:Se,factory:Se.\u0275fac})},60954:Te=>{Te.exports=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24">
  <defs>
    <path id="a" fill="#fff" d="M0,0H1.7V5.1H0V0"/>
    <path id="b" fill="#fff" d="M0,0H10.774V2.552H0V0"/>
  </defs>
  <rect width="24" height="24" fill="none" rx="4"/>
  <path fill="#fff" d="M0,0H4.031V2.552H0V0" transform="rotate(180 3.701 3.488)"/>
  <use xlink:href="#a" transform="rotate(180 4.23 4.125)"/>
  <use xlink:href="#a" transform="rotate(180 8.095 7.276)"/>
  <use xlink:href="#a" transform="rotate(180 4.095 10.421)"/>
  <path fill="#fff" d="M0,0H11.969V2.552H0V0" transform="rotate(180 7.67 6.634)"/>
  <path fill="#fff" d="M0,0H3.18V2.552H0V0" transform="rotate(180 3.276 9.823)"/>
  <use xlink:href="#b" transform="rotate(180 10.364 3.488)"/>
  <path fill="#fff" d="M0,0H3.122V2.552H0V0" transform="rotate(180 10.364 6.634)"/>
  <use xlink:href="#b" transform="rotate(180 10.364 9.823)"/>
</svg>
`},94171:Te=>{Te.exports=`<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18.333 5.83325H2.83301C2.28072 5.83325 1.83301 6.28097 1.83301 6.83325V13.1666C1.83301 13.7189 2.28072 14.1666 2.83301 14.1666H18.333C18.8853 14.1666 19.333 13.7189 19.333 13.1666V6.83325C19.333 6.28097 18.8853 5.83325 18.333 5.83325Z" stroke="white" stroke-width="2"/>
<path d="M10.5889 15.0925V17.9167" stroke="white" stroke-width="2" stroke-linecap="round"/>
<path d="M7.25586 17.9165H13.9225" stroke="white" stroke-width="2" stroke-linecap="round"/>
<path d="M6.00586 6.25V13.75" stroke="white"/>
<path d="M6.00586 9.58325H18.5059" stroke="white"/>
</svg>
`}}]);
