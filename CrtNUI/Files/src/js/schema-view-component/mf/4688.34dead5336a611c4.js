(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[4688,8239,5036,6118,7344,8160,1034,8056,1906,4501,1216,9256,9795,1006,7571,6025,9424,885,7709,6662,9669,2375],{14688:(re,k,g)=>{g.r(k),g.d(k,{APPLY_PARENT_ON_CLIENT_UNIT_SCHEMA:()=>se,AVAILABLE_CLIENT_UNIT_PARENT_SCHEMAS:()=>oe,CLIENT_UNIT_SCHEMA:()=>ne,ClientUnitSchema:()=>H,ClientUnitSchemaBuilderService:()=>N,ClientUnitSchemaConverterService:()=>A,ClientUnitSchemaDependencyBuilder:()=>I,ClientUnitSchemaDesignerApiModule:()=>R,ClientUnitSchemaDesignerApiService:()=>M,ClientUnitSchemaDesignerService:()=>O,CurrentPageSchemaPackageService:()=>P,DesignSchemaInitializerService:()=>D,EntitySchemaDesignerService:()=>F,GlobalSearchEnabledEntitiesLoaderService:()=>G,LookupRegistrationService:()=>w,Message:()=>q,MessageDirection:()=>J,MessageMode:()=>Q,NEW_CLIENT_UNIT_SCHEMA:()=>ie,PAGE_SCHEMA_MOCK:()=>xe,PagesListLoaderService:()=>T,TEMPLATE_UIDS:()=>ae});var j=g(31134),c=g(94450),b=g(41307),v=g(38626),E=g(57325),u=g(98956),B=g(12947),f=g(49475),y=g(52045),x=g(24709),l=g(21322),o=g(27049);class M extends u.BaseDesignerApiService{constructor(e,t,a){super(e),this._imageUploaderService=t,this._measurePerformanceService=a,this.getParentSchemasMethodName="GetParentSchemas",this.getSchemaInfoMethodName="GetSchemaInfo",this.getSchemaInfoByNameMethodName="GetSchemaInfoByName"}get converter(){return super.converter}_appendImageToSchema(e,t){const a=t.length-1,r=t.map((n,i)=>this._imageUploaderService.appendImageToSchema(e,n,i===a).pipe((0,o.tap)(s=>{s.success&&(n.isChanged=!1)})));return(0,l.concat)(...r).pipe((0,o.toArray)(),(0,o.switchMap)(n=>{const i=n.filter(m=>!m.success);if(i.length===0)return(0,l.of)({success:!0});const s=i.map(m=>m.errorInfo.message);return(0,l.of)({success:!1,errorInfo:{message:s.join(";")}})}))}_getParentSchemaFromService(e,t){return(0,f.postJson)(this.httpClient,e,t).pipe((0,o.map)(a=>(a.values?.length&&(a.values=a.values.map(r=>this.convertToObject(r))),a)),(0,o.share)())}getSchemaManagerName(){return"ClientUnitSchemaManager"}convertSchemaToDTO(e){const t=e.addons?[...e.addons]:[];delete e.addons;const a=e.clone();return e.addons=t,a}saveSchema(e){const t=e.uId,a=e.images.filter(n=>n.isChanged&&n.data?.size>0),r=this.converter.convertToDto(e);return super.saveSchema(r).pipe((0,o.switchMap)(n=>!n.success||a.length===0?(0,l.of)(n):this._appendImageToSchema(t,a)),(0,o.tap)(n=>{n.success&&a.forEach(i=>i.isChanged=!1)}),(0,o.share)())}getAvailableParents(e,t,a){const r=this.serviceEndpoint+"GetAvailableParentSchemas",n={packageUId:e,allowExtended:t,schemaType:a,useFullHierarchy:!1};return(0,f.postJson)(this.httpClient,r,n).pipe((0,o.map)(i=>(i.success&&(i.items=i.items.map(s=>{const m=new u.ParentItem;return m.name=s.name,m.title=s.title,m.uId=s.uId,m})),i)),(0,o.share)())}applyParent(e){const t=this.serviceEndpoint+"ApplyParent",a={newParentUid:e.newParentUid,clientUnitSchema:this.converter.convertToDto(this.convertSchemaToDTO(e.schema))};return this.getSchemaFromService(t,a,!0)}getParentSchemas(e){const t=`${this.serviceEndpoint}${this.getParentSchemasMethodName}`;return this._getParentSchemaFromService(t,e)}getSchemaInfo(e){const t=`${this.serviceEndpoint}${this.getSchemaInfoMethodName}`;return(0,f.postJson)(this.httpClient,t,e).pipe(this._measurePerformanceService.measure$("getSchemaInfo in ClientUnitSchemaDesignerApiService"))}getSchemaInfoByName(e){const t=`${this.serviceEndpoint}${this.getSchemaInfoByNameMethodName}`;return(0,f.postJson)(this.httpClient,t,{schemaName:e}).pipe(this._measurePerformanceService.measure$("getSchemaInfoByName in ClientUnitSchemaDesignerApiService"))}}M.\u0275fac=function(e){return new(e||M)(c.\u0275\u0275inject(c.Injector),c.\u0275\u0275inject(u.SchemaImageUploaderService),c.\u0275\u0275inject(f.MeasurePerformanceService))},M.\u0275prov=c.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac});var p=g(75378);const W=(0,p.generateGuid)(),ne={uId:W,name:"TestClientUnit",body:'define("TestClientUnit", [], function() {return {};})',less:`:host {
	display: flex;
	flex-direction: column;
	width: 100%;
	min-height: 100vh;
}
`,schemaType:2,isReadOnly:!1,caption:[{cultureName:"en-US",value:"test client unit"}],description:[{cultureName:"en-US",value:"test description"}],package:{isChanged:!1,isLocked:!1,name:"Calendar",uId:(0,p.generateGuid)()},localizableStrings:[{name:"String1",uId:(0,p.generateGuid)(),values:[{cultureName:"en-US",value:"String 1"},{cultureName:"ru-RU",value:"\u0421\u0442\u0440\u043E\u043A\u0430 1"}]}],messages:[{name:"Message1",uId:(0,p.generateGuid)(),mode:0,direction:0},{name:"Message2",uId:(0,p.generateGuid)(),mode:1,direction:1}],images:[{name:"FilledImage",uId:(0,p.generateGuid)(),image:"(Image)",isChanged:!1},{name:"NoImage",uId:(0,p.generateGuid)(),image:"(No)",isChanged:!1},{name:"Image3",uId:(0,p.generateGuid)()}],parameters:[{uId:"9871d4b0-61b5-450e-87ae-2d43a8429e84",caption:[{cultureName:"en-US",value:"User task schema parameter mock"}],name:"TextParameter",parentSchemaUId:W,type:p.DataValueType.Text,resulting:!0},{uId:"94720F39-7710-4FA1-A07C-11DE875989F4",parentSchemaUId:W,name:"LookupParameter",type:p.DataValueType.Lookup},{uId:"F565CD2D-404A-4F9B-A8D9-28A34C3A18B5",parentSchemaUId:(0,p.generateGuid)(),name:"LczParameter",type:p.DataValueType.LOCALIZABLE_STRING},{uId:"FDD3483D-AEDC-4D22-A9B3-76A1BECB753A",name:"NotLczParameter",type:p.DataValueType.METADATA_TEXT},{uId:"72EBC6D3-E0DB-4D19-8D6D-521D8CB9781F",name:"EntityParameter",type:p.DataValueType.ENTITY,lazyLoad:!0},{uId:"6F8D1D65-AF3E-4973-87F3-4DD606428DC2",name:"ObjectParameter",type:p.DataValueType.CUSTOM_OBJECT,lazyLoad:!0},{uId:"74318F72-3AE9-B160-5D62-2BAC9A7409D5",name:"CompositeObjectList",type:p.DataValueType.COMPOSITE_OBJECT_LIST}]},ie={uId:W,name:"TestNewClientUnit",body:'define("TestClientUnit", [], function() {return {};})',less:`:host {
	display: flex;
	flex-direction: column;
	width: 100%;
	min-height: 100vh;
}
`,schemaType:2,isReadOnly:!1,caption:[{cultureName:"en-US",value:"test new client unit"}],description:[],package:{isChanged:!1,isLocked:!1,name:"Calendar",uId:(0,p.generateGuid)()},localizableStrings:[],messages:[],images:[],parameters:[]},oe=[{name:"TestParent1",title:"Test Parent 1",parentSchemaUId:p.EMPTY_GUID,uId:"c748bf4e-e4e1-454e-8f5b-4f65f91d8396"},{name:"TestParent2",title:"Test Parent 2",parentSchemaUId:p.EMPTY_GUID,uId:(0,p.generateGuid)()},{name:"TestParent3",title:"Test Parent 3",parentSchemaUId:p.EMPTY_GUID,uId:(0,p.generateGuid)()}],se={uId:(0,p.generateGuid)(),name:"",body:"",less:"",schemaType:3,isReadOnly:!1,parent:{body:null,caption:[{cultureName:"en-US",value:"Test Parent 1"}],description:null,extendParent:!1,id:"4b958aca-8f02-4aa0-ab3c-03eaf0741563",images:null,isReadOnly:!1,less:null,localizableStrings:null,messages:null,name:"TestParent1",package:null,parent:null,parentSchemaUId:"00000000-0000-0000-0000-000000000000",uId:"b6b678aa-adac-48fb-92e2-f83a5c63aff0",schemaType:2},caption:[],description:[],package:{isChanged:!1,isLocked:!1,name:"NUI",uId:(0,p.generateGuid)()},localizableStrings:[],messages:[],images:[],parameters:[{uId:"9871d4b0-61b5-450e-87ae-2d43a8429e84",caption:[{cultureName:"en-US",value:"User task schema parameter mock"}],name:"TextParameter",type:p.DataValueType.Text,resulting:!0},{uId:"94720F39-7710-4FA1-A07C-11DE875989F4",name:"LookupParameter",type:p.DataValueType.Lookup},{uId:"F565CD2D-404A-4F9B-A8D9-28A34C3A18B5",name:"LczParameter",type:p.DataValueType.LOCALIZABLE_STRING},{uId:"FDD3483D-AEDC-4D22-A9B3-76A1BECB753A",name:"NotLczParameter",type:p.DataValueType.METADATA_TEXT},{uId:"72EBC6D3-E0DB-4D19-8D6D-521D8CB9781F",name:"EntityParameter",type:p.DataValueType.ENTITY,lazyLoad:!0},{uId:"6F8D1D65-AF3E-4973-87F3-4DD606428DC2",name:"ObjectParameter",type:p.DataValueType.CUSTOM_OBJECT,lazyLoad:!0},{uId:"74318F72-3AE9-B160-5D62-2BAC9A7409D5",name:"CompositeObjectList",type:p.DataValueType.COMPOSITE_OBJECT_LIST}]},ce=[{operation:"insert",name:"MainHeader",values:{type:"crt.HeaderContainer",items:[]}},{operation:"insert",name:"ActionContainer",parentName:"MainHeader",propertyName:"items",index:0,values:{type:"crt.GridContainer",direction:"column",rows:"minmax(max-content, 32px)",columns:["minmax(64px, 1fr)"],color:"primary",borderRadius:"medium",padding:{top:"none",right:"large",bottom:"large",left:"large"},gap:{columnGap:"small",rowGap:"small"},styles:{"border-top":"none","border-top-left-radius":0,"border-top-right-radius":0},items:[]}},{operation:"insert",name:"ActionButtonsContainer",parentName:"ActionContainer",propertyName:"items",index:0,values:{type:"crt.FlexContainer",layoutConfig:{column:1,row:1,colSpan:1,rowSpan:1},direction:"row",items:[]}},{operation:"insert",name:"MainContainer",values:{type:"crt.FlexContainer",direction:"column",wrap:"nowrap",gap:6,items:[]}},{operation:"merge",name:"ActionContainer",values:{styles:{"border-top":"none","border-bottom":"none","border-radius":0},padding:{top:"none",right:"large",bottom:"none",left:"large"}}},{operation:"insert",name:"AddButton",parentName:"ActionButtonsContainer",propertyName:"items",values:{type:"crt.Button",clicked:{request:"crt.CreateRecordRequest",params:{itemsAttributeName:"Items"}},color:"accent",caption:"Add"}},{operation:"insert",name:"SectionContentWrapper",parentName:"MainContainer",propertyName:"items",index:1,values:{type:"crt.FlexContainer",direction:"column",layoutConfig:{basis:"100%"},color:"primary",items:[]}},{operation:"insert",name:"SectionContentContainer",parentName:"SectionContentWrapper",propertyName:"items",index:0,values:{type:"crt.FlexContainer",direction:"column",layoutConfig:{basis:"100%"},items:[]}},{operation:"insert",name:"DataTable",values:{type:"crt.DataGrid",columns:"$Columns",items:"$Items",layoutConfig:{basis:"100%"}},parentName:"SectionContentContainer",propertyName:"items",index:1}],me=[{operation:"insert",name:"MainContainer",values:{type:"crt.FlexContainer",direction:"column",wrap:"nowrap",gap:6,items:[]},index:0},{operation:"insert",name:"crt.GridContainerb2ed698a-b941-81f6-f40a-8c934714cea9",values:{type:"crt.GridContainer",columns:["minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:24,rowGap:0},styles:{"background-color":"white",border:"1px solid rgb(230, 230, 230)","border-radius":"8px",padding:"20px"},items:[]},parentName:"MainContainer",propertyName:"items",index:0},{operation:"insert",name:"crt.FlexContainer7d44aaff-ad5e-cc34-49df-7a0e4e93a527",values:{type:"crt.FlexContainer",direction:"column",justifyContent:"start",alignItems:"stretch",gap:8,items:[]},parentName:"MainContainer",propertyName:"items",index:1},{operation:"insert",name:"crt.ChartWidgetbd43d098-d47e-1b5b-26df-5488da22f1fc",values:{type:"crt.ChartWidget",config:{series:[{type:"scatter"}]}},parentName:"crt.FlexContainer7d44aaff-ad5e-cc34-49df-7a0e4e93a527",propertyName:"items",index:0},{operation:"insert",name:"crt.Checkbox0c32a4dc-8353-46d9-f2ae-8545ff0aa533",values:{type:"crt.Checkbox",value:!0,disabled:!1,inversed:!1,label:"Label",ariaLabel:"Label",labelPosition:"auto"},parentName:"crt.FlexContainer7d44aaff-ad5e-cc34-49df-7a0e4e93a527",propertyName:"items",index:1},{operation:"insert",name:"crt.GridContainer89b0d4b0-6364-f2a0-8b3d-d3092d5e6157",values:{type:"crt.GridContainer",columns:["minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:24,rowGap:0},styles:{"background-color":"white",border:"1px solid rgb(230, 230, 230)","border-radius":"8px",padding:"20px"},items:[]},parentName:"MainContainer",propertyName:"items",index:2},{operation:"insert",name:"crt.ChartWidgetfe73d146-fe71-7272-8708-f2e18eae32ec",values:{layoutConfig:{column:1,row:1,colSpan:1,rowSpan:1},type:"crt.ChartWidget",config:{series:[{type:"doughnut"}]}},parentName:"crt.GridContainer89b0d4b0-6364-f2a0-8b3d-d3092d5e6157",propertyName:"items",index:0},{operation:"insert",name:"crt.FlexContainer951f06b3-0620-2a84-41db-fef24d9ccd94",values:{type:"crt.FlexContainer",direction:"row",justifyContent:"start",alignItems:"stretch",gap:8,items:[]},parentName:"MainContainer",propertyName:"items",index:3},{operation:"insert",name:"crt.Buttonbf64ac96-521e-23be-3600-87b220aae25c",values:{type:"crt.Button",caption:"primary",color:"primary",disabled:!1},parentName:"crt.FlexContainer951f06b3-0620-2a84-41db-fef24d9ccd94",propertyName:"items",index:0},{operation:"insert",name:"crt.DataGrid401ad421-f8cc-ad0b-2018-cb30a8c6cdd3",values:{type:"crt.DataGrid"},parentName:"crt.FlexContainer951f06b3-0620-2a84-41db-fef24d9ccd94",propertyName:"items",index:1},{operation:"insert",name:"crt.Checkbox43e1be8a-f414-1058-cbf3-90022dfe4619",values:{type:"crt.Checkbox",value:!0,disabled:!1,inversed:!1,label:"Label",ariaLabel:"Label",labelPosition:"auto"},parentName:"crt.FlexContainer951f06b3-0620-2a84-41db-fef24d9ccd94",propertyName:"items",index:2},{operation:"insert",name:"crt.Buttone7053546-60a5-bec7-23dc-572532868cff",values:{type:"crt.Button",caption:"primary",color:"primary",disabled:!1},parentName:"crt.FlexContainer951f06b3-0620-2a84-41db-fef24d9ccd94",propertyName:"items",index:3},{operation:"insert",name:"crt.Checkbox52b937bd-ffb8-7b92-13e9-1f728a0c1e21",values:{type:"crt.Checkbox",value:!0,disabled:!1,inversed:!1,label:"Label",ariaLabel:"Label",labelPosition:"auto",layoutConfig:{}},parentName:"crt.FlexContainer951f06b3-0620-2a84-41db-fef24d9ccd94",propertyName:"items",index:4},{operation:"insert",name:"crt.FlexContainer31a96814-47ac-d43a-9a64-ac675532901e",values:{type:"crt.FlexContainer",direction:"column",justifyContent:"start",alignItems:"stretch",gap:8,items:[]},parentName:"crt.FlexContainer951f06b3-0620-2a84-41db-fef24d9ccd94",propertyName:"items",index:5},{operation:"insert",name:"crt.GridContainer5574835a-2bf0-c864-57f3-cde190de1399",values:{type:"crt.GridContainer",columns:["minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:24,rowGap:0},styles:{"background-color":"white",border:"1px solid rgb(230, 230, 230)","border-radius":"8px",padding:"20px"},items:[]},parentName:"MainContainer",propertyName:"items",index:4},{operation:"insert",name:"crt.Button6b63e1a3-2e4d-8ce3-3ce9-fcd5161916cb",values:{type:"crt.Button",caption:"primary",color:"primary",disabled:!1,layoutConfig:{column:1,row:1,colSpan:1,rowSpan:1}},parentName:"crt.GridContainer5574835a-2bf0-c864-57f3-cde190de1399",propertyName:"items",index:0},{operation:"insert",name:"crt.ChartWidgetfe06de0f-d334-107c-af6a-0e131db844d6",values:{layoutConfig:{column:1,row:2,colSpan:1,rowSpan:1},type:"crt.ChartWidget",config:{series:[{type:"scatter"}]}},parentName:"crt.GridContainer5574835a-2bf0-c864-57f3-cde190de1399",propertyName:"items",index:1}],pe=[{operation:"insert",name:"Main",values:{type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)"],gap:"small",items:[]},index:0},{operation:"insert",name:"FlexContainerb76ae3d5-2615-9d38-4f41-6c98460708e9",values:{layoutConfig:{row:1,rowSpan:2,column:1,colSpan:12},type:"crt.FlexContainer",direction:"row",items:[]},parentName:"Main",propertyName:"items",index:0},{operation:"insert",name:"ChartWidget3c84da70-449e-153f-791c-be77067c499a",values:{type:"crt.ChartWidget",config:{series:[{type:"spline"}]}},parentName:"crt.FlexContainerb76ae3d5-2615-9d38-4f41-6c98460708e9",propertyName:"items",index:0},{operation:"insert",name:"GridContainerab8f30cb-b151-d7d6-aedf-1fa2bf2fbbc9",values:{type:"crt.GridContainer",columns:["minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:"large"},styles:{"background-color":"white",border:"1px solid rgb(230, 230, 230)","border-radius":"8px",padding:"20px"},items:[]},parentName:"crt.FlexContainerb76ae3d5-2615-9d38-4f41-6c98460708e9",propertyName:"items",index:1}],le=[{operation:"insert",name:"Main",values:{type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)"],gap:8,items:[]},index:0}],de=[{operation:"insert",name:"Main",values:{type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)"],classes:["grid_parent"],gap:8,items:[]},index:0},{operation:"insert",name:"Flex1",values:{type:"crt.FlexContainer",layoutConfig:{row:1,rowSpan:3,column:2,colSpan:10},direction:"row",justifyContent:"start",alignItems:"stretch",gap:8,items:[]},parentName:"Main",propertyName:"items",index:0},{operation:"insert",name:"Grid2",values:{type:"crt.GridContainer",columns:["minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:24,rowGap:0},classes:["grid_child"],styles:{"background-color":"white",border:"1px solid rgb(230, 230, 230)","border-radius":"8px",padding:"20px"},items:[]},parentName:"Flex1",propertyName:"items",index:0},{operation:"insert",name:"crt.ChartWidget9ae6a60e-35be-f702-ec7c-935e816183dc",values:{type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""},layoutConfig:{column:1,row:1,colSpan:1,rowSpan:1}},parentName:"Grid2",propertyName:"items",index:0},{operation:"insert",name:"crt.ChartWidgetb644d52d-3a75-bc99-a9a0-8c892c8c3ef4",values:{type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""},layoutConfig:{column:1,row:2,colSpan:1,rowSpan:1}},parentName:"Grid2",propertyName:"items",index:1},{operation:"insert",name:"crt.ChartWidgetc8a09a0e-9764-07b5-1947-ccc1dbacac67",values:{type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""},layoutConfig:{}},parentName:"Flex1",propertyName:"items",index:1},{operation:"insert",name:"crt.ChartWidget68f1080e-0e4e-d33f-0276-149a063870e6",values:{type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""},layoutConfig:{}},parentName:"Flex1",propertyName:"items",index:2},{operation:"insert",name:"crt.FlexContainerd83bcd92-49e1-b64b-4747-cd82b921cf17",values:{layoutConfig:{column:2,row:4,colSpan:10,rowSpan:3},type:"crt.FlexContainer",direction:"row",justifyContent:"start",alignItems:"stretch",gap:8,items:[]},parentName:"Main",propertyName:"items",index:1},{operation:"insert",name:"crt.ChartWidget2d8af227-493c-6d8a-ced8-bb02daccf6bb",values:{type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""},layoutConfig:{}},parentName:"crt.FlexContainerd83bcd92-49e1-b64b-4747-cd82b921cf17",propertyName:"items",index:0},{operation:"insert",name:"Grid1",values:{type:"crt.GridContainer",columns:["minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:24,rowGap:0},styles:{"background-color":"white",border:"1px solid rgb(230, 230, 230)","border-radius":"8px",padding:"20px"},items:[],layoutConfig:{}},parentName:"crt.FlexContainerd83bcd92-49e1-b64b-4747-cd82b921cf17",propertyName:"items",index:1},{operation:"insert",name:"Widget1",values:{layoutConfig:{column:1,row:1,colSpan:1,rowSpan:1},type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""}},parentName:"Grid1",propertyName:"items",index:0},{operation:"insert",name:"Widget2",values:{layoutConfig:{column:1,row:2,colSpan:1,rowSpan:1},type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""}},parentName:"Grid1",propertyName:"items",index:1},{operation:"insert",name:"crt.FlexContainer91880229-26f3-7c27-0858-af6301e1ad22",values:{layoutConfig:{column:2,row:7,colSpan:10,rowSpan:2},type:"crt.FlexContainer",direction:"row",justifyContent:"start",alignItems:"stretch",gap:8,items:[]},parentName:"Main",propertyName:"items",index:2},{operation:"insert",name:"crt.GridContainer0e42ac75-76b7-c35a-adbd-e0db8afb07ca",values:{type:"crt.GridContainer",columns:["minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:24,rowGap:0},styles:{"background-color":"white",border:"1px solid rgb(230, 230, 230)","border-radius":"8px",padding:"20px"},items:[]},parentName:"crt.FlexContainer91880229-26f3-7c27-0858-af6301e1ad22",propertyName:"items",index:0},{operation:"insert",name:"crt.GridContainer392095b6-be5f-ed2c-0683-2cb8f2a5be6c",values:{type:"crt.GridContainer",columns:["minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:24,rowGap:0},styles:{"background-color":"white",border:"1px solid rgb(230, 230, 230)","border-radius":"8px",padding:"20px"},items:[]},parentName:"crt.FlexContainer91880229-26f3-7c27-0858-af6301e1ad22",propertyName:"items",index:1},{operation:"insert",name:"crt.GridContainera19dccf4-a302-0742-1f4d-eaee228c02a8",values:{type:"crt.GridContainer",columns:["minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:24,rowGap:0},styles:{"background-color":"white",border:"1px solid rgb(230, 230, 230)","border-radius":"8px",padding:"20px"},items:[]},parentName:"crt.FlexContainer91880229-26f3-7c27-0858-af6301e1ad22",propertyName:"items",index:2},{operation:"insert",name:"crt.ChartWidgetf6c65dee-64b3-266f-03fd-6b8c46c5312a",values:{layoutConfig:{},type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""}},parentName:"crt.FlexContainer91880229-26f3-7c27-0858-af6301e1ad22",propertyName:"items",index:3},{operation:"insert",name:"crt.FlexContainer68ceb734-6c40-2eda-557d-2f56b1d5e746",values:{layoutConfig:{column:2,row:9,colSpan:10,rowSpan:2},type:"crt.FlexContainer",direction:"row",justifyContent:"start",alignItems:"stretch",gap:8,items:[]},parentName:"Main",propertyName:"items",index:3},{operation:"insert",name:"crt.ChartWidget6c92a4f4-5e62-77d8-b257-eda82cb260de",values:{type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""}},parentName:"crt.FlexContainer68ceb734-6c40-2eda-557d-2f56b1d5e746",propertyName:"items",index:0},{operation:"insert",name:"crt.ChartWidgetef7be419-23b0-848b-c88f-45721bd978fb",values:{type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""}},parentName:"crt.FlexContainer68ceb734-6c40-2eda-557d-2f56b1d5e746",propertyName:"items",index:1},{operation:"insert",name:"crt.ChartWidget8751c697-23d9-eabb-3371-f7fb57a1c807",values:{type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""}},parentName:"crt.FlexContainer68ceb734-6c40-2eda-557d-2f56b1d5e746",propertyName:"items",index:2},{operation:"insert",name:"crt.ChartWidget24c91a48-219a-224b-960a-78b4499f301b",values:{type:"crt.ChartWidget",config:{color:"green",series:[{type:"spline"}],theme:"full-fill",title:""}},parentName:"crt.FlexContainer68ceb734-6c40-2eda-557d-2f56b1d5e746",propertyName:"items",index:3}],ue=[{operation:"insert",name:"Main",values:{name:"Main",type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)"],gap:8,items:[]}},{operation:"insert",name:"Flex1",parentName:"Main",propertyName:"items",index:0,values:{type:"crt.FlexContainer",layoutConfig:{row:1,rowSpan:3,column:2,colSpan:11},direction:"row",justifyContent:"start",alignItems:"stretch",borderRadius:"50px",gap:8,items:[]}},{operation:"insert",name:"Flex1-Widget1",parentName:"Flex1",propertyName:"items",index:0,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex1-Widget2",parentName:"Flex1",propertyName:"items",index:1,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex1-Widget3",parentName:"Flex1",propertyName:"items",index:2,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex1-Flex1",parentName:"Flex1",propertyName:"items",index:0,values:{type:"crt.FlexContainer",direction:"column",justifyContent:"start",alignItems:"stretch",gap:8,items:[]}},{operation:"insert",name:"Flex1-Flex1-Widget1",parentName:"Flex1-Flex1",propertyName:"items",index:0,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex1-Flex1-Widget2",parentName:"Flex1-Flex1",propertyName:"items",index:1,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex2",parentName:"Main",propertyName:"items",index:0,values:{type:"crt.FlexContainer",layoutConfig:{row:4,rowSpan:5,column:2,colSpan:10},direction:"column",justifyContent:"start",alignItems:"stretch",gap:"50px",items:[]}},{operation:"insert",name:"Flex2-Widget1",parentName:"Flex2",propertyName:"items",index:0,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex2-Widget2",parentName:"Flex2",propertyName:"items",index:1,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex2-Widget3",parentName:"Flex2",propertyName:"items",index:2,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex2-Flex1",parentName:"Flex2",propertyName:"items",index:0,values:{type:"crt.FlexContainer",direction:"row",justifyContent:"start",alignItems:"stretch",gap:"none",items:[]}},{operation:"insert",name:"Flex2-Flex1-Widget1",parentName:"Flex2-Flex1",propertyName:"items",index:0,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex2-Flex1-Widget2",parentName:"Flex2-Flex1",propertyName:"items",index:1,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex2-Flex1-Flex1",parentName:"Flex2-Flex1",propertyName:"items",index:0,values:{type:"crt.FlexContainer",direction:"column",justifyContent:"start",alignItems:"stretch",gap:8,items:[]}},{operation:"insert",name:"Flex2-Flex1-Flex1-Widget1",parentName:"Flex2-Flex1-Flex1",propertyName:"items",index:0,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex2-Flex1-Flex1-Widget2",parentName:"Flex2-Flex1-Flex1",propertyName:"items",index:1,values:{type:"crt.IndicatorWidget"}}],fe=[{operation:"insert",name:"Main",values:{name:"Main",type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)"],gap:8,items:[]}},{operation:"insert",name:"Flex1",parentName:"Main",propertyName:"items",index:0,values:{type:"crt.FlexContainer",layoutConfig:{row:1,rowSpan:3,column:2,colSpan:11},direction:"row",justifyContent:"start",alignItems:"stretch",gap:8,items:[]}},{operation:"insert",name:"Flex1-Widget1",parentName:"Flex1",propertyName:"items",index:0,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Flex1-Widget2",parentName:"Flex1",propertyName:"items",index:1,values:{type:"crt.IndicatorWidget"}},{operation:"insert",name:"Grid1",parentName:"Flex1",propertyName:"items",index:2,values:{type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)"],styles:{"background-color":"white",border:"1px solid rgb(230, 230, 230)","border-radius":"8px",padding:"20px"},gap:8,items:[]}},{operation:"insert",name:"Main-Widget1",parentName:"Main",propertyName:"items",index:1,values:{type:"crt.IndicatorWidget",layoutConfig:{row:4,rowSpan:3,column:3,colSpan:1}}}],he=[{operation:"insert",name:"Main",values:{type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)"],gap:8,items:[]},index:0},{operation:"insert",name:"Grid1-gap-small-small",values:{type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)"],layoutConfig:{row:1,rowSpan:2,column:1,colSpan:5},borderRadius:"small",color:"rgba(93,122,224,0.56)",gap:"small",padding:20,items:[]},parentName:"Main",propertyName:"items",index:0},{operation:"insert",name:"Grid2-gap-none",values:{type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)"],layoutConfig:{row:3,rowSpan:2,column:1,colSpan:5},borderRadius:"small",color:"rgba(226,82,234,0.28)",padding:"20px",items:[]},parentName:"Main",propertyName:"items",index:1},{operation:"insert",name:"Grid3-gap-custom-custom",values:{type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)"],layoutConfig:{row:5,rowSpan:2,column:1,colSpan:5},borderRadius:"small",gap:{columnGap:"5",rowGap:10},color:"rgba(230,241,113,0.7)",padding:"largE",items:[]},parentName:"Main",propertyName:"items",index:2},{operation:"insert",name:"Grid4-gap-custom",values:{type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)"],layoutConfig:{row:7,rowSpan:2,column:1,colSpan:5},borderRadius:"small",gap:15,color:"rgba(92,204,100,0.99)",padding:{top:"large"},items:[]},parentName:"Main",propertyName:"items",index:3},{operation:"insert",name:"Grid5-gap-large-custom",values:{type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)"],layoutConfig:{row:9,rowSpan:2,column:1,colSpan:5},borderRadius:"small",gap:{columnGap:"large",rowGap:10},color:"rgba(220,156,101,0.86)",padding:{left:30},items:[]},parentName:"Main",propertyName:"items",index:5},{operation:"insert",name:"Grid6-gap-custom-em",values:{type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)"],layoutConfig:{row:11,rowSpan:2,column:1,colSpan:5},borderRadius:"small",gap:{columnGap:"1em",rowGap:"2em"},color:"rgba(255,112,185,0.63)",padding:{bottom:"25px"},items:[]},parentName:"Main",propertyName:"items",index:5}],ge=[{operation:"insert",name:"Main",values:{name:"Main",type:"crt.GridContainer",rows:"64px",columns:["minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)","minmax(35px, 1fr)"],gap:8,items:[]}},{operation:"insert",name:"Grid1",parentName:"Main",propertyName:"items",index:0,values:{type:"crt.GridContainer",rows:"minmax(max-content, 32px)",columns:["minmax(64px, 1fr)","minmax(64px, 1fr)","minmax(64px, 1fr)","minmax(64px, 1fr)"],layoutConfig:{row:1,rowSpan:7,column:4,colSpan:7},gap:8,items:[]}},{operation:"insert",name:"Widget1",parentName:"Main",propertyName:"items",index:1,values:{type:"crt.IndicatorWidget",layoutConfig:{row:1,rowSpan:2,column:1,colSpan:2}}}],Se=[{operation:"insert",name:"MainHeader",values:{type:"crt.HeaderContainer",items:[]}},{operation:"insert",name:"ActionContainer",parentName:"MainHeader",propertyName:"items",index:0,values:{type:"crt.GridContainer",direction:"column",rows:"minmax(max-content, 32px)",columns:["minmax(64px, 1fr)"],color:"primary",borderRadius:"medium",padding:{top:"none",right:"large",bottom:"large",left:"large"},gap:{columnGap:"small",rowGap:"small"},styles:{"border-top":"none","border-top-left-radius":0,"border-top-right-radius":0},items:[]}},{operation:"insert",name:"ActionButtonsContainer",parentName:"ActionContainer",propertyName:"items",index:0,values:{type:"crt.FlexContainer",layoutConfig:{column:1,row:1,colSpan:1,rowSpan:1},direction:"row",items:[]}},{operation:"insert",name:"MainContainer",values:{type:"crt.FlexContainer",direction:"column",wrap:"nowrap",gap:6,items:[]}},{operation:"insert",name:"SaveButton",parentName:"ActionButtonsContainer",propertyName:"items",index:0,values:{type:"crt.Button",clicked:{request:"crt.SaveRecordRequest"},color:"accent",caption:"Save",icon:"save-button-icon",iconPosition:"leftIcon",visible:"$IsChanged"}},{operation:"insert",name:"CancelButton",parentName:"ActionButtonsContainer",propertyName:"items",index:1,values:{type:"crt.Button",clicked:{request:"crt.CancelRecordChangesRequest"},caption:"Cancel",icon:"close-button-icon",iconPosition:"only-icon",visible:"$IsChanged"}},{operation:"insert",name:"CloseButton",parentName:"ActionButtonsContainer",propertyName:"items",index:2,values:{type:"crt.Button",clicked:{request:"crt.ClosePageRequest"},color:"primary",caption:"Close",icon:"delete-button-icon",iconPosition:"left-icon",visible:"$IsChanged | crt.InvertBooleanValue"}},{operation:"insert",name:"CardContentWrapper",parentName:"MainContainer",propertyName:"items",index:1,values:{type:"crt.GridContainer",columns:["298px","minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:"small",rowGap:"small"},items:[]}},{operation:"insert",name:"LeftModulesContainer",parentName:"CardContentWrapper",propertyName:"items",index:0,values:{type:"crt.FlexContainer",direction:"column",layoutConfig:{column:1,row:1,colSpan:1,rowSpan:1},items:[]}},{operation:"insert",name:"LeftAreaProfileContainer",parentName:"LeftModulesContainer",propertyName:"items",index:0,values:{type:"crt.GridContainer",rows:"minmax(max-content, 32px)",columns:"minmax(64px, 1fr)",gap:{columnGap:"large"},padding:{top:"large",right:"large",bottom:"large",left:"large"},color:"primary",borderRadius:"medium",items:[]}},{operation:"insert",name:"LeftAreaContainer",parentName:"LeftModulesContainer",propertyName:"items",index:1,values:{type:"crt.GridContainer",rows:"minmax(max-content, 32px)",columns:"minmax(64px, 1fr)",gap:{columnGap:"large"},padding:{top:"large",right:"large",bottom:"large",left:"large"},color:"primary",borderRadius:"medium",items:[]}},{operation:"insert",name:"CardContentContainer",parentName:"CardContentWrapper",propertyName:"items",index:1,values:{type:"crt.FlexContainer",direction:"column",layoutConfig:{column:2,row:1,colSpan:1,rowSpan:1},items:[]}},{operation:"insert",name:"ControlGroupContainer",parentName:"CardContentContainer",propertyName:"items",index:0,values:{type:"crt.GridContainer",columns:["minmax(64px, 1fr)","minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:"large"},padding:{top:"large",right:"large",bottom:"large",left:"large"},color:"primary",borderRadius:"medium",layoutConfig:{basis:"100%"},items:[]}},{operation:"insert",name:"AddButton",parentName:"ActionButtonsContainer",propertyName:"items",index:3,values:{type:"crt.Button",color:"accent",caption:"Add",icon:"add-button-icon",iconPosition:"leftIcon",menuItems:[]}},{operation:"insert",name:"TestMenuItem0",parentName:"AddButton",propertyName:"menuItems",values:{type:"crt.MenuItem",caption:"Test menu item 0",items:[]}},{operation:"insert",name:"TestMenuItem1",parentName:"TestMenuItem0",propertyName:"items",values:{type:"crt.MenuItem",caption:"Test menu item 1",icon:"save-button-icon"}},{operation:"insert",name:"TestMenuItem2",parentName:"TestMenuItem0",propertyName:"items",values:{type:"crt.MenuItem",caption:"Test menu item 2",items:[]}},{operation:"insert",name:"TestMenuItem3",parentName:"TestMenuItem2",propertyName:"items",values:{type:"crt.MenuItem",caption:"Test menu item 3",icon:"save-button-icon"}}],ye=[{operation:"insert",name:"MainHeader",values:{type:"crt.HeaderContainer",items:[]}},{operation:"insert",name:"ActionContainer",parentName:"MainHeader",propertyName:"items",index:0,values:{type:"crt.GridContainer",direction:"column",rows:"minmax(max-content, 32px)",columns:["minmax(64px, 1fr)"],color:"primary",borderRadius:"medium",padding:{top:"none",right:"large",bottom:"large",left:"large"},gap:{columnGap:"small",rowGap:"small"},styles:{"border-top":"none","border-top-left-radius":0,"border-top-right-radius":0},items:[]}},{operation:"insert",name:"ActionButtonsContainer",parentName:"ActionContainer",propertyName:"items",index:0,values:{type:"crt.FlexContainer",layoutConfig:{column:1,row:1,colSpan:1,rowSpan:1},direction:"row",items:[]}},{operation:"insert",name:"MainContainer",values:{type:"crt.FlexContainer",direction:"column",wrap:"nowrap",gap:6,items:[]}},{operation:"insert",name:"SaveButton",parentName:"ActionButtonsContainer",propertyName:"items",index:0,values:{type:"crt.Button",clicked:{request:"crt.SaveRecordRequest"},color:"accent",caption:"Save",visible:"$IsChanged"}},{operation:"insert",name:"CancelButton",parentName:"ActionButtonsContainer",propertyName:"items",index:1,values:{type:"crt.Button",clicked:{request:"crt.CancelRecordChangesRequest"},caption:"Cancel",visible:"$IsChanged"}},{operation:"insert",name:"CloseButton",parentName:"ActionButtonsContainer",propertyName:"items",index:2,values:{type:"crt.Button",clicked:{request:"crt.ClosePageRequest"},color:"primary",caption:"Close",visible:"$IsChanged | crt.InvertBooleanValue"}},{operation:"insert",name:"CardContentWrapper",parentName:"MainContainer",propertyName:"items",index:1,values:{type:"crt.GridContainer",columns:["298px","minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:"small",rowGap:"small"},items:[]}},{operation:"insert",name:"LeftModulesContainer",parentName:"CardContentWrapper",propertyName:"items",index:0,values:{type:"crt.FlexContainer",direction:"column",layoutConfig:{column:1,row:1,colSpan:1,rowSpan:1},items:[]}},{operation:"insert",name:"ProfileContainer",parentName:"LeftModulesContainer",propertyName:"items",index:0,values:{type:"crt.GridContainer",rows:"minmax(max-content, 32px)",columns:"minmax(64px, 1fr)",gap:{columnGap:"large"},padding:{top:"large",right:"large",bottom:"large",left:"large"},color:"primary",borderRadius:"medium",items:[]}},{operation:"insert",name:"AccountProfileContainer",parentName:"LeftModulesContainer",propertyName:"items",index:1,values:{type:"crt.GridContainer",rows:"minmax(max-content, 32px)",columns:"minmax(64px, 1fr)",gap:{columnGap:"large"},padding:{top:"large",right:"large",bottom:"large",left:"large"},color:"primary",borderRadius:"medium",items:[]}},{operation:"insert",name:"CardContentContainer",parentName:"CardContentWrapper",propertyName:"items",index:1,values:{type:"crt.FlexContainer",direction:"column",layoutConfig:{column:2,row:1,colSpan:1,rowSpan:1},padding:{top:"large",right:"large",bottom:"large",left:"large"},color:"primary",borderRadius:"medium",items:[]}},{operation:"insert",name:"ControlGroup1Container",parentName:"CardContentContainer",propertyName:"items",index:0,values:{type:"crt.GridContainer",columns:["minmax(64px, 1fr)","minmax(64px, 1fr)"],rows:"minmax(max-content, 32px)",gap:{columnGap:"large"},items:[]}}],Ce=d=>{switch(d.toLowerCase().replaceAll("-","")){case"grid0Widget1Grid1".toLowerCase():return ge;case"grid0Flex1WidgetFlex2Widget".toLowerCase():return ue;case"grid0Flex1Widget1Grid1".toLowerCase():return fe;case"flexWidgetArea".toLowerCase():return pe;case"flexGridWidgets".toLowerCase():return me;case"gridFlex1Flex2Flex3".toLowerCase():return de;case"grid0Grid1Grid2Grid3".toLowerCase():return he;case"gridEmpty".toLowerCase():return le;case"pageWithTabsTemplate".toLowerCase():return ye;case"baseSectionTemplate".toLowerCase():return ce;default:return Se}},xe={get:function(d){return{id:d,uId:d,name:"HomePage",caption:"HomePage",parameters:[],body:this.getBody(d),package:{uId:"a00051f4-cde3-4f3f-b08e-c5ad1a5c735a"}}},getBody:function(d){return window.localStorage.getItem(d)||`/**SCHEMA_DIFF*/${JSON.stringify(Ce(d))}/**SCHEMA_DIFF*/`},setBody:function(d,e){window.resetSchema?(window.localStorage.removeItem(d),window.resetSchema=!1):window.localStorage.setItem(d,e)}};var L=g(69615);class N extends y.BaseSchemaBuilderService{constructor(e){super(),this.jsonApplierService=e}_mergeResources(e){const t={strings:{}};return e.forEach(a=>{a.forEach(r=>{t.strings[r.name]=t.strings[r.name]||{},r.values?.forEach(n=>{t.strings[r.name][n.cultureName]=n.value})})}),t}_mergeParameters(e){const t={};return e.forEach(a=>{a.parameters.forEach(r=>{t[r.name]={uId:r.uId,name:r.name,caption:r.caption,dataValueType:r.type,required:r.required,isOwnParameter:r.parentSchemaUId===a.schemaUId,referenceSchemaUId:r.lookup,referenceSchemaName:r.schema}})}),t}build(e){const t=[...e].reverse(),a=t.map(C=>L.parse(C.getSchemaBodyProperty("SCHEMA_DIFF")||C.getSchemaBodyProperty("SCHEMA_VIEW_CONFIG_DIFF"))),r=this.jsonApplierService.applyDiff([],a),n=t.map(C=>({viewModelConfig:L.parse(C.getSchemaBodyProperty("SCHEMA_VIEW_MODEL_CONFIG"))||{},viewModelConfigDiff:L.parse(C.getSchemaBodyProperty("SCHEMA_VIEW_MODEL_CONFIG_DIFF"))||[],modelConfig:L.parse(C.getSchemaBodyProperty("SCHEMA_MODEL_CONFIG"))||{},modelConfigDiff:L.parse(C.getSchemaBodyProperty("SCHEMA_MODEL_CONFIG_DIFF"))||[]})),i=this.getViewModelConfig(n),s=this.getModelConfig(n),m=this._mergeParameters(t.map(C=>({schemaUId:C.uId,parameters:C.parameters}))),h=t.length-1,S=t[h],_=S?.getSchemaBodyProperty("SCHEMA_HANDLERS")||S?.getSchemaBodyProperty("SCHEMA_HANDLERS_CONFIG")||"[]",V=S?.getSchemaBodyProperty("SCHEMA_CONVERTERS")||"{}",Z=S?.getSchemaBodyProperty("SCHEMA_DEPS")||"[]",K=S?.getSchemaBodyProperty("SCHEMA_ARGS")||"()",X=this._mergeResources(t.map(C=>C.localizableStrings)),ee=S?.getSchemaBodyProperty("SCHEMA_VALIDATORS")||"{}";return(0,l.of)({name:S?.name,viewConfig:r,viewModelConfig:i,modelConfig:s,resources:X,handlers:_,deps:Z,args:K,converters:V,validators:ee,parameters:m,tag:e.map(C=>C.name).join(".")})}}N.\u0275fac=function(e){return new(e||N)(c.\u0275\u0275inject(y.JsonApplierService))},N.\u0275prov=c.\u0275\u0275defineInjectable({token:N,factory:N.\u0275fac});var U=g(97600);class H extends u.BaseSchemaParameter{constructor(e){super(e),this._markerCommentsTemplate="(\\/\\*\\*PROPERTY_NAME\\*\\/)([\\s\\S]*)(\\/\\*\\*PROPERTY_NAME\\*\\/)",this.messages=new u.MetaItemArray,this.images=new u.MetaItemArray,this.onMetaItemsChanged=new c.EventEmitter,this.useFullHierarchy=!1,e&&(this.group=e.group,this.schemaType=e.schemaType,this.parent=(0,U.cloneDeep)(e.parent),this.less=e.less,this.extendParent=e.extendParent,e.messages&&(this.messages=e.messages.clone()),e.images&&(this.images=e.images.clone()),e.addons&&e.addons.length>0&&(this.addons=e.addons),e.addonTypes&&e.addonTypes.length>0&&(this.addonTypes=[...e.addonTypes]),this.useFullHierarchy=e.useFullHierarchy)}get isModule(){return this.schemaType===f.ClientUnitSchemaType.Module}get DefaultName(){return"ClientUnitSchema"}_setNameFromParent(){this.extendParent&&(this.name=this.parent.name)}_addUpdateImages(e){this.images.filter(a=>a.isChanged).forEach(a=>{e.images.find(n=>n.uId===a.uId).updateFile(a.data)})}_fixBodyTabs(e){return e.split(`
`).map((t,a)=>(a>0?"		":"")+t,this).join(`
`)}_getMarkerCommentsRegExp(e){return new RegExp(this._markerCommentsTemplate.replace(/PROPERTY_NAME/g,e))}updateBodySchemaName(e,t){e?.length&&(this.body=this.body?.replace(e,t))}findChildrenItem(e){return this.messages.findItem(e)||this.images.findItem(e)||super.findChildrenItem(e)}findGroup(e){return[this.messages,this.images].find(a=>a.uId===e)||super.findGroup(e)}updateDescription(e){super.updateDescription(e),this._setNameFromParent()}updateMetaItems(e){this._addUpdateImages(e),this.name=e.name,this.parent=e.parent,this.group=e.group,this.caption=new f.LocalizableStringArray(e.caption),this.description=new f.LocalizableStringArray(e.description),this.localizableStrings=new u.MetaItemArray(e.localizableStrings),this.messages=new u.MetaItemArray(e.messages),this.images=new u.MetaItemArray(e.images),this.parameters=new u.MetaItemArray(e.parameters),this.onMetaItemsChanged.emit()}getSchemaBodyProperty(e){const t=this._getMarkerCommentsRegExp(e),a=this.body.match(t);return a&&a[2]}setSchemaBodyProperty(e,t){let a=JSON.stringify(t||{},null,"	");a=this._fixBodyTabs(a),this.setSchemaBody(e,a)}setSchemaBody(e,t){const a=this._getMarkerCommentsRegExp(e);this.body=this.body.replace(a,"$1"+t+"$3")}clone(){return new H(this)}}class q extends u.MetaItem{constructor(e){super(e),e&&(this.direction=e.direction,this.mode=e.mode)}clone(){return new q(this)}}var J;(function(d){d[d.Subscribe=0]="Subscribe",d[d.Publish=1]="Publish"})(J||(J={}));var Q;(function(d){d[d.Broadcast=0]="Broadcast",d[d.PointToPoint=1]="PointToPoint"})(Q||(Q={}));class A extends u.BaseSchemaConverterService{constructor(){super(H)}_convertMessages(e){return e.messages?new u.MetaItemArray(e.messages.map(t=>new q(t))):new u.MetaItemArray}_convertImages(e){return e.images?new u.MetaItemArray(e.images.map(t=>new u.ImageListSchemaItem(t))):new u.MetaItemArray}convertToSchema(e){const t=super.createSchema(e);return t.caption=new f.LocalizableStringArray(e.caption),t.description=new f.LocalizableStringArray(e.description),t.localizableStrings=super.createLocalizableStrings(e.localizableStrings),t.messages=this._convertMessages(e),t.images=this._convertImages(e),e.parent&&(t.parent={name:e.parent.name,id:e.parent.id,uId:e.parent.uId,caption:new f.LocalizableStringArray(e.parent.caption)}),t.parameters=new u.MetaItemArray,e.parameters.forEach(a=>{const r=new u.SchemaParameter(a);t.parameters.push(r)}),t}convertToDto(e){const t=e.clone();if(e.parent){const a=e.parent;t.parent={uId:a.uId,name:a.name}}else t.parent=null;return delete t.onMetaItemsChanged,t}}A.\u0275fac=function(e){return new(e||A)},A.\u0275prov=c.\u0275\u0275defineInjectable({token:A,factory:A.\u0275fac});var z=g(8239),_e=g(57186),Ie=g(77207),$=g(33177),ve=g(13696),be=g(29989),Ee=g(93265);class I{constructor(e){this._featureValues=e}_getMappedDataSourceEntityColumnPaths(e,t){let a;const r=e.map(n=>{const i=I._attributeParseRegex.exec(n);if(!i)return null;const s=t[i.groups.dataSourceName];if(!s||s.type!=="crt.EntityDataSource")return null;let m=i.groups.columnName;if(s.config?.attributes){const h=s.config.attributes[m];if(h&&(m=h.path),h?.aggregationConfig?.filter){const S=h.aggregationConfig.filter;a=this._getEntityColumnPathsFromFilterConfigs(Object.values(S.items),S.rootSchemaName)}}return[s.config.entitySchemaName,m]}).filter(n=>Boolean(n));return a?r.concat(a):r}_assembleRequiredEntityColumns(e){const t=[];for(const[a,r]of e){let n=t.find(i=>i.entitySchemaName===a);n?.columnPaths.includes(r)||(n||(n={entitySchemaName:a,columnPaths:[]},t.push(n)),n.columnPaths.push(r))}return t}_getMapConfigAttributes(e){return Object.values(e).filter(t=>t&&(0,x.isModelAttributeConfig)(t)&&t.modelConfig?.path).map(t=>{const a=t.modelConfig.path;return a.split(".").length!==1?a:this._getMapConfigAttributes(t.viewModelConfig.attributes)}).flat().filter(t=>Boolean(t))}_getDataSourceEntityColumnPaths(e){let t=[];const a=e?.modelConfig?.dataSources,r=e?.viewModelConfig?.attributes||{};if(a){const n=this._getMapConfigAttributes(r);t=this._getMappedDataSourceEntityColumnPaths(n,a)}return t}_getFiltersEntityColumnPaths(e){const t=e?.viewModelConfig?.attributes||{};return Object.values(t).filter(r=>r&&(0,x.isModelAttributeConfig)(r)&&r.value?.rootSchemaName&&r.value?.filterType).flatMap(r=>{const n=r.value.rootSchemaName,i=r.value.items;return this._getEntityColumnPathsFromFilterConfigs(Object.values(i),n)})}_getEntityColumnPathsFromFilterConfigs(e,t){const a=e.map(r=>p.FilterParser.fromJson(r));return this._getFilterColumnPaths(a,t)}_getFilterColumnPaths(e,t){const a=[];for(const r of e){const n=r,i=n.subFilters;if(i?.filters&&n.leftExpression instanceof p.ColumnExpression)a.push([t,n.leftExpression.columnPath]),a.push(...this._getFilterColumnPaths(i.filters.values(),i.rootSchemaName));else{const s=r;s.leftExpression instanceof p.ColumnExpression&&a.push([t,s.leftExpression.columnPath])}}return a}_getRequiredSchemaUIdsByViewConfigDiff(e,t){const a=new Array;if(!(0,U.isEmpty)(e)&&!this._featureValues.DisableInterfaceDesignerUseFullHierarchy)for(const r of e){const n=L.parse(r.getSchemaBodyProperty("SCHEMA_DIFF")||r.getSchemaBodyProperty("SCHEMA_VIEW_CONFIG_DIFF"));for(const i of t){const s=n.some(_=>_.name===i.parentName&&_.operation==="insert"),m=i.operation!=="insert"&&i.operation!=="remove",h=n.some(_=>m&&_.name===i.name&&_.operation==="insert");(s||h)&&!a.includes(r.uId)&&a.push(r.uId)}}return a}_getRequiredSchemaUIdsByParentSchemas(e,t){return!this._featureValues.EnableInterfaceDesignerUsePackageHierarchy&&!(0,U.isEmpty)(t)&&e.extendParent?[t[0].uId]:[]}build(e,t,{parentSchemas:a,schemaViewConfigDiff:r}){const n=this._getDataSourceEntityColumnPaths(e),i=this._getFiltersEntityColumnPaths(e),s=[...this._getRequiredSchemaUIdsByViewConfigDiff(a,r),...this._getRequiredSchemaUIdsByParentSchemas(t,a)];return{requiredSchemas:[...new Set(s)],requiredEntityColumns:this._assembleRequiredEntityColumns(n.concat(i))}}}I._attributeParseRegex=/^(?<dataSourceName>[^.]+)\.(?<columnName>.+)$/,I.\u0275fac=function(e){return new(e||I)(c.\u0275\u0275inject(f.FEATURE_VALUES))},I.\u0275prov=c.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac});class D{constructor(e,t,a,r,n,i){this._modelGenerator=e,this._macrosHandlerService=t,this._viewModelGenerator=a,this._metadataPreprocessorService=r,this._injector=n,this._measurePerformanceService=i}_generateModel(e){return e.modelConfig?this._modelGenerator.generate(e.modelConfig):(0,l.of)([])}_preprocessOnMetadataInit(e){return(0,l.from)(this._metadataPreprocessorService.onMetaDataInit(e))}_preprocessOnModelInit(e){var t=this;return this._generateModel(e).pipe(this._measurePerformanceService.measure$("_generateModel in DesignSchemaInitializerService")).pipe((0,l.switchMap)(function(){var a=(0,z.Z)(function*(r){return[yield t._metadataPreprocessorService.onModelInit(e,r),r]});return function(r){return a.apply(this,arguments)}}()))}_preprocessOnViewModelInit(e,t,a){var r=this;return this._macrosHandlerService.handleResourceMacros(t.viewModelConfig,t.resources).pipe((0,l.switchMap)(n=>this._viewModelGenerator.generate({...t,models:a,viewModelConfig:n,businessRulesActive:!1},c.Injector.create({providers:[{provide:x.SCOPE_NAME,useValue:e}],parent:this._injector}))),(0,l.switchMap)(function(){var n=(0,z.Z)(function*(i){return[yield r._metadataPreprocessorService.onViewModelInit(t,a,i),a,i]});return function(i){return n.apply(this,arguments)}}())).pipe(this._measurePerformanceService.measure$("_preprocessOnViewModelInit"))}init(e,t){return this._preprocessOnMetadataInit(t).pipe((0,l.switchMap)(a=>this._preprocessOnModelInit(a)),(0,l.switchMap)(([a,r])=>this._preprocessOnViewModelInit(e,a,r)),(0,o.map)(([a,r,n])=>[a,n]))}}D.\u0275fac=function(e){return new(e||D)(c.\u0275\u0275inject(x.ModelGenerator),c.\u0275\u0275inject(f.MacrosHandlerService),c.\u0275\u0275inject(x.ViewModelGenerator),c.\u0275\u0275inject(x.MetadataPreprocessorService),c.\u0275\u0275inject(c.Injector),c.\u0275\u0275inject(f.MeasurePerformanceService))},D.\u0275prov=c.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac});class O{constructor(e,t,a,r,n,i,s,m,h,S,_,V,Z,K,X,ee,C,De,we){this.apiService=e,this.builderService=t,this.jsonDifferService=a,this.converter=r,this.translateService=n,this.translateUtilsService=i,this.messageService=s,this.userInfo=m,this.activateRoute=h,this.clientUnitSchemaDependencyBuilder=S,this._workplaceService=_,this._addonInfoFactory=V,this._addonMetadataNormalizerFactory=Z,this._jsonObjectDifferService=K,this._metadataPostprocessorService=X,this._schemaInitializerService=ee,this._featureValues=C,this.jsonPathDifferService=De,this.jsonPathApplierService=we,this.bodyTemplateSchemaViewModelConfigDiff=`
		viewModelConfigDiff: /**SCHEMA_VIEW_MODEL_CONFIG_DIFF*/[]/**SCHEMA_VIEW_MODEL_CONFIG_DIFF*/,`,this.bodyTemplateSchemaViewModelConfig=`
		viewModelConfig: /**SCHEMA_VIEW_MODEL_CONFIG*/{}/**SCHEMA_VIEW_MODEL_CONFIG*/,`,this.bodyTemplateSchemaModelConfigDiff=`
		modelConfigDiff: /**SCHEMA_MODEL_CONFIG_DIFF*/[]/**SCHEMA_MODEL_CONFIG_DIFF*/,`,this.bodyTemplateSchemaModelConfig=`
		modelConfig: /**SCHEMA_MODEL_CONFIG*/{}/**SCHEMA_MODEL_CONFIG*/,`,this.bodyTemplate=`define("{SCHEMA_NAME}", /**SCHEMA_DEPS*/[]/**SCHEMA_DEPS*/, function/**SCHEMA_ARGS*/()/**SCHEMA_ARGS*/ {
	return {
		viewConfigDiff: /**SCHEMA_VIEW_CONFIG_DIFF*/[]/**SCHEMA_VIEW_CONFIG_DIFF*/,${this.bodyTemplateSchemaViewModelConfigDiff}${this.bodyTemplateSchemaViewModelConfig}${this.bodyTemplateSchemaModelConfigDiff}${this.bodyTemplateSchemaModelConfig}
		handlers: /**SCHEMA_HANDLERS*/[]/**SCHEMA_HANDLERS*/,
		converters: /**SCHEMA_CONVERTERS*/{}/**SCHEMA_CONVERTERS*/,
		validators: /**SCHEMA_VALIDATORS*/{}/**SCHEMA_VALIDATORS*/
	};
});`,this._logger=new $.LoggerService,this._measurePerformanceService=(0,c.inject)(f.MeasurePerformanceService)}get parentSchemaUId(){return this.activateRoute.snapshot.queryParams.parentSchemaUId}_deepObjectDiff(e,t){return this._featureValues?.DisableClientSchemaDesignerJsonObjectDiffer?(0,ve.diff)(e,t):this._jsonObjectDifferService.deepObjectDiff(e,t)}_setSchemaViewConfigDiff(e,t,a){e.setSchemaBodyProperty("SCHEMA_VIEW_CONFIG_DIFF",a)}_setBundleDeps(e,t){e.deps=this._getClientUnitSchemaDeps(e.deps,t)}_getSchemaViewConfigDiff(e,t){return this.jsonDifferService.getJsonDiff(e,t,{identifyItemByPath:!0})}_getSchemaViewModelConfigDiff(e,t){return this.jsonPathDifferService.getJsonDiff(e,t,{identifyItemByPath:!0})}_getClientUnitSchemaDeps(e,t){const a=e?.replace(/\[|\]/g,"")||"";let r=[];return t.forEach(n=>{const i=n.values?.type;if(!i)return;const s=p.InterfaceDesignerItemRegistry.interfaceDesignerItemRegistrationInfos.get(i);if(s&&s.clientSchemaDeps){const m=s.clientSchemaDeps.filter(h=>!a.includes(h)).map(h=>`"${h}"`);r=r.concat(m)}}),a.length>0&&(r=[a].concat(r)),`[${r.join(", ")}]`}_setSchemaViewModelConfig(e,t,a){const r=this._deepObjectDiff(a,t);e.body=e.body.replace(this.bodyTemplateSchemaViewModelConfigDiff,""),e.setSchemaBodyProperty("SCHEMA_VIEW_MODEL_CONFIG",r)}_setSchemaViewModelConfigDiff(e,t,a){let r;const n=this._getSchemaViewModelConfigDiff(a.viewModelConfig,t.viewModelConfig);if(this._featureValues?.EnableViewModelConfigDiffSelfTest){const i=this.jsonPathApplierService.apply(a.viewModelConfig,n);(0,U.isEqual)(t.viewModelConfig,i)||(console.error("SCHEMA_VIEW_MODEL_CONFIG_DIFF","Generated schema metadata is not consistent"),r=this._deepObjectDiff(a.viewModelConfig,t.viewModelConfig),e.setSchemaBodyProperty("SCHEMA_VIEW_MODEL_CONFIG",r))}r||(e.body=e.body.replace(this.bodyTemplateSchemaViewModelConfig,"")),e.setSchemaBodyProperty("SCHEMA_VIEW_MODEL_CONFIG_DIFF",n)}_setSchemaModelConfigDiff(e,t,a){let r;const n=this.jsonPathDifferService.getJsonDiff(a.modelConfig,t.modelConfig,{identifyItemByPath:!0});if(this._featureValues?.EnableModelConfigDiffSelfTest){const i=this.jsonPathApplierService.apply(a.modelConfig,n);(0,U.isEqual)(t.modelConfig,i)||(console.error("SCHEMA_MODEL_CONFIG_DIFF","Generated schema metadata is not consistent"),r=this._deepObjectDiff(a.modelConfig,t.modelConfig),e.setSchemaBodyProperty("SCHEMA_MODEL_CONFIG",r))}r||(e.body=e.body.replace(this.bodyTemplateSchemaModelConfig,"")),e.setSchemaBodyProperty("SCHEMA_MODEL_CONFIG_DIFF",n)}_setSchemaModelConfig(e,t,a){const r=this._deepObjectDiff(a,t);e.body=e.body.replace(this.bodyTemplateSchemaModelConfigDiff,""),e.setSchemaBodyProperty("SCHEMA_MODEL_CONFIG",r)}_setLocalizableStrings(e,t,a){const r=this._deepObjectDiff(a?.strings,t?.strings);Object.entries(r).forEach(([n,i])=>{let s=e.localizableStrings.find(m=>m.name===n);s||(s=new u.SchemaLocalizableStringModel({name:n,parentSchemaUId:e.uId}),e.localizableStrings.addItem(s)),Object.entries(i).forEach(([m,h])=>{s.values.setValueLocalizableString(m,h)})})}_setCopySchemaCaption(e){const t=e.caption,a=t.map(({cultureName:r})=>r);return this.translateUtilsService.getAllCultureValues(a,"HomePageDesigner.Operation.Copy").pipe((0,o.tap)(r=>{const n=new f.LocalizableStringArray,i=this.translateService.defaultLang,s=r.find(m=>m.cultureName===i)?.value||"Copy";r.forEach(m=>{const h=m.cultureName,S=t.getValue(h),_=m.value||s;n.setValueLocalizableString(h,`${S} - ${_}`)}),e.caption=n}),(0,o.map)(()=>e))}_setCopySchemaBaseProperties(e,t,a,r,n){t.id=(0,p.generateGuid)(),t.uId=a,t.name=$.NameGenerator.generateUnique(e.name,n),t.package=new u.Package(null,r),e.package.uId===r&&(t.package.name=e.package.name)}_setCopySchemaParent(e,t,a){const r=a.find(n=>n.extendParent===!1&&n.name!==e.name);t.extendParent=!1,t.parent={uId:r?.uId,name:r?.name}}_setDependencies(e,t,a,r){e.dependencies=this.clientUnitSchemaDependencyBuilder.build(t,e,{parentSchemas:a,schemaViewConfigDiff:r})}_sendMessage(e){return this.messageService.sendMessage({event:this.designerSavedMessage,schemaUId:e.uId,name:e.name},f.MessageChannelType.BROADCAST)}_getSchemaDefaultCaption(e,t){let a=this._translate(this.designerCaption);e&&!t&&(a=this._translate(this.designerCaptionTemplate,e)),t&&!e&&(a=this._translate(this.designerCaptionWithEntityTemplate,t));const r=new f.LocalizableStringArray;return r.setValueLocalizableString(this.userInfo.cultureInfo.sysCultureName,a),r}_translate(e,...t){const a=Object.fromEntries(t.map((r,n)=>[n,r]));return this.translateService.instant(e,a)}_createSchemaAddons(e){e.addons=this._addonInfoFactory.create(e,"ClientUnitSchemaManager")}_logWarnIsNotOwnParameter(e){this._logger.warn(`Could not modify schema parameter "${e}" due to it belongs to another schema`)}_getIsOwnSchemaParameter(e,t){return e.parentSchemaUId===t?!0:(this._logWarnIsNotOwnParameter(e.name),!1)}_getIsOwnParameter(e){return e.isOwnParameter?!0:(this._logWarnIsNotOwnParameter(e.name),!1)}_saveParameters(e,t){const a=e.parameters??{};Object.values(a).forEach(r=>{if(!this._getIsOwnParameter(r))return;let n=t.parameters.findItem(r.uId);n||(n=new u.SchemaParameter,n.uId=r.uId??(0,p.generateGuid)(),n.parentSchemaUId=t.uId,t.parameters.addItem(n)),this._assignSchemaParameter(n,r)}),this._removeParameters(a,t.parameters,t.uId)}_assignSchemaParameter(e,t){e.name=t.name,e.caption=t.caption,e.type=t.dataValueType,e.required=t.required,e.lookup=t.referenceSchemaUId}_removeParameters(e,t,a){const r=[];t=t??[],t.forEach(n=>{r.push(n.uId)}),r.forEach(n=>{if(Object.values(e).find(m=>m.uId===n))return;const s=t.findItem(n);this._getIsOwnSchemaParameter(s,a)&&t.deleteItemByUId(n)})}_getCanUseParametersDesign(){return this._featureValues?.["ClientUnitSchemaFeatures.AllowParametersDatasourceDesign"]??!1}_setPageParametersInDataSourceConfig(e,t=null){!this._getCanUseParametersDesign()||(this._initialPageParametersDataSourceConfig=(0,U.cloneDeep)(e.modelConfig?.dataSources?.[f.PAGE_PARAMETERS_DATA_SOURCE_NAME]),e.modelConfig=(0,be.all)([e.modelConfig,{dataSources:{[f.PAGE_PARAMETERS_DATA_SOURCE_NAME]:{type:f.PAGE_PARAMETERS_DATA_SOURCE_TYPE_NAME,config:{schemaName:t??e.name,parameters:null}}}}]),e.modelConfig.dataSources[f.PAGE_PARAMETERS_DATA_SOURCE_NAME].config.parameters=e.parameters)}_restorePageParametersDataSourceConfig(e){!this._getCanUseParametersDesign()||(this._initialPageParametersDataSourceConfig?e.modelConfig.dataSources[f.PAGE_PARAMETERS_DATA_SOURCE_NAME]=this._initialPageParametersDataSourceConfig:(delete e.modelConfig.dataSources[f.PAGE_PARAMETERS_DATA_SOURCE_NAME],Object.keys(e.modelConfig.dataSources).length===0&&delete e.modelConfig.dataSources))}_extractAddonMetadataInfo(e){return e.addons.length===0?(0,l.of)([]):(0,l.forkJoin)(e.addons.map(t=>t.addonConfig.pipe((0,o.map)(a=>({metadata:a,name:t.addonName,resources:t.resources})),(0,o.take)(1))))}_shouldCopyAddon(e,t,a){return!e.isEmpty(t)&&e.isEmpty(a)}_copyAddons(e,t,a){t.length!==0&&e.addons.forEach(r=>{const n=t.find(m=>m.name===r.addonName),i=a.find(m=>m.name===r.addonName);if(!n||!n.metadata)return;const s=this._addonMetadataNormalizerFactory.create(n.name);if(this._shouldCopyAddon(s,n,i)){const m=s.copy(n);r.addonConfig=(0,l.of)(m.metadata),m.resources.forEach(h=>{r.createOrUpdateResource(h)})}})}_preprocessedSchemaBundle(e){var t=this;return(0,z.Z)(function*(){const a=t._featureValues.DisableProcessingSchemaInDesignTime,[r,n]=a?[e.bundle,null]:yield(0,l.firstValueFrom)(t._schemaInitializerService.init(e.schema?.name,e.bundle));return{...{...e,bundle:r},viewModel:n}})()}_createDesignItem(e){const{packageUId:t,useFullHierarchy:a=!1}=e,r=e.parentSchemaUId??this.parentSchemaUId;return(0,l.forkJoin)([this.createNewSchema(f.ClientUnitSchemaType.AngularSchema,t,r),this.getParentSchemas(r,t,a)]).pipe((0,o.switchMap)(([n,i])=>(n.body=this.bodyTemplate.replace("{SCHEMA_NAME}",n.name),this.buildSchema([n,...i]).pipe((0,o.tap)(s=>this._setPageParametersInDataSourceConfig(s)),(0,o.map)(s=>({schema:n,parentSchemas:i,bundle:s,isNew:!0}))))),(0,o.tap)(({schema:n})=>{this._onAfterBuildSchema(n,a)}))}_onAfterBuildSchema(e,t){this._featureValues?.FeatureFixReadingAddonsWhenUseFullHierarchy&&(e.useFullHierarchy=t),this._createSchemaAddons(e),this._currentClientUnitSchema=e}_updateBundleName(e,t){e.bundle.name=t}setSchemaBodyProperties(e,t,a,r){const n=this._getSchemaViewConfigDiff(t.viewConfig,a.viewConfig);this.setDefaultSchemaBody(e),this._setSchemaViewConfigDiff(e,a,n),this._featureValues?.EnableViewModelConfigDiff?this._setSchemaViewModelConfigDiff(e,a,t):this._setSchemaViewModelConfig(e,a.viewModelConfig,t.viewModelConfig),this._saveParameters(a,e),this._featureValues?.EnableModelConfigDiff?this._setSchemaModelConfigDiff(e,a,t):this._setSchemaModelConfig(e,a.modelConfig,t.modelConfig),e.setSchemaBody("SCHEMA_HANDLERS",a.handlers),e.setSchemaBody("SCHEMA_CONVERTERS",a.converters),e.setSchemaBody("SCHEMA_DEPS",a.deps),e.setSchemaBody("SCHEMA_ARGS",a.args),e.setSchemaBody("SCHEMA_VALIDATORS",a.validators),this._setLocalizableStrings(e,a.resources,t.resources),this._setDependencies(e,a,r,n),e.body=(0,Ee.lf)(e.body)}setDefaultSchemaBody(e){e.body=this.bodyTemplate.replace("{SCHEMA_NAME}",e.name)}getCurrentClientUnitSchema(){return this._currentClientUnitSchema}getParentSchemas(e,t,a=!1){const r={schemaUId:e,packageUId:t,useFullHierarchy:a};return this.apiService.getParentSchemas(r).pipe((0,o.map)(({values:n})=>n))}getSchemaViewConfig(e,t,a=!1){return this.apiService.getParentSchemas({schemaUId:e,packageUId:t,useFullHierarchy:a}).pipe((0,o.switchMap)(({values:r})=>this.builderService.build(r).pipe((0,o.map)(({viewConfig:n})=>n))))}createNewSchema(e,t,a){return this.apiService.createSchema({packageUId:t,schemaType:e}).pipe((0,o.switchMap)(r=>{if(a){const n={schema:r.schema,newParentUid:a};return this.apiService.applyParent(n).pipe((0,o.map)(({schema:i})=>i))}return(0,l.of)(r.schema)}))}extendSchema(e,t){return this.apiService.createSchema({packageUId:t,schemaType:e.schemaType,extendParent:!0}).pipe((0,o.switchMap)(({schema:a})=>{a.extendParent=!0;const r=e.extendParent?e.parent.uId:e.uId,n={schema:a,newParentUid:r};return this.apiService.applyParent(n).pipe((0,o.map)(({schema:i})=>(i.extendParent=!0,i.name=e.name,i.caption=e.caption.clone(),i.description=e.description.clone(),i)))}))}buildSchema(e){return this.builderService.build(e)}copySchema(e,t,a,r){const n=(0,p.generateGuid)(),i=this.converter.convertToDto(e);delete i.addons;let s=JSON.stringify(i);s=s.replace(e.uId??(0,p.generateGuid)(),n).replace(e.package.uId,a);const m=this.converter.convertToSchema(JSON.parse(s));return this._setCopySchemaBaseProperties(e,m,n,a,r),this._setCopySchemaParent(e,m,t),this.setDefaultSchemaBody(m),this._setCopySchemaCaption(m).pipe((0,o.tap)(h=>{this._createSchemaAddons(h)}),(0,o.switchMap)(h=>(0,l.forkJoin)({copiedSchema:(0,l.of)(h),loadedSourceAddons:this._extractAddonMetadataInfo(e),loadedCopyAddons:this._extractAddonMetadataInfo(h)})),(0,o.tap)(({copiedSchema:h,loadedSourceAddons:S,loadedCopyAddons:_})=>{this._copyAddons(h,S,_)}),(0,o.map)(({copiedSchema:h})=>h),(0,o.tap)(h=>{this._currentClientUnitSchema=h}))}initDesignItemByParentSchema(e){const{packageUId:t,parentSchemaUId:a}=e;return this._createDesignItem({packageUId:t,parentSchemaUId:a}).pipe((0,o.switchMap)(r=>this._preprocessedSchemaBundle(r)))}initDesignItem(e,t,a=!1){return(e?this.designItem(e,t,a):this.designNewItem(t,a)).pipe((0,o.switchMap)(n=>this._preprocessedSchemaBundle(n)))}designItem(e,t,a=!1){return this.getParentSchemas(e,t,a).pipe(this._measurePerformanceService.measure$("designItem.getParentSchemas"),(0,o.switchMap)(r=>{const n=r[0];return n.package.uId===t?(0,l.of)({parentSchemas:r,extendSchema:!1}):a&&r.some(i=>i.package.uId===t)?(0,l.of)({parentSchemas:r,extendSchema:!1}):this.extendSchema(n,t).pipe(this._measurePerformanceService.measure$("extendSchema"),(0,o.switchMap)(i=>(i.body=this.bodyTemplate.replace("{SCHEMA_NAME}",i.name),r.unshift(i),(0,l.of)({parentSchemas:r,extendSchema:!0}))))}),(0,o.switchMap)(({parentSchemas:r,extendSchema:n})=>this.buildSchema(r).pipe(this._measurePerformanceService.measure$("designItem.buildSchema"),(0,o.tap)(i=>this._setPageParametersInDataSourceConfig(i)),(0,o.map)(i=>{const s=r.findIndex(h=>h.package.uId===t);return{schema:r.splice(s,1)[0],parentSchemas:r,bundle:i,extendSchema:n}}))),(0,o.tap)(({schema:r})=>{this._onAfterBuildSchema(r,a)}))}designNewItem(e,t=!1){return this._createDesignItem({packageUId:e,useFullHierarchy:t})}saveDesignItem({schema:e,parentSchemas:t,bundle:a}){var r=this;return this.buildSchema(t).pipe((0,o.tap)(()=>this._restorePageParametersDataSourceConfig(a)),(0,o.tap)(n=>{const i=this._getSchemaViewConfigDiff(n.viewConfig,a.viewConfig);this._setBundleDeps(a,i)}),(0,o.switchMap)(function(){var n=(0,z.Z)(function*(i){const m=r._featureValues?.DisableProcessingSchemaInDesignTime?a:yield r._metadataPostprocessorService.onMetaDataChanged(a);return r.setSchemaBodyProperties(e,i,m,t),yield(0,l.firstValueFrom)(r.apiService.saveSchema(e))});return function(i){return n.apply(this,arguments)}}()),(0,o.switchMap)(n=>n.success?this._workplaceService.resetWorkplaceScriptCache().pipe((0,o.switchMap)(()=>this._sendMessage(e).pipe((0,o.mapTo)(n)))):(0,l.of)(n)),(0,o.tap)(()=>this._setPageParametersInDataSourceConfig(a)))}checkUniqueSchemaName(e,t,a){return this.apiService.checkUniqueSchemaName(e,t,a).pipe((0,o.map)(r=>r.success?r.value:!1),(0,o.share)())}copyDesignItem(e,t,a){return this._restorePageParametersDataSourceConfig(e.bundle),this.copySchema(e.schema,e.parentSchemas,t,a).pipe((0,o.map)(r=>{const n=e.parentSchemas.filter(i=>i.name!==e.schema.name);return this._setPageParametersInDataSourceConfig(e.bundle,r.name),this._updateBundleName(e,r.name),{parentSchemas:n,schema:r,bundle:e.bundle}}))}setDesignItemDefaultPropertyValues(e,t,a,r,n){e.name=$.NameGenerator.generateUnique(t,a),e.caption=this._getSchemaDefaultCaption(r,n),this.setDefaultSchemaBody(e)}}O.\u0275fac=function(e){return new(e||O)(c.\u0275\u0275inject(M),c.\u0275\u0275inject(N),c.\u0275\u0275inject(y.JsonDifferService),c.\u0275\u0275inject(u.SCHEMA_DESIGNER_CONVERTER),c.\u0275\u0275inject(Ie.TranslateService),c.\u0275\u0275inject(f.TranslateUtilsService),c.\u0275\u0275inject(f.MessageChannelService),c.\u0275\u0275inject(f.UserInfo),c.\u0275\u0275inject(_e.ActivatedRoute),c.\u0275\u0275inject(I),c.\u0275\u0275inject(f.WorkplaceService),c.\u0275\u0275inject(u.AddonInfoFactory),c.\u0275\u0275inject(u.AddonMetadataNormalizerFactory),c.\u0275\u0275inject(y.JsonObjectDifferService),c.\u0275\u0275inject(x.MetadataPostprocessorService),c.\u0275\u0275inject(D),c.\u0275\u0275inject(f.FEATURE_VALUES,8),c.\u0275\u0275inject(y.JsonPathDifferService),c.\u0275\u0275inject(y.JsonPathApplierService))},O.\u0275prov=c.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac});var te=g(83232),Me=g(96923);class P{constructor(){this._currentPackageUIdSubject=new l.ReplaySubject(1)}setCurrentPackageUId(e){return e&&this._currentPackageUIdSubject.next(e),(0,l.of)(null)}getCurrentPackageUId(){return this._currentPackageUIdSubject.asObservable()}}P.\u0275fac=function(e){return new(e||P)},P.\u0275prov=c.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac,providedIn:"root"});var Y=g(6523);class w{constructor(e,t,a,r){this._schemaDataDesignerApi=e,this._queryExecutor=t,this._entitySchemaService=a,this._lczToString=r}_mapEntitySchemaColumn(e,t){return{uId:t.uId,name:t.name,caption:t.caption,isForceUpdate:!1,isKey:t.uId===e.primaryColumnUId}}_saveRegistrationDataToPackage(e,t,a){return this._entitySchemaService.getEntitySchemaByName("Lookup").pipe((0,o.switchMap)(r=>{const{entitySchema:n}=r,i=new E.SchemaData;return i.name=t,i.body="",i.package=new u.Package,i.uId=(0,p.generateGuid)(),i.package.uId=a.uId,i.package.name=a.name,i.entitySchemaName="Lookup",i.entitySchemaUId=n.uId,i.boundRecordIds=[e],i.columns=n.columns.map(s=>this._mapEntitySchemaColumn(n,s)),this._schemaDataDesignerApi.saveSchema(i)}))}_register(e){const t=new p.InsertQuery("Lookup");return t.addColumn("Name",this._lczToString.transform(e.caption),p.DataValueType.Text),t.addColumn("SysEntitySchemaUId",e.uId,p.DataValueType.Guid),this._queryExecutor.executeInsertQuery(t)}register(e){return this._register(e).pipe((0,o.switchMap)(t=>{const a=$.NameGenerator.generateUnique("Lookup_"+e.name);return this._saveRegistrationDataToPackage(t.id,a,e.package)}),(0,o.map)(()=>null))}}w.\u0275fac=function(e){return new(e||w)(c.\u0275\u0275inject(E.SchemaDataDesignerApiService),c.\u0275\u0275inject(Y.QueryExecutor),c.\u0275\u0275inject(f.EntitySchemaService),c.\u0275\u0275inject(f.LczToStringPipe))},w.\u0275prov=c.\u0275\u0275defineInjectable({token:w,factory:w.\u0275fac});const Ne="Feature-InterfaceDesigner-DisableEntitySchemaDeferredResourceLoading";class F{constructor(e,t,a,r,n,i,s,m,h,S,_,V){this._entitySchemaDesignerApiService=e,this._sysSettingsService=t,this._applicationInfoService=a,this._errorHandler=r,this._workspaceStructureService=n,this._restErrorHandler=i,this._featureService=s,this._lczToString=m,this._workspaceCompilationService=h,this._currentPageSchemaPackageService=S,this._lookupRegistrationService=_,this._userInfo=V,this._allowBuildConfigurationOnSave="InterfaceDesignerAllowBuild",this._defaultFileEntitySchemaName="FileLink",this._defaultFileStorageEntitySchemaName="SysFile",this._resourceLoadingRequests=new Set,this._resourceLoadingStarted=!1,this._entitySchemaModelInfos=new Map,this._changedSchemaNames=new Set}_getUserSettings(){return this._userSettings?this._currentPageSchemaPackageService.getCurrentPackageUId().pipe((0,o.take)(1),(0,o.map)(e=>({...this._userSettings,currentPackageUId:e}))):(0,l.forkJoin)({currentPackageUId:this._currentPageSchemaPackageService.getCurrentPackageUId().pipe((0,o.take)(1)),sysSettings:this._sysSettingsService.getByCodes(["CustomPackageUId","SchemaNamePrefix"]).pipe((0,o.map)(e=>e.values))}).pipe((0,o.map)(({currentPackageUId:e,sysSettings:t})=>{const a=t.SchemaNamePrefix?.value,r=t.CustomPackageUId.value;return{schemaNamePrefix:a,currentPackageUId:e,customPackageUId:r}}),(0,o.tap)(e=>{this._userSettings=e}))}_getSystemValues(){return this._systemValues?(0,l.of)(this._systemValues):this._applicationInfoService.loadSysValues().pipe((0,o.tap)(e=>{this._systemValues=e}))}_updateDBStructure(e){return this._restErrorHandler.handleRequest(this._workspaceStructureService.updateDBStructure(e))}_createDeletedSchemaDesignItemByName(e){const t=new v.EntitySchemaModel;return t.name=e,t.isDeleted=!0,t.columns=new u.MetaItemArray,t.inheritedColumns=new u.MetaItemArray,t}_getSchemaDesignItem(e,t,a){return this._entitySchemaDesignerApiService.getSchemaDesignItem(t,e,!0,a).pipe((0,o.map)(r=>r.schema?r.schema:this._createDeletedSchemaDesignItemByName(e)))}_getSchemesDesignItems(e,t,a){return this._entitySchemaDesignerApiService.getSchemesDesignItems(t,e,!0,a).pipe((0,o.map)(r=>{const n=[...r.schemas];return r.notFoundSchemes?.length>0&&r.notFoundSchemes.forEach(i=>{n.push(this._createDeletedSchemaDesignItemByName(i))}),n}))}_getDesignedReferenceSchemas(){return Array.from(this._entitySchemaModelInfos.entries()).filter(([,e])=>!this._referenceSchemas||!this._referenceSchemas.find(t=>t.uId===e.entitySchema.uId||t.uId===e.entitySchema.parentSchema?.uId&&!e.entitySchema.isVirtual)).map(([,e])=>new u.ManagerItem({name:e.entitySchema.name,uId:e.entitySchema.uId,caption:this._lczToString.transform(e.entitySchema.caption)}))}_updateConfiguration(){return this._workspaceCompilationService.buildConfiguration().pipe((0,o.mergeMap)(e=>e.success?this._workspaceCompilationService.runODataBuild():(0,l.of)(e)))}_isSchemaColumnsModified(e){const t=this._entitySchemaModelInfos.get(e.name);return t.isNewSchema?!0:!t.sourceEntitySchema.equal(e)}_needUpdateDBStructure(e){return!e.some(t=>(0,p.isEmptyGuid)(t))}_handleSaveSchemaResults(e,t){if(this._isSchemasSaved(e)){this._actualizeSchemas();const a=e.map(r=>r.schemaUid);return this._needUpdateDBStructure(a)?this._updateDBStructure(a).pipe((0,o.mergeMap)(r=>t?this._updateConfiguration():(0,l.of)(r))):(0,l.of)({success:!0})}return(0,l.of)({success:!1})}_isSchemaDeleted(e){return this._entitySchemaModelInfos.get(e).entitySchema.isDeleted}_saveChangedSchemas(e,t=!1){const a=e.filter(n=>this._changedSchemaNames.has(n.name)).filter(n=>!this._isSchemaDeleted(n.name)).filter(n=>this._isSchemaColumnsModified(n)),r=a.map(n=>this._entitySchemaDesignerApiService.saveSchema(n,!0));return a.length?(0,l.forkJoin)(r).pipe((0,o.mergeMap)(n=>this._handleSaveSchemaResults(n,t))):(0,l.of)({success:!0})}_actualizeSchemas(){this._entitySchemaModelInfos.forEach(e=>{e.isNewSchema=!1,e.sourceEntitySchema=e.entitySchema.clone()})}_isSchemasSaved(e){return!e||e.length===0||e.every(t=>t.success)}get _schemas(){return Array.from(this._entitySchemaModelInfos.values()).map(e=>e.entitySchema)}_getDesignedColumns(e){const a=this._entitySchemaModelInfos.get(e.name).sourceEntitySchema.columns.map(r=>r.uId);return e.columns.filter(r=>!a.includes(r.uId))}_isColumnReferenceToSchema(e,t){return e.type!==p.DataValueType.Lookup?!1:e.referenceSchema?.uId===t.uId}_hasReferenceToEntitySchema(e,t,a=!1){return(a?[...e.columns,...e.inheritedColumns]:this._getDesignedColumns(e)).filter(n=>n.type===p.DataValueType.Lookup).some(n=>n.referenceSchema?.uId===t.uId)}_findReferencingSchemas(e){return this._schemas.filter(t=>this._getDesignedColumns(t).filter(r=>r.type===p.DataValueType.Lookup).filter(r=>!this._isColumnReferenceToSchema(r,t)).some(r=>e.includes(r.referenceSchema?.uId)))}_findReferencedSchemas(e,t,a=!1){return this._schemas.filter(r=>!t.includes(r.uId)).filter(r=>e.some(n=>this._hasReferenceToEntitySchema(n,r,a)))}_findRootSchemas(e){let t=this._schemas.filter(a=>!this._findReferencingSchemas([a.uId]).length);return e&&(t=t.filter(a=>e.includes(a.name))),t}_getReferenceSchemas(e,t=!1){const a=[],r=e.map(i=>i.uId);let n=this._findReferencedSchemas(e,r,t);for(r.push(...n.map(i=>i.uId));n.length;)a.push(n),n=this._findReferencedSchemas(n,r,t),r.push(...n.map(i=>i.uId));return a.reverse()}_saveSchemas(e){return this._featureService.getFeatureState(this._allowBuildConfigurationOnSave).pipe((0,o.mergeMap)(t=>{const a=this._findRootSchemas(e),r=this._getReferenceSchemas(a),n=a.map(m=>m.name);r.forEach(m=>{m.forEach(h=>{n.push(h.name)})});const i=[...this._changedSchemaNames].filter(m=>!n.includes(m)).map(m=>this._entitySchemaModelInfos.get(m).entitySchema),s=r.map(m=>this._saveChangedSchemas(m,t));return(0,l.concat)(...s,this._saveChangedSchemas(i),this._saveChangedSchemas(a)).pipe((0,o.toArray)(),(0,o.map)(m=>({success:m.every(h=>h.success)})))}))}_createDesignItem(e,t,a,r){return this._getUserSettings().pipe((0,o.mergeMap)(({currentPackageUId:n})=>this._errorHandler.handleRequest(this._entitySchemaDesignerApiService.createSchema({packageUId:n}))),(0,o.map)(n=>n.schema),(0,o.mergeMap)(n=>(n.useFullHierarchy=!0,this._errorHandler.handleRequest(this._entitySchemaDesignerApiService.assignParentSchema(n,e)))),(0,o.map)(n=>n.schema),(0,o.tap)(n=>{n.caption=t,a&&(n.description=a),r&&(n.name=r),this._entitySchemaModelInfos.set(n.name,{entitySchema:n,isNewSchema:!0,sourceEntitySchema:n.clone()}),this.markSchemaAsChanged(n.name)}))}_registerLookups(e=null){const t=this._findRootSchemas(e),a=this._getReferenceSchemas(t,!0),n=[t,...a].flat().filter(s=>this._entitySchemaModelInfos.get(s.name).registerAsLookup);if(!n.length)return(0,l.of)({success:!0});const i=n.map(s=>this._lookupRegistrationService.register(s).pipe((0,o.tap)(()=>this._entitySchemaModelInfos.get(s.name).registerAsLookup=!1)));return(0,l.forkJoin)(i).pipe((0,o.map)(()=>({success:!0})),(0,o.catchError)(s=>(0,l.of)({success:!1,errorInfo:s})))}_loadFullSchemesResources(e,t){e.forEach(a=>this._resourceLoadingRequests.add(a)),!this._resourceLoadingStarted&&(this._resourceLoadingStarted=!0,setTimeout(()=>{const a=[...this._resourceLoadingRequests];this._resourceLoadingStarted=!1,this._resourceLoadingRequests.clear(),this._getSchemesDesignItems(a,t).pipe((0,o.tap)(r=>{r.forEach(n=>{if(this._entitySchemaModelInfos.has(n.name)){const i={};n.getLocalizableValues(i);const s=this._entitySchemaModelInfos.get(n.name);s.sourceEntitySchema.loadLocalizableValues(i,!0),s.entitySchema.loadLocalizableValues(i,!0)}})})).subscribe()},500))}_getCulturesToRequest(){return this._featureService.getFeatureState(Ne).pipe((0,o.map)(e=>e?[]:[this._userInfo.cultureInfo.sysCultureName,this._userInfo.defCultureInfo.sysCultureName]),(0,o.map)(e=>[...new Set(e)]))}_initDesignItemsInternal(e,t,a=[]){return this._getSchemesDesignItems(e,t,a).pipe((0,o.tap)(()=>{a.length>0&&this._loadFullSchemesResources(e,t)}),(0,o.tap)(r=>this._updateEntitySchemaModelInfos(r)))}_initDesignItemByNameInternal(e,t,a=[]){return this._getSchemaDesignItem(e,t,a).pipe((0,o.tap)(r=>{if(!r.isDeleted&&a.length>0){const n={schemaName:e,forwardReferencePaths:[]};this._loadFullSchemesResources([n],t)}}),(0,o.tap)(r=>this._updateEntitySchemaModelInfos([r])))}_updateEntitySchemaModelInfos(e){e.forEach(t=>{this._entitySchemaModelInfos.has(t.name)||this._entitySchemaModelInfos.set(t.name,{entitySchema:t,isNewSchema:!1,sourceEntitySchema:t.clone()})})}getAvailableReferenceSchemas(e=!1){return(Array.isArray(this._referenceSchemas)?(0,l.of)(this._referenceSchemas):this._getUserSettings().pipe((0,o.mergeMap)(({customPackageUId:t})=>this._entitySchemaDesignerApiService.getAvailableReferenceSchemas(t,e)),(0,o.map)(t=>t?.items||[]),(0,o.tap)(t=>{this._referenceSchemas=t}))).pipe((0,o.map)(t=>[...t,...this._getDesignedReferenceSchemas()]))}findFileSchemasForReferenceSchema(e){return this.getAvailableReferenceSchemas().pipe((0,o.map)(t=>{const a=[`${e}File`,`File${e}`],r=t.find(s=>a.includes(s.name));if(r)return{file:r,storage:r,column:`${e}Id`};const n=t.find(s=>s.name===this._defaultFileEntitySchemaName),i=t.find(s=>s.name===this._defaultFileStorageEntitySchemaName);if(!n||!i)throw new Error(`File entity schema is not found for schema ${e}`);return{file:n,storage:i,column:"RecordId"}}))}getEntitySchemaByName(e){return(0,l.of)(this._entitySchemaModelInfos.get(e)?.entitySchema)}getExistingColumns(e){return(0,l.of)(this._entitySchemaModelInfos.get(e)?.sourceEntitySchema?.columns)}getIsNewSchemaByUId(e){const t=Array.from(this._entitySchemaModelInfos.values()).find(a=>a.entitySchema.uId===e)?.isNewSchema??!1;return(0,l.of)(t)}getIsSchemaModified(e){return this._changedSchemaNames.has(e)}getEntitySchemaNameLengthLimit(){return this._getSystemValues().pipe((0,o.map)(e=>e.maxEntitySchemaNameLength))}updateEntitySchemaMaps(){return this._entitySchemaModelInfos.forEach((e,t)=>{if(e.entitySchema.name!==t){const a=this._entitySchemaModelInfos.get(t);this._entitySchemaModelInfos.delete(t),this._entitySchemaModelInfos.set(e.entitySchema.name,a),this._changedSchemaNames.has(t)&&(this._changedSchemaNames.delete(t),this._changedSchemaNames.add(e.entitySchema.name))}}),(0,l.of)(null)}checkUniqueSchemaName(e,t){return this._entitySchemaDesignerApiService.checkUniqueSchemaName(e,t,"EntitySchemaManager")}deleteDesignItem(e){this._entitySchemaModelInfos.delete(e),this._changedSchemaNames.has(e)&&this._changedSchemaNames.delete(e)}initDesignItemByName(e){const t=Array.from(this._entitySchemaModelInfos.values()).find(a=>a.entitySchema.name===e||a.entitySchema.parentSchema?.name===e);return t?(0,l.of)(t.entitySchema):(0,l.forkJoin)([this._getUserSettings(),this._getCulturesToRequest()]).pipe((0,o.switchMap)(([a,r])=>this._initDesignItemByNameInternal(e,a.currentPackageUId,r)))}initDesignItems(e){return(0,l.forkJoin)([this._getUserSettings(),this._getCulturesToRequest()]).pipe((0,o.switchMap)(([t,a])=>this._initDesignItemsInternal(e,t.currentPackageUId,a)))}markSchemaAsChanged(e){this._entitySchemaModelInfos.has(e)&&!this._changedSchemaNames.has(e)&&this._changedSchemaNames.add(e)}createDesignItem(e,t){const a="1bab9dcf-17d5-49f8-9536-8e0064f1dce0";return this._createDesignItem(a,e,t,null)}createLookupDesignItem(e,t){const a="11ab4bcb-9b23-4b6d-9c86-520fae925d75";return this._createDesignItem(a,e,null,t).pipe((0,o.tap)(()=>this._entitySchemaModelInfos.get(t).registerAsLookup=!0))}saveDesignItems(e=null){return this._changedSchemaNames.size===0?(0,l.of)({success:!0}):this._saveSchemas(e).pipe((0,o.switchMap)(t=>t.success?this._registerLookups(e):(0,l.of)(t)))}clearCache(){this._entitySchemaModelInfos.clear()}}F.\u0275fac=function(e){return new(e||F)(c.\u0275\u0275inject(v.EntitySchemaDesignerApiService),c.\u0275\u0275inject(b.SysSettingsService),c.\u0275\u0275inject(f.ApplicationInfoService),c.\u0275\u0275inject(f.RestErrorHandler),c.\u0275\u0275inject(te.WorkspaceDbStructureService),c.\u0275\u0275inject(Me.DefaultRestErrorHandler),c.\u0275\u0275inject(b.FeatureService),c.\u0275\u0275inject(f.LczToStringPipe),c.\u0275\u0275inject(te.WorkspaceCompilationService),c.\u0275\u0275inject(P),c.\u0275\u0275inject(w),c.\u0275\u0275inject(f.UserInfo))},F.\u0275prov=c.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac});const ae=["05477cbd-1ca8-4658-b427-971fc58bbc08","98ca84c1-5f6a-4a55-9c3f-d668ce12378c","3176536a-77ac-403a-932e-28dd4b50e4e6","0f8eb896-7b62-4dfa-bd55-a414f50932a7","e4b45c7b-cfe3-4ee4-b56b-502f690db0d5","0c5cfb7a-1ed9-41b8-905e-9a38c6915550","a5678241-e5e0-f691-b825-84b6039d5fa2","f691e828-0b36-42a7-898f-c337e9af67d0","9d0fd8cc-431b-455a-beeb-3bb93c64cb38","c6a6e333-21c2-4f43-b6fb-cf4b0369b09f","1a29b42d-f75e-48e5-b227-0b29bf0e676d","ecdcc8ff-272c-4957-9381-7d74ce17e140","ac545d45-b915-46c9-ad64-806407e620a4"];class T{constructor(e){this._queryExecutor=e}_excludeTemplateUIds(e){return ae.forEach(t=>e.addSchemaColumnFilterWithParameter(p.ComparisonType.Not_equal,"UId",t)),e}_getEntitySchemaQueryByGroup(e){const t=new p.EntitySchemaQuery("SysSchema");t.addSchemaColumn("=[VwSysSchemaExtending:BaseSchemaId:Id].[SysSchema:Id:TopExtendingSchemaId].Caption","caption"),t.addSchemaColumn("Name","value"),t.addSchemaColumn("UId","uId");let a=new p.FilterGroup;return a.addSchemaColumnFilterWithParameter(p.ComparisonType.Equal,"[SysSchemaProperty:SysSchema:Id].Name","Group"),a.addSchemaColumnFilterWithParameter(p.ComparisonType.Equal,"[SysSchemaProperty:SysSchema:Id].Value",e),a=this._excludeTemplateUIds(a),t.filters.add(a),t}getPagesByGroups(e){const t=e.map(a=>{const r=this._getEntitySchemaQueryByGroup(a);return this._queryExecutor.executeSelectQuery(r)});return(0,l.forkJoin)(t).pipe((0,o.map)(a=>{let r=[];return a.forEach(n=>{r=r.concat(n.map(({caption:i,value:s,uId:m})=>({caption:i,value:s,uId:m})))}),r}))}getSpecificPages(){const e=new p.EntitySchemaQuery("SysSchema");e.addSchemaColumn("=[VwSysSchemaExtending:BaseSchemaId:Id].[SysSchema:Id:TopExtendingSchemaId].Caption","caption"),e.addSchemaColumn("Name","value"),e.addSchemaColumn("UId","uId");let t=new p.FilterGroup;return t.addSchemaColumnFilterWithParameter(p.ComparisonType.Equal,"[SysSchemaProperty:SysSchema:Id].Name","SchemaType"),t.addSchemaColumnFilterWithParameter(p.ComparisonType.Equal,"[SysSchemaProperty:SysSchema:Id].Value","AngularSchema"),t=this._excludeTemplateUIds(t),t.addNotExistsFilter("[SysModuleEdit:CardSchemaUId:UId].CardSchemaUId"),t.addNotExistsFilter("[SysDetail:DetailSchemaUId:UId].DetailSchemaUId"),e.filters.add(t),this._queryExecutor.executeSelectQuery(e).pipe((0,o.map)(a=>a.map(({caption:r,value:n,uId:i})=>({caption:r,value:n,uId:i}))))}}T.\u0275fac=function(e){return new(e||T)(c.\u0275\u0275inject(Y.QueryExecutor))},T.\u0275prov=c.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac});class G{constructor(e){this._queryExecutor=e}getEntityOptions(){const e=new p.EntitySchemaQuery("SysModule");e.addSchemaColumn("Code","code"),e.addSchemaColumn("SysModuleEntity.SysEntitySchemaUId","uId"),e.addSchemaColumn("=SysModuleEntity.[SysSchema:UId:SysEntitySchemaUId].Caption","caption");const t=new p.FilterGroup;return t.addSchemaColumnFilterWithParameter(p.ComparisonType.Equal,"GlobalSearchAvailable",!0),e.filters.add(t),this._queryExecutor.executeSelectQuery(e).pipe((0,o.map)(a=>a.map(({code:r,uId:n,caption:i})=>({entityUId:n.toString(),value:r.toString(),displayValue:i.toString()}))))}}G.\u0275fac=function(e){return new(e||G)(c.\u0275\u0275inject(Y.QueryExecutor))},G.\u0275prov=c.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac});class R{}R.\u0275fac=function(e){return new(e||R)},R.\u0275mod=c.\u0275\u0275defineNgModule({type:R}),R.\u0275inj=c.\u0275\u0275defineInjector({providers:[M,(0,u.getSchemaDesignerApiUrlProvider)("ClientUnitSchemaDesignerService.svc"),{provide:u.SCHEMA_DESIGNER_CONVERTER,useClass:A},(0,u.getSchemaImageUploaderApiUrlProvider)("SchemaImageUploaderService.svc"),F,{provide:v.EntitySchemaDesignerApiService,useFactory:d=>{const e=c.Injector.create({parent:d,name:"EntitySchemaDesignerInjector",providers:[(0,u.getSchemaDesignerApiUrlProvider)("EntitySchemaDesignerService.svc"),{provide:u.SCHEMA_DESIGNER_CONVERTER,useClass:v.EntitySchemaConverterService,deps:[]}]});return new v.EntitySchemaDesignerApiService(e,e.get(b.ServerClientOperationNotificationReceiver))},deps:[c.Injector]},u.SchemaImageUploaderService,N,y.JsonApplierService,y.JsonPathApplierService,y.JsonDifferService,y.JsonPathDifferService,I,B.RestValidationErrorHandler,w,{provide:E.SchemaDataDesignerApiService,useFactory:d=>{const e=c.Injector.create({parent:d,name:"SchemaDataDesignerInjector",providers:[(0,u.getSchemaDesignerApiUrlProvider)("SchemaDataDesignerService.svc"),{provide:u.SCHEMA_DESIGNER_CONVERTER,useClass:E.SchemaDataConverterService,deps:[]}]});return new v.EntitySchemaDesignerApiService(e,e.get(b.ServerClientOperationNotificationReceiver))},deps:[c.Injector]},T,G,D,f.EntitySchemaService,b.SchemaInfoService],imports:[j.CommonModule,u.SchemaDesignerApiModule,x.ModelModule,f.MacrosModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(R,{imports:[j.CommonModule,u.SchemaDesignerApiModule,x.ModelModule,f.MacrosModule]})}()},8239:(re,k,g)=>{g.d(k,{Z:()=>c});function j(b,v,E,u,B,f,y){try{var x=b[f](y),l=x.value}catch(o){E(o);return}x.done?v(l):Promise.resolve(l).then(u,B)}function c(b){return function(){var v=this,E=arguments;return new Promise(function(u,B){var f=b.apply(v,E);function y(l){j(f,u,B,y,x,"next",l)}function x(l){j(f,u,B,y,x,"throw",l)}y(void 0)})}}}}]);
