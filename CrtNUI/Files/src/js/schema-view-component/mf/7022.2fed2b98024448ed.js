(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[7022],{37022:(mi,Xt,N)=>{N.r(Xt),N.d(Xt,{BaseDataGridActionsPreprocessor:()=>jt,ChartWidgetAdaptAxesFormattingPreprocessor:()=>je,ChartWidgetPreprocessor:()=>We,ComponentsPreprocessorsModule:()=>Ze,CustomQuickFilterAdditionalPreprocessingService:()=>sr,DISABLE_CHART_WIDGET_AXES_FORMATTING_ADAPTATION:()=>fr,DataGridActionsPreprocessor:()=>X,DataGridActiveRowPreprocessor:()=>de,DataGridBulkActionsPreprocessor:()=>K,DataGridBulkActionsPreprocessorsModule:()=>j,DataGridCancelItemsChangesPreprocessor:()=>ae,DataGridColumnsPreprocessor:()=>L,DataGridCreateItemPreprocessor:()=>oe,DataGridDeleteItemPreprocessor:()=>ne,DataGridEditingCellViewPreprocessor:()=>ee,DataGridFilterOptionsBackwardCompatibilityPreprocessor:()=>te,DataGridFilterOptionsPostprocessorsModule:()=>tt,DataGridFilterOptionsPreprocessor:()=>re,DataGridFilterOptionsPreprocessorsModule:()=>Ke,DataGridHeaderToolbarPreprocessor:()=>ie,DataGridPagingPreprocessor:()=>le,DataGridPlaceholderPreprocessor:()=>ue,DataGridReloadItemsPreprocessor:()=>ce,DataGridRestrictionsPreprocessor:()=>_e,DataGridRowDoubleClickPreprocessor:()=>me,DataGridRowsSelectionPreprocessor:()=>pe,DataGridSaveItemsChangesPreprocessor:()=>se,DataGridSelectionOptionsBackwardCompatibilityPreprocessor:()=>fe,DataGridSelectionOptionsPostprocessorsModule:()=>it,DataGridSelectionOptionsPreprocessorsModule:()=>U,DataGridSortingPreprocessor:()=>ge,DataGridStageCellViewPreprocessor:()=>he,DataSourceUtils:()=>E,QuickFilterAdditionalPreprocessingService:()=>Q,QuickFilterPreprocessor:()=>Me,QuickFilterPreprocessorService:()=>x,QuickFilterValueAttributeUpdaterService:()=>z,SearchFilterPreprocessor:()=>Re,SearchFilterPreprocessorService:()=>J,ShellHeaderPreprocessor:()=>Lt,WidgetDataProvidingPostprocessor:()=>qe,WidgetDataProvidingPostprocessorModule:()=>k,WidgetDataProvidingPreprocessor:()=>Ue,WidgetDataProvidingPreprocessorModule:()=>B,WidgetPreprocessorsModule:()=>G,findViewModelAttributeByModelPath:()=>Gt,getDataSourceFilterAttribute:()=>tr,getDefaultPagingConfig:()=>Zt,getPaginationChange:()=>Wt,getSearchFilterAttributeName:()=>rr});var kt=N(31134),F=N(33177),A=N(41307),f=N(34038),v=N(46338),p=N(49475),g=N(24709),u=N(8239),_=N(21322);function Wt(c){return{request:"crt.LoadDataRequest",params:{dataSourceName:c,parameters:[]}}}function Zt(){return{rowCount:30}}var b=N(75378);class E{static _getMasterRecordEntitySchemaName(e,t,r){if(!e?.startsWith("$"))return Promise.resolve(null);const i=e.substring(1),a=t.viewModelConfig.attributes&&t.viewModelConfig.attributes[i];if(!a)return Promise.resolve(null);let o="";a&&(0,g.isModelAttributeConfig)(a)&&(o=a.modelConfig?.path??"");const n=o?.split("."),l=n?.shift()||"",d=n?.pop()||"";return E.getDataSchemaName({models:r,schema:t,dataSourceName:l,attributeName:d})}static _findRelatedPath(e,t){const r=e.split(".");if(r.length!==2)return;const i=r[0],a=r[1],o=t.modelConfig?.dataSources,l=(o&&o[i])?.config?.attributes,d=l&&l[a];if(!!d?.path)return`${i}.${d.path}`}static _getRelativeAttributePath(e,t){const i=(t.viewModelConfig.attributes||{})[e]??{};if(!i||!(0,g.isModelAttributeConfig)(i)||!i.modelConfig?.path)return;const a=i.modelConfig.path;return this._findRelatedPath(a,t)||a}static _createDependency(e,t){return[{attributePath:t,relationPath:e}]}static _getReferenceColumnName(e){return e.masterRecordColumnName||e.recordColumnName}static getDataSchemaName(e){var t=this;return(0,u.Z)(function*(){const r=yield t.getDataSchema(e.models,e.dataSourceName);return r?e.attributeName&&r?.attributes.find(a=>a.name===e.attributeName)?.referenceSchemaName||r?.name:(e.schema.modelConfig?.dataSources&&e.schema.modelConfig?.dataSources[e.dataSourceName])?.config?.entitySchemaName})()}static getDataSchema(e,t){const r=e.find(i=>i.getDataSource()?.dataSourceName===t);return(0,_.firstValueFrom)(r?.getSchema()||(0,_.of)(null))}static getDataSourcePrimaryAttribute(e,t="Id"){const r=e.modelConfig?.primaryDataSourceName;if(!r)return"";const i=e.viewModelConfig?.attributes;return i&&!i[t]&&(i[t]={modelConfig:{path:`${r}.${t}`}}),t}static getDataSourceNameByAttribute(e){if(!e?.startsWith("$"))return null;const t=e.substring(1);return this.getAttributeDSName(t)}static getAttributeDSName(e){return`${e}${g.DATA_SOURCE_PREFIX}`}static createDataSourceConfig(e){return{type:"crt.EntityDataSource",scope:b.DataSourceScope.ViewElement,config:{entitySchemaName:e}}}static getRecordEntitySchemaName(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=E.getDataSourceNameByAttribute(e);return!o||!!!(yield E.getDataSchema(i,o))?.findAttributeByName(a._recordSchemaNameColumnName)?Promise.resolve(null):a._getMasterRecordEntitySchemaName(t,r,i)})()}static addDependencies(e,t,r){const i=e.modelConfig?.dependencies||{};if(!i[r]&&t.masterRecordColumnValue){const a=t.masterRecordColumnValue.split("$")[1];if(!a)return;const o=this._getRelativeAttributePath(a,e);if(!o)return;const n=this._getReferenceColumnName(t);if(!n)return;i[r]=this._createDependency(o,n),e.modelConfig=e.modelConfig||{},e.modelConfig.dependencies=i}}}E._recordSchemaNameColumnName="RecordSchemaName";const Kt="SysFile";function _r(c){const e=[];return c.forEach(t=>{const r={expressionType:2,parameter:{dataValueType:10,value:{Id:t,value:t}}};e.push(r)}),e}function er(c){const e=[],t={expressionType:2,parameter:{dataValueType:1,value:c}};return e.push(t),e}function tr(c,e,t,r){const i={};if(c?.length){const a=(0,b.generateGuid)(),o={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"FileGroup"},isAggregative:!1,dataValueType:10,referenceSchemaName:"FileGroup",rightExpressions:_r(c)};i[a]=o}if(e?.trim()){const a=(0,b.generateGuid)(),o={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"Tag"},isAggregative:!1,dataValueType:2,rightExpressions:er(e)};i[a]=o}if(r&&t===Kt){const a=(0,b.generateGuid)(),o={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"RecordSchemaName"},isAggregative:!1,dataValueType:2,rightExpressions:er(r)};i[a]=o}return Object.getOwnPropertyNames(i).length?{value:{items:i,logicalOperation:0,isEnabled:!0,filterType:6,rootSchemaName:t||Kt}}:null}function rr(c,e){return`${c}_${e}`}function Gt(c,e){let t="";return e&&Object.keys(c).forEach(r=>{const i=c[r];i&&(0,g.isModelAttributeConfig)(i)&&i.modelConfig?.path===e&&(t=r)}),t}var s=N(94450);class He{get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._actionDashboardPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._dcmSettingsService=t,this._actionDashboardPreprocessingDisableFeature="DisableActionDashboardPreprocessing"}_addStageAttribute(e,t,r){const i=e.viewModelConfig.attributes||{},a=`${r}.${t}`;if(!Gt(i,a)){const o=`LookupAttribute_${t}`;i[o]={modelConfig:{path:a}},e.viewModelConfig.attributes=i}}_extendWithDcmStageAttribute(e,t){var r=this;return(0,u.Z)(function*(){const i=yield(0,_.lastValueFrom)(r._dcmSettingsService.getStageColumnName(t.viewConfig.entitySchemaName),{defaultValue:null});i&&r._addStageAttribute(e,i,t.viewConfig.dataSourceName)})()}_extendWithPrimaryValueAttribute(e,t,r,i){const a=e.viewModelConfig.attributes||{},o=`${r}.${i}`;let n=Gt(a,o);n||(n=`ActionDashboard_${i}`,a[n]={modelConfig:{path:o}},e.viewModelConfig.attributes=a),t.viewConfig.primaryColumnValue=`$${n}`}processItemsAsync(e,t,r){var i=this;return(0,u.Z)(function*(){if(!t)return;const a=e.map(function(){var o=(0,u.Z)(function*(n){const l=t.getDataSource(),d=yield(0,_.lastValueFrom)(t.getSchema());n.viewConfig.dataSourceName=l.dataSourceName,n.viewConfig.entitySchemaName=d.name,n.viewConfig.primaryDisplayColumnValue=`$${d.primaryDisplayAttributeName}`,yield i._extendWithDcmStageAttribute(r,n),i._extendWithPrimaryValueAttribute(r,n,l.dataSourceName,d.primaryAttributeName||"Id")});return function(n){return o.apply(this,arguments)}}());yield Promise.all(a)})()}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ActionDashboard",r.viewConfig).forEach(a=>{a.viewConfig.allowedActions||(a.viewConfig.allowedActions=(0,f.getDefaultDashboardActions)())}),e})()}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if((yield r.isProcessingDisabled)||t.length===0)return e;const i=e,a=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ActionDashboard",i.viewConfig),o=i.modelConfig?.primaryDataSourceName,n=t.find(l=>l.name===o);return yield r.processItemsAsync(a,n,i),e})()}}He.\u0275fac=function(e){return new(e||He)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(A.DcmSettingsService))},He.\u0275prov=s.\u0275\u0275defineInjectable({token:He,factory:He.\u0275fac});class Qe{get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState("DisableApprovalsPreprocessing"))}constructor(e,t){this._featureService=e,this._sysSettingsService=t,this._componentName="crt.Approval",this._dataLoadedAttributeSuffix="_DataLoaded",this._approvalMetricsAttributeSuffix="_ApprovalsMetrics",this._approvalChangedHandlerAttributeSuffix="_ApprovalChangedHandler",this._listAttributeSuffix="_ApprovalList"}_getApprovals(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getApprovalName(e){return e.name.replace(/\./g,"_")}_getAcceptApprovalSettingValue(){return(0,_.lastValueFrom)(this._sysSettingsService.getByCodes(["AcceptApprovalWithoutComment"]).pipe((0,_.pluck)("values"),(0,_.map)(e=>e.AcceptApprovalWithoutComment?.value)))}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const i=e,a=r._getApprovals(i);for(const o of a){const n=o?.viewConfig;let l=i.viewModelConfig.attributes;l||(l=i.viewModelConfig.attributes={});const d=r._getApprovalName(n);l[`${d}${r._listAttributeSuffix}`]={value:null},l[`${d}${r._approvalMetricsAttributeSuffix}`]={value:null},l[`${d}${r._dataLoadedAttributeSuffix}`]={value:!1},l[`${d}${r._approvalChangedHandlerAttributeSuffix}`]={value:!1}}return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){if(yield i.isProcessingDisabled)return e;const a=yield i._getAcceptApprovalSettingValue(),o=e,n=i._getApprovals(o);for(const l of n){const d=l?.viewConfig,m=i._getApprovalName(d),h=`${m}${i._listAttributeSuffix}`,y=`${m}${i._dataLoadedAttributeSuffix}`,C=`${m}${i._approvalChangedHandlerAttributeSuffix}`,P=`${m}${i._approvalMetricsAttributeSuffix}`;d.recordId="$Id",d.approval=`$${h}`,d.approvalsMetrics=`$${P}`,d.dataLoaded=`$${y}`,d.approvalChangedHandler=`$${C}`,d.loadData={request:"crt.ApprovalLoadDataRequest",params:{dataAttribute:h,dataMetricsAttribute:P,dataLoadedAttribute:y,config:"@event"}},a?d.approve={request:"crt.ApprovalActionHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:C}}:d.approve={request:"crt.ApprovalCofirmationHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:C}},d.reject={request:"crt.ApprovalCofirmationHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:C}}}return e})()}}Qe.\u0275fac=function(e){return new(e||Qe)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(A.SysSettingsService))},Qe.\u0275prov=s.\u0275\u0275defineInjectable({token:Qe,factory:Qe.\u0275fac});var M=N(77207);class ze{constructor(e,t){this._sysSettingsService=e,this._translateService=t,this._componentName="crt.ApprovalList"}_getApprovalLists(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getApprovalListName(e){return e.items?.slice(1)}_getAcceptApprovalSettingValue(){return(0,_.lastValueFrom)(this._sysSettingsService.getByCodes(["AcceptApprovalWithoutComment"]).pipe((0,_.pluck)("values"),(0,_.map)(e=>e.AcceptApprovalWithoutComment?.value)))}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){const i=e,a=r._getApprovalLists(i);for(const o of a){const n=o?.viewConfig;let l=i.viewModelConfig.attributes;l||(l=i.viewModelConfig.attributes={});const d=r._getApprovalListName(n);l[`${d}_ApprovalsList`]={value:[]},l[`${d}_EntityName`]={value:n.entityName}}return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=yield i._getAcceptApprovalSettingValue(),n=i._getApprovalLists(a);for(const l of n){const d=l?.viewConfig,m=i._getApprovalListName(d),h=`${m}_ApprovalsList`,y=`$${m}.${m}${g.DATA_SOURCE_PREFIX}_Id`,C=o?"crt.ApprovalListActionRequest":"crt.ApprovalListConfirmationRequest";d.recordId="$Id",d.rowToolbarItems=[{type:"crt.MenuItem",caption:i._translateService.instant("ApprovalList.ApproveButtonLabel"),icon:"approve-icon",iconColor:"accent",disabled:`${y} | crt.ToDisabledApprovalActionConverter: $${h}`,clicked:{request:C,params:{config:{id:y,schemaName:d.approvalEntityName,actionType:f.ApprovalActionType.Approve},loadDataConfig:{parentSchemaName:d.entityName,parentRecordId:"$Id"},approvalListAttributeName:h,viewElementName:m}}},{type:"crt.MenuItem",caption:i._translateService.instant("ApprovalList.RejectButtonLabel"),icon:"reject-icon",iconColor:"warn",disabled:`${y} | crt.ToDisabledApprovalActionConverter: $${h}`,clicked:{request:"crt.ApprovalListConfirmationRequest",params:{config:{id:y,schemaName:d.approvalEntityName,actionType:f.ApprovalActionType.Reject},loadDataConfig:{parentSchemaName:d.entityName,parentRecordId:"$Id"},approvalListAttributeName:h,viewElementName:m}}}],d.reloadData={request:"crt.ApprovalListReloadRequest",params:{config:"@event",viewElementName:m}}}return e})()}}ze.\u0275fac=function(e){return new(e||ze)(s.\u0275\u0275inject(A.SysSettingsService),s.\u0275\u0275inject(M.TranslateService))},ze.\u0275prov=s.\u0275\u0275defineInjectable({token:ze,factory:ze.\u0275fac});class jt{hasEntityEditPage(e,t){return(0,u.Z)(function*(){const r={type:"crt.7XRequest",action:"HasEntityEditPage",$context:e,payload:{entityName:t}};return yield b.HandlerChainService.instance.process(r)})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){return yield Promise.all((0,v.getDataGridViewConfigsWithItemsBinding)(e,i.viewItemTypes).filter(a=>!a.rowToolbarItems).map(a=>i.setRowToolbarMenuItems(a,r))),e})()}}class X extends jt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var r=this;return(0,u.Z)(function*(){const i=e.items.slice(1),a=t.getBoundDataSourceNameByAttributePath(i),o=t.getBoundDataSchemaByAttributePath(i)?.name,n=yield r.hasEntityEditPage(t,o),l=`$${i}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:r._translateService.instant("DataGrid.RowToolbar.Open"),icon:"edit-row-action",visible:n,disabled:l,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${a}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:r._translateService.instant("DataGrid.RowToolbar.Copy"),icon:"copy-row-action",visible:n,disabled:l,clicked:{request:"crt.CopyRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${a}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:r._translateService.instant("DataGrid.RowToolbar.Delete"),icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${a}_Id`},useRelativeContext:!1}}]})()}}X.\u0275fac=function(e){return new(e||X)(s.\u0275\u0275inject(M.TranslateService))},X.\u0275prov=s.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac});var I=N(52045);class K{constructor(e){this._dataGridDefaultBulkActionsCreator=e,this.viewItemTypes=["crt.DataGrid"]}_setDefaultBulkActions(e,t){const r=(0,I.parseExpression)(e.items).attributePath;if(!r)return;const a=t[r]?.modelConfig?.path;!a||(e.bulkActions=this._dataGridDefaultBulkActionsCreator.createDefaultBulkActions(a,e))}crtOnMetaDataInit(e){const t=e,r=t.viewModelConfig.attributes??{};return(0,v.getDataGridViewConfigsWithItemsBinding)(t,this.viewItemTypes).filter(i=>i.bulkActions===void 0).forEach(i=>{this._setDefaultBulkActions(i,r)}),Promise.resolve(e)}}K.\u0275fac=function(e){return new(e||K)(s.\u0275\u0275inject(f.DataGridDefaultBulkActionsCreator))},K.\u0275prov=s.\u0275\u0275defineInjectable({token:K,factory:K.\u0275fac});var S=N(97600);class Je{constructor(e){this._dataGridDefaultBulkActionsCreator=e,this.viewItemTypes=["crt.DataGrid"]}_clearDefaultBulkActions(e,t){const r=(0,I.parseExpression)(e.items).attributePath;if(!r)return;const a=t[r]?.modelConfig?.path;if(!a)return;const o=this._dataGridDefaultBulkActionsCreator.createDefaultBulkActions(a,e);o&&(0,S.isEqual)(e.bulkActions,o)&&(e.bulkActions=void 0)}crtOnMetaDataChanged(e){const t=e,r=t.viewModelConfig.attributes??{};return(0,v.getDataGridViewConfigsWithItemsBinding)(t,this.viewItemTypes).forEach(i=>{this._clearDefaultBulkActions(i,r)}),Promise.resolve(e)}}Je.\u0275fac=function(e){return new(e||Je)(s.\u0275\u0275inject(f.DataGridDefaultBulkActionsCreator))},Je.\u0275prov=s.\u0275\u0275defineInjectable({token:Je,factory:Je.\u0275fac});class j{}j.\u0275fac=function(e){return new(e||j)},j.\u0275mod=s.\u0275\u0275defineNgModule({type:j}),j.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_PREPROCESSOR,useClass:K,multi:!0},{provide:g.CRT_METADATA_POSTPROCESSOR,useClass:Je,multi:!0}]});var R=N(14537),Ht=N(96578);class ${constructor(e,t,r,i,a,o){this._comboboxDropdownPageSizeService=e,this._translateService=t,this._dataSchemaRepository=r,this._rightsService=i,this._featureValues=a,this._window=o,this._disableLookupSelectionWindowFeatureName="DisableLookupSelectionWindow"}_getBindedAttributeName(e){return e.slice(1).split(".").pop()||""}_setComboboxShowListEvent(e,t){e.showList||(e.showList=this._createLoadDataRequestConfig(t),e.showList.params={...e.showList.params,config:{loadType:b.DataSourceLoadType.Reload}})}_setComboboxPaginationChange(e,t){e.paginationChange||(e.paginationChange=this._createLoadDataRequestConfig(t))}_createLoadDataRequestConfig(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:`${e}_DS`,parameters:[],primaryDisplayFilterValue:"@event.filterValue"},useRelativeContext:!0}}_setComboboxListActions(e,t){if(!e.listActions&&(e.listActions=[],e.isAddAllowed)){const i={...f.defaultAddRecordActionConfig,name:F.NameGenerator.generateUnique("ListAction")};e.listActions.push(i)}const r=this._findAddRecordListAction(e);if(r){const i=e.attributeName;r.clicked.params={itemsAttributeName:`${t}`,attributeName:`${i}`,detail:"@event.detail"}}}_findAddRecordListAction(e){return e?.listActions?.find(t=>t.code===f.ComboboxActionCodeEnum.AddRecord)}_setComboboxControlActions(e,t){if(!e.controlActions&&(e.controlActions=[],e.isGoToSourceAllowed)){const a={...f.defaultGoToRecordListActionConfig,name:F.NameGenerator.generateUnique("ControlAction")};e.controlActions.push(a)}const r=e.controlActions.find(a=>a.code===f.ComboboxActionCodeEnum.GoToRecordList);r&&(r.clicked.params={itemsAttributeName:`${t}`});const i=e.controlActions.find(a=>a.code===f.ComboboxActionCodeEnum.OpenLookupPage);i&&(i.clicked.params={itemsAttributeName:`${t}`,itemAttributeName:`${e.attributeName}`})}_getReferenceSchemaName(e,t){const r=t[`${e.attributeName}_List`];return r&&"embeddedModel"in r&&r.embeddedModel?.config?.config?.entitySchemaName}_setComboboxLinkViewConfig(e,t){const r=e.items.slice(1),i=this._getReferenceSchemaName(e,t),a=this._translateService.instant("ComboBox.EmptyDisplayValue"),o=e.attributeName;e.linkViewConfig={type:"crt.Link",mode:"preventDefault",caption:`$${o} | crt.ToObjectProp : 'displayValue' : '${a}'`,href:`$${o} | crt.ToObjectProp : 'value' | crt.ToRecordLinkAsync : '${r}'`,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:o,recordId:`$${o} | crt.ToObjectProp : 'value'`,entityName:i}}}}_setComboboxConfig(e,t){this._setComboboxShowListEvent(e,t),this._setComboboxListActions(e,t),this._setComboboxControlActions(e,t),this._setComboboxPaginationChange(e,t)}_checkEditPagesAndExtendWithLinkViewConfig(e,t,r){var i=this;return(0,u.Z)(function*(){yield Promise.all(e.filter(a=>a.showValueAsLink).map(function(){var a=(0,u.Z)(function*(o){(yield i._hasEditPage(o,t,r))&&i._setComboboxLinkViewConfig(o,t)});return function(o){return a.apply(this,arguments)}}()))})()}_addListAttribute(e,t){const r=e[t];e[t]={isCollection:!0,isLookup:!0,...r}}_addBusinessRuleListFilterAttribute(e,t){const r=(0,p.getBusinessRuleFilterAttributeName)(t);e[r]||(e[r]={value:{}})}_setEmbeddedModel(e,t){var r=this;return(0,u.Z)(function*(){const{vmListAttribute:i,model:a,comboboxAttributeName:o,vmAttribute:n}=e,m=(yield(0,_.lastValueFrom)(a.getSchema(),{defaultValue:null}))?.attributes?.find(({name:h})=>h===t)?.referenceSchemaName;!m||(i.embeddedModel=r._createEmbeddedModel((0,p.getItemsAttributeName)(o),m,n.modelConfig?.showDeactivatedRecords))})()}_setViewModelConfig(e,t){var r=this;return(0,u.Z)(function*(){const{vmListAttribute:i,model:a,comboboxAttributeName:o}=e,l=(yield(0,_.lastValueFrom)(a.getSchema(),{defaultValue:null}))?.findAttributeByName(t);if(!l){i.viewModelConfig={attributes:{value:{},displayValue:{},primaryColorValue:{}}};return}const d=yield r._getDataSchema(l?.referenceSchemaName),m=r._createViewModelConfig((0,p.getItemsAttributeName)(o),d);d?.primaryColorAttributeName&&(m.attributes.primaryColorValue={modelConfig:{path:`${(0,p.getItemsAttributeName)(o)}_DS.${d?.primaryColorAttributeName}`}}),i.viewModelConfig=m})()}_getFilterAttributes(e,t){const r=e.modelConfig,i={name:(0,p.getBusinessRuleFilterAttributeName)((0,p.getItemsAttributeName)(t)),loadOnChange:!0},a=r?.filterAttributes??[];return a.find(o=>o.name===i.name)||a.push(i),a}_setModelConfig(e,t){var r=this;return(0,u.Z)(function*(){const{vmListAttribute:i,model:a,comboboxAttributeName:o}=e,n=yield r._getModelConfigDefaultSorting(a,t),l=yield r._comboboxDropdownPageSizeService.getPageSize(),d=r._getFilterAttributes(i,o),m=r._createModelConfig((0,p.getItemsAttributeName)(o),n,l,d);r._mergeModelConfig(i,m)})()}_getModelConfigDefaultSorting(e,t){var r=this;return(0,u.Z)(function*(){const i=[],o=(yield(0,_.lastValueFrom)(e.getSchema(),{defaultValue:null}))?.findAttributeByName(t);if(o){const n=yield r._getDataSchema(o.referenceSchemaName);i.push(r._getDefaultSorting(n))}return i})()}_getDefaultSorting(e){return{columnName:e?.primaryDisplayAttributeName,direction:"asc"}}_getDataSchema(e){var t=this;return(0,u.Z)(function*(){let r;try{r=yield(0,_.lastValueFrom)(t._dataSchemaRepository.get(e),{defaultValue:null})}catch{r=null}return Promise.resolve(r)})()}_mergeModelConfig(e,t){const r=e.modelConfig;e.modelConfig=(0,S.merge)(t,r)}_getComboboxLookupModeFromDataSchema({attribute:e,models:t}){return(0,u.Z)(function*(){const r=e.modelConfig?.path.split(".")[0],i=e.modelConfig?.path.split(".").pop(),a=t.find(d=>d.name===r),n=(yield(0,_.lastValueFrom)(a.getSchema(),{defaultValue:null}))?.findAttributeByName(i),l=Ht.LookupMode.List;return n?.lookupMode??l})()}_setComboboxMode({viewConfig:e,attributes:t,models:r,comboboxAttributeName:i}){var a=this;return(0,u.Z)(function*(){const o=!a._featureValues[a._disableLookupSelectionWindowFeatureName];if(!(0,S.get)(a._window,"Terrasoft")?.isAngularHost||!o){e.mode=Ht.LookupMode.List;return}const l=t[i]??{};!(0,g.isModelAttributeConfig)(l)||(e.mode===void 0&&(e.mode=yield a._getComboboxLookupModeFromDataSchema({attribute:l,models:r})),e.mode===Ht.LookupMode.SelectionWindow&&a._setSelectionWindowAction(e,t))})()}_setComboboxListAttribute({attributes:e,models:t,comboboxAttributeName:r}){var i=this;return(0,u.Z)(function*(){const a=e[r]??{};if(!(0,g.isModelAttributeConfig)(a))return;const o=a.modelConfig?.path.split(".")[0],n=a.modelConfig?.path.split(".").pop(),l=e[(0,p.getItemsAttributeName)(r)],d=t.find(h=>h.name===o),m={vmListAttribute:l,model:d,comboboxAttributeName:r,vmAttribute:a};yield i._setEmbeddedModel(m,n),yield i._setViewModelConfig(m,n),yield i._setModelConfig(m,n)})()}_setComboboxListSortingAttribute(e,t){const r=this._getComboboxListSortingAttributeName(t),i=e[r];e[r]={...i,isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}}}_getComboboxListSortingAttributeName(e){return`${e}_Sorting`}_hasEditPage(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getReferenceSchemaName(e,t);if(!a)return Promise.resolve(!1);const o={type:"crt.7XRequest",action:"HasEntityEditPage",$context:r,payload:{entityName:a}};return yield b.HandlerChainService.instance.process(o)})()}_createAttributeConfigByDataSchema(e,t){var r=this;return(0,u.Z)(function*(){const i=[r._getDefaultSorting(t)],a=yield r._comboboxDropdownPageSizeService.getPageSize();return{isCollection:!0,embeddedModel:r._createEmbeddedModel(e,t.name),viewModelConfig:r._createViewModelConfig(e,t),modelConfig:r._createModelConfig(e,i,a,[])}})()}_createAndAddFilterAttribute(e,t,r){const i=`${t}_Filter`,n=((e[t]||{}).modelConfig||{}).filterAttributes||[];!!n.find(d=>d.name===i)||n.push({name:i,loadOnChange:!0}),e[i]={value:r}}_createEmbeddedModel(e,t,r=!1){return{name:`${e}_DS`,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t,useRecordDeactivation:!r}}}}_createViewModelConfig(e,t){return{attributes:{value:{modelConfig:{path:`${e}_DS.${t?.primaryAttributeName}`}},displayValue:{modelConfig:{path:`${e}_DS.${t?.primaryDisplayAttributeName}`,ignoreValidators:!this._featureValues.DisableIgnoreLookupsDisplayValueValidators}}}}}_createModelConfig(e,t,r,i){return{path:`${e}_DS`,sortingConfig:{attributeName:this._getComboboxListSortingAttributeName(e),default:t},pagingConfig:{rowCount:r,rowsOffset:null},filterAttributes:i}}_getFiltersConfig(e,t){const i=e[t]?.modelConfig?.filterAttributes;if(!i)return null;const a={};return i.forEach(o=>{a[o.name]={value:"$"+o.name}}),{filterAttributes:i,attributesConfig:a}}_setSelectionWindowAction(e,t){const r=(0,p.getItemsAttributeName)(e.control).slice(1),i=e.attributeName;if(!r||!i)return;const a=this._getFiltersConfig(t,r),o=!!this._findAddRecordListAction(e),n=t[i]??{},l=Boolean(n.modelConfig?.showDeactivatedRecords);e.selectionWindowIconPressed={request:"crt.OpenLookupPageRequest",params:{itemsAttributeName:r,itemAttributeName:i,filtersConfig:a,features:{showDeactivatedRecords:l,create:{enabled:o}}}}}_actualizeComboboxAddRecordAction(e,t,r){var i=this;return(0,u.Z)(function*(){if(i._featureValues.DisableCheckingForAddRecordActionInCombobox)return;const a=e.filter(d=>!!i._findAddRecordListAction(d)),o=yield i._getViewConfigsWithEditPage(a,t,r),n=i._getDifferentElementsInConfigCollections(a,o),l=yield i._getIsNotAllowedAddRecordActionViewConfigs(o,t);[...n,...l].forEach(d=>i._disableAddRecordAction(d))})()}_getDifferentElementsInConfigCollections(e,t){return e.filter(r=>!t.some(i=>r.attributeName===i.attributeName))}_getViewConfigsWithEditPage(e,t,r){var i=this;return(0,u.Z)(function*(){return(yield Promise.all(e.map(function(){var a=(0,u.Z)(function*(o){return(yield i._isViewConfigIfWithoutEditPage(o,t,r))?null:o});return function(o){return a.apply(this,arguments)}}()))).filter(a=>!!a)})()}_isViewConfigIfWithoutEditPage(e,t,r){var i=this;return(0,u.Z)(function*(){return!i._getReferenceSchemaName(e,t)||!(yield i._hasEditPage(e,t,r))})()}_getIsNotAllowedAddRecordActionViewConfigs(e,t){var r=this;return(0,u.Z)(function*(){if(!e||e.length===0)return[];const i=yield r._getIsNotAllowedAddRecordActionSchemaNames(e,t);return e.filter(a=>i.includes(r._getReferenceSchemaName(a,t)))})()}_getIsNotAllowedAddRecordActionSchemaNames(e,t){var r=this;return(0,u.Z)(function*(){const i=[...new Set(e?.map(o=>r._getReferenceSchemaName(o,t)))];return(yield(0,_.lastValueFrom)(r._rightsService.getCanAdd(i).pipe((0,_.catchError)(()=>(0,_.of)(null)))))?.filter(o=>!o.result).map(o=>o.schemaName)??[]})()}_disableAddRecordAction(e){this._removeAddRecordAction(e),this._disableAddRecordInSelectionWindow(e)}_removeAddRecordAction(e){const t=this._findAddRecordListAction(e);e.listActions=e.listActions.filter(r=>r!==t)}_disableAddRecordInSelectionWindow(e){const r=(e.selectionWindowIconPressed?.params?.features||{}).create||{};r.enabled=!1}crtOnMetaDataInit(e,t){e=e.filter(r=>(0,R.isBindToViewModelAttribute)(r.control,t)),e.forEach(r=>{const i=r.control,a=this._getBindedAttributeName(i),o=r.items,n=(0,p.getItemsAttributeName)(a);if((0,R.isBindToViewModelAttribute)(o,t)){const l=o.slice(1).split(".").pop();t[l].isLookup=!0}else this._addListAttribute(t,n),r.items=(0,p.getItemsAttributeName)(i);this._addBusinessRuleListFilterAttribute(t,n),r.attributeName=a,this._setComboboxConfig(r,n)})}crtOnModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){e=e.filter(a=>(0,R.isBindToViewModelAttribute)(a.control,t)),yield Promise.all(e.map(function(){var a=(0,u.Z)(function*(o){const n=i._getBindedAttributeName(o.control);i._setComboboxListSortingAttribute(t,(0,p.getItemsAttributeName)(n)),yield i._setComboboxListAttribute({attributes:t,models:r,comboboxAttributeName:n}),yield i._setComboboxMode({viewConfig:o,attributes:t,models:r,comboboxAttributeName:n})});return function(o){return a.apply(this,arguments)}}()))})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){e=e.filter(a=>(0,R.isBindToViewModelAttribute)(a.items,t)),yield i._checkEditPagesAndExtendWithLinkViewConfig(e,t,r),yield i._actualizeComboboxAddRecordAction(e,t,r)})()}setupComboboxMetadataByEntitySchema(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=yield a._getDataSchema(r);if(!o)return;const n=(0,p.getItemsAttributeName)(e.name);t[n]=yield a._createAttributeConfigByDataSchema(n,o),i&&a._createAndAddFilterAttribute(t,n,i),a._setComboboxListSortingAttribute(t,n),e.items=`$${n}`,a._setComboboxShowListEvent(e,n),a._setComboboxPaginationChange(e,n)})()}}$.\u0275fac=function(e){return new(e||$)(s.\u0275\u0275inject(f.ComboboxDropdownPageSizeService),s.\u0275\u0275inject(M.TranslateService),s.\u0275\u0275inject(g.DataSchemaRepositoryService),s.\u0275\u0275inject(A.RightsService),s.\u0275\u0275inject(p.FEATURE_VALUES),s.\u0275\u0275inject(F.WINDOW_TOKEN))},$.\u0275prov=s.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac});class Ye{constructor(e){this._comboboxPreprocessorService=e}_getComboboxesViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ComboBox",e.viewConfig).map(t=>t.viewConfig)}crtOnMetaDataInit(e){const t=e,r=t.viewModelConfig.attributes,i=this._getComboboxesViewConfigs(t);return this._comboboxPreprocessorService.crtOnMetaDataInit(i,r),Promise.resolve(e)}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){const i=e,a=i.viewModelConfig.attributes,o=r._getComboboxesViewConfigs(i);return yield r._comboboxPreprocessorService.crtOnModelInit(o,a,t),e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=a.viewModelConfig.attributes,n=i._getComboboxesViewConfigs(a);return yield i._comboboxPreprocessorService.crtOnViewModelInit(n,o,r),e})()}}Ye.\u0275fac=function(e){return new(e||Ye)(s.\u0275\u0275inject($))},Ye.\u0275prov=s.\u0275\u0275defineInjectable({token:Ye,factory:Ye.\u0275fac});const br={[b.DataValueType.Integer]:0,[b.DataValueType.FLOAT1]:1,[b.DataValueType.FLOAT2]:2,[b.DataValueType.FLOAT3]:3,[b.DataValueType.FLOAT4]:4,[b.DataValueType.FLOAT8]:8,[b.DataValueType.Money]:2};class q{process(e,t){const r=br[t]??null;r!==null&&!e.format&&(e.format={decimalPrecision:r})}}q.\u0275fac=function(e){return new(e||q)},q.\u0275prov=s.\u0275\u0275defineInjectable({token:q,factory:q.\u0275fac});class Xe{constructor(e){this._numberInputPreprocessorService=e}_process(e,t,r){const i=e.control.startsWith("$")?e.control.substring(1):"",a=t.attributes?.[i]??{};if(!(0,g.isModelAttributeConfig)(a))return;const o=a?.modelConfig?.path;if(!o)return;const l=this._getDataSchemaAttributeByPath(o,r)?.dataValueType;!l||this._numberInputPreprocessorService.process(e,l)}_getDataSchemaAttributeByPath(e,t){const[r,i]=e.split("."),a=t.dataSchemas[r]?.attributes;let o;for(const n in a)if(a[n].path===i){o=a[n];break}return o}crtOnViewModelInit(e,t,r){const i=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.NumberInput",i.viewConfig).forEach(o=>{this._process(o.viewConfig,i.viewModelConfig,r)}),Promise.resolve(e)}}Xe.\u0275fac=function(e){return new(e||Xe)(s.\u0275\u0275inject(q))},Xe.\u0275prov=s.\u0275\u0275defineInjectable({token:Xe,factory:Xe.\u0275fac});class ee{constructor(e,t,r,i,a){this._editingCellViewConfigCreatorFactory=e,this._featureService=t,this._metadataModifierService=r,this._comboboxPreprocessorService=i,this._numberInputPreprocessorService=a}_isEditingModeDisabled(){return(0,_.firstValueFrom)(this._featureService.getFeatureState(v.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_updateAttributeProperties(e,t,r){R.ViewElementConfigUtils.updateCollectionAttributeProperties(t,e,r,[{name:"readonly",defaultValue:!1}])}_addColumnsEditingCellViewConfigs(e,t,r,i=!1){var a=this;return(0,u.Z)(function*(){const o=e.columns;if(!Array.isArray(o))return;const n=e.items,l=o.filter(d=>!d.editingCellView);for(const d of l){const h=yield a._editingCellViewConfigCreatorFactory.create({dataValueType:d.dataValueType,columnName:d.code}).getViewElementConfig({column:d,itemsAttributeName:n,context:t});i&&h&&a._updateAttributeProperties(r,h,n),h&&a._metadataModifierService.addProperty(d,"editingCellView",h)}})()}_getColumnDefinitionByPredicate(e,t){return Array.isArray(e.columns)?(e.columns||[]).filter(t):[]}_getComboboxesViewConfigsFromDataGridViewConfig(e){return this._getDataGridComboBoxColumnDefinitions(e).map(t=>t.editingCellView)}_getDataGridComboBoxColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>Boolean(t.dataValueType===b.DataValueType.Lookup&&t.editingCellView))}_getDataGridNumberInputColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>Boolean(t.editingCellView?.type==="crt.DataTableEditNumericCell"))}_getDataGridItemsAttributeConfig(e,t){const r=(0,v.getViewModelItemsAttributeName)(e);return r?t.viewModelConfig.attributes[r]?.viewModelConfig?.attributes:void 0}_addEditableFeature(e,t){const r=e.features;if((0,I.isBindingExpression)(r))return;const i=(0,f.fullInDataTableEditingFeatures)(r?.editable,!t);if(!r)return this._metadataModifierService.addProperty(e,"features",{editable:i});const a=r.editable;if(a==null)return this._metadataModifierService.addProperty(r,"editable",i);typeof a!="boolean"&&(a.enable==null&&this._metadataModifierService.addProperty(a,"enable",i.enable),a.itemsCreation==null&&this._metadataModifierService.addProperty(a,"itemsCreation",a.enable&&i.itemsCreation),a.lookupItemsCreation==null&&this._metadataModifierService.addProperty(a,"lookupItemsCreation",a.enable&&i.lookupItemsCreation))}_comboboxesOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getComboboxesViewConfigsForOnViewModelInit(e,t);yield i._comboboxPreprocessorService.crtOnViewModelInit(a,t,r)})()}_getComboboxesViewConfigsForOnViewModelInit(e,t){return e.map(r=>{const i=this._getComboboxesViewConfigsFromDataGridViewConfig(r);return this._addActionAddRecordToListActionsIfNeed(i,t,r),i}).flat(1)}_addActionAddRecordToListActionsIfNeed(e,t,r){const i=this._getLookupItemsCreationFeatureValue(r);!(!(0,S.isBoolean)(i)||i)||e.forEach(o=>this._addActionAddRecordToListActions(o,t))}_getLookupItemsCreationFeatureValue(e){return e.features?.editable?.lookupItemsCreation}_addActionAddRecordToListActions(e,t){const r=t[`${e.attributeName}_List`],i=r&&"embeddedModel"in r&&r.embeddedModel?.config?.config?.entitySchemaName;if(!i)return;const a=e.control.split(".").pop(),o={...f.defaultAddRecordActionConfig,clicked:{request:"crt.CreateRecordFromEditLookupCellRequest",params:{schemaName:i,attributeName:a,detail:"@event.detail"},useRelativeContext:!0},name:F.NameGenerator.generateUnique("ListAction")};this._addComboboxActionIfNotExist(e,f.ComboboxActionCodeEnum.AddRecord,o)}_addComboboxActionIfNotExist(e,t,r){e.listActions||(e.listActions=[]),!e.listActions.some(a=>a.code===t)&&e.listActions.push(r)}_numbersOnViewModelInit(e){this._getDataGridNumberInputColumnDefinitions(e).forEach(r=>{const i=r.dataValueType,a=r.editingCellView;this._numberInputPreprocessorService.process(a,i)})}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=yield t._isEditingModeDisabled(),a=(0,v.getDataGridViewConfigs)(e);for(const o of a){if(t._addEditableFeature(o,i),i)continue;yield t._addColumnsEditingCellViewConfigs(o,null,r,!0);const n=t._getDataGridItemsAttributeConfig(o,e);if(!n)continue;const l=t._getComboboxesViewConfigsFromDataGridViewConfig(o);t._comboboxPreprocessorService.crtOnMetaDataInit(l,n)}return e})()}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r._isEditingModeDisabled())return e;const i=(0,v.getDataGridViewConfigs)(e);for(const a of i){const o=r._getDataGridItemsAttributeConfig(a,e);if(!o)continue;const n=r._getComboboxesViewConfigsFromDataGridViewConfig(a);yield r._comboboxPreprocessorService.crtOnModelInit(n,o,t)}return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){if(yield i._isEditingModeDisabled())return e;const a=e,o=(0,v.getDataGridViewConfigs)(e);let n={};const l=[];for(const d of o){const m=i._getDataGridItemsAttributeConfig(d,e);!m||(n={...n,...m},l.push(d),yield i._addColumnsEditingCellViewConfigs(d,r,a),i._numbersOnViewModelInit(d))}return yield i._comboboxesOnViewModelInit(l,n,r),e})()}}ee.\u0275fac=function(e){return new(e||ee)(s.\u0275\u0275inject(v.DATA_GRID_EDITING_CELL_VIEW_CONFIG_CREATOR_FACTORY),s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(g.MetadataModifierService),s.\u0275\u0275inject($),s.\u0275\u0275inject(q))},ee.\u0275prov=s.\u0275\u0275defineInjectable({token:ee,factory:ee.\u0275fac});var O=N(27049);class L{constructor(e,t,r){this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=r,this.featureName="DisableDataGridColumnsPreprocessing",this.viewItemTypes=["crt.DataGrid"]}_getColumnDefinitions(e,t){var r=this;return(0,u.Z)(function*(){const i=e.columns,a=yield r.getGenerateCellViewConfig(e,t);return a?yield(0,_.lastValueFrom)(r.dataGridColumnDefinitionService.processDataGridColumnDefinitions(a,i)):[]})()}_addColumnsCellViewConfigs(e,t){var r=this;return(0,u.Z)(function*(){const i=e.columns;if(!Array.isArray(i)||i.length===0)return;const a=yield r._getColumnDefinitions(e,t);r._addColumnProperty(i,a,"cellView"),r._addColumnProperty(i,a,"readonly")})()}_addColumnProperty(e,t,r){e.filter(i=>!i[r]).map(i=>[i,t.find(a=>a.code===i.code)]).forEach(([i,a])=>this.metadataModifierService.addProperty(i,r,a?.[r]))}getGenerateCellViewConfig(e,t){const r=(0,_.of)(t),i=(0,v.getViewModelItemsAttributeName)(e);if(!i)return Promise.resolve(null);const a=r.pipe((0,O.map)(l=>l?.getBoundDataSourceNameByAttributePath(i))),o=r.pipe((0,O.map)(l=>l?.getBoundDataSchemaByAttributePath(i))),n=e.items;return(0,_.lastValueFrom)((0,_.forkJoin)([a,o]).pipe((0,O.switchMap)(([l,d])=>l&&d?(0,_.of)({dataSchema:d,dataSourceName:l,itemsAttributeName:n,viewModel:t,features:e.features,dataGridName:e.name}):(0,_.of)(null))))}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){if(yield(0,_.lastValueFrom)(i.featureService.getFeatureState(i.featureName),{defaultValue:null}))return e;const o=p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",i.viewItemTypes,e.viewConfig);for(const n of o)yield i._addColumnsCellViewConfigs(n.viewConfig,r);return e})()}}L.\u0275fac=function(e){return new(e||L)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(g.MetadataModifierService),s.\u0275\u0275inject(v.DataGridColumnDefinitionService))},L.\u0275prov=s.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac});class te{constructor(e){this._filterOptionsBackwardCompatibilityModifier=e}_isEmptyExposeFilters(e){const t=e?._filterOptions;return t?!t.expose?.length:!1}crtOnMetaDataInit(e){return(0,v.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(t=>this._isEmptyExposeFilters(t)).forEach(t=>this._filterOptionsBackwardCompatibilityModifier.modify(t)),Promise.resolve(e)}}te.\u0275fac=function(e){return new(e||te)(s.\u0275\u0275inject(f.DataGridFilterOptionsBackwardCompatibilityModifier))},te.\u0275prov=s.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac});class re{_setInitialFilterOptions(e){e.items??(e.items=`$${(0,f.createDataGridItemsAttributeName)(e)}`),e.activeRow??(e.activeRow=`$${(0,f.createDataGridActiveRowAttributeName)(e)}`);const t=(0,f.createDataGridInitialFilterOptions)(e);t&&(e._filterOptions=t)}_canSetInitialFilterOptions(e){return(0,S.isEmpty)(e?._filterOptions)&&(0,f.canDataGridContainsFilterOptions)(e)}crtOnMetaDataInit(e){return(0,v.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(this._canSetInitialFilterOptions).forEach(t=>this._setInitialFilterOptions(t)),Promise.resolve(e)}}re.\u0275fac=function(e){return new(e||re)},re.\u0275prov=s.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac});class Ke{}Ke.\u0275fac=function(e){return new(e||Ke)},Ke.\u0275mod=s.\u0275\u0275defineNgModule({type:Ke}),Ke.\u0275inj=s.\u0275\u0275defineInjector({providers:[f.DataGridFilterOptionsBackwardCompatibilityModifier,{provide:g.CRT_METADATA_PREPROCESSOR,useClass:re,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:te,multi:!0}]});class et{_cleanupDefaultFilterOptionsMetadata(e){const t=e._filterOptions;if(!t)return this._cleanupDefaultActiveRow(e);const r=(0,S.cloneDeep)(e),i=`$${(0,f.createDataGridActiveRowAttributeName)(e)}`;r.activeRow??(r.activeRow=i);const a=(0,f.createDataGridInitialFilterOptions)(r);!(0,S.isEqual)(t,a)||(delete e._filterOptions,this._cleanupDefaultActiveRow(e))}_cleanupDefaultActiveRow(e){const t=e.activeRow,r=`$${(0,f.createDataGridActiveRowAttributeName)(e)}`;(0,S.isEqual)(t,r)&&delete e.activeRow}crtOnMetaDataChanged(e){return(0,v.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultFilterOptionsMetadata(t)),Promise.resolve(e)}}et.\u0275fac=function(e){return new(e||et)},et.\u0275prov=s.\u0275\u0275defineInjectable({token:et,factory:et.\u0275fac});class tt{}tt.\u0275fac=function(e){return new(e||tt)},tt.\u0275mod=s.\u0275\u0275defineNgModule({type:tt}),tt.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_POSTPROCESSOR,useClass:et,multi:!0}]});class ie{constructor(e,t){this._defaultFeatures=e,this._translateService=t}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=(0,v.getDataGridViewConfigs)(e).filter(i=>!i.headerToolbarItems);for(const i of r)i.headerToolbarItems=[{type:"crt.MenuItem",caption:t._translateService.instant("DataGrid.ActionsToolbar.ResetToDefault"),icon:"reset",clicked:{request:"crt.DataGridResetConfigsToDefaultRequest",params:{dataGridName:i.name}}}],t._defaultFeatures?.operations?.canCreateDefaultGridSettings&&i.headerToolbarItems.unshift({type:"crt.MenuItem",caption:t._translateService.instant("DataGrid.ActionsToolbar.SaveForAll"),icon:"save",clicked:{request:"crt.DataGridSaveConfigsForAllRequest",params:{dataGridName:i.name}}});return e})()}}ie.\u0275fac=function(e){return new(e||ie)(s.\u0275\u0275inject(f.DATA_GRID_FEATURES,8),s.\u0275\u0275inject(M.TranslateService))},ie.\u0275prov=s.\u0275\u0275defineInjectable({token:ie,factory:ie.\u0275fac});class ae{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,_.firstValueFrom)(this._featureService.getFeatureState(v.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_setCancelItemsChangesOutput(e){const t=e.items.slice(1);e.cancelItemsChanges={request:"crt.DataGridCancelItemsChangesRequest",params:{itemsAttributeName:t,changedItems:"@event"}}}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){return(yield t._isEditingModeDisabled())||(0,v.getDataGridViewConfigsWithItemsBinding)(e).filter(r=>r.cancelItemsChanges==null).forEach(r=>t._setCancelItemsChangesOutput(r)),e})()}}ae.\u0275fac=function(e){return new(e||ae)(s.\u0275\u0275inject(A.FeatureService))},ae.\u0275prov=s.\u0275\u0275defineInjectable({token:ae,factory:ae.\u0275fac});class oe{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,_.firstValueFrom)(this._featureService.getFeatureState(v.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_isItemsCreationEnabled(e){const t=e.features;if((0,I.isBindingExpression)(t))return!0;const r=(0,f.fullInDataTableEditingFeatures)(t?.editable,!0);return Boolean(r.itemsCreation)}_bindEditingCellsInput(e,t){if(e.editingCells)return;const r=e.name&&`${e.name}_EditingCells`;!r||(t[r]||(t[r]={value:null}),e.editingCells=`$${r}`)}_bindItemCreatingOutput(e,t,r){if(e.createItem)return;const i=this._getDefaultValuesFromDependencies(e,t,r);e.createItem={request:"crt.DataGridCreateItemRequest",params:{dataGridName:e.name,insertionIndex:"@event.index",defaultValues:i.map(({attributeName:a,value:o})=>({attributeName:a,value:o}))}}}_getDefaultValuesFromDependencies(e,t,r){const i=r.dependencies,a=r.dataSources,o=r.primaryDataSourceName||"",n=e.items.slice(1),d=t[n]?.modelConfig?.path,m=d&&i?.[d];return m?m.filter(h=>this._isDependOnPageDataSource(h,a)).map(h=>this._getDependencyAttributeName(h,t,o)).map((h,y)=>h||`${e.name}_DependencyValue_${y}`).map((h,y)=>{const C=m[y];return this._setDependencyViewModelAttribute(h,C,t),this._getDefaultValue(h,C,a)}):[]}_getRelatedDataSourceName(e){return e.relationPath.split(".").shift()??""}_isDependOnPageDataSource(e,t){const r=this._getRelatedDataSourceName(e);return t?.[r]?.scope===b.DataSourceScope.Page}_getDefaultValue(e,t,r){const i=this._getRelatedDataSourceName(t),a=r?.[i]?.config||{},o=a.entitySchemaName?`$${e} | crt.ToLookup : '${a.entitySchemaName}'`:`$${e}`;return{attributeName:t.attributePath,value:o}}_setDependencyViewModelAttribute(e,t,r){r[e]||(r[e]={modelConfig:{path:t.relationPath}})}_getDependencyAttributeName(e,t,r){return Object.keys(t).find(i=>(t[i]?.modelConfig?.path||"").replace("#PrimaryDataSourceName()#",r)===e.relationPath)}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t._isEditingModeDisabled())return e;const r=e;r.viewModelConfig=r.viewModelConfig??{};const i=r.viewModelConfig.attributes=r.viewModelConfig.attributes||{},a=r.modelConfig||{};return(0,v.getDataGridViewConfigsWithItemsBinding)(r).filter(o=>t._isItemsCreationEnabled(o)).forEach(o=>{t._bindEditingCellsInput(o,i),t._bindItemCreatingOutput(o,i,a)}),e})()}}oe.\u0275fac=function(e){return new(e||oe)(s.\u0275\u0275inject(A.FeatureService))},oe.\u0275prov=s.\u0275\u0275defineInjectable({token:oe,factory:oe.\u0275fac});class ne{_bindItemDeletionOutput(e){const t=e.items.slice(1);e.deleteItem||!t||(e.deleteItem={request:"crt.DeleteRecordRequest",params:{itemsAttributeName:t,recordId:"@event.rowId"}})}crtOnMetaDataInit(e){const t=e;return t.viewModelConfig=t.viewModelConfig??{},(0,v.getDataGridViewConfigsWithItemsBinding)(t).forEach(r=>{this._bindItemDeletionOutput(r)}),Promise.resolve(e)}}ne.\u0275fac=function(e){return new(e||ne)},ne.\u0275prov=s.\u0275\u0275defineInjectable({token:ne,factory:ne.\u0275fac});class se{constructor(e){this._featureService=e,this._featureName="DisableDataGridEditingMode"}_isEditingModeDisabled(){return(0,_.firstValueFrom)(this._featureService.getFeatureState(v.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_setSaveItemsChangesOutput(e){const t=e.items.slice(1);e.saveItemsChanges={request:"crt.SaveRecordsRequest",params:{itemsAttributeName:t}}}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){return(yield t._isEditingModeDisabled())||(0,v.getDataGridViewConfigsWithItemsBinding)(e).filter(r=>r.saveItemsChanges==null).forEach(r=>t._setSaveItemsChangesOutput(r)),e})()}}se.\u0275fac=function(e){return new(e||se)(s.\u0275\u0275inject(A.FeatureService))},se.\u0275prov=s.\u0275\u0275defineInjectable({token:se,factory:se.\u0275fac});class ce{constructor(e){this._featureValues=e}_setOnChangeAttributeRequests(e,t){e.change??(e.change=[]),Array.isArray(e.change)||(e.change=[e.change]),e.change.push(...t)}_createActivateRowBusinessRulesRequest(e,t){return{request:"crt.DataGridActivateRowBusinessRulesRequest",params:{rowValueAttributeName:e,dataGridViewElementName:t.name}}}_getActiveRowAttributeName(e){let t=e.activeRow;return t==null&&(t=`$${(0,f.createDataGridActiveRowAttributeName)(e)}`),(0,I.isBindingExpression)(t)?(0,I.parseExpression)(t).attributePath:""}crtOnMetaDataInit(e){var t;if(this._featureValues.DisableActivateGridRowOnReload)return Promise.resolve(e);const i=(t=e.viewModelConfig).attributes??(t.attributes={});return(0,v.getDataGridViewConfigsWithItemsBinding)(e).forEach(a=>{const o=this._getActiveRowAttributeName(a);if(o){const n=[this._createActivateRowBusinessRulesRequest(o,a)],l=a.items.slice(1);this._setOnChangeAttributeRequests(i[l],n)}}),Promise.resolve(e)}}ce.\u0275fac=function(e){return new(e||ce)(s.\u0275\u0275inject(p.FEATURE_VALUES))},ce.\u0275prov=s.\u0275\u0275defineInjectable({token:ce,factory:ce.\u0275fac});class le{constructor(e){this._featureService=e,this._featureName="DisableDataGridPagingPreprocessing"}_setPaginationChange(e,t){if(e.paginationChange)return;const r=e.items?.slice(1),i=t.getBoundDataSourceNameByAttributePath(r);e.paginationChange=Wt(i)}_setPagingConfig(e,t){const r=e.items?.slice(1),i=(t?.viewModelConfig?.attributes)[r]??{};if(!(0,g.isModelAttributeConfig)(i))return;const a=i.modelConfig;!a||a?.pagingConfig||(a.pagingConfig=Zt())}get _isFeatureDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._featureName))}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t._isFeatureDisabled)return e;const r=e,i=(0,v.getDataGridViewConfigsWithItemsBinding)(e);for(const a of i)t._setPagingConfig(a,r);return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){if(yield i._isFeatureDisabled)return e;const a=(0,v.getDataGridViewConfigsWithItemsBinding)(e);for(const o of a)i._setPaginationChange(o,r);return e})()}}le.\u0275fac=function(e){return new(e||le)(s.\u0275\u0275inject(A.FeatureService))},le.\u0275prov=s.\u0275\u0275defineInjectable({token:le,factory:le.\u0275fac});class ue{constructor(e){this._featureService=e,this._featureName="DisableDataGridPlaceholderPreprocessing"}_setNoConfiguredPlaceholder(e){e.skeleton==null&&(e.skeleton=[{type:"crt.Placeholder",image:{type:"icon",icon:"data-table",width:null,height:null,padding:null},title:"",subhead:""}])}_setNoItemsPlaceholders(e,t,r){const i=t.placeholder,a=t.items?.split("$")?.pop(),o=this._getSearchFilterAttributesNames(r,a),l=[...this._getFilterAttributesNames(e,a),...o];if(!i?.length||!l.length)return;i.map(m=>m.visible).map(m=>(m??"")?.split("$")?.pop()).filter(Boolean).map(m=>e[m]).filter(Boolean).forEach(m=>m.from=(0,S.uniq)([...m.from,...l]))}_getFilterAttributesNames(e,t){const i=e[t]?.modelConfig?.filterAttributes??[];return Object.values(i).filter(a=>a.loadOnChange).filter(a=>!a.name.endsWith("_PredefinedFilter")).map(a=>a.name)}_getSearchFilterAttributesNames(e,t){return e.filter(r=>r.targetAttributes?.includes(t)).map(({name:r})=>rr(r,t))}_getSearchFilterViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield(0,_.lastValueFrom)(t._featureService.getFeatureState(t._featureName),{defaultValue:null}))return e;const i=e;i.viewModelConfig.attributes=i.viewModelConfig.attributes??{};const a=i.viewModelConfig.attributes,o=t._getSearchFilterViewConfigs(i);return(0,v.getDataGridViewConfigs)(e).forEach(n=>{(0,R.isBindToViewModelAttribute)(n.items,a)?t._setNoItemsPlaceholders(a,n,o):t._setNoConfiguredPlaceholder(n)}),e})()}}ue.\u0275fac=function(e){return new(e||ue)(s.\u0275\u0275inject(A.FeatureService))},ue.\u0275prov=s.\u0275\u0275defineInjectable({token:ue,factory:ue.\u0275fac});class de{_setOnChangeAttributeRequests(e,t){e.change??(e.change=[]),Array.isArray(e.change)||(e.change=[e.change]),e.change.push(...t)}_bindActiveRow(e,t){if(e.activeRow===void 0&&(e.activeRow=`$${(0,f.createDataGridActiveRowAttributeName)(e)}`),!(0,I.isBindingExpression)(e.activeRow))return;const r=(0,I.parseExpression)(e.activeRow).attributePath;t[r]||(t[r]={value:null});const i=[this._createActivateRowBusinessRulesRequest(r,e)];this._setOnChangeAttributeRequests(t[r],i)}_createActivateRowBusinessRulesRequest(e,t){return{request:"crt.DataGridActivateRowBusinessRulesRequest",params:{rowValueAttributeName:e,dataGridViewElementName:t.name}}}crtOnMetaDataInit(e){var t;const i=(t=e.viewModelConfig).attributes??(t.attributes={});return(0,v.getDataGridViewConfigs)(e).forEach(a=>this._bindActiveRow(a,i)),Promise.resolve(e)}}de.\u0275fac=function(e){return new(e||de)},de.\u0275prov=s.\u0275\u0275defineInjectable({token:de,factory:de.\u0275fac});class me{constructor(e){this._featureService=e,this._featureName="DisableDataGridRowDoubleClickPreprocessing"}_hasSectionEditPage(e,t){return(0,u.Z)(function*(){const r={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:e}};return yield b.HandlerChainService.instance.process(r)})()}_getReferenceSchemaName(e,t){return(0,u.Z)(function*(){return(yield(0,g.getEntitySchemaAttribute)(t,e))?.referenceSchemaName})()}_getPrimaryAttributeName(e,t){const r=(0,v.getViewModelItemsAttributeName)(e),i=t.getBoundDataSourceNameByAttributePath(r),a=t.getBoundDataSchemaByAttributePath(r),{primaryAttributeName:o}=a??{};return o?`${i}_${o}`:""}_isPageExists(e,t){var r=this;return(0,u.Z)(function*(){const i=r._getPrimaryAttributeName(e,t),a=yield r._getReferenceSchemaName(i,t);return r._hasSectionEditPage(a,t)})()}_getDataGridViewConfigs(e,t){var r=this;return(0,u.Z)(function*(){const i=(0,v.getDataGridViewConfigsWithItemsBinding)(e);return(yield Promise.all(i.map(o=>r._isPageExists(o,t)))).reduce((o,n,l)=>(n&&!i[l].rowDoubleClick&&o.push(i[l]),o),[])})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){if(yield(0,_.lastValueFrom)(i._featureService.getFeatureState(i._featureName),{defaultValue:null}))return e;const o=yield i._getDataGridViewConfigs(e,r);for(const n of o)n.rowDoubleClick={request:"crt.DataGridRowDoubleClickRequest",params:{itemsAttributeName:(0,v.getViewModelItemsAttributeName)(n),rowId:"@event.rowId"}};return e})()}}me.\u0275fac=function(e){return new(e||me)(s.\u0275\u0275inject(A.FeatureService))},me.\u0275prov=s.\u0275\u0275defineInjectable({token:me,factory:me.\u0275fac});class pe{constructor(e){this._featureService=e}_isSelectionPreprocessingDisabled(){const e=this._featureService.getFeatureState("DisableDataGridRowsSelectionPreprocessing");return(0,_.lastValueFrom)(e,{defaultValue:!1})}_bindSelectedRows(e,t){if(e.selectedRows??(e.selectedRows=`$${(0,f.createDataGridSelectedRowsAttributeName)(e)}`),!(0,I.isBindingExpression)(e.selectedRows))return;const r=(0,I.parseExpression)(e.selectedRows).attributePath;t[r]||(t[r]={value:null})}_bindSelectionState(e,t){if(e.selectionState??(e.selectionState=`$${(0,f.createDataGridSelectionStateAttributeName)(e)}`),!(0,I.isBindingExpression)(e.selectionState))return;const r=(0,I.parseExpression)(e.selectionState).attributePath;if(t[r]??(t[r]={value:null}),!(0,I.isBindingExpression)(e.items))return;const i=(0,I.parseExpression)(e.items).attributePath;if(e.totalItemsCount??(e.totalItemsCount=`$${i}_TotalItemsCount`),!(0,I.isBindingExpression)(e.totalItemsCount))return;const a=(0,I.parseExpression)(e.totalItemsCount).attributePath,o=`${i}_SelectedItemsCount`;this._createTotalItemsCountAttribute(a,{itemsAttributeName:i,selectionStateAttributeName:r},t),this._createSelectedItemsCountAttribute(o,{itemsAttributeName:i,selectionStateAttributeName:r,totalItemsCountAttributeName:a},t);const n=t[r];if(n.change||(n.change=[]),Array.isArray(n.change)||(n.change=[n.change]),n.change.push({request:"crt.DataGridCleanupCachedItemsCountLoadParametersRequest",params:{itemsAttributeName:i,selectionStateAttributeName:r}},{request:"crt.DataGridRunSelectedItemsCountAttributeCalculationRequest",params:{selectionStateAttributeName:r,selectedItemsCountAttributeName:o}}),!(0,I.isBindingExpression)(e.selectedRows))return;const l=(0,I.parseExpression)(e.selectedRows).attributePath;n.change.push({request:"crt.DataGridSetSelectedRowsFromSelectionStateRequest",params:{selectedRowsAttributeName:l,selectionStateAttributeName:r}})}_createTotalItemsCountAttribute(e,t,r){const{itemsAttributeName:i,selectionStateAttributeName:a}=t,o=`${e}_Actualization`;r[e]??(r[e]={from:[i,o],converter:`crt.ToCollectionItemsCount : '${i}' : '${e}'`}),r[o]??(r[o]={from:a,converter:"crt.IsAnySelected"})}_createSelectedItemsCountAttribute(e,t,r){const{itemsAttributeName:i,selectionStateAttributeName:a,totalItemsCountAttributeName:o}=t;r[e]??(r[e]={from:[i,a,o],converter:`crt.ToCollectionSelectedItemsCount : '${i}' : '${e}'`,change:{request:"crt.DataGridSetSelectedCountToRowsSelectionStateRequest",params:{selectionStateAttributeName:a,selectedItemsCountAttributeName:e}}})}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){var r;if(yield t._isSelectionPreprocessingDisabled())return e;const a=(r=e.viewModelConfig).attributes??(r.attributes={});return(0,v.getDataGridViewConfigs)(e).forEach(o=>{t._bindSelectedRows(o,a),t._bindSelectionState(o,a)}),e})()}}pe.\u0275fac=function(e){return new(e||pe)(s.\u0275\u0275inject(A.FeatureService))},pe.\u0275prov=s.\u0275\u0275defineInjectable({token:pe,factory:pe.\u0275fac});class fe{constructor(e=!1){this._isDesignTime=e}_setInitialSelectionOptions(e){(0,v.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(t=>this._canSetSelectionOptions(t)).forEach(t=>this._setSelectionOptions(t))}_canSetSelectionOptions(e){return(0,S.isEmpty)(e?._selectionOptions)&&(0,f.canDataGridContainsSelectionOptions)(e)}_setSelectionOptions(e){e.selectionState??(e.selectionState=`$${(0,f.createDataGridSelectionStateAttributeName)(e)}`);const t=(0,f.createDataGridInitialSelectionOptions)(e);t&&(e._selectionOptions=t)}_setExportToExcelRequestFiltersParameter(e){(0,R.getRequestBindingConfigs)(e.viewConfig,"crt.ExportDataGridToExcelRequest",this._canSetExportToExcelRequestFiltersParameter).forEach(t=>{const r=t.params.viewName,i=this._getExportToExcelRequestFiltersParameter(e,r);!i||(t.params={...t.params,filters:i})})}_canSetExportToExcelRequestFiltersParameter(e){const{viewName:t,filters:r}=e?.params??{};return Boolean(t)&&r===void 0}_getExportToExcelRequestFiltersParameter(e,t){const r=p.MetadataSchemaUtils.getViewConfigInfoByName(e,t);if(!r?.viewConfig)return null;const{items:i,_selectionOptions:a}=r.viewConfig,o=(0,I.isBindingExpression)(i)&&(0,I.parseExpression)(i).attributePath,n=(0,I.getSelectionStateAttributeName)(a);return!o||!n?null:(0,I.createCollectionFiltersBindingExpression)(o,n,{supportEmptySelection:!0})}crtOnMetaDataInit(e){const t=e;return this._setInitialSelectionOptions(t),this._isDesignTime||this._setExportToExcelRequestFiltersParameter(t),Promise.resolve(e)}}fe.\u0275fac=function(e){return new(e||fe)(s.\u0275\u0275inject(p.IS_DESIGN_TIME,8))},fe.\u0275prov=s.\u0275\u0275defineInjectable({token:fe,factory:fe.\u0275fac});class U{}U.\u0275fac=function(e){return new(e||U)},U.\u0275mod=s.\u0275\u0275defineNgModule({type:U}),U.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_PREPROCESSOR,useClass:fe,multi:!0}]});class rt{_isSelectionStateAttributeBound(e,t,r){const i=(0,S.cloneDeep)(r),o=p.MetadataSchemaUtils.getViewConfigInfoByName(i,e).viewConfig;return delete o._selectionOptions,delete o.selectionState,p.MetadataSchemaUtils.isViewModelAttributeBound(i,t)}_cleanupDefaultSelectionOptionsMetadata(e,t){const r=e._selectionOptions;if(!r)return this._cleanupDefaultSelectionState(e,t);const i=(0,S.cloneDeep)(e),a=`$${(0,f.createDataGridSelectionStateAttributeName)(e)}`;i.selectionState??(i.selectionState=a);const o=(0,f.createDataGridInitialSelectionOptions)(i);if(!(0,S.isEqual)(r,o))return;const n=(0,I.getSelectionStateAttributeName)(r);e.name&&this._isSelectionStateAttributeBound(e.name,n,t)||(delete e._selectionOptions,this._cleanupDefaultSelectionState(e,t))}_cleanupDefaultSelectionState(e,t){const r=e.selectionState,i=`$${(0,f.createDataGridSelectionStateAttributeName)(e)}`;if(!(0,S.isEqual)(r,i))return;const a=(0,I.parseExpression)(r).attributePath;e.name&&this._isSelectionStateAttributeBound(e.name,a,t)||delete e.selectionState}crtOnMetaDataChanged(e){return(0,v.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultSelectionOptionsMetadata(t,e)),Promise.resolve(e)}}rt.\u0275fac=function(e){return new(e||rt)},rt.\u0275prov=s.\u0275\u0275defineInjectable({token:rt,factory:rt.\u0275fac});class it{}it.\u0275fac=function(e){return new(e||it)},it.\u0275mod=s.\u0275\u0275defineNgModule({type:it}),it.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_POSTPROCESSOR,useClass:rt,multi:!0}]});class ge{constructor(e){this._featureService=e,this._featureName="DisableDataGridSortingPreprocessing"}_setSorting(e,t){if(e.sorting)return;const r=`${e.name.split(" ").join("").replace(/\./g,"_")}Sorting`,i=t.viewModelConfig.attributes;i[r]||(i[r]={});const o=`| crt.ToDataTableSortingConfig: '${e.items.slice(1)}'`;e.sorting=`$${r} ${o}`}_setSortingChange(e){if(e.sortingChange)return;const t=e.items.slice(1);e.sortingChange={request:"crt.DataGridSortDataRequest",params:{itemsAttributeName:t,sorting:"@event"}}}_setSortingConfig(e,t){const r=e.items.slice(1),i=t.viewModelConfig.attributes;i[r]||(i[r]={});const a=(t?.viewModelConfig?.attributes)[r]??{};if(!(0,g.isModelAttributeConfig)(a))return;const o=a?.modelConfig;!o||o.sortingConfig?.attributeName||(a.modelConfig={...a.modelConfig,sortingConfig:{...a.modelConfig?.sortingConfig,attributeName:`${e.name.split(" ").join("").replace(/\./g,"_")}Sorting`}})}setSortingValuesToViewConfig(e,t){this._setSorting(e,t),this._setSortingChange(e),this._setSortingConfig(e,t)}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield(0,_.lastValueFrom)(t._featureService.getFeatureState(t._featureName),{defaultValue:null}))return e;const i=e,a=(0,v.getDataGridViewConfigsWithItemsBinding)(e);for(const o of a)t.setSortingValuesToViewConfig(o,i);return e})()}}ge.\u0275fac=function(e){return new(e||ge)(s.\u0275\u0275inject(A.FeatureService))},ge.\u0275prov=s.\u0275\u0275defineInjectable({token:ge,factory:ge.\u0275fac});class he{constructor(e,t,r){this._featureService=e,this._dcmSchemaManagerService=t,this._entitySchemaRepository=r,this._dcmDataAttributePostfix="_DCMData",this._dcmSchemas=[],this._dataGridToDataSourceMap=[],this._dataSourceSchemas=[]}_getDataGridToDataSourceMap(e,t){return e.map(r=>{const i=r.primaryColumnName?.split("_");i?.pop();const a=i?.join("_")||"",o=t[a];return{dataGridName:r.name,dataSource:o,dataSourceName:a}}).filter(({dataSource:r})=>r!=null)}_getEntitySchemaFromDataSourceSchemas(e){return this._dataSourceSchemas.find(t=>t.name===e?.config?.entitySchemaName)}_getFilterColumnPath(e){const t=e.find(i=>i.filters)?.filters;let r="";if(t){const i=JSON.parse(t);r=`${Object.values(i.items)[0].leftExpression.columnPath}`}return r}_fillDataGridModelConfig(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=a._dcmSchemas.filter(C=>C.entitySchemaUId===e);if(!o?.length)return;const n=a._getFilterColumnPath(o),l=a._dcmSchemaManagerService.getDcmSchemaDataItems(e),d=yield(0,_.firstValueFrom)(l),m=`${t.name}${a._dcmDataAttributePostfix}`;i[m]={value:{schemas:o,schemasData:d,filterColumnAttributePath:`${r?.dataSourceName}_${n}`}};const h=t.items.substring(1),y=i[h].viewModelConfig;n&&h&&!y.attributes[n]&&(y.attributes[`${r?.dataSourceName}_${n}`]={modelConfig:{path:`${r?.dataSourceName}.${n}`}})})()}_initDataGridViewConfigAttributes(e,t){var r=this;return(0,u.Z)(function*(){const i=r._dataGridToDataSourceMap.find(o=>o.dataGridName===e.name);if(!i)return;const a=r._getEntitySchemaFromDataSourceSchemas(i.dataSource);!a||(yield r._fillDataGridModelConfig(a?.uId,e,i,t))})()}_getDataSourceSchemas(){var e=this;return(0,u.Z)(function*(){const t=e._dataGridToDataSourceMap.map(r=>({name:r?.dataSource?.config?.entitySchemaName,loadLookupColumns:!0}));return yield(0,_.firstValueFrom)(e._entitySchemaRepository.getSchemes(t))})()}get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState("DisableDataGridProgressBarStageCell"))}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=(0,v.getDataGridViewConfigs)(e);if(!r?.length)return e;const i=e.modelConfig.dataSources||{};t._dcmSchemas=yield(0,_.firstValueFrom)(t._dcmSchemaManagerService.getDcmSchemaDataCollection()),t._dataGridToDataSourceMap=t._getDataGridToDataSourceMap(r,i),t._dataSourceSchemas=yield t._getDataSourceSchemas();const a=e,o=a.viewModelConfig.attributes=a.viewModelConfig.attributes||{};for(const n of r)yield t._initDataGridViewConfigAttributes(n,o);return e})()}}he.\u0275fac=function(e){return new(e||he)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(A.DcmSchemaManagerService),s.\u0275\u0275inject(p.EntitySchemaRepository))},he.\u0275prov=s.\u0275\u0275defineInjectable({token:he,factory:he.\u0275fac});class _e{constructor(e,t){this._featureValues=e,this._licenceOperationValues=t}crtOnMetaDataInit(e){const t=this._licenceOperationValues[f.CAN_MANAGE_LIST_COLUMNS_LICENSE_OPERATION_CODE];if(this._featureValues.DisableDataGridRestrictionsPreprocessing||t)return Promise.resolve(e);const r={columns:{editing:!1,adding:!1}};return(0,v.getDataGridViewConfigs)(e).filter(i=>typeof i.features!="string").forEach(i=>{i.features??(i.features={}),(0,S.merge)(i.features,r)}),Promise.resolve(e)}}_e.\u0275fac=function(e){return new(e||_e)(s.\u0275\u0275inject(p.FEATURE_VALUES),s.\u0275\u0275inject(A.LICENSE_RESTRICTION_OPERATION_VALUES))},_e.\u0275prov=s.\u0275\u0275defineInjectable({token:_e,factory:_e.\u0275fac});class be extends L{constructor(){super(...arguments),this.viewItemTypes=["crt.ApprovalList"]}}be.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(be)))(t||be)}}(),be.\u0275prov=s.\u0275\u0275defineInjectable({token:be,factory:be.\u0275fac});var at=N(34617);class ot{_getMenuItem(e,t,r){return{type:"crt.MenuItem",caption:e.caption||e.captionLcz,clicked:{request:"crt.CreateRecordRequest",params:{entityName:t,defaultValues:r}}}}_getDefaultValues(e,t,r){const i=r?[{attributeName:r,value:e.UId}]:[];return t.length&&i.splice(0,0,...t),i}_getEntityName(e,t){const r=e.viewConfig.clicked.params;let i=r.entityName||"";if(!i){const a=r.itemsAttributeName;if(a){const o=t.getBoundDataSourceNameByAttributePath(a);i=t.dataSchemas[o]?.name}}return i}_getButtonsWithCreateRecordRequest(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(r=>{const i=r.viewConfig.clicked;return i?.params&&i.request==="crt.CreateRecordRequest"})}_fillMenuItems(e,t){var r;const i=this._getEntityName(e,t);if(!i)return;const a=at.NavigationUtils.getEntityStructure(i,at.UITypePriority.PreferFreedomUI);if(!a)return;const o=at.NavigationUtils.getPagesForAddAction(a.pages);if(!o?.length)return;const n=a.attribute,l=e.viewConfig.clicked.params?.defaultValues||[];if(!l.find(m=>m.attributeName===n)?.value){if(o.length>1){e.viewConfig.clickMode="menu";const m=o.map(h=>{const y=this._getDefaultValues(h,l,n);return this._getMenuItem(h,i,y)});(r=e.viewConfig).menuItems??(r.menuItems=[]),e.viewConfig.menuItems.splice(0,0,...m)}else if(n){const m=this._getDefaultValues(o[0],l,n);e.viewConfig.clicked.params.defaultValues=m}}}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){return i._getButtonsWithCreateRecordRequest(e).forEach(a=>{i._fillMenuItems(a,r)}),e})()}}ot.\u0275fac=function(e){return new(e||ot)},ot.\u0275prov=s.\u0275\u0275defineInjectable({token:ot,factory:ot.\u0275fac});class nt{constructor(e){this.crtRoute=e}_getButtonsWithDefaultPageRequest(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(r=>r?.viewConfig?.clicked?.request==="crt.ContinueInOtherPageRequest")}_prepareButton(e,t){const r=e.viewConfig;(0,S.isString)(r.visible)||(r.visible=t)}_getEntityNavigationOptions(e){const t=(0,I.resolveSchemaPrimaryEntityName)(e),r=this.crtRoute.getState(),i=(0,S.last)(r?.children),a=(0,S.last)(i?.modelInitConfigs),o=(0,S.last)(r?.modelInitConfigs);return{defaultValues:a?.defaultValues||o?.defaultValues||[],entityName:t,recordId:a?.recordId}}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=t._getButtonsWithDefaultPageRequest(r),a=t._getEntityNavigationOptions(r),o=yield at.NavigationUtils.getPageForActionAsync({action:b.ModelInPageAction.Edit,...a}),n=yield at.NavigationUtils.getPageForActionAsync({action:b.ModelInPageAction.Add,...a}),l=o?.cardSchema===n?.cardSchema,d=o?.cardSchema===r.name,m=Boolean(!l&&!d&&n&&o?.cardSchema);return i.forEach(h=>{t._prepareButton(h,m)}),Promise.resolve(e)})()}}nt.\u0275fac=function(e){return new(e||nt)(s.\u0275\u0275inject(at.LocationStrategy))},nt.\u0275prov=s.\u0275\u0275defineInjectable({token:nt,factory:nt.\u0275fac});const ir="Telephony.Use",ar="MailboxSynchronization.Use",or="Chats.Use";class w{constructor(e){this._featureService=e,this._disableSaveToProfileAttributesFeature="DisableSaveToProfileAttributes"}get isProfileDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._disableSaveToProfileAttributesFeature))}createOrUpdateAttributeWithChangeRequest(e,t,r,i=""){const a=t[r],o=e.viewModelConfig.attributes,n=`${t.name}_${(0,S.upperFirst)(r)}_Profile`,l=(0,R.isBindToViewModelAttribute)(a,o)?a.slice(1):i||n,d={...o[l]};d.value=d.value??((0,R.isBindToViewModelAttribute)(a,o)?void 0:a),d.change=Array.isArray(d.change)?d.change:[{...d.change}].filter(m=>Object.keys(m).length>0),d.change.push({request:"crt.SaveAttributeToProfileRequest",params:{profileAttributeName:l}}),o[l]=d,t[r]=`$${l}`}prepareAttributeWithFeatureCheck(e,t,r,i="",a=""){var o=this;return(0,u.Z)(function*(){const n=(0,_.lastValueFrom)(o._featureService.getFeatureState(a));(yield o.isProfileDisabled)||(yield n)||o.createOrUpdateAttributeWithChangeRequest(e,t,r,i)})()}}w.\u0275fac=function(e){return new(e||w)(s.\u0275\u0275inject(A.FeatureService))},w.\u0275prov=s.\u0275\u0275defineInjectable({token:w,factory:w.\u0275fac});const Sr="SelectedItem";class st{constructor(e,t,r){this._userInfo=e,this._profileAttributeService=t,this._licenceOperationValues=r}_getButtonToggleGroups(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ButtonToggleGroup",e.viewConfig).filter(r=>r.viewConfig.for)}_getDefaultSelectedTabValue(e){return e.selectedTab?{value:e.selectedTab}:{}}_removeTab(e,t){const r=e.findIndex(i=>i.name===t);r!==-1&&e.splice(r,1)}_isRemoveTab(e){return!this._licenceOperationValues[e]}_getLicenceOperations(){const e=new Map;return e.set(ir,"CtiTab"),e.set(ar,"EmailsTab"),e.set(or,"ChatsTab"),e}_filterTabs(e){return this._userInfo.isSSP?e.filter(r=>r.name==="FeedsTab"):(this._getLicenceOperations().forEach((r,i)=>{this._isRemoveTab(i)&&this._removeTab(e,r)}),e)}crtOnModelInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=r?.viewModelConfig?.attributes,a=t._getButtonToggleGroups(r);for(const o of a){const n=o.viewConfig,l=n.for,m=p.MetadataSchemaUtils.getViewConfigInfoByFilter(C=>C.name===l,r.viewConfig)?.[0]?.viewConfig,h=`${l}_Items`;n.items=`$${h}`;let y=m?.items;if(m.name==="CommunicationsPanelItemsTabPanel"&&(y=t._filterTabs(y)),y?.length){const C=y.map(T=>({value:T.name,icon:T.icon,iconPosition:T.iconPosition,tooltipTitle:T.title,displayValue:T.caption}))||[];i[h]={value:C};const P=`${l}_${Sr}`;i[P]=i[P]||t._getDefaultSelectedTabValue(m),n.value=`$${P}`,m.selectedTab=`$${P}`,m.visible=`$${P} | crt.ToBoolean`,yield t._profileAttributeService.prepareAttributeWithFeatureCheck(r,m,"selectedTab",P,"DisableSaveToProfileToggleGroupSelectedTab")}m?.allowToggleClose!==void 0&&(n.allowUntoggle=m?.allowToggleClose)}return Promise.resolve(e)})()}}st.\u0275fac=function(e){return new(e||st)(s.\u0275\u0275inject(p.UserInfo),s.\u0275\u0275inject(w),s.\u0275\u0275inject(A.LICENSE_RESTRICTION_OPERATION_VALUES))},st.\u0275prov=s.\u0275\u0275defineInjectable({token:st,factory:st.\u0275fac});class ct{constructor(e){this._profileAttributeService=e,this._pageSize=150}_getViewConfigs(e,t){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",t,e).map(r=>r?.viewConfig).filter(Boolean)}_getDsAttributeName(e,t){return e.replace(`${t}_`,"")}_getCalendarDateColumns(e,t,r){if(!t.modelConfig||!e.modelConfig||!e.modelConfig.dataSources)return[];const i=t.modelConfig.path,o=e.modelConfig.dataSources[i]?.config?.attributes||{},n=r.templateValuesMapping;return[o[this._getDsAttributeName(n.startColumn,i)]?.path,o[this._getDsAttributeName(n.endColumn,i)]?.path].filter(l=>Boolean(l))}_setFilterAttribute(e,t,r){if(r.filters)return;const i=e.viewModelConfig.attributes,a=i[r.items?.replace("$","")];if(!a||!a.modelConfig?.filterAttributes||t.length===0)return;const o=this._getCalendarDateColumns(e,a,r),n=this._getCalendarDateFilterAttributes(a,t,o);n.length!==0&&(r.filters=`$${this._createCalculatedAttribute(i,r.name,n)}`)}_setParticipantFilterAttribute(e,t,r){if(r.participantFilters)return;const i=e.viewModelConfig.attributes,a=i[r.items?.replace("$","")];if(!a||!a.modelConfig?.filterAttributes||t.length===0)return;if((e.modelConfig?.dataSources&&e.modelConfig.dataSources[a.modelConfig.path])?.config?.entitySchemaName==="Activity"&&r.colorizationType===f.CalendarColorizationType.ByOwner){const n=this._getCalendarParticipantFilterAttribute(a,t);if(n.length===0)return;r.participantFilters=`$${this._createCalculatedAttribute(i,"participant",n)}`}}_getCalendarDateFilterAttributes(e,t,r){const i=e.modelConfig?.filterAttributes?.map(a=>a.name)||[];return t.filter(a=>{if(a.filterType!==f.QuickFilterType.DateRange||!i.find(n=>n.startsWith(a.name)))return!1;const o=new Array;return a._filterOptions.expose.forEach(n=>n.converters?.forEach(l=>l.args?.forEach(d=>{const m=d.target;o.push(m.filterColumn),o.push(m.filterColumnEnd),o.push(m.filterColumnStart)}))),!!r.find(n=>o.includes(n))}).map(a=>a.value.replace("$",""))}_getCalendarParticipantFilterAttribute(e,t){const r=e.modelConfig?.filterAttributes?.map(a=>a.name)||[];return t.find(a=>{if(a.filterType!==f.QuickFilterType.Lookup||!r.find(n=>n.startsWith(a.name)))return!1;let o=!1;return a._filterOptions.expose.forEach(n=>n.converters?.forEach(l=>l.args?.forEach(d=>{o=d.target.filterColumn==="[ActivityParticipant:Activity].Participant"}))),o})?.value.replace("$","")||""}_createCalculatedAttribute(e,t,r){const i=`${t}_FilterValues`;return e[i]={from:r},i}_setCrudEventsBindings(e){if((0,S.isEmpty)(e.items))return;const t=e.items.slice(1);e.silenceCreate={request:"crt.SilenceCreateCalendarRecordRequest",params:{itemsAttributeName:t,title:{key:e.templateValuesMapping.titleColumn,value:"@event.title"},startDate:{key:e.templateValuesMapping.startColumn,value:"@event.startDate"},endDate:{key:e.templateValuesMapping.endColumn,value:"@event.endDate"}}},this._setHighlightedEventBinding(t,e)}_setHighlightedEventBinding(e,t){const r=`${t.name}_highlightedStartDate`,i=`${t.name}_highlightedEndDate`;t.highlightArea={request:"crt.HighlightCalendarAreaRequest",params:{itemsAttributeName:e,startDate:"@event.startDate",startDateAttrName:r,endDate:"@event.endDate",endDateAttrName:i}},t.unhighlightArea={request:"crt.UnhighlightCalendarAreaRequest",params:{itemsAttributeName:e,startDateAttrName:r,endDateAttrName:i}}}_setShowWeekendsAttribute(e,t){var r=this;return(0,u.Z)(function*(){(0,S.isEmpty)(t.showWeekends)||(yield r._profileAttributeService.createOrUpdateAttributeWithChangeRequest(e,t,"showWeekends",""))})()}_setLoadNextPageOptions(e,t){const i=e.viewModelConfig.attributes[t.items?.replace("$","")];this._setPagingConfig(i,t),this._setSortingConfig(e,i,t);const a=i?.modelConfig?.path;t.loadNextPage={request:"crt.LoadDataRequest",params:{dataSourceName:a}}}_setPagingConfig(e,t){if(!e?.modelConfig||e.modelConfig.pagingConfig){const r=e?.modelConfig?.pagingConfig;t.pageSize=r?.rowCount||this._pageSize;return}e.modelConfig.pagingConfig={rowCount:this._pageSize,rowsOffset:null}}_setSortingConfig(e,t,r){if(!t?.modelConfig||t.modelConfig.sortingConfig||!e?.modelConfig?.dataSources)return;const i=r.templateValuesMapping.startColumn,a=t.modelConfig.path,l=(e.modelConfig.dataSources[a]?.config?.attributes||{})[this._getDsAttributeName(i,a)]?.path;t.modelConfig.sortingConfig={attributeName:"ItemsSorting",default:[{columnName:l,direction:"asc"}]}}_setTileLabelsColor(e){if(!e.colorizationType||e.colorizationType==="default")return;this._getViewConfigs(e.tileContent,"crt.Label").forEach(r=>{r.labelColor=`${e.items}.LabelColor`})}_setTimeScaleFromProfile(e,t){var r=this;return(0,u.Z)(function*(){(0,S.isEmpty)(t.timeScale)||(yield r._profileAttributeService.createOrUpdateAttributeWithChangeRequest(e,t,"timeScale",""))})()}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=t._getViewConfigs(r.viewConfig,"crt.Calendar"),a=t._getViewConfigs(r.viewConfig,"crt.QuickFilter");for(const o of i)t._setFilterAttribute(r,a,o),t._setParticipantFilterAttribute(r,a,o),t._setCrudEventsBindings(o),yield t._setShowWeekendsAttribute(r,o),t._setLoadNextPageOptions(r,o),t._setTileLabelsColor(o),yield t._setTimeScaleFromProfile(r,o);return Promise.resolve(e)})()}}ct.\u0275fac=function(e){return new(e||ct)(s.\u0275\u0275inject(w))},ct.\u0275prov=s.\u0275\u0275defineInjectable({token:ct,factory:ct.\u0275fac});class lt{constructor(){this._activityIdParamName="activityId",this._activityIsOutdatedParamName="isActivityOutdated",this._toMeetingInvitationInfoConverter="crt.ToMeetingInvitationInfo",this._toSendInviteVisibleConverter="crt.ToSendInviteVisible",this._toSendInviteDisabledConverter="crt.ToSendInviteDisabled",this._toSendInviteIsOutdatedConverter="crt.ToSendInviteIsOutdated",this._toSendInviteIsStartDateUpdatedConverter="crt.ToSendInviteIsStartDateUpdated",this._pdsName=""}_getSendInvitesButtons(e){return p.MetadataSchemaUtils.getViewConfigInfoByFilter(t=>t.clicked?.request==="crt.SendInvitesForActivityRequest",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_setActivityBindings(e,t){if(!this._hasActivityIdParam(t)||!this._pdsName)return;const r=this._tryGetAttributeFromBinding(e,t)||this._getOrAddActivityIdAttribute(e,t);t.clicked.params[this._activityIdParamName]=`$${r}`,t.clicked.params[this._activityIsOutdatedParamName]=`$${this._getOrAddIsOutdatedAttribute(e,t,r)}`,t.clicked.params.isStartDateUpdated=`$${this._getOrAddIsStartDateUpdatedAttribute(e,t)}`,t.visible=`$${this._getOrAddVisibilityAttribute(e,t,r)}`,t.disabled=`$${this._getOrAddDisabledAttribute(e,t,r)}`}_hasActivityIdParam(e){return!!e.clicked&&!!e.clicked.params&&!(0,S.isEmpty)(e.clicked.params[this._activityIdParamName])}_tryGetAttributeFromBinding(e,t){const r=e.viewModelConfig.attributes,a=(t.clicked?.params[this._activityIdParamName]||"").split("$")[1];return r[a]?a:""}_getOrAddActivityIdAttribute(e,t){return this._findActivityIdAttribute(e,t)||this._createActivityIdAttribute(e,t)}_getOrAddMeetingInvitationInfoAttribute(e,t,r){return this._findCalculatedAttribute(e,r,this._toMeetingInvitationInfoConverter)||this._createCalculatedAttribute(e,`${t.name}_MeetingInfo`,r,this._toMeetingInvitationInfoConverter)}_getOrAddVisibilityAttribute(e,t,r){const i=this._getOrAddMeetingInvitationInfoAttribute(e,t,r);return this._findCalculatedAttribute(e,i,this._toSendInviteVisibleConverter)||this._createCalculatedAttribute(e,`${t.name}_Visible`,i,this._toSendInviteVisibleConverter)}_getOrAddDisabledAttribute(e,t,r){const i=this._getOrAddMeetingInvitationInfoAttribute(e,t,r);return this._findCalculatedAttribute(e,i,this._toSendInviteDisabledConverter)||this._createCalculatedAttribute(e,`${t.name}_Disabled`,i,this._toSendInviteDisabledConverter)}_getOrAddIsOutdatedAttribute(e,t,r){const i=this._getOrAddMeetingInvitationInfoAttribute(e,t,r);return this._findCalculatedAttribute(e,i,this._toSendInviteIsOutdatedConverter)||this._createCalculatedAttribute(e,`${t.name}_IsOutdated`,i,this._toSendInviteIsOutdatedConverter)}_getOrAddIsStartDateUpdatedAttribute(e,t){return this._findCalculatedAttribute(e,`${t.name}_IsStartDateUpdated`,this._toSendInviteIsStartDateUpdatedConverter)||this._createCalculatedAttribute(e,`${t.name}_IsStartDateUpdated`,"StartDate",this._toSendInviteIsStartDateUpdatedConverter)}_findActivityIdAttribute(e,t){const r=e.viewModelConfig.attributes,i=t.clicked?.params[this._activityIdParamName],a=Object.keys(r).find(o=>(r[o]??{}).modelConfig?.path===`${this._pdsName}.${i}`);return(0,S.isEmpty)(a)?void 0:a}_findCalculatedAttribute(e,t,r){const i=e.viewModelConfig.attributes,a=Object.keys(i).find(o=>{const n=i[o]??{};return n.from===t&&n.converter===r});return(0,S.isEmpty)(a)?void 0:a}_createActivityIdAttribute(e,t){const r=e.viewModelConfig.attributes,i=`${t.name}_ActivityId`,a=t.clicked?.params.activityId;return r[i]={modelConfig:{path:`${this._pdsName}.${a}`}},i}_createCalculatedAttribute(e,t,r,i){const a=e.viewModelConfig.attributes;return a[t]={from:r,converter:i},t}crtOnMetaDataInit(e){const t=e;return this._pdsName=(0,I.resolveSchemaPrimaryDataSource)(t),this._getSendInvitesButtons(t).forEach(i=>{this._setActivityBindings(t,i)}),Promise.resolve(e)}}lt.\u0275fac=function(e){return new(e||lt)},lt.\u0275prov=s.\u0275\u0275defineInjectable({token:lt,factory:lt.\u0275fac});class qt{constructor(e){this.translateService=e,this.translatePrefix="CommunicationOptions"}translate(e){return this.translateService.instant(`${this.translatePrefix}.${e}`)}}var Ar=N(72856),Cr=N(54514),yr=N(6523);class Se extends qt{constructor(e,t,r,i,a){super(e),this.translateService=e,this._queryExecutor=t,this._domSanitizer=r,this._matIconRegistry=i,this._rightsService=a,this._addCommunicationOptionsRequestName="crt.AddCommunicationOptionsRequest"}_getMenuItemClickRequest(e,t,r,i,a,o){return{request:"crt.CreateCommunicationOptionRequest",params:{componentName:e,indexToInsert:"@event.index",masterRecordColumnName:a,values:{CommunicationType:t,[a]:i,CommunicationTypeName:o,CommunicationTypeDisplayFormat:r}},useRelativeContext:!0}}_getSubMenuItem(e,t,r,i,a,o,n){return{type:"crt.MenuItem",caption:e,clicked:this._getMenuItemClickRequest(t,r,i,a,o,e),...n&&{icon:`${n}`}}}_getMenuItem(e,t){return{type:"crt.MenuItem",caption:t,items:[],...e&&{icon:`${e}`}}}_registerIcon(e){if(!e)return;const t=this._domSanitizer.bypassSecurityTrustResourceUrl(window.location.origin+(0,p.getImageFullUrlById)(e));this._matIconRegistry.addSvgIcon(e,t)}_getAddOptionItems(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=[],n=yield a.getCommTypes(i),l=[...new Set(n.map(d=>d.typeOrGroupId))];for(const d of l){const m=n.filter(C=>C.typeOrGroupId===d),h=m[0],y=h?.groupIcon?.value;if(m.length>1){const C=a._getMenuItem(y,h.groupName);C.items=m.map(P=>a._getSubMenuItemFromType(P,e,t,r)),o.push(C)}else{const C=a._getSubMenuItemFromType(h,e,t,r);o.push(C)}}return o})()}_getSubMenuItemFromType(e,t,r,i){const a=this._getSubMenuItem(e.displayValue,t,e.value,e.displayFormat,r,i,e.typeIcon?.value);return this._registerIcon(e?.typeIcon?.value),this._registerIcon(e?.groupIcon?.value),a}_getValidationResult(e,t=""){return{success:e,errorMessage:t}}_validateComponentState(e,t){var r=this;return(0,u.Z)(function*(){const i=r._getValidationResult(!0);if(!e.masterRecordColumnName||!e.masterRecordColumnValue)return r._getValidationResult(!1,r.translate("Validations.IncorrectSetupComponentMessage"));if(e.readonly)return r._getValidationResult(!1,r.translate("Validations.ReadOnlyStateMessage"));const a={isNew:!0,schemaName:t},o=yield(0,_.lastValueFrom)(r._rightsService.getCanEdit(a));return o&&!o.result?r._getValidationResult(!1,o.message):i})()}_applyAddButtonState(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=yield a._validateComponentState(t,i);if(!o.success){e.forEach(n=>{n.clicked={request:"crt.NotificationRequest",params:{message:o.errorMessage,duration:1e4}},n.clickMode="default",n.menuItems=[]});return}e.forEach(n=>{n.clickMode="menu",n.menuItems=[...r,...n.menuItems||[]]})})()}_selectCommTypesFromDB(e){const t=new b.EntitySchemaQuery("CommunicationType");return t.addMacrosFunctionColumn(b.QueryMacrosType.PrimaryColumn,"typeId"),t.addMacrosFunctionColumn(b.QueryMacrosType.PrimaryDisplayColumn,"typeName"),t.addSchemaColumn("ImageLink","typeIcon"),t.addSchemaColumn("DisplayFormat","displayFormat"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Id","groupId"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Name","groupName"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.ImageLink","groupIcon"),t.filters.addSchemaColumnFilterWithParameter(b.ComparisonType.Not_equal,"[ComTypebyCommunication:CommunicationType:Id].Communication",f.CommunicationEnum.SMS),e==="ContactCommunication"&&t.filters.addSchemaColumnFilterWithParameter(b.ComparisonType.Equal,"UseforContacts",!0),e==="AccountCommunication"&&t.filters.addSchemaColumnFilterWithParameter(b.ComparisonType.Equal,"UseforAccounts",!0),this._queryExecutor.executeSelectQuery(t).pipe((0,_.share)(),(0,_.map)(r=>r.map(i=>({typeOrGroupId:i.groupId||i.typeId,value:i.typeId,displayValue:i.typeName,groupName:i.groupName,typeIcon:i.typeIcon,groupIcon:i.groupIcon,displayFormat:i.displayFormat}))),(0,_.catchError)(r=>(0,_.of)([])))}_getAddCommOptionsButtonsConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],e.viewConfig).filter(t=>t.viewConfig.clicked?.request===this._addCommunicationOptionsRequestName).map(t=>t.viewConfig)}getCommTypes(e){return(0,_.lastValueFrom)(this._selectCommTypesFromDB(e))}processAddButton(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getAddCommOptionsButtonsConfigs(t),o=t?.modelConfig?.dataSources,n=o&&o[r]?.config?.entitySchemaName||"",l=yield i._getAddOptionItems(e.name,e.masterRecordColumnValue,e.masterRecordColumnName,n),d=a.filter(m=>e.name===m.clicked?.params?.viewElementName);yield i._applyAddButtonState(d,e,l,n)})()}}Se.\u0275fac=function(e){return new(e||Se)(s.\u0275\u0275inject(M.TranslateService),s.\u0275\u0275inject(yr.QueryExecutor),s.\u0275\u0275inject(Cr.DomSanitizer),s.\u0275\u0275inject(Ar.MatIconRegistry),s.\u0275\u0275inject(A.RightsService))},Se.\u0275prov=s.\u0275\u0275defineInjectable({token:Se,factory:Se.\u0275fac});class Ae extends qt{constructor(e){super(e),this.translateService=e}_setSortingConfig(e,t){const r=e.items.slice(1),i=`${r}_Sorting`,a=t.viewModelConfig.attributes;a[i]={isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}};const o=a[r];o.modelConfig={...o.modelConfig,sortingConfig:{...o.modelConfig?.sortingConfig,attributeName:i,default:[{columnName:"CreatedOn",direction:"asc"}]}}}_initTypeNameAttribute(e,t){const r=`${t}_CommunicationTypeName`,i=`${t}_Primary`,a=`${t}_NonActual`,o=" \u2022 "+this.translate("Primary"),n=" \u2022 "+this.translate("Invalid"),l=`${r}_Extended`,d=e?.viewModelConfig.attributes??{};d[l]={from:[r,i,a],converter:`crt.AppendConditionalParts : '${o}' : '${n}'`}}_prepareAttributes(e,t,r,i){(0,g.isModelAttributeConfig)(r)&&!r.modelConfig?.sortingConfig?.attributeName&&this._setSortingConfig(e,t),this._initTypeNameAttribute(r,i)}processAttributes(e,t,r,i){this._prepareAttributes(e,t,r,i)}}Ae.\u0275fac=function(e){return new(e||Ae)(s.\u0275\u0275inject(M.TranslateService))},Ae.\u0275prov=s.\u0275\u0275defineInjectable({token:Ae,factory:Ae.\u0275fac});class Ce extends qt{constructor(e){super(e),this.translateService=e}_getActionClickedRequest(e,t,r){return{request:e,params:{recordId:`$${t}.${r}_Id`,collectionAttributeName:t}}}_getDefaultOptionActions(e,t){const r=`${e}.${t}_Primary`,i=`${e}.${t}_NonActual`,a=this.translate("MarkAsPrimary"),o=this.translate("MarkAsValid"),n=this.translate("MarkAsInvalid"),l=this.translate("DeleteOption");return[{type:"crt.MenuItem",caption:a,icon:"flag-button-icon",visible:`$${r} | crt.NorCondition : $${i}`,clicked:this._getActionClickedRequest("crt.MakeCommunicationOptionPrimaryRequest",e,t)},{type:"crt.MenuItem",caption:`$${i}
					| crt.BooleanToStringValue : '${o}' : '${n}'`,icon:`$${i}
					| crt.BooleanToStringValue : 'valid-circle' : 'invalid-circle'`,clicked:this._getActionClickedRequest("crt.ChangeCommunicationInvalidStateRequest",e,t)},{type:"crt.MenuItem",caption:l,icon:"delete-button-icon",clicked:this._getActionClickedRequest("crt.RemoveCommunicationOptionRequest",e,t)}]}_getOptionActions(e,t,r){const i=this._getDefaultOptionActions(t,r),a=e.optionActions||[];return[...i,...a]}_extendViewConfig(e,t,r){e.primaryColumnName=`${r}_Id`,e.numberColumnName=`${r}_Number`,e.typeColumnName=`${r}_CommunicationType`,e.displayFormatColumnName=`${r}_CommunicationTypeDisplayFormat`,e.optionActions=this._getOptionActions(e,t,r)}_getDefaultOptionConfig(e,t,r){return{label:`$${`${`${e}.${t}_CommunicationTypeName`}_Extended`}`,control:`$${e}.${t}_Number`,labelPosition:r}}_applyReadonlyState(e,t){Object.entries(e).forEach(([,r])=>{t.readonly&&(r.readonly=t.readonly),r.bindTo=`$${(0,p.generatePropertiesAttributeName)(t.name)}`})}_getToolsTemplate(e){return[{type:"crt.Button",icon:"actions-button-icon",iconPosition:"only-icon",color:"default",size:"none",clickMode:"menu",displayType:"text",classes:["actions-btn"],menuItems:e.optionActions}]}_extendWithProperties(e,t){Object.keys(e).forEach(r=>{e[r]={...t,...e[r]}})}_initTemplates(e,t,r){const i=this._getDefaultOptionConfig(t,r,e.labelPosition||"auto"),a=e.templates||{},o=this._getToolsTemplate(e),n={[f.CommunicationOptionTypeEnum.Email]:{type:"crt.EmailInput"},[f.CommunicationOptionTypeEnum.Phone]:{type:"crt.PhoneInput",phoneAsLink:!0,displayAsPhone:!1,displayPhoneMask:!1},[f.CommunicationOptionTypeEnum.Web]:{type:"crt.WebInput"},[f.CommunicationOptionTypeEnum.Google]:{type:"crt.WebInput",icon:"google-web-icon"},[f.CommunicationOptionTypeEnum.Facebook]:{type:"crt.WebInput",icon:"facebook-web-icon"},[f.CommunicationOptionTypeEnum.LinkedIn]:{type:"crt.WebInput",icon:"linkedin-web-icon"},[f.CommunicationOptionTypeEnum.Twitter]:{type:"crt.WebInput",icon:"twitter-web-icon"},[f.CommunicationOptionTypeEnum.Skype]:{type:"crt.WebInput",icon:"skype-web-icon"},[f.CommunicationOptionTypeEnum.Text]:{type:"crt.Input"}};this._extendWithProperties(n,{tools:o});const l={...n,...a};this._extendWithProperties(l,i),this._applyReadonlyState(l,e),e.templates=l}processViewConfig(e,t,r){this._extendViewConfig(e,t,r),this._initTemplates(e,t,r)}}Ce.\u0275fac=function(e){return new(e||Ce)(s.\u0275\u0275inject(M.TranslateService))},Ce.\u0275prov=s.\u0275\u0275defineInjectable({token:Ce,factory:Ce.\u0275fac});class ye{}ye.\u0275fac=function(e){return new(e||ye)},ye.\u0275mod=s.\u0275\u0275defineNgModule({type:ye}),ye.\u0275inj=s.\u0275\u0275defineInjector({providers:[Se,Ce,Ae]});class ut extends qt{constructor(e,t,r,i,a){super(t),this._featureService=e,this.translateService=t,this._addButtonService=r,this._viewConfigService=i,this._attributesService=a,this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this.translatePrefix="CommunicationOptions"}get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_isValidItemsBinding(e,t){return(0,R.isBindToViewModelAttribute)(e.items,t.viewModelConfig?.attributes)?!0:(console.warn(`The setup property [items] for component [${e.name}] is incorrect.Only binding to the ViewModel collection attribute is allowed for this property.`),!1)}processItem(e,t){var r=this;return(0,u.Z)(function*(){if(r._isValidItemsBinding(e,t)){const i=e.items.split("$")[1],a=t.viewModelConfig?.attributes?.[i]??{},o=a?.modelConfig?.path||"";r._viewConfigService.processViewConfig(e,i,o),r._attributesService.processAttributes(e,t,a,o),E.addDependencies(t,e,o),yield r._addButtonService.processAddButton(e,t,o)}})()}processItemsAsync(e,t){var r=this;return(0,u.Z)(function*(){const i=e.map(function(){var a=(0,u.Z)(function*(o){yield r.processItem(o.viewConfig,t)});return function(o){return a.apply(this,arguments)}}());yield Promise.all(i)})()}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=e,i=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.CommunicationOptions",r.viewConfig);return yield t.processItemsAsync(i,r),e})()}}ut.\u0275fac=function(e){return new(e||ut)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(M.TranslateService),s.\u0275\u0275inject(Se),s.\u0275\u0275inject(Ce),s.\u0275\u0275inject(Ae))},ut.\u0275prov=s.\u0275\u0275defineInjectable({token:ut,factory:ut.\u0275fac});class dt{constructor(e){this._featureService=e,this._commonCommunicationsBehaviorFeature="CommonCommunicationsBehavior",this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this._replacementConfig={ContactCommunicationOptions:{replaceData:[{type:"crt.EmailInput",label:"Email",labelPosition:"above",control:"$Email",visible:!0,placeholder:"",tooltip:"",name:"Email"},{type:"crt.PhoneInput",label:"Mobile phone",labelPosition:"above",control:"$MobilePhone",visible:!0,placeholder:"",tooltip:"",name:"MobilePhone"}],additionalAttributesConfig:{MobilePhone:{modelConfig:{path:"PDS.MobilePhone"}},Email:{modelConfig:{path:"PDS.Email"}}}},AccountCommunicationOptions:{replaceData:[{type:"crt.WebInput",label:"Web",labelPosition:"above",control:"$Web",visible:!0,placeholder:"",tooltip:"",name:"Web"},{type:"crt.PhoneInput",label:"Primary phone",labelPosition:"above",control:"$Phone",visible:!0,placeholder:"",tooltip:"",name:"Phone"}],additionalAttributesConfig:{Phone:{modelConfig:{path:"PDS.Phone"}},Web:{modelConfig:{path:"PDS.Web"}}}}},this._namesToDelete=[...Object.keys(this._replacementConfig),"ContactCommunicationOptionsAddButton","AccountCommunicationOptionsAddButton"]}get isCommonCommunicationsBehaviorEnabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._commonCommunicationsBehaviorFeature))}get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_prepareAttibutesBeforeReplacement(e,t){const r=e?.additionalAttributesConfig||{};for(const[i,a]of Object.entries(r)){const o=Gt(t,a.modelConfig?.path);o&&o!==i&&(r[o]=t[o],delete r[i],e.replaceData=[...e.replaceData].map(n=>n.control===`$${i}`?{...n,control:`$${o}`}:n))}Object.assign(t,r)}_replaceCommOptionsWithFields(e){e.viewModelConfig={attributes:{},...e.viewModelConfig},p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("name",this._namesToDelete,e.viewConfig).forEach(r=>{const a=p.MetadataSchemaUtils.getViewConfigInfoByProperty("name",r.parentName,e.viewConfig)[0].viewConfig,o=r.viewConfig.name,n=a[r.parentPropertyName],l=n.indexOf(r.viewConfig);this._prepareAttibutesBeforeReplacement(this._replacementConfig[r.viewConfig.name],e.viewModelConfig.attributes);const d=this._replacementConfig[o]?.replaceData||[];n.splice(l,1,...d)})}_makeOtherCommOptionsComponentsReadonly(e){e.filter(r=>!this._namesToDelete.includes(r.viewConfig.name)).forEach(r=>r.viewConfig.readonly=!0)}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if((yield t.isProcessingDisabled)||(yield t.isCommonCommunicationsBehaviorEnabled))return e;const r=e,i=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.CommunicationOptions",r.viewConfig);return t._replaceCommOptionsWithFields(r),t._makeOtherCommOptionsComponentsReadonly(i),e})()}}dt.\u0275fac=function(e){return new(e||dt)(s.\u0275\u0275inject(A.FeatureService))},dt.\u0275prov=s.\u0275\u0275defineInjectable({token:dt,factory:dt.\u0275fac});var Qt=N(16710);class W{get isProcessingDisabled(){return(0,_.lastValueFrom)(this.featureService.getFeatureState(this.preprocessingFeature))}constructor(e,t,r,i,a){this.featureService=e,this.metadataModifierService=t,this.comboboxPreprocessorService=r,this.attributeConfigProvider=i,this.translateService=a,this.preprocessingFeature="",this.translatePrefix="",this.viewItemTypes=[],this.profileConfig={},this.editColumns=[],this.viewColumns=[]}_addImageSelectedRequest(e,t){e.imageSelected||this.metadataModifierService.addProperty(e,"imageSelected",{request:"crt.UploadImageRequest",params:{imageAttributeName:t,details:"@event"}})}_addimageClearRequest(e,t){e.imageClear||this.metadataModifierService.addProperty(e,"imageClear",{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:t,attributeValue:null}})}_getDataSourceAttributeByPath(e,t){return t?.find(r=>r.path===e)}_getViewModelAttributeByDataSourcePath(e,t,r){const i=Object.keys(t).find(o=>{const n=t[o]??{};return(0,g.isModelAttributeConfig)(n)&&n?.modelConfig?.path===e}),a=e.split(".");if(!i&&a.length>2){const o=a[0],n=a.slice(1).join("."),l=this._getDataSourceAttributeByPath(n,r?.attributes);return l&&this._getViewModelAttributeByDataSourcePath(`${o}.${l.name}`,t,r)}return i}_createViewModelAttribute(e,t,r){r[e]||(r[e]={modelConfig:{path:t}})}_findOrCreateViewModelAttribute(e,t,r,i){let a=this._getViewModelAttributeByDataSourcePath(e,t,r);if(!a){const o=e.split(".").slice(1).join("");a=`${this.profileConfig.name}_${o}`,this._createViewModelAttribute(a,e,t)}return i&&(t[a].validators={required:{type:"crt.Required"}}),a}_createFormField(e,t){const{columnName:r,propertyName:i,...a}=e;a.name=`${this.profileConfig.name}_${r.replace(".","")}Field`,a.control=this.profileConfig[i];const o=t?.attributes&&this._getDataSourceAttributeByPath(r,t.attributes);return o?(a.label=a.label||o.caption,a.type=a.type||this.attributeConfigProvider.getConfigByType(o.dataValueType).controlType):a.type=a.type||Qt.ControlTypes.Input,a.readonly||(a.readonly=r.split(".").length>1),a}_getComboboxesViewConfigs(e){return(e.dialogItems||[]).filter(r=>r.type===Qt.ControlTypes.Combobox&&!r.readonly)}_processComboboxes(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getComboboxesViewConfigs(e);i.comboboxPreprocessorService.crtOnMetaDataInit(a,t),yield i.comboboxPreprocessorService.crtOnModelInit(a,t,r)})()}_getReferenceColumnPath(e,t,r){let o=(t[e].modelConfig?.path||"").split(".");const n=o.shift()||"";if(o.slice(-1)[0]==="Id"&&o.pop(),!o.length)return n;if(o.length===1){const d=o[0];o=(r.findAttributeByName(d)?.path||"").split(".")}return o.unshift(n),o.join(".")}_initProfileConfig(e,t,r,i){this.profileConfig={name:e.name},this.viewColumns.forEach(a=>{if(!a.propertyName)return;const o=t+"."+a.columnName,n=a.isRequired&&!e.readonly,l=this._findOrCreateViewModelAttribute(o,r,i,n);this.profileConfig[a.propertyName]=`$${l}`}),this.profileConfig.photo+=this.profileConfig.photo?" | crt.ToImageLink":"",Object.assign(this.profileConfig,e),Object.assign(e,this.profileConfig)}_initDialogItems(e,t){e.dialogItems||(e.dialogItems=[]),e.dialogTitle=this.translateService.instant(this.translatePrefix+".DialogTitle"),this.editColumns.forEach(r=>{const i=this._createFormField(r,t);e.dialogItems.findIndex(o=>o.name===i.name)===-1&&e.dialogItems.push(i)})}addProfileChangeHandlers(e){if(e.photo){const r=e.photo.split("|").map(i=>i.trim())[0].slice(1);this._addImageSelectedRequest(e,r),this._addimageClearRequest(e,r)}}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const i=e,a=p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",r.viewItemTypes,i.viewConfig);for(const o of a){const n=o.viewConfig.referenceColumn||"",l=n.slice(1).split(".").pop()||"",m=e.viewModelConfig.attributes;if((0,R.isBindToViewModelAttribute)(n,m)){const h=m[l]??{};let y="";(0,g.isModelAttributeConfig)(h)&&(y=h.modelConfig?.path.split(".")[0]);const C=t.find(xt=>xt.name===y),P=yield(0,_.lastValueFrom)(C.getSchema()),T=r._getReferenceColumnPath(l,m,P);o.viewConfig.readonly=T.split(".").length>1||o.viewConfig.readonly,r._initProfileConfig(o.viewConfig,T,m,P),o.viewConfig.readonly||(r.addProfileChangeHandlers(o.viewConfig),r._initDialogItems(o.viewConfig,P),yield r._processComboboxes(o.viewConfig,m,t))}else o.viewConfig.readonly=!0}return e})()}}W.\u0275fac=function(e){return new(e||W)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(g.MetadataModifierService),s.\u0275\u0275inject($),s.\u0275\u0275inject(Qt.AttributeConfigProvider),s.\u0275\u0275inject(M.TranslateService))},W.\u0275prov=s.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac});class ve extends W{constructor(){super(...arguments),this.preprocessingFeature="DisableAccountCompactProfilePreprocessing",this.translatePrefix="AccountCompactProfile",this.viewItemTypes=["crt.AccountCompactProfile"],this.editColumns=[{columnName:"Name",propertyName:"accountName"},{columnName:"AlternativeName",propertyName:"alternativeName",label:this.translateService.instant(this.translatePrefix+".AlternativeNameFieldLabel")}],this.viewColumns=[...this.editColumns,{columnName:"Country",propertyName:"country"},{columnName:"City",propertyName:"city"},{columnName:"AccountLogo",propertyName:"photo"},{columnName:"City.TimeZone",propertyName:"timeZone"}]}}ve.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(ve)))(t||ve)}}(),ve.\u0275prov=s.\u0275\u0275defineInjectable({token:ve,factory:ve.\u0275fac});class Ie extends W{constructor(){super(...arguments),this.preprocessingFeature="DisableContactCompactProfilePreprocessing",this.translatePrefix="ContactCompactProfile",this.viewItemTypes=["crt.ContactCompactProfile"],this.editColumns=[{columnName:"GivenName",propertyName:"firstName",isRequired:!0},{columnName:"Surname",propertyName:"lastName"},{columnName:"MiddleName",propertyName:"middleName"},{columnName:"BirthDate",propertyName:"birthDate",pickerType:"date"}],this.viewColumns=[...this.editColumns,{columnName:"Country",propertyName:"country"},{columnName:"City",propertyName:"city"},{columnName:"Photo",propertyName:"photo"},{columnName:"City.TimeZone",propertyName:"timeZone"},{columnName:"Name",propertyName:"displayName"}]}_addChangeHandler(e,t,r){if(e[t]&&!e[r]){const i=e[t];this.metadataModifierService.addProperty(e,r,{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:i.slice(1),attributeValue:"@event"}})}}addProfileChangeHandlers(e){super.addProfileChangeHandlers(e),this._addChangeHandler(e,"displayName","fullNameChange"),this._addChangeHandler(e,"firstName","firstNameChange"),this._addChangeHandler(e,"lastName","lastNameChange"),this._addChangeHandler(e,"middleName","middleNameChange")}}Ie.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Ie)))(t||Ie)}}(),Ie.\u0275prov=s.\u0275\u0275defineInjectable({token:Ie,factory:Ie.\u0275fac});class Pe extends W{constructor(){super(...arguments),this.preprocessingFeature="DisableUserCompactProfilePreprocessing",this.translatePrefix="UserCompactProfile",this.viewItemTypes=["crt.UserCompactProfile"],this.editColumns=[{columnName:"FirstName",propertyName:"firstName",isRequired:!0},{columnName:"MiddleName",propertyName:"middleName"},{columnName:"LastName",propertyName:"lastName"}],this.viewColumns=[...this.editColumns,{columnName:"Photo",propertyName:"photo"}]}}Pe.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Pe)))(t||Pe)}}(),Pe.\u0275prov=s.\u0275\u0275defineInjectable({token:Pe,factory:Pe.\u0275fac});class mt{crtOnMetaDataInit(e){return(0,u.Z)(function*(){const t=e;return t.name==="Playbooks_FormPage"&&(t.viewModelConfig.attributes.DcmStages={from:"CrtPlaybookDS_DcmCase",converter:"crt.ToDcmStageValue"}),Promise.resolve(e)})()}}mt.\u0275fac=function(e){return new(e||mt)},mt.\u0275prov=s.\u0275\u0275defineInjectable({token:mt,factory:mt.\u0275fac});class pt{constructor(){this._pageSize=150}_getViewConfigs(e,t){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",t,e.viewConfig).map(r=>r?.viewConfig).filter(Boolean)}_setCrudEventsBindings(e){e.emailComposerSaved={request:"crt.EmailComposerSavedRequest",params:{emailWithParams:"@event"}}}crtOnMetaDataInit(e){const t=e;return this._getViewConfigs(t,"crt.EmailComposer").forEach(i=>{this._setCrudEventsBindings(i)}),Promise.resolve(e)}}pt.\u0275fac=function(e){return new(e||pt)},pt.\u0275prov=s.\u0275\u0275defineInjectable({token:pt,factory:pt.\u0275fac});class ft{_modifyInputType(e,t,r){const i=e.control.replace("$",""),a=t.attributes[i]?.modelConfig?.path;if(a){const o=this._getDataSchemaAttributeByPath(a,r);b.DataValueType.EMAIL_TEXT&&o?.dataValueType===b.DataValueType.EMAIL_TEXT&&(e.type="crt.EmailInput",e.isFormatValidated=o.isFormatValidated)}}_getDataSchemaAttributeByPath(e,t){const[r,i]=e.split("."),a=t.dataSchemas[r]?.attributes;let o;for(const n in a)if(a[n].path===i){o=a[n];break}return o}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),n=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.EmailInput",a.viewConfig);return o.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),n.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),e})()}}ft.\u0275fac=function(e){return new(e||ft)},ft.\u0275prov=s.\u0275\u0275defineInjectable({token:ft,factory:ft.\u0275fac});class gt{get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState("DisableEntityStageProgressBarPreprocessing"))}constructor(e,t,r,i){this._featureService=e,this._dcmSettingsService=t,this._dcmSchemaManagerService=r,this._configurationDataService=i,this._componentName="crt.EntityStageProgressBar",this._stagesAttributeSuffix="_StagesList",this._stageConnectionsAttributeSuffix="_StageConnections",this._allowedStagesAttributeSuffix="_AllowedStages",this._valueAttributeSuffix="_CurrentStage",this._stageFilteredByAttributeSuffix="_StageFilteredBy",this._stageRunningProcessUIdAttributeSuffix="_RunningProcessUId",this._entityStageSchemasAttributeSuffix="_EntityStageSchemas",this._isAppropriateEntityStageSchemaAttributeSuffix="_IsAppropriateEntityStageSchema",this._filteredByValueAttributeName="",this._primaryDataSourceName=""}_getComponents(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getComponentName(e){return e.name.replace(/\./g,"_")}_getStageColumnName(e){return(0,_.lastValueFrom)(this._dcmSettingsService.getStageColumnName(e),{defaultValue:null})}_getEntityStagesSchemas(e){return(0,_.lastValueFrom)(this._dcmSchemaManagerService.getDcmSchemaDataCollection().pipe((0,O.map)(t=>t.filter(r=>r.entitySchemaUId===e))))}_getEntitySchemaUid(e){return(0,_.lastValueFrom)(this._configurationDataService.getEntityUId(e).pipe((0,O.map)(t=>t?.data?.entityUIds?.filter(r=>r.entitySchemaName===e)[0].entitySchemaUId)))}_findAttributeKeyByPath(e,t){let r=null;return Object.keys(e).forEach(i=>{e[i]?.modelConfig?.path===t&&(r=i)}),r}_generateAttributes(e){return{listAttributeName:`${e}${this._stagesAttributeSuffix}`,stageConnectionsAttributeName:`${e}${this._stageConnectionsAttributeSuffix}`,allowedStagesAttributeName:`${e}${this._allowedStagesAttributeSuffix}`,stageRunningProcessUIdAttributeName:`${e}${this._stageRunningProcessUIdAttributeSuffix}`,entityStageSchemasAttribute:`${e}${this._entityStageSchemasAttributeSuffix}`,isAppropriateEntityStageSchemaAttribute:`${e}${this._isAppropriateEntityStageSchemaAttributeSuffix}`,currentStageAttributeName:""}}_loadEntityStageSchemas(e,t,r){var i=this;return(0,u.Z)(function*(){const a=yield i._getEntitySchemaUid(t),o=(yield i._getEntityStagesSchemas(a)).filter(n=>n.isActive&&n.isActiveVersion);if(o){e[`${r}${i._entityStageSchemasAttributeSuffix}`]={value:o};const n=o.find(C=>C.filters)?.filters;if(!n)return;const l=JSON.parse(n),m=Object.values(l.items)[0].leftExpression.columnPath,h=`${i._primaryDataSourceName}.${m}`,y=i._findAttributeKeyByPath(e,h);y&&(i._filteredByValueAttributeName=y),i._filteredByValueAttributeName||(i._filteredByValueAttributeName=`${r}${i._stageFilteredByAttributeSuffix}`,e[i._filteredByValueAttributeName]={modelConfig:{path:h}})}})()}_loadEntityAttributes(e,t){var r=this;return(0,u.Z)(function*(){const i=`ProgressBarComponent_${t}`,a=r._generateAttributes(i);let o=e.viewModelConfig.attributes;o||(o=e.viewModelConfig.attributes={}),o[a.entityStageSchemasAttribute]={value:null},yield r._loadEntityStageSchemas(o,t,i),a.filterValueAttributeName=r._filteredByValueAttributeName||"";const n=yield r._getStageColumnName(t);return n&&(a.currentStageAttributeName=r.setupColumnAttribute(n,o,i,r._valueAttributeSuffix)),a.idAttributeName=r.setupColumnAttribute("Id",o,i,"_RecordId"),o[a.listAttributeName]={value:null},o[a.stageConnectionsAttributeName]={value:null},o[a.allowedStagesAttributeName]={value:null},o[a.stageRunningProcessUIdAttributeName]={value:null},o[a.isAppropriateEntityStageSchemaAttribute]={value:!0},a})()}setupColumnAttribute(e,t,r,i){const a=`${this._primaryDataSourceName}.${e}`;let o=this._findAttributeKeyByPath(t,a);return o||(o=`${r}${i}`,t[o]={modelConfig:{path:a}}),o}_setupComponentConfig(e,t){this._setupComponentFields(e,t),this._setupComponentHandlers(e,t)}_setupComponentFields(e,t){const r=e?.viewConfig;r.recordId=`$${t.idAttributeName}`,r.stages=`$${t.listAttributeName}`,r.stageConnections=`$${t.stageConnectionsAttributeName}`,r.allowedStages=`$${t.allowedStagesAttributeName}`,r.stageSchemaFilterByValue=`$${t.filterValueAttributeName}`,r.value=`$${t.currentStageAttributeName}`,r.isAppropriateEntityStageSchema=`$${t.isAppropriateEntityStageSchemaAttribute}`,r.stageRunningProcessUId=`$${t.stageRunningProcessUIdAttributeName}`}_setupComponentHandlers(e,t){const r=e?.viewConfig;r.stageChanged={request:"crt.EntityStageProgressBarStageChangedHandlerRequest",params:{stageAttribute:t.currentStageAttributeName,stagesAttribute:t.listAttributeName,config:"@event"}},r.setAllowedStages={request:"crt.EntityStageProgressBarProcessStagePermissionsHandlerRequest",params:{stagesAttribute:t.listAttributeName,config:"@event"}},r.loadData={request:"crt.EntityStageProgressBarLoadDataHandlerRequest",params:{stagesAttribute:t.listAttributeName,stageConnectionsAttribute:t.stageConnectionsAttributeName,allowedStagesAttribute:t.allowedStagesAttributeName,stageRunningProcessUIdAttribute:t.stageRunningProcessUIdAttributeName,stageSchemaFilterByValueName:t.filterValueAttributeName,config:"@event"}},r.checkIsAnAppropriateProcessSchema={request:"crt.EntityStageProcessAppropriateCheckHandlerRequest",params:{entityStageSchemas:`$${t.entityStageSchemasAttribute}`,stageRunningProcessUId:`$${t.stageRunningProcessUIdAttributeName}`,filterColumnAttributeName:t.filterValueAttributeName,isAppropriateEntityStageSchemaAttribute:t.isAppropriateEntityStageSchemaAttribute,config:"@event"}},r.changeToAppropriateEntityStageSchema={request:"crt.EntityStageProgressBarChangeStageProcessHandlerRequest",params:{entityName:e?.viewConfig.entityName,entityId:`$${t.idAttributeName}`,currentStage:`$${t.currentStageAttributeName}`,stageRunningProcessUIdAttribute:t.stageRunningProcessUIdAttributeName,isAppropriateEntityStageSchemaAttribute:t.isAppropriateEntityStageSchemaAttribute,loadDataRequest:r.loadData}}}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const i=e;r._primaryDataSourceName=(0,I.resolveSchemaPrimaryDataSource)(i);const a=r._getComponents(i),o=a.map(n=>n.viewConfig.entityName).filter((n,l,d)=>d.indexOf(n)===l);for(const n of o){r._filteredByValueAttributeName="";const l=yield r._loadEntityAttributes(i,n);for(const d of a.filter(m=>m.viewConfig.entityName===n))r._setupComponentConfig(d,l)}return e})()}}gt.\u0275fac=function(e){return new(e||gt)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(A.DcmSettingsService),s.\u0275\u0275inject(A.DcmSchemaManagerService),s.\u0275\u0275inject(A.ConfigurationDataService))},gt.\u0275prov=s.\u0275\u0275defineInjectable({token:gt,factory:gt.\u0275fac});var Ne=N(96923);const vr=32,Ir=81;class De{_getDataGridViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.DataGrid",e?.items)}_setDataGridMaxHeight(e){if(!e.layoutConfig?.rowSpan)return;const r=e.layoutConfig.rowSpan*vr,i=Math.max(r,Ir);e.layoutConfig.rowSpan=1,e.styles=(0,S.merge)(e.styles,{["max-height"]:`${i}px`})}_replaceLegacyGridContainerRowsConfig(e){const t=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.GridContainer",e).shift();t?.viewConfig?.rows?.replace(/\s/g,"")==="minmax(32px,32px)"&&(t.viewConfig.rows="minmax(max-content, 32px)")}setDataGridMaxHeight(e){const t=this._getDataGridViewConfigs(e);t.forEach(r=>{this._setDataGridMaxHeight(r.viewConfig)}),t.length&&this._replaceLegacyGridContainerRowsConfig(e?.items)}}De.\u0275fac=function(e){return new(e||De)},De.\u0275prov=s.\u0275\u0275defineInjectable({token:De,factory:De.\u0275fac});class ht{constructor(e,t,r){this._featureService=e,this._expandedListLayoutService=t,this._profileAttributeService=r,this._expPanelActionsProcessingDisableFeature="DisableExpansionPanelPreprocessing"}_filterItemsByGridType(e){if(!e.items||e.items.length===0)return;const t=e?.tools??[],r=e.items.filter(i=>i.gridContainerType===f.ExpansionPanelGridContainerType.TOOLS);t?.length===0&&r?.length>0&&(e.items=e.items.filter(i=>i.gridContainerType!==f.ExpansionPanelGridContainerType.TOOLS),e.tools=r)}_processPaddings(e){e.padding||(e.padding={top:Ne.SizeEnum.Small,bottom:Ne.SizeEnum.Small,left:Ne.SizeEnum.Medium,right:Ne.SizeEnum.Medium})}get _isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._expPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t._isProcessingDisabled)return e;const r=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ExpansionPanel",r.viewConfig).forEach(function(){var a=(0,u.Z)(function*(o){t._expandedListLayoutService.setDataGridMaxHeight(o.viewConfig),t._filterItemsByGridType(o.viewConfig),t._processPaddings(o.viewConfig),yield t._profileAttributeService.prepareAttributeWithFeatureCheck(r,o.viewConfig,"expanded","","DisableSaveToProfileExpPanelExpanded")});return function(o){return a.apply(this,arguments)}}()),e})()}}ht.\u0275fac=function(e){return new(e||ht)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(De),s.\u0275\u0275inject(w))},ht.\u0275prov=s.\u0275\u0275defineInjectable({token:ht,factory:ht.\u0275fac});class _t{_getFeedViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Feed",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_setValueAttribute(e,t){t.feedType!==f.FeedSourceType.Record||this._validateRecordFeedConfig(e,t)||!(0,I.resolveSchemaPrimaryDataSource)(e)||(t.primaryColumnValue=`$${this._getOrAddAttribute(e,t)}`,t.entitySchemaName=this._getEntitySchemaName(e))}_validateRecordFeedConfig(e,t){const r=e.viewModelConfig.attributes,i=t.primaryColumnValue?.split("$")[1],a=r[i];return!(0,S.isEmpty)(t.entitySchemaName)&&!!a}_getOrAddAttribute(e,t){return this._findAttribute(e,t)||this._createAttribute(e,t)}_findAttribute(e,t){const i=`${(0,I.resolveSchemaPrimaryDataSource)(e)}.Id`,a="#PrimaryDataSourceName()#.Id",o=e.viewModelConfig.attributes,n=Object.keys(o).find(d=>{const h=(o[d]??{}).modelConfig?.path;return h===i||h===a});if(!(0,S.isEmpty)(n))return n;const l=`${t.name}_RecordId`;return l in o?l:void 0}_createAttribute(e,t){const r=(0,I.resolveSchemaPrimaryDataSource)(e),i=e.viewModelConfig.attributes,a=`${t.name}_RecordId`;return i[a]={modelConfig:{path:`${r}.Id`}},a}_getEntitySchemaName(e){const t=(0,I.resolveSchemaPrimaryDataSource)(e);return(e.modelConfig?.dataSources||{})[t]?.config?.entitySchemaName}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e;return t._getFeedViewConfigs(r).forEach(a=>{t._setValueAttribute(r,a)}),Promise.resolve(e)})()}}_t.\u0275fac=function(e){return new(e||_t)},_t.\u0275prov=s.\u0275\u0275defineInjectable({token:_t,factory:_t.\u0275fac});class bt{get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._fileInputPreprocessingDisableFeature))}constructor(e){this._featureService=e,this._fileInputPreprocessingDisableFeature="DisableFileInputPreprocessing"}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FileInput",r.viewConfig).forEach(a=>{if(!a.viewConfig.upload){const n=a.viewConfig.control.slice(1);a.viewConfig.upload={request:"crt.UploadDataAttributeFileRequest",params:{fileAttributeName:n,detail:"@event.detail"}}}a.viewConfig.download||(a.viewConfig.download={request:"crt.DownloadEntityFileRequest",params:{detail:"@event.detail"}})}),e})()}}bt.\u0275fac=function(e){return new(e||bt)(s.\u0275\u0275inject(A.FeatureService))},bt.\u0275prov=s.\u0275\u0275defineInjectable({token:bt,factory:bt.\u0275fac});class St extends jt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.FileList"]}setRowToolbarMenuItems(e,t){var r=this;return(0,u.Z)(function*(){const i=e.items.slice(1),a=t.getBoundDataSourceNameByAttributePath(i);e.rowToolbarItems=[{type:"crt.MenuItem",caption:r._translateService.instant("DataGrid.RowToolbar.Delete"),icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${a}_Id`},useRelativeContext:!1}}]})()}}St.\u0275fac=function(e){return new(e||St)(s.\u0275\u0275inject(M.TranslateService))},St.\u0275prov=s.\u0275\u0275defineInjectable({token:St,factory:St.\u0275fac});class At extends L{constructor(e,t,r,i){super(e,t,r),this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=r,this._cellViewConfigCreatorFactory=i,this._predefinedColumns={},this.viewItemTypes=["crt.FileList"]}_setPredefinedColumnDefinitions(e){for(const t of e){const r=t.viewConfig.name,i=t.viewConfig.columns,a=[];for(const o of i)o.cellView&&a.push(o.code);this._predefinedColumns[r]=a}}_processFileListColumnDefinitions(e,t,r){var i=this;return(0,u.Z)(function*(){const{dataSourceName:a,dataSchema:o,itemsAttributeName:n,viewModel:l}=t,{primaryAttributeName:d,primaryDisplayAttributeName:m}=o??{},h=o.name,y=d&&`${a}_${d}`;for(const C of r){const P=o.attributes.find(di=>(0,p.removeSpecialSymbols)(`${a}_${di.name}`)===C.code);if(!P)continue;const T=P.name,xt={columnName:T,dataValueType:P.dataValueType,primaryDisplayAttributeName:m},ui={column:C,context:l,itemsAttributeName:n,primaryAttributeName:y,dataSchemaName:h,columnName:T},hr=yield i._cellViewConfigCreatorFactory.create(xt)?.getViewElementConfig(ui);hr&&!i._predefinedColumns[e]?.includes(C.code)&&i.metadataModifierService.addProperty(C,"cellView",hr)}})()}crtOnViewModelInit(e,t,r){var i=()=>super.crtOnViewModelInit,a=this;return(0,u.Z)(function*(){if(yield(0,_.lastValueFrom)(a.featureService.getFeatureState(a.featureName),{defaultValue:null}))return e;const n=p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",a.viewItemTypes,e.viewConfig);a._setPredefinedColumnDefinitions(n),e=yield i().call(a,e,t,r);for(const l of n){const d=l.viewConfig.columns,m=l.viewConfig.name,h=yield a.getGenerateCellViewConfig(l.viewConfig,r);h&&(yield a._processFileListColumnDefinitions(m,h,d))}return e})()}}At.\u0275fac=function(e){return new(e||At)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(g.MetadataModifierService),s.\u0275\u0275inject(v.DataGridColumnDefinitionService),s.\u0275\u0275inject(v.FILE_LIST_CELL_VIEW_CONFIG_CREATOR_FACTORY))},At.\u0275prov=s.\u0275\u0275defineInjectable({token:At,factory:At.\u0275fac});class Z{get order(){return this.index||0}constructor(e){this.featureService=e,this.componentTypes=[]}getComponentsToProcess(e){return p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this.componentTypes,e.viewConfig)}process(e,t){var r=this;return(0,u.Z)(function*(){const i=r.getComponentsToProcess(e);return yield r.innerProcess(i,e,t)})()}}Z.\u0275fac=function(e){return new(e||Z)(s.\u0275\u0275inject(A.FeatureService))},Z.\u0275prov=s.\u0275\u0275defineInjectable({token:Z,factory:Z.\u0275fac});class Te extends Z{constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=2,this.defaultFilesEntitySchemaName="SysFile",this._galleryColumnNames=["Name","CreatedOn","Size"]}_addDataSourceAttributes(e,t){let r=e[t];r||(r=E.createDataSourceConfig(this.defaultFilesEntitySchemaName),e[t]=r);const i=r.config||{attributes:{}};i.attributes=i.attributes||{},this._galleryColumnNames.forEach(a=>{i?.attributes[a]||(i.attributes[a]={path:a})}),r.config=i}_addViewModelAttributes(e,t,r){if(!e?.attributes)return;const a=e.attributes[t]?.viewModelConfig?.attributes;!a||this._galleryColumnNames.forEach(o=>{const n=`${r}_${o}`;a[n]||(a[n]={modelConfig:{path:`${r}.${o}`}})})}_applyGalleryConfig(e,t){t.viewConfig.galleryItemConfig||(t.viewConfig.galleryItemConfig={templateValuesMapping:{fileId:`${e}_Id`,fileName:`${e}_Name`,fileCreatedOn:`${e}_CreatedOn`,fileSize:`${e}_Size`}}),t.viewConfig.galleryItemConfig.defaultSize=t.viewConfig.tileSize||Ne.SizeEnum.Medium}_getAttributeDSName(e){return`${e}${g.DATA_SOURCE_PREFIX}`}innerProcess(e,t,r){var i=this;return(0,u.Z)(function*(){return e.forEach(a=>{const o=a.viewConfig.items;if(typeof o!="string")return;const n=o.split("$")[1];if(!n)return;const l=i._getAttributeDSName(n);i._addDataSourceAttributes(t.modelConfig?.dataSources||{},l),i._addViewModelAttributes(t.viewModelConfig,n,l),i._applyGalleryConfig(l,a)}),yield Promise.resolve(t)})()}}Te.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Te)))(t||Te)}}(),Te.\u0275prov=s.\u0275\u0275defineInjectable({token:Te,factory:Te.\u0275fac});class Fe extends Z{constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=1,this.defaultPrimaryColumnName="Id",this.defaultFilesEntitySchemaName="SysFile",this.defaultRecordColumnName="RecordId",this._fileDropDisableFeature="DisableFileListDropPreprocessing"}_getAdditionalFilterName(e){return`${e}_PredefinedFilter`}_createViewModelAttribute(e){return{isCollection:!0,modelConfig:{path:e},viewModelConfig:{attributes:{}}}}_getUploadFileRequest(e){return{request:"crt.UploadFileRequest",params:{viewElementName:e}}}_setFileListDropZoneParameters(e,t){t&&(e.viewConfig.droppable=!1,e.viewConfig.fileDropped=void 0),e.viewConfig.droppable!==!1&&(e.viewConfig.droppable=!0,e.viewConfig.fileDropped||(e.viewConfig.fileDropped=this._getUploadFileRequest(e.viewConfig.name)))}_setFileListUploadButtonParameters(e){e.viewConfig.uploadClicked||(e.viewConfig.uploadClicked=this._getUploadFileRequest(e.viewConfig.name))}_tryAddFileListProperties(e){if(e.viewConfig.items||(e.viewConfig.items=`$${e.viewConfig.name}`),!e.viewConfig.primaryColumnName){const t=e.viewConfig.name,i=`${E.getAttributeDSName(t)}_${this.defaultPrimaryColumnName}`;e.viewConfig.primaryColumnName=i}}_linkFilterToAttribute(e,t){if(e=e??{},!(0,g.isModelAttributeConfig)(e)||!e.modelConfig)return;const r=e.modelConfig.filterAttributes||[];r.find(i=>i.name===t)||r.push({loadOnChange:!0,name:t}),e.modelConfig.filterAttributes=r}tryAddAttributeAndDataSource(e,t,r){var i=this;return(0,u.Z)(function*(){const a=r.viewConfig.items;if(typeof a!="string")return;const o=a.split("$")[1];if(!o)return;const n=E.getAttributeDSName(o),l=i._getAdditionalFilterName(o);e.modelConfig||(e.modelConfig={});const d=e.modelConfig.dataSources||{},m=e.viewModelConfig.attributes||{};if(d[n]||(d[n]=E.createDataSourceConfig(i.defaultFilesEntitySchemaName),e.modelConfig.dataSources=d),E.addDependencies(e,r.viewConfig,n),m[o]||(m[o]=i._createViewModelAttribute(n),e.viewModelConfig.attributes=m),!m[l]){const h=r.viewConfig.fileGroups,y=r.viewConfig.tag||"",C=d[n].config?.entitySchemaName,P=yield E.getRecordEntitySchemaName(r.viewConfig.items,r.viewConfig?.masterRecordColumnValue,e,t),T=tr(h,y,C,P);T&&(m[l]=T,i._linkFilterToAttribute(m[o],l),e.viewModelConfig.attributes=m)}})()}innerProcess(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i.featureService.getFeatureState(i._fileDropDisableFeature),o=yield(0,_.lastValueFrom)(a);return e.forEach(function(){var n=(0,u.Z)(function*(l){i._tryAddFileListProperties(l),i._setFileListDropZoneParameters(l,o),i._setFileListUploadButtonParameters(l),yield i.tryAddAttributeAndDataSource(t,r,l)});return function(l){return n.apply(this,arguments)}}()),t})()}}Fe.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Fe)))(t||Fe)}}(),Fe.\u0275prov=s.\u0275\u0275defineInjectable({token:Fe,factory:Fe.\u0275fac});const Ut=new s.InjectionToken("FILE_UPLOAD_METADATA_WORKER");class Ct{constructor(e){this._workers=e??[]}run(e,t){var r=this;return(0,u.Z)(function*(){const i=[...r._workers].sort((a,o)=>a.order-o.order);for(const a of i)yield a.process(e,t)})()}}Ct.\u0275fac=function(e){return new(e||Ct)(s.\u0275\u0275inject(Ut,8))},Ct.\u0275prov=s.\u0275\u0275defineInjectable({token:Ct,factory:Ct.\u0275fac,providedIn:"root"});class Ee extends Z{constructor(){super(...arguments),this.index=3,this._uploadFileRequestName="crt.UploadFileRequest",this._defaultFilesEntitySchemaName="SysFile",this._defaultRecordColumnName="RecordId"}_getUploadFileRequestConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],e.viewConfig).filter(t=>t.viewConfig.clicked?.request===this._uploadFileRequestName).map(t=>t.viewConfig.clicked)}_getFileLists(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FileList",e.viewConfig)}_getFileDropRequestConfigs(e){const t=this._getFileLists(e);return t.filter(r=>r.viewConfig.fileDropped?.request===this._uploadFileRequestName).map(r=>r.viewConfig.fileDropped).concat(t.filter(r=>r.viewConfig.uploadClicked?.request===this._uploadFileRequestName).map(r=>r.viewConfig.uploadClicked))}getFilesEntitySchemaName(e,t,r){const i=E.getDataSourceNameByAttribute(e);return i?E.getDataSchemaName({models:r,schema:t,dataSourceName:i}):Promise.resolve(null)}setRequestParam(e,t,r){!e[t]&&r&&(e[t]=r)}getBaseRequestParams(){return{fileGroup:g.FileGroupEnum.Attachments,tag:"",files:"@event.files"}}getDefaultRequestParams(e){const t=E.getDataSourcePrimaryAttribute(e);return{...this.getBaseRequestParams(),recordId:`$${t}`,fileEntitySchemaName:this._defaultFilesEntitySchemaName,recordColumnName:this._defaultRecordColumnName}}getRequestParams(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i.getBaseRequestParams(),o=e.items,n=(yield i.getFilesEntitySchemaName(o,t,r))||i._defaultFilesEntitySchemaName,l=e?.masterRecordColumnValue,d=yield E.getRecordEntitySchemaName(o,l,t,r);return{...a,fileGroup:e?.fileGroups&&e.fileGroups[0],tag:e?.tag,recordId:l,itemsAttributeName:e.name,fileEntitySchemaName:n,recordEntitySchemaName:d,recordColumnName:e.recordColumnName||i._defaultRecordColumnName}})()}_setRequestParams(e,t){for(const r in t)t[r]&&this.setRequestParam(e.params,r,t[r])}_extendRequestParams(e,t,r,i){var a=this;return(0,u.Z)(function*(){e.params=e.params||{};const o=t.find(l=>l.viewConfig.name===e.params.viewElementName),n=o?yield a.getRequestParams(o.viewConfig,r,i):a.getDefaultRequestParams(r);a._setRequestParams(e,n)})()}getComponentsToProcess(e){return[...this._getUploadFileRequestConfigs(e),...this._getFileDropRequestConfigs(e)]}innerProcess(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getFileLists(t);for(const o of e)yield i._extendRequestParams(o,a,t,r);return t})()}}Ee.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Ee)))(t||Ee)}}(),Ee.\u0275prov=s.\u0275\u0275defineInjectable({token:Ee,factory:Ee.\u0275fac});class H{}H.\u0275fac=function(e){return new(e||H)},H.\u0275mod=s.\u0275\u0275defineNgModule({type:H}),H.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:Ut,useClass:Te,multi:!0},{provide:Ut,useClass:Fe,multi:!0},{provide:Ut,useClass:Ee,multi:!0}],imports:[kt.CommonModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(H,{imports:[kt.CommonModule]})}();class yt{get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._fileListPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._workersService=t,this._fileListPreprocessingDisableFeature="DisableFileListPreprocessing"}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const i=e;return yield r._workersService.run(i,t),e})()}}yt.\u0275fac=function(e){return new(e||yt)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(Ct))},yt.\u0275prov=s.\u0275\u0275defineInjectable({token:yt,factory:yt.\u0275fac});const pi={fileLists:{A:"FileListA",B:"FileListB",C:"FileListC",D:"FileListD",E:"FileListE",F:"FileListF",G:"FileListG",H:"FileListH",I:"FileListI",WithDeepMasterRecordColumn:"FileListWithDeepMasterRecordColumn",WithAttributeWoPath:"FileListWithAttributeWoPath",WithUploadButton:"FileListWithCustomUploadButton",WoMasterRecordColumn:"FileListWoMasterRecordColumn",WoRecordSchemaName:"FileListWoRecordSchemaName",WithRecordSchemaName:"FileListWithRecordSchemaName",WoDropZone:"FileListWoDropZone"},recordColumnNameA:"ColumnA",testFileEntity:"TestFile",testEntityName:"TestEntity",testTag:"TestTag"};function fi(){return{viewConfig:[{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.WithUploadButton,uploadClicked:{request:"crt.UploadFileRequest",params:{viewElementName:"custom"}}},{type:"crt.FileList",droppable:!1,name:TEST_SCHEMA_DATA.fileLists.WoDropZone},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerId",recordColumnName:TEST_SCHEMA_DATA.recordColumnNameA,primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.A,tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListRecordSchemaName",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName},{type:"crt.FileList",items:"$FileListE",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.E,fileGroups:[FileGroupEnum.Attachments]},{type:"crt.FileList",items:"$FileListF",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.F,fileGroups:[FileGroupEnum.Attachments],tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListG",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.G},{type:"crt.FileList",items:TEST_SCHEMA_DATA.fileLists.H,masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.H},{type:"crt.FileList",items:"$FileListI",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.I},{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.B,droppable:!0}],name:"InnerContainer"},{type:"crt.Button",name:"ButtonA",clicked:{request:"crt.UploadFileRequest",params:{maximumAllowedFileSize:null,allowedFileTypes:"",viewElementName:TEST_SCHEMA_DATA.fileLists.A}}},{type:"crt.Button",name:"ButtonB",clicked:{request:"crt.UploadFileRequest",params:{}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName}}},{type:"crt.Button",name:"ButtonC",menuItems:[{type:"crt.MenuItem",name:"MenuItemA",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.B}}},{type:"crt.MenuItem",name:"MenuItemB",clicked:{request:"crt.UpdateRecordRequest",params:{}}},{type:"crt.MenuItem",name:"MenuItemC"}]},{type:"crt.Button",name:"ButtonD",clicked:"$onClick"},{type:"crt.Button",name:"ButtonE"},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountId",name:TEST_SCHEMA_DATA.fileLists.C,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoColumn",name:TEST_SCHEMA_DATA.fileLists.D,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoPath",name:TEST_SCHEMA_DATA.fileLists.WithAttributeWoPath},{type:"crt.FileList",masterRecordColumnValue:"not a master record attribute",name:TEST_SCHEMA_DATA.fileLists.WoMasterRecordColumn},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn,recordColumnName:"RecordId"},{type:"crt.Button",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn}}}],name:"MainContainer"}],viewModelConfig:{attributes:{OwnerId:{modelConfig:{path:"PDS.Id"}},OwnerAccountId:{modelConfig:{path:"PDS.OwnerAccountId"}},FileListA:{isCollection:!0,modelConfig:{path:"FileListADS",filterAttributes:[{loadOnChange:!0,name:"FileListA_PredefinedFilter"}]},viewModelConfig:{attributes:{FileListADS_Name:{modelConfig:{path:"FileListADS.NamePredefined"}},FileListADS_CreatedOn:{modelConfig:{path:"FileListADS.CreatedOnPredefined"}},FileListADS_Size:{modelConfig:{path:"FileListADS.SizePredefined"}}}}},FileListRecordSchemaName:{isCollection:!0,modelConfig:{path:"FileListRecordSchemaNameDS"}},FileListE:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListF:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListG:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListI:{isCollection:!0,modelConfig:null,viewModelConfig:{attributes:{}}},AttributeWoColumn:{modelConfig:{path:"AttributeWoColumn"}},AttributeWoPath:{modelConfig:{path:""}},AttributeWoModelConfig:{modelConfig:void 0},OwnerAccountCreatedBy:{modelConfig:{path:"PDS.OwnerAccountCreatedBy"}}}},modelConfig:{dataSources:{PDS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testEntityName,attributes:{OwnerAccountId:{path:"Owner.Account.Id"},OwnerAccountCreatedBy:{path:"Owner.Account.CreatedBy"}}}},FileListADS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testFileEntity}},FileListRecordSchemaNameDS:{type:"crt.EntityDataSource",config:{entitySchemaName:"ObjectWithoutRecordSchemaName"}}},primaryDataSourceName:"PDS",dependencies:{FileListADS:[{attributePath:"RecordId",relationPath:"PDS.Id"}]}}}}class vt{constructor(e,t){this._filterViewElementOptionsModifierFactory=e,this._exposeAttributeConverterMetadataGenerator=t}_getFilterViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByFilter(t=>Boolean(t?._filterOptions),e).map(t=>t.viewConfig)}_modifyFilterViewConfig(e){return this._filterViewElementOptionsModifierFactory?.create(e?.type)?.modify(e)||e}_generateFiltersAttributes(e){const{from:t,converters:r,expose:i}=e._filterOptions||{};return(0,S.isEmpty)(t)||(0,S.isEmpty)(i)?{}:i.filter(a=>Boolean(a?.attribute)).map(a=>({from:t,converters:r,expose:a})).map(a=>this._generateFilterAttributes(a)).reduce((a,o)=>({...a,...o}),{})}_generateFilterAttributes(e){const{from:t,expose:r}=e,i=r.attribute;if(!i)return{};const a=this._exposeAttributeConverterMetadataGenerator.generate({...r,converters:this._getFilterConverters(r.converters,e.converters)});return a?{[i]:{from:t,converter:a.converterExpression},...a.converterArgsAttributes}:{}}_getFilterConverters(e,t){const r=e?.filter(({converter:a})=>Boolean(a))??[],i=t?.filter(({converter:a})=>Boolean(a))??[];return r.length===0?i:r.map(({converter:a,args:o})=>{const n=i.find(l=>l.converter===a);return{converter:a,args:o??n?.args}})}crtOnMetaDataInit(e){const t=e;return this._getFilterViewConfigs(t.viewConfig).map(r=>this._modifyFilterViewConfig(r)).map(r=>this._generateFiltersAttributes(r)).forEach(r=>{t.viewModelConfig.attributes={...t.viewModelConfig.attributes??{},...r}}),Promise.resolve(e)}}vt.\u0275fac=function(e){return new(e||vt)(s.\u0275\u0275inject(I.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS_FACTORY,8),s.\u0275\u0275inject(I.ExposeAttributeConverterMetadataGenerator))},vt.\u0275prov=s.\u0275\u0275defineInjectable({token:vt,factory:vt.\u0275fac});function Pr(c,e){const t=new Map(e.map(([r,i])=>[r,{injectable:i}]));return new F.Factory(c,t)}class V{static withModifiers(e){return{ngModule:V,providers:e.map(t=>({provide:I.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS,useValue:t,multi:!0}))}}}V.\u0275fac=function(e){return new(e||V)},V.\u0275mod=s.\u0275\u0275defineNgModule({type:V}),V.\u0275inj=s.\u0275\u0275defineInjector({providers:[I.ExposeAttributeConverterMetadataGenerator,{provide:g.CRT_METADATA_PREPROCESSOR,useClass:vt,multi:!0},{provide:I.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS_FACTORY,useFactory:Pr,deps:[s.Injector,I.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS]}]});class It{constructor(){this._folderTreeItemsFilterName="folderTreeItemsFilter",this._featureValues=(0,s.inject)(p.FEATURE_VALUES),this._userInfo=(0,s.inject)(p.UserInfo),this._folderTreeUseStaticFolderService=(0,s.inject)(f.FolderTreeUseStaticFolderService),this._dataSchemaRepository=(0,s.inject)(g.DataSchemaRepositoryService)}_getFolderTreeViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FolderTree",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_processFolderTree(e,t){var r=this;return(0,u.Z)(function*(){yield r._setUseStaticFoldersAttributeValue(t),yield r._setItemsConfig(e,t),r._setFolderTreeInputs(e,t),r._setFolderTreeOutputs(e,t),r._setFavoriteItemsConfig(e,t)})()}_setFolderTreeInputs(e,t){this._setExpandedItemsAttrValue(e,t),this._setVisibleAttrValue(e,t),this._setActiveFolderAttributes(e,t)}_setFolderTreeOutputs(e,t){this._setActiveFolderChanged(t),this._setFolderTreeVisibleChanged(t),this._setAddFolderRequest(t),this._setCopyFolderRequest(t),this._setFolderRenameRequest(t),this._setFolderFiltersUpdatedRequest(t),this._setDeleteFolderRequest(e,t),this._setFolderTreeExpandedItemsChanged(t),this._setConvertToStaticFolder(t),this._setFolderChangeRights(t),this._setToggleFolderFavoriteRequest(t)}_isOldSourceSchema(e){return(0,f.isOldSourceSchema)(e.sourceSchemaName)}_setActiveFolderChanged(e){e.activeFolderChanged||(e.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:e.name,id:"@event.id",name:"@event.name",filterData:"@event.filterData",isFavorite:"@event.isFavorite"}})}_setFolderTreeVisibleChanged(e){e.folderTreeVisibleChanged||(e.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.name,visible:"@event.visible"}})}_setAddFolderRequest(e){e.addFolder||(e.addFolder={request:"crt.AddFolderDataRequest",params:this._getAddFolderRequestParameters(e)})}_getAddFolderRequestParameters(e){return{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId"}}_setCopyFolderRequest(e){e.copyFolder||(e.copyFolder={request:"crt.CopyFolderDataRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",sourceId:"@event.sourceId",copyRights:"@event.copyRights",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData"}})}_setFolderRenameRequest(e){e.folderRenamed||(e.folderRenamed={request:"crt.FolderTreeRenameRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",sourceSchemaName:"@event.sourceSchemaName",reloadFavorites:"@event.reloadFavorites"}})}_setToggleFolderFavoriteRequest(e){e.toggleFolderFavorite||(e.toggleFolderFavorite={request:"crt.ToggleFolderFavoriteRequest",params:{folderTreeName:e.name,id:"@event.id",favoriteId:"@event.favoriteId",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",status:"@event.status"}})}_setFolderFiltersUpdatedRequest(e){e.folderFiltersUpdated||(e.folderFiltersUpdated={request:"crt.FolderTreeUpdateFiltersRequest",params:{folderTreeName:e.name,filterData:"@event.filterData",sourceSchemaName:"@event.sourceSchemaName",folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}})}_setDeleteFolderRequest(e,t){if(t.deleteFolder)return;const{itemsAttrName:r}=(0,p.buildFolderTreeAttributeNames)(t.name);t.deleteFolder={request:"crt.DeleteFolderDataRequest",params:{dataSourceName:this._getDataSourceNameByItems(e,r),folderTreeName:t.name,folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}}}_getDataSourceNameByItems(e,t){const r=this._getViewModelConfigAttribute(e,t)??{};return"embeddedModel"in r?r?.embeddedModel?.name??"":""}_setItemsConfig(e,t){var r=this;return(0,u.Z)(function*(){r._setItemsAttrValue(t),yield r._addOrUpdateItemsViewModelAttribute(e,t),r._setItemsFilterAttrValue(e,t)})()}_setItemsAttrValue(e){if(e.items)return;const{itemsAttrName:t}=(0,p.buildFolderTreeAttributeNames)(e.name);e.items=`$${t}`}_addOrUpdateItemsViewModelAttribute(e,t){var r=this;return(0,u.Z)(function*(){const{itemsAttrName:i}=(0,p.buildFolderTreeAttributeNames)(t.name),a=r._getViewModelConfigAttribute(e,i);if(a)return r._updateItemsViewModelAttribute(a,t),Promise.resolve();yield r._createItemsViewModelAttribute(e,t)})()}_updateItemsViewModelAttribute(e,t){this._updateItemsViewModelAttributeViewModelConfig(e.viewModelConfig,t),this._updateItemsViewModelAttributeEmbeddedModel(e,t)}_updateItemsViewModelAttributeViewModelConfig(e,t){const{itemsModelName:r}=(0,p.buildFolderTreeAttributeNames)(t.name);if(!this._isOldSourceSchema(t)){e.attributes.FilterData={modelConfig:{path:`${r}.FilterData`}};return}e.attributes.FolderTypeId={modelConfig:{path:`${r}.FolderType.Id`}},e.attributes.FilterData={modelConfig:{path:`${r}.SearchData`}}}_updateItemsViewModelAttributeEmbeddedModel(e,t){const{itemsModelName:r}=(0,p.buildFolderTreeAttributeNames)(t.name),i=t.sourceSchemaName,a=(0,S.get)(e,"embeddedModel")||this._createItemsViewModelAttributeEmbeddedModel(r,i);(0,S.set)(a.config,"config.entitySchemaName",i),(0,S.set)(e,"embeddedModel",a)}_createItemsViewModelAttribute(e,t){var r=this;return(0,u.Z)(function*(){const{itemsAttrName:i,itemsModelName:a,itemsFilterAttrName:o}=(0,p.buildFolderTreeAttributeNames)(t.name),n=t.sourceSchemaName,l=yield r._getDataSchema(n),d={isCollection:!0,viewModelConfig:r._createItemsViewModelAttributeViewModelConfig(t,l),modelConfig:r._createItemsViewModelAttributeModelConfig(a,o),embeddedModel:r._createItemsViewModelAttributeEmbeddedModel(a,n)};r._addViewModelConfigAttribute(e,i,d)})()}_getDataSchema(e){return(0,_.lastValueFrom)(this._dataSchemaRepository.get(e))}_createItemsViewModelAttributeViewModelConfig(e,t){const{itemsModelName:r}=(0,p.buildFolderTreeAttributeNames)(e.name),a=this._isOldSourceSchema(e)?"SearchData":"FilterData",o={attributes:{Id:{modelConfig:{path:`${r}.${t.primaryAttributeName}`}},Name:{modelConfig:{path:`${r}.${t.primaryDisplayAttributeName}`}},ParentId:{modelConfig:{path:`${r}.${t.hierarchyAttributeName}.${t.primaryAttributeName}`}},FilterData:{modelConfig:{path:`${r}.${a}`}}}};return this._updateItemsViewModelAttributeViewModelConfig(o,e),o}_createItemsViewModelAttributeModelConfig(e,t){return{path:e,filterAttributes:[{name:t,loadOnChange:!0}]}}_createItemsViewModelAttributeEmbeddedModel(e,t){return{name:e,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t}}}}_setItemsFilterAttrValue(e,t){if(!e?.viewModelConfig?.attributes)return;const{itemsFilterAttrName:r}=(0,p.buildFolderTreeAttributeNames)(t.name),i=this._createItemsFilterGroup(t);this._addViewModelConfigAttribute(e,r,{value:i},!0)}_createItemsFilterGroup(e){return this._isOldSourceSchema(e)?this._createOldStructureItemsFilterGroup(e):this._createNewStructureItemsFilterGroup(e)}_createOldStructureItemsFilterGroup(e){const t=new b.FilterGroup(b.LogicalOperatorType.Or),r=[f.DYNAMIC_FOLDER_TYPE_ID];return e.useStaticFolders&&r.push(f.STATIC_FOLDER_TYPE_ID),t.addSchemaColumnInFilterWithParameters(b.ComparisonType.Equal,"FolderType",r,this._folderTreeItemsFilterName),t}_createNewStructureItemsFilterGroup(e){const t=new b.FilterGroup(b.LogicalOperatorType.Or);return t.addSchemaColumnFilterWithParameter(b.ComparisonType.Equal,"EntitySchemaName",e.rootSchemaName,this._folderTreeItemsFilterName),t}_isAllowUseStaticFolders(e){var t=this;return(0,u.Z)(function*(){return t._featureValues.IsAllowUseStaticFolders&&(yield(0,_.lastValueFrom)(t._folderTreeUseStaticFolderService.isEnabled(e.rootSchemaName)))})()}_setVisibleAttrValue(e,t){if(t.visible)return;const{visibleAttrName:r}=(0,p.buildFolderTreeAttributeNames)(t.name);t.visible=`$${r}`,this._addViewModelConfigAttribute(e,r,{value:!0})}_setActiveFolderAttributes(e,t){t.activeFolderId||(this._setActiveFolderIdAttribute(t),this._setActiveFolderFilterAttribute(e,t),this._addActiveFolderNameAttribute(e,t))}_setActiveFolderIdAttribute(e){const{activeFolderIdAttrName:t}=(0,p.buildFolderTreeAttributeNames)(e.name);e.activeFolderId=`$${t}`}_addActiveFolderNameAttribute(e,t){const{activeFolderNameAttrName:r}=(0,p.buildFolderTreeAttributeNames)(t.name);this._addViewModelConfigAttribute(e,r,{})}_setActiveFolderFilterAttribute(e,t){if(!this._isNeedToSetFolderFilterAttribute(e,t))return;const{activeFolderIdAttrName:r,activeFolderFilterAttrName:i,itemsAttrName:a,favoriteItemsAttrName:o}=(0,p.buildFolderTreeAttributeNames)(t.name);this._addViewModelConfigAttribute(e,i,{from:[a,o,r],converter:`crt.FolderTreeActiveFilterAttributeConverter : '${t.rootSchemaName}'`},!0)}_isNeedToSetFolderFilterAttribute(e,t){const{activeFolderFilterAttrName:r}=(0,p.buildFolderTreeAttributeNames)(t.name),i=this._getViewModelConfigAttribute(e,r);return!(i&&(0,g.isCalculatedAttributeConfig)(i))}_setFavoriteItemsConfig(e,t){const{favoriteItemsAttrName:r}=(0,p.buildFolderTreeAttributeNames)(t.name);t.favoriteItems=`$${r}`;const i=`${r}_DS`,a=`${i}_filter`;this._setFavoriteItemsFilterAttr(a,e,t);const o={isCollection:!0,modelConfig:{path:i,filterAttributes:[{name:a,loadOnChange:!0}]}};this._addFavoriteItemsViewModelConfig(o,t,i),this._addFavoriteItemsEmbeddedModel(o,t,i),this._addViewModelConfigAttribute(e,r,o)}_addFavoriteItemsViewModelConfig(e,t,r){const i=this._isOldSourceSchema(t),a=i?"":".FolderTree",o=i?"FolderId":"Id",n={Id:{modelConfig:{path:`${r}.Id`}},Name:{modelConfig:{path:`${r}${a}.Name`}},FolderTreeId:{modelConfig:{path:`${r}${a}.${o}`}},FilterData:{modelConfig:{path:`${r}${a}.FilterData`}}};i&&(n.FolderTypeId={modelConfig:{path:`${r}${a}.FolderTypeId`}}),e.viewModelConfig={attributes:n}}_addFavoriteItemsEmbeddedModel(e,t,r){const i=this._isOldSourceSchema(t),a=i?f.OLD_FOLDER_TREE_FAVORITE_SCHEMA_NAME:f.DEFAULT_FOLDER_TREE_FAVORITE_SCHEMA_NAME,o={name:r,config:{type:"crt.EntityDataSource",config:{entitySchemaName:a},hiddenInPageDesigner:!1}};if(i){const n=t.sourceSchemaName;o.config.config.attributes={Name:{path:`[${n}:Id:FolderId].Name`,type:b.DataSchemaAttributeType.ForwardReferenceAttribute},FilterData:{path:`[${n}:Id:FolderId].SearchData`,type:b.DataSchemaAttributeType.ForwardReferenceAttribute},FolderTypeId:{path:`[${n}:Id:FolderId].FolderType.Id`,type:b.DataSchemaAttributeType.ForwardReferenceAttribute}}}e.embeddedModel=o}_setFavoriteItemsFilterAttr(e,t,r){if(t?.viewModelConfig?.attributes?.[e]||!t.viewModelConfig.attributes)return;const i=this._isOldSourceSchema(r),a=new b.FilterGroup(b.LogicalOperatorType.And),o=new b.CompareFilter(b.ComparisonType.Equal,new b.ColumnExpression({columnPath:"SysAdminUnit"}),new b.ParameterExpression({value:this._userInfo?.id,dataValueType:b.DataValueType.Guid}));if(a.add(o,"adminUnitFilter"),i){const n=r.sourceSchemaName;a.addExistsFilter(`[${n}:Id:FolderId].Id`)}else{const n=new b.CompareFilter(b.ComparisonType.Equal,new b.ColumnExpression({columnPath:"EntitySchemaName"}),new b.ParameterExpression({value:r.rootSchemaName}));a.add(n,"schemaFilter")}t.viewModelConfig.attributes[e]={value:a}}_setExpandedItemsAttrValue(e,t){if(t.expandedItems)return;const{expandedItemsAttrName:r}=(0,p.buildFolderTreeAttributeNames)(t.name);t.expandedItems=`$${r}`,this._addViewModelConfigAttribute(e,r,{})}_getViewModelConfigAttribute(e,t){return(e?.viewModelConfig?.attributes||{})[t]}_addViewModelConfigAttribute(e,t,r,i=!1){!e?.viewModelConfig?.attributes||!i&&e.viewModelConfig.attributes[t]||(e.viewModelConfig.attributes[t]=r)}_setFolderTreeExpandedItemsChanged(e){e.folderTreeExpandedItemsChanged||(e.folderTreeExpandedItemsChanged={request:"crt.FolderTreeExpandedItemsRequest",params:{folderTreeName:e.name,expandedItems:"@event.expandedItems"}})}_setFolderChangeRights(e){e.folderChangeRights||(e.folderChangeRights={request:"crt.LoadRightsModuleRequest",params:{payload:{entitySchemaName:"@event.entitySchemaName",entitySchemaCaption:"@event.entitySchemaCaption",primaryColumnValue:"@event.primaryColumnValue",primaryDisplayColumnValue:"@event.primaryDisplayColumnValue"}}})}_setConvertToStaticFolder(e){e.convertToStaticFolder||!this._isOldSourceSchema(e)||(e.convertToStaticFolder={request:"crt.ConvertToStaticFolderRequest",params:this._getAddFolderRequestParameters(e)})}_setUseStaticFoldersAttributeValue(e){var t=this;return(0,u.Z)(function*(){!t._isOldSourceSchema(e)||(e.useStaticFolders=yield t._isAllowUseStaticFolders(e))})()}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=t._getFolderTreeViewConfigs(r);return yield Promise.all(i.map(a=>t._processFolderTree(r,a))),e})()}}It.\u0275fac=function(e){return new(e||It)},It.\u0275prov=s.\u0275\u0275defineInjectable({token:It,factory:It.\u0275fac});class Pt{_setProperties(e){const t=e.viewConfig.folderTree,{activeFolderIdAttrName:r,activeFolderNameAttrName:i,activeFolderFavoriteStateAttrName:a,itemsAttrName:o,favoriteItemsAttrName:n}=(0,p.buildFolderTreeAttributeNames)(t);e.viewConfig.activeFolderId||(e.viewConfig.activeFolderId=t?`$${r}`:null),e.viewConfig.activeFolderName||(e.viewConfig.activeFolderName=t?`$${i}`:null),e.viewConfig.activeFolderFavoriteState||(e.viewConfig.activeFolderFavoriteState=t?`$${a}`:null),e.viewConfig.items||(e.viewConfig.items=t?`$${o}`:null),e.viewConfig.favoriteItems||(e.viewConfig.favoriteItems=t?`$${n}`:null)}_setActiveFolderChangedRequest(e){e.viewConfig.activeFolderChanged||(e.viewConfig.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:e.viewConfig.folderTree??null,id:"@event.id",name:"@event.name",filterData:"@event.filterData",isFavorite:"@event.isFavorite"}})}_setFolderTreeVisibleChangedRequest(e){e.viewConfig.folderTreeVisibleChanged||(e.viewConfig.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.viewConfig.folderTree??null,togglePanel:"@event.togglePanel"}})}crtOnMetaDataInit(e){const t=e,r=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FolderTreeActions",t.viewConfig);for(const i of r)this._setProperties(i),this._setActiveFolderChangedRequest(i),this._setFolderTreeVisibleChangedRequest(i);return Promise.resolve(e)}}Pt.\u0275fac=function(e){return new(e||Pt)},Pt.\u0275prov=s.\u0275\u0275defineInjectable({token:Pt,factory:Pt.\u0275fac});class Nt{get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._imageInputPreprocessingDisableFeature))}get isAutobindDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._autoBindToDisabled))}constructor(e,t){this._featureService=e,this._metadataModifierService=t,this._imageInputPreprocessingDisableFeature="DisableImageInputPreprocessing",this._autoBindToDisabled="AutoBindToDisabled"}_addToImageLinkConverter(e,t){const r=t.indexOf("|");if(t.startsWith("$")&&r===-1){const i=t+" | crt.ToImageLink";this._metadataModifierService.updateProperty({source:e,keys:["value"],value:i})}}_addBusinessRulesBinding(e,t,r,i,a){if(i.startsWith("$")&&!e.bindTo&&!a){this._metadataModifierService.addProperty(e,"bindTo",`$${r}`);const o=t.attributes||{};o[r]={...o[r],viewItemName:e.name},t.attributes=o}}_addImageSelectedRequest(e,t){e.imageSelected||this._metadataModifierService.addProperty(e,"imageSelected",{request:"crt.UploadImageRequest",params:{imageAttributeName:t,details:"@event"}})}_addimageClearRequest(e,t){e.imageClear||this._metadataModifierService.addProperty(e,"imageClear",{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:t,attributeValue:null}})}_setReadonlyByType(e,t,r){var i=this;return(0,u.Z)(function*(){const a=t.viewModelConfig.attributes,o=i._getBindingAttributeWoConverters(e.value);if((0,R.isBindToViewModelAttribute)(o,a)){const n=o.slice(1).split(".").pop(),l=a[n]??{};let d="";(0,g.isModelAttributeConfig)(l)&&(d=l.modelConfig?.path.split(".")[0]);let m="";(0,g.isModelAttributeConfig)(l)&&(m=l.modelConfig?.path.split(".").pop());const h=r.find(P=>P.name===d),C=(h?yield(0,_.lastValueFrom)(h.getSchema(),{defaultValue:null}):null)?.findAttributeByName(m);C&&C.dataValueType!==b.DataValueType.IMAGELOOKUP&&(e.readonly||i._metadataModifierService.updateProperty({source:e,keys:["readonly"],value:!0}),i._metadataModifierService.removeProperty(e,"bindTo"))}})()}_getBindingAttributeWoConverters(e){const t=e?.indexOf("|");return t&&t!==-1&&(e=e.substring(0,t-1).trimEnd()),e}_getBindAttributeName(e){return this._getBindingAttributeWoConverters(e).replace("$","")}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=e,i=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ImageInput",r.viewConfig),a=yield t.isAutobindDisabled;return i.forEach(o=>{const n=o.viewConfig.value,l=t._getBindAttributeName(n);t._addToImageLinkConverter(o.viewConfig,n),t._addBusinessRulesBinding(o.viewConfig,r.viewModelConfig,l,n,a),t._addImageSelectedRequest(o.viewConfig,l),t._addimageClearRequest(o.viewConfig,l)}),e})()}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const i=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ImageInput",i.viewConfig).forEach(function(){var o=(0,u.Z)(function*(n){yield r._setReadonlyByType(n.viewConfig,i,t)});return function(n){return o.apply(this,arguments)}}()),e})()}}Nt.\u0275fac=function(e){return new(e||Nt)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(g.MetadataModifierService))},Nt.\u0275prov=s.\u0275\u0275defineInjectable({token:Nt,factory:Nt.\u0275fac});class Dt{constructor(e){this._featureService=e,this._labelProcessingDisableFeature="DisableLabelPreprocessing"}_actualizeLabelType(e){const t=f.LABEL_TYPE_MAPPING[e.labelType];t&&(e.labelType=t)}get _isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._labelProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t._isProcessingDisabled)return e;const r=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Label",r.viewConfig).forEach(a=>{t._actualizeLabelType(a.viewConfig)}),e})()}}Dt.\u0275fac=function(e){return new(e||Dt)(s.\u0275\u0275inject(A.FeatureService))},Dt.\u0275prov=s.\u0275\u0275defineInjectable({token:Dt,factory:Dt.\u0275fac});class Tt{constructor(){this._parentComposerType="crt.MessageComposerSelector"}_getViewConfigs(e,t){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",t,e.viewConfig).map(r=>r?.viewConfig).filter(Boolean)}_createAndBindComposerEventAttribute(e){const t=this._getViewConfigs(e,this._parentComposerType),r=e.viewModelConfig.attributes;t.forEach((i,a)=>{const o=`${p.COMPOSER_EVENT_ATTRIBUTE_PREFIX}_${a}`;r[o]={value:[]},i.composerEvent="$"+o,i.items.forEach(n=>{n.composerEvent="$"+o})})}crtOnMetaDataInit(e){const t=e;return this._createAndBindComposerEventAttribute(t),Promise.resolve(e)}}Tt.\u0275fac=function(e){return new(e||Tt)},Tt.\u0275prov=s.\u0275\u0275defineInjectable({token:Tt,factory:Tt.\u0275fac});class Ft{_getViewConfigs(e,t){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",t,e.viewConfig).map(r=>r?.viewConfig).filter(Boolean)}_setAddNextStepBtnAdditionalProperties(e){Object.keys(e).includes("visible")||(e.visible="$CardState | crt.IsEqual : 'edit'")}_setNextStepsComponentAdditionalProperties(e){e&&!Object.keys(e).includes("cardState")&&(e.cardState="$CardState")}_handleNextStepsComponent(e){this._getViewConfigs(e,"crt.NextSteps").forEach(r=>{this._setNextStepsComponentAdditionalProperties(r)})}_handleNextStepsAddButtons(e){this._getViewConfigs(e,"crt.Button").forEach(r=>{if(r&&r.clickMode==="menu"){const i=r.menuItems||[];Array.isArray(i)&&i.some(a=>{const o=a.clicked;return o&&(o.request==="crt.AddNextStepRequest"||o.request==="crt.CreateEmailRequest")})&&this._setAddNextStepBtnAdditionalProperties(r)}})}_getNextStepRelatedConfigs(e){const t=p.MetadataSchemaUtils.getViewConfigInfoByFilter(r=>r.type==="crt.NextSteps"&&r.bindingColumns||r.type==="crt.MenuItem"&&r.clicked?.request==="crt.CreateEmailRequest"&&!r.clicked?.params?.bindingColumns,[e]).map(r=>r?.viewConfig).filter(Boolean);return t?.length!==2?null:{nextStep:t.find(r=>r.type==="crt.NextSteps"),addEmailBtn:t.find(r=>r.type==="crt.MenuItem")}}_getConfigsToFix(e){const t=new Array;return p.MetadataSchemaUtils.getViewConfigInfoByFilter(r=>{if(r.type!=="crt.ExpansionPanel")return!1;const i=this._getNextStepRelatedConfigs(r);return i&&t.push(i),Boolean(i)},e.viewConfig),t}_fixBindingColumns(e){this._getConfigsToFix(e).forEach(r=>{const i=r.addEmailBtn.clicked;i.params=i.params||{},i.params.bindingColumns=(0,S.cloneDeep)(r.nextStep.bindingColumns)})}crtOnMetaDataInit(e){const t=e;return this._fixBindingColumns(t),this._handleNextStepsAddButtons(t),this._handleNextStepsComponent(t),Promise.resolve(e)}}Ft.\u0275fac=function(e){return new(e||Ft)},Ft.\u0275prov=s.\u0275\u0275defineInjectable({token:Ft,factory:Ft.\u0275fac});class Et{_modifyInputType(e,t,r){const i=e.control.replace("$",""),a=t.attributes[i]?.modelConfig?.path;if(a){const o=this._getDataSchemaAttributeByPath(a,r);o?.dataValueType===b.DataValueType.PHONE_TEXT&&(e.type="crt.PhoneInput",e.phoneAsLink=!0,e.displayAsPhone=o.isMasked)}}_getDataSchemaAttributeByPath(e,t){const[r,i]=e.split("."),a=t.dataSchemas[r]?.attributes;let o;for(const n in a)if(a[n].path===i||a[n].name===i){o=a[n];break}return o}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),n=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.PhoneInput",a.viewConfig);return o.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),n.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),e})()}}Et.\u0275fac=function(e){return new(e||Et)},Et.\u0275prov=s.\u0275\u0275defineInjectable({token:Et,factory:Et.\u0275fac});class Mt{constructor(e,t,r){this._translateService=e,this._printablesService=t,this._rightsService=r,this._translatePrefix="PrintablesMenuItemsPreprocessor",this._canManageReports=!1}_generateMenuItems(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e.viewConfig.clicked.params,o=t.modelConfig?.dataSources;if((0,S.isEmpty)(o))return console.warn("There is no datasources in modelConfig."),[];const n=o?.[a.dataSourceName];if(!n)return console.warn(`Datasource '${a.dataSourceName}' specified in the request is not found in the modelConfig.`),[];const l=n.scope===b.DataSourceScope.Page,d=n.config?.entitySchemaName;return(yield i._printablesService.getPrintablesForEntity(d)).filter(h=>l?h.ShowInCard:h.ShowInSection).map(h=>({type:"crt.MenuItem",caption:h.Caption,clicked:{request:"crt.PrintablesRequest",params:{convertInPDF:h.ConvertInPDF===!0,printableCaption:h.Caption,templateId:h.Id,dataSourceName:a.dataSourceName,filters:a?.filters}}}))})()}_getItemsWithPrintablesRequest(e,t){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",e,t.viewConfig).filter(i=>{const{clicked:a,menuItems:o}=i.viewConfig||{};return!o?.length&&a?.request==="crt.PrintablesRequest"&&a.params?.dataSourceName&&!a.params.templateId})}_noAvailablePrintablesMenuItem(){return{type:"crt.MenuLabel",caption:this._translateService.instant(this._translatePrefix+".NoAvailablePrintablesCaption")}}_goToPrintablesSetupMenuItems(){return this._canManageReports?[{type:"crt.MenuDivider"},{type:"crt.MenuItem",caption:this._translateService.instant(this._translatePrefix+".GoToPrintablesSetupCaption"),icon:"open-button-icon",handleItemClick:()=>{this._goToPrintables()}}]:[]}_goToPrintables(){const e=(0,p.getWorkspaceBaseUrl)();window.open(`${e}ClientApp#/Printables`,"_blank")}_generateInfoMenuItems(){return[this._noAvailablePrintablesMenuItem(),...this._goToPrintablesSetupMenuItems()]}_prepareItemMenu(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=a._getItemsWithPrintablesRequest(e,r);for(const n of o){let l=yield a._generateMenuItems(n,r,i);l.length===0?l=a._generateInfoMenuItems():l.push(...a._goToPrintablesSetupMenuItems()),n.viewConfig[t]=l,n.viewConfig.clickMode="menu",delete n.viewConfig.clicked}})()}_initCanManageReports(){var e=this;return(0,u.Z)(function*(){e._canManageReports=yield(0,_.firstValueFrom)(e._rightsService.getCanExecuteOperation("CanManageReports"))})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e;return yield i._initCanManageReports(),yield i._prepareItemMenu("crt.MenuItem","items",a,r),yield i._prepareItemMenu("crt.Button","menuItems",a,r),e})()}}Mt.\u0275fac=function(e){return new(e||Mt)(s.\u0275\u0275inject(M.TranslateService),s.\u0275\u0275inject(A.PrintablesService),s.\u0275\u0275inject(A.RightsService))},Mt.\u0275prov=s.\u0275\u0275defineInjectable({token:Mt,factory:Mt.\u0275fac});class nr{constructor(e){this.injector=e,this.isNewStructure=t=>!!t._filterOptions,this.initializeDependencies()}initializeDependencies(){}crtOnMetaDataInit(e,t){return Promise.resolve(t)}}class sr extends nr{_getDependencyFilterConfigsFromViewConfig(e){const t=e._filterOptions.expose?.map(i=>i.converters),r=[];return t?.forEach(i=>{i?.forEach(a=>this._addDependencyFilterConfigsFromConverterConfig(a,r))}),r}_addDependencyFilterConfigsFromConverterConfig(e,t){e?.args?.map(a=>a.target)?.map(a=>{const o=a.dependencyFilters?.filter(n=>n.attributeName);o?.length>0&&t.push(...o)})}_createAttributesForDependencyFilterConfigs(e,t){this._getDependencyFilterConfigsFromViewConfig(e).forEach(i=>this._createViewModelAttributeIfNeed(i,t))}_createViewModelAttributeIfNeed(e,t){t[e.attributeName]||(t[e.attributeName]={modelConfig:{path:e.relationPath}})}crtOnMetaDataInit(e,t){var r;if(!this.isNewStructure(e))return Promise.resolve(t);const i=t;(r=i.viewModelConfig).attributes??(r.attributes={});const a=i.viewModelConfig.attributes;return this._createAttributesForDependencyFilterConfigs(e,a),Promise.resolve(t)}}class Nr extends nr{constructor(e){super(e),this.injector=e}_isAllowToSetupComboboxViewConfig(e){const t=e.config;return!this._isShowRecordsInWindows(e)&&!("comboboxViewElementConfig"in t)&&!!t.entitySchemaName}_isShowRecordsInWindows(e){return e.config.showRecordsInWindows}_getEntitySchemaName(e){const t=e.entitySchemaName;return t===f.TAG_VIRTUAL_COLUMN_SCHEMA_NAME?f.DEFAULT_TAG_SOURCE_SCHEMA_NAME:t}_getComboboxFilter(e,t,r){const i=new b.FilterGroup;return this._addTagSchemaNameComboboxFilterIfNeed(i,e,t,r),this._addRecordsComboboxFilterIfNeed(i,e),i.toJson()}_addTagSchemaNameComboboxFilterIfNeed(e,t,r,i){if(t.entitySchemaName===f.TAG_VIRTUAL_COLUMN_SCHEMA_NAME){const o=this._getBindedListsEntitySchemaNames(r,i);o.length&&e.add((0,f.createTagLookupFilter)(o),"TagFilter")}}_addRecordsComboboxFilterIfNeed(e,t){const r=t.recordsFilter;if(r){const i=b.FilterGroup.fromJson(r,b.FilterParser);e.add(i,"RecordsFilter")}}_getBindedListsEntitySchemaNames(e,t){const r=[];return this._getBindedViewAttributeNames(e).forEach(a=>{const o=this._getDataSourceEntitySchemaNameByViewAttribute(a,t);o&&r.push(o)}),[...new Set(r)]}_getBindedViewAttributeNames(e){const t=[];return e._filterOptions?.expose?.forEach(r=>{r.converters?.forEach(i=>{i.args?.forEach(a=>{const o=a.target?.viewAttributeName;o&&t.push(o)})})}),[...new Set(t)]}_getDataSourceEntitySchemaNameByViewAttribute(e,t){const i=(p.MetadataSchemaUtils.getViewModelAttribute(t,e)||{}).modelConfig?.path||"";return(t.modelConfig?.dataSources||{})[i]?.config?.entitySchemaName}initializeDependencies(){super.initializeDependencies(),this._comboboxPreprocessorService=this.injector.get($)}crtOnMetaDataInit(e,t){var r=this;return(0,u.Z)(function*(){if(!r._isAllowToSetupComboboxViewConfig(e))return Promise.resolve(t);const a=t.viewModelConfig.attributes,o={name:`${e.name}_ComboBox`},n=e.config;return yield r._comboboxPreprocessorService.setupComboboxMetadataByEntitySchema(o,a,r._getEntitySchemaName(n),r._getComboboxFilter(n,e,t)),n.comboboxViewElementConfig={type:"crt.ComboBox",labelPosition:"hidden",useMultiChoice:!0,...o},Promise.resolve(t)})()}}class Q{constructor(e){this._injector=e}_getQuickFilterAdditionalPreprocessingService(e){switch(e){case f.QuickFilterType.Custom:return new sr(this._injector);case f.QuickFilterType.Lookup:return new Nr(this._injector);default:return null}}crtOnMetaDataInit(e,t){return this._getQuickFilterAdditionalPreprocessingService(e.filterType)?.crtOnMetaDataInit(e,t)||Promise.resolve(t)}}Q.\u0275fac=function(e){return new(e||Q)(s.\u0275\u0275inject(s.Injector))},Q.\u0275prov=s.\u0275\u0275defineInjectable({token:Q,factory:Q.\u0275fac});class cr{constructor(e){this.injector=e,this.initializeDependencies()}initializeDependencies(){}getAttributeValue(e,t){return this.getViewModelConfigAttributes(e)[t]?.value||[]}setAttributeValue(e,t,r){const i=this.getViewModelConfigAttributes(e);i[t]={value:r}}getViewModelConfigAttributes(e){return e.viewModelConfig.attributes}update(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i.getAttributeValue(t,r);if(i.isNotNeedUpdateValue(a))return;const o=yield i.createNewAttributeValue(e,a);i.setAttributeValue(t,r,o)})()}}class Dr extends cr{_createDateRangeQuickFilterValue(e){return this._dateRangeMacrosConverter.convert(e)}_isMacrosEnum(e){return typeof e=="string"}initializeDependencies(){super.initializeDependencies(),this._dateRangeMacrosConverter=this.injector.get(f.DateRangeMacrosConverter)}isNotNeedUpdateValue(e){return(0,S.isEmpty)(e)||!this._isMacrosEnum(e)&&!e.macros}createNewAttributeValue(e,t){const r=this._isMacrosEnum(t)?t:t.macros;return Promise.resolve(this._createDateRangeQuickFilterValue(r))}}class Tr extends cr{_createLookupQuickFilterValue(e,t){var r=this;return(0,u.Z)(function*(){const i=t.filter(o=>r._isMacrosValueItem(o)),a=t.filter(o=>!r._isMacrosValueItem(o));return[...r._createMacrosLookupQuickFilterValue(i),...yield r._createNotMacrosLookupQuickFilterValue(a,e)]})()}_isMacrosValueItem(e){return Object.values(f.LookupDefaultValueMacros).includes(this._getValueFromValueItem(e))}_createMacrosLookupQuickFilterValue(e){return e.map(t=>this._createMacrosLookupQuickFilterValueItem(t)).filter(Boolean)}_createMacrosLookupQuickFilterValueItem(e){switch(this._getValueFromValueItem(e)){case f.LookupDefaultValueMacros.CurrentUserContact:return this._createLookupQuickFilterValueItemFromPreviousItem(e,this._userInfo.contactId,this._userInfo.contactName);case f.LookupDefaultValueMacros.CurrentUserAccount:return this._createLookupQuickFilterValueItemFromPreviousItem(e,this._userInfo.accountId,this._userInfo.accountName);default:return null}}_createNotMacrosLookupQuickFilterValue(e,t){var r=this;return(0,u.Z)(function*(){return(0,S.isEmpty)(e)?Promise.resolve([]):(yield r._lookupQuickFilterValueRepository.getActualData(e,t)).map(i=>r._mapActualValueItem(e,i)).filter(Boolean)})()}_mapActualValueItem(e,t){const r=e.find(i=>i.value===t.value);return r?this._createLookupQuickFilterValueItemFromPreviousItem(r,t.value,t.displayValue):null}_createLookupQuickFilterValueItemFromPreviousItem(e,t,r){return!this._isValidValue(t)||(0,S.isEmpty)(r)?null:{...e,value:t,displayValue:r,originalValue:this._getValueFromValueItem(e),checkedState:"checkedState"in e?e.checkedState:!1}}_getValueFromValueItem(e){return"originalValue"in e?e.originalValue:e.value}_isValidValue(e){return(0,b.isGuid)(e)&&!(0,b.isEmptyGuid)(e)}initializeDependencies(){super.initializeDependencies(),this._userInfo=this.injector.get(p.UserInfo),this._lookupQuickFilterValueRepository=this.injector.get(f.LookupQuickFilterValueRepositoryService)}isNotNeedUpdateValue(e){return(0,S.isEmpty)(e)}createNewAttributeValue(e,t){return this._createLookupQuickFilterValue(e.config,t)}}class z{constructor(e){this._injector=e}_getQuickFilterValueAttributeUpdater(e){switch(e){case f.QuickFilterType.Lookup:return new Tr(this._injector);case f.QuickFilterType.DateRange:return new Dr(this._injector);default:return null}}update(e,t,r){return this._getQuickFilterValueAttributeUpdater(e.filterType)?.update(e,t,r)||Promise.resolve()}}z.\u0275fac=function(e){return new(e||z)(s.\u0275\u0275inject(s.Injector))},z.\u0275prov=s.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac});class zt{constructor(){this.isNewStructure=e=>!!e._filterOptions}_getOrCreateModelFilters(e){const t=e.modelConfig;return t.filterAttributes||(t.filterAttributes=[]),t.filterAttributes}_setFilterToModelFilters(e,t,r){const i=this.getAttributeModelFilters(e,t);i.some(o=>o.name===r)||i.push({name:r,loadOnChange:!0})}getFilterAttributeName(e,t){return`${e}_${t}`}getAttributeModelFilters(e,t){const r=e[t];return r?.modelConfig?this._getOrCreateModelFilters(r):[]}createAttributeIfNeed(e,t,r){t in e||(e[t]=r)}setFilterAttribute(e,t,r){const i=this.getFilterAttributeName(t,r),a=e.viewModelConfig.attributes;this.createAttributeIfNeed(a,i,{value:{}}),this._setFilterToModelFilters(a,r,i)}}class x extends zt{constructor(e,t){super(),this._quickFilterValueAttributeUpdater=e,this._quickFilterAdditionalPreprocessingService=t,this._isTargetExists=r=>!!r.targets?.length}_setValueAttribute(e,t){const r=t?.config;if("value"in t||!r)return;const i=this._getQuickFilterValueAttributeName(t.name);t.value=`$${i}`;const a="defaultValue"in t.config?t.config.defaultValue:null;this._createValueAttributeIfNeed(e,i,a)}_createValueAttributeIfNeed(e,t,r){const i=e.viewModelConfig.attributes;this.createAttributeIfNeed(i,t,{value:r})}_updateValueAttribute(e,t){const r=this._getQuickFilterValueAttributeName(t.name);return this._quickFilterValueAttributeUpdater.update(t,e,r)}_setFilterAttribute(e,t){this.isNewStructure(t)||!this._isTargetExists(t)||t.targets?.forEach(r=>{this._setFilterConverterAttribute(e,t,r),this.setFilterAttribute(e,t.name,r.viewAttributeName),r.filterAttributeName=this.getFilterAttributeName(t.name,r.viewAttributeName)})}_setFilterConverterAttribute(e,t,r){const i=e.viewModelConfig.attributes,a=this.getFilterAttributeName(t.name,r.viewAttributeName),o=`${a}_Target`,n={from:this._getQuickFilterValueAttributeName(t.name),converter:`crt.QuickFilterAttributeConverter: $${o}`};this.createAttributeIfNeed(i,o,{value:this._createQuickFilterConverterParameters(r,t)}),this.createAttributeIfNeed(i,a,n)}_createQuickFilterConverterParameters(e,t){const r={target:e,quickFilterType:t.filterType};return this._allowAddConfigToConverterParameters(t)&&(r.config=t.config),r}_allowAddConfigToConverterParameters(e){return e.filterType===f.QuickFilterType.Custom}_setValueChangeRequest(e){if(e.valueChange||!e.filterType)return;const t=this._getQuickFilterValueAttributeName(e.name);e.valueChange={request:"crt.QuickFilterRequest",params:{valueAttributeName:t,value:"@event"}}}_getQuickFilterValueAttributeName(e){return`${e}_Value`}crtOnMetaDataInit(e,t){var r=this;return(0,u.Z)(function*(){const i=t;return r._setValueAttribute(i,e),yield r._updateValueAttribute(i,e),r._setFilterAttribute(i,e),r._setValueChangeRequest(e),yield r._quickFilterAdditionalPreprocessingService.crtOnMetaDataInit(e,t),Promise.resolve(t)})()}}x.\u0275fac=function(e){return new(e||x)(s.\u0275\u0275inject(z),s.\u0275\u0275inject(Q))},x.\u0275prov=s.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac});class Me extends zt{constructor(e){super(),this._quickFilterPreprocessorService=e}_getQuickFilterViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.QuickFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=t._getQuickFilterViewConfigs(r);return yield Promise.all(i.map(function(){var a=(0,u.Z)(function*(o){yield t._quickFilterPreprocessorService.crtOnMetaDataInit(o,e)});return function(o){return a.apply(this,arguments)}}())),Promise.resolve(e)})()}}Me.\u0275fac=function(e){return new(e||Me)(s.\u0275\u0275inject(x))},Me.\u0275prov=s.\u0275\u0275defineInjectable({token:Me,factory:Me.\u0275fac});var lr=N(70806);class J{constructor(e){this._resourceFinderService=e,this._dataGridType="crt.DataGrid",this._galleryType="crt.Gallery",this._findAttributeInDataSchema=(t,r)=>t?.attributes?.find(i=>i.name===r)}_getBindedViewElementConfigsByAttributeNames(e,t){return p.MetadataSchemaUtils.getViewConfigInfoByFilter(r=>this._isViewConfigInfoBindedByPropertyValues(r,t.map(i=>`$${i}`)),e.viewConfig).map(r=>r.viewConfig)}_isViewConfigInfoBindedByPropertyValues(e,t){const r=Object.values(e);for(const i of r)if(t.includes(i))return!0;return!1}_getColumnByViewType(e,t,r,i){switch(i.type){case this._dataGridType:return this._getColumnsFromDataGridViewConfig(e,t,r,i);case this._galleryType:return Promise.resolve(this._getColumnsFromGalleryViewConfig(e,t,r,i));default:return Promise.resolve(this._getColumnsFromViewModelConfig(e,t,r))}}_getColumnsFromDataGridViewConfig(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=[],n=a._getDataSchema(t,r);if(!n)return Promise.resolve(null);const l=i;if(!l.columns)return a._getColumnsFromViewModelConfig(e,t,r);const d=a._getColumnAttributes(e,r);for(const m of l.columns){const h=m.code,y=d?.[h];yield a._addColumnByResourcesIfNeed(n,t,o,m,y)}return{columns:o,viewName:i.name||r,primaryDisplayName:n.primaryDisplayAttributeName}})()}_addColumnByResourcesIfNeed(e,t,r,i,a){var o=this;return(0,u.Z)(function*(){const n=o._getColumnNameFromAttributeConfigPath(a),l=o._findAttributeInDataSchema(e,n);o._isAllowedToAddColumn(l,r,n)&&r.push(yield o._createColumnByResources(t[p.SchemaResourcesSuffix],i.caption,n,l?.path))})()}_getColumnsFromGalleryViewConfig(e,t,r,i){const a=[],o=this._getDataSchema(t,r);if(!o)return null;const n=i?.itemConfig,l=this._getColumnAttributes(e,r);return(0,S.forEach)(n?.templateValuesMapping,(d,m)=>{const h=l?.[d];this._addColumnByDataSchemaIfNeed(o,a,h)}),{columns:a,viewName:i.name||r,primaryDisplayName:o.primaryDisplayAttributeName}}_getColumnsFromViewModelConfig(e,t,r){const i=[],a=this._getDataSchema(t,r);if(!a)return null;const o=this._getColumnAttributes(e,r);return(0,S.forEach)(o,(n,l)=>{this._addColumnByDataSchemaIfNeed(a,i,n)}),{columns:i,viewName:r,primaryDisplayName:a.primaryDisplayAttributeName}}_getDataSchema(e,t){return e.getBoundDataSchemaByAttributePath(t)}_getColumnAttributes(e,t){const r=e.viewModelConfig.attributes;return Object.prototype.hasOwnProperty.call(r,t)?r[t].viewModelConfig?.attributes||{}:{}}_addColumnByDataSchemaIfNeed(e,t,r){const i=this._getColumnNameFromAttributeConfigPath(r),a=this._findAttributeInDataSchema(e,i);this._isAllowedToAddColumn(a,t,i)&&t.push(this._createColumnByDataSchema(a,i))}_getColumnNameFromAttributeConfigPath(e){if(e&&(0,g.isModelAttributeConfig)(e))return e?.modelConfig?.path?.split(".").slice(1).shift()}_isAllowedToAddColumn(e,t,r){return(0,p.isAllowedTypeSearchColumn)(e)&&!!r&&!t.some(i=>i.name===r)}_createColumnByResources(e,t,r,i){var a=this;return(0,u.Z)(function*(){return{caption:(yield a._resourceFinderService.findViewModelResourceValue(t,e,t))||r,name:r,path:i||r}})()}_createColumnByDataSchema(e,t){return{caption:e?.caption||t,name:t,path:e?.path||t}}_getUniqueColumns(e){if(!e.length)return null;const t=[];return e.forEach(r=>{r.columns.forEach(i=>{this._isSearchFilterColumnExist(t,i)||t.push(i)})}),{columns:t,viewName:e.slice().shift()?.viewName||"",primaryDisplayName:e.slice().shift()?.primaryDisplayName}}_isSearchFilterColumnExist(e,t){return e.some(r=>r.caption===t.caption&&r.name===t.name)}getColumnsModelByAttributeName(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getBindedViewElementConfigsByAttributeNames(e,[r]);if(a.length===0)return i._getColumnsFromViewModelConfig(e,t,r);const o=(yield Promise.all(a.map(n=>i._getColumnByViewType(e,t,r,n)))).filter(Boolean);return i._getUniqueColumns(o)})()}}J.\u0275fac=function(e){return new(e||J)(s.\u0275\u0275inject(p.ResourceFinderService))},J.\u0275prov=s.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac});class Re extends zt{constructor(e,t,r,i){super(),this._featureService=e,this._searchFilterPreprocessorService=t,this._searchFilterQueryAnalyzerService=r,this._translateService=i,this._isTargetAttributesExist=(a,o)=>this._getAvailableTargetAttributes(a,o)?.length>0}_getSearchFilterViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_getAvailableTargetAttributes(e,t){return t?.targetAttributes?.map(r=>(0,S.get)(e.viewModelConfig?.attributes||{},r)?r:null).filter(Boolean)||[]}_getSearchValueViewModelAttributeName(e){return`${e}SearchValue`}_getSearchFilteredColumnViewModelAttributeName(e){return`${e}SearchFilteredColumn`}_getSearchFilteredColumnsGroupsAttributeName(e){return`${e}_FilteredColumnsGroups`}_setDisabledAttribute(e,t){this._isTargetAttributesExist(e,t)||(t.disabled=!0)}_setTooltipAttribute(e){e.tooltip||(e.tooltip=this._translateService.instant("Components.SearchFilter.Tooltip"))}_setSearchValueAttribute(e,t){const r=this._getSearchValueViewModelAttributeName(t.name);this._createViewModelAttribute(e,r),t.value=`$${r}`}_setSearchFilteredColumnAttribute(e,t){const r=this._getSearchFilteredColumnViewModelAttributeName(t.name);this._createViewModelAttribute(e,r),t.filteredColumn=`$${r}`}_createViewModelAttribute(e,t){const r=e.viewModelConfig.attributes;Object.prototype.hasOwnProperty.call(r,t)||(r[t]={value:""})}_setFilterAttribute(e,t){!this._isTargetAttributesExist(e,t)||this._getAvailableTargetAttributes(e,t).forEach(r=>{this._setFilterConverterAttribute(e,t,r),this.setFilterAttribute(e,t.name,r)})}_setFilterConverterAttribute(e,t,r){const i=e.viewModelConfig.attributes,a=this.getFilterAttributeName(t.name,r),o=this._getSearchFilteredColumnsGroupsAttributeName(t.name),n={from:[this._getSearchValueViewModelAttributeName(t.name),o],converter:`crt.SearchFilterAttributeConverter: '${r}'`};this.createAttributeIfNeed(i,o,{value:[]}),this.createAttributeIfNeed(i,a,n)}_setSearchFilterColumnsGroupsRequest(e,t,r){var i=this;return(0,u.Z)(function*(){if(r.valueChange||!i._isTargetAttributesExist(e,r))return;const a=(yield i._createSearchFilterTargets(e,t,r)).filter(Boolean);if((0,S.isEmpty)(a))return;const n=(yield i._getIsSearchFilterQueryAnalyzerEnabled())?yield i._getIsNeedShowAllOptionForTargets(e,t,a):!0;i._setSearchFilterConfigIntoView(r,a,n),r.valueChange={request:"crt.SearchFilterColumnsGroupsRequest",params:{value:"@event.value",searchFilterColumnsGroups:"@event.columnsGroups",searchFilterGroups:a.map(l=>({filterAttributeName:l.filterAttributeName,viewAttributeName:l.viewAttribute.name})),searchValueAttributeName:i._getSearchValueViewModelAttributeName(r.name),searchFilteredColumnAttributeName:i._getSearchFilteredColumnViewModelAttributeName(r.name),searchFilteredColumnsGroupsAttributeName:i._getSearchFilteredColumnsGroupsAttributeName(r.name)}}})()}_getIsSearchFilterQueryAnalyzerEnabled(){return this._featureService.getFeatureState("SearchFilterQueryAnalyzerEnabled")}_getIsNeedShowAllOptionForTargets(e,t,r){var i=this;return(0,u.Z)(function*(){for(const a of r)if(yield i._getIsNeedOptimization(e,t,a.viewAttribute.name,a.columnsModel.columns))return!1;return!0})()}_getIsNeedOptimization(e,t,r,i){var a=this;return(0,u.Z)(function*(){if(a._isCollectionAttributeHasFixedFilter(e,t,r))return!1;const o=t.getBoundDataSchemaByAttributePath(r)?.name,n=i.map(d=>d.path);return!(0,lr.isNotEmpty)(o)||i.length===0?!1:(yield(0,_.firstValueFrom)(a._searchFilterQueryAnalyzerService.analyze(o,n))).isNeedOptimization})()}_isCollectionAttributeHasFixedFilter(e,t,r){let i=!1;const a=e.viewModelConfig.attributes;if(this._isDataSourceHasDependencies(e,t,r))return!0;const o=this.getAttributeModelFilters(a,r);return(0,S.each)(o,n=>(i=this._isPredefineFilterAttribute(a,n.name),!i)),i}_isPredefineFilterAttribute(e,t){const i=e[t]?.value?.filterType;return!!i||i===0}_isDataSourceHasDependencies(e,t,r){const i=t.getBoundDataSourceNameByAttributePath(r);return((e.modelConfig?.dependencies||{})[i]||[]).length>0}_createSearchFilterTargets(e,t,r){return Promise.all(this._getAvailableTargetAttributes(e,r).map(i=>this._createSearchFilterTarget(e,t,r.name,i)))}_createSearchFilterTarget(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=yield a._getColumnsModel(e,t,i);if(!o)return Promise.resolve(null);const n=`${r}_${i}`,l=a._getDisplayValueForViewAttributeName(t,i,o.viewName);return{columnsModel:o,filterAttributeName:n,viewAttribute:{caption:l,name:i}}})()}_getColumnsModel(e,t,r){return this._searchFilterPreprocessorService.getColumnsModelByAttributeName(e,t,r)}_getDisplayValueForViewAttributeName(e,t,r){const i=e.getBoundDataSchemaByAttributePath(t);return i?`${i.name}${(0,lr.isNotEmpty)(r)?" | "+r:""}`:r}_setSearchFilterConfigIntoView(e,t,r){e.columnsGroupsConfig={showAllOption:r,columnsGroups:t.map(i=>({group:i.viewAttribute,columns:i.columnsModel.columns})),primaryColumnName:t.slice().shift()?.columnsModel.primaryDisplayName}}crtOnMetaDataInit(e){const t=e;return this._getSearchFilterViewConfigs(t).forEach(i=>{this._setDisabledAttribute(t,i),this._setTooltipAttribute(i),this._setSearchValueAttribute(t,i),this._setSearchFilteredColumnAttribute(t,i),this._setFilterAttribute(t,i)}),Promise.resolve(e)}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=r,n=i._getSearchFilterViewConfigs(a);for(const l of n)yield i._setSearchFilterColumnsGroupsRequest(a,o,l);return e})()}}Re.\u0275fac=function(e){return new(e||Re)(s.\u0275\u0275inject(b.FeatureService),s.\u0275\u0275inject(J),s.\u0275\u0275inject(f.SearchFilterQueryAnalyzerService),s.\u0275\u0275inject(M.TranslateService))},Re.\u0275prov=s.\u0275\u0275defineInjectable({token:Re,factory:Re.\u0275fac});class Rt{constructor(e){this._exposeAttributeConverterMetadataGenerator=e}_getSelectionElementViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByFilter(t=>Boolean(t?._selectionOptions),e).map(t=>t.viewConfig)}_generateSelectionAttributes(e){const t=e._selectionOptions.attribute;if(typeof t=="string")return{};const{from:r,expose:i}=t??{};if((0,S.isEmpty)(r)||(0,S.isEmpty)(i))return{};const a=i.attribute;if(!a)return{};const o=this._exposeAttributeConverterMetadataGenerator.generate(i);return o?{[a]:{from:r,converter:o.converterExpression},...o.converterArgsAttributes}:{[a]:{from:r}}}crtOnMetaDataInit(e){const t=e;return this._getSelectionElementViewConfigs(t.viewConfig).map(r=>this._generateSelectionAttributes(r)).forEach(r=>{t.viewModelConfig.attributes={...t.viewModelConfig.attributes??{},...r}}),Promise.resolve(e)}}Rt.\u0275fac=function(e){return new(e||Rt)(s.\u0275\u0275inject(I.ExposeAttributeConverterMetadataGenerator))},Rt.\u0275prov=s.\u0275\u0275defineInjectable({token:Rt,factory:Rt.\u0275fac});class Oe{}Oe.\u0275fac=function(e){return new(e||Oe)},Oe.\u0275mod=s.\u0275\u0275defineNgModule({type:Oe}),Oe.\u0275inj=s.\u0275\u0275defineInjector({providers:[I.ExposeAttributeConverterMetadataGenerator,{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Rt,multi:!0}]});class Ot extends jt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var r=this;return(0,u.Z)(function*(){const i=e.items.slice(1),a=t.getBoundDataSchemaByAttributePath(i)?.name;if(a!=="SimilarLead")return;const o=t.getBoundDataSourceNameByAttributePath(i),n=yield r.hasEntityEditPage(t,a),l=`$${i}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:r._translateService.instant("DataGrid.RowToolbar.Open"),icon:"edit-row-action",visible:n,disabled:l,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${o}_Id`},useRelativeContext:!0}}]})()}}Ot.\u0275fac=function(e){return new(e||Ot)(s.\u0275\u0275inject(M.TranslateService))},Ot.\u0275prov=s.\u0275\u0275defineInjectable({token:Ot,factory:Ot.\u0275fac});class we extends F.AbstractHandler{constructor(e){super(),this._profileAttributeService=e}handle(e){const{metadata:t,viewConfig:r}=e??{};return!t||!r?.name?super.handle(e):typeof r.expanded=="boolean"?super.handle(e):(this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(t,r,"expanded",(0,f.createSummariesExpandedAttributeName)(r)),super.handle(e))}}we.\u0275fac=function(e){return new(e||we)(s.\u0275\u0275inject(w))},we.\u0275prov=s.\u0275\u0275defineInjectable({token:we,factory:we.\u0275fac});const Fr={type:"crt.MenuDivider"},Er="CanCreateDefaultSummariesSettings";class Ve extends F.AbstractHandler{constructor(e,t,r,i){super(),this._translateService=e,this._summaryItemMetaSettingsCreator=t,this._quickSummaryItemCreationActionsProvider=r,this._rightsService=i}_getDataSourceInfo(e,t,r){return g.DataSourceInfo.getFromViewModelConfig(e.viewModelConfig,t).get(r)}_createQuickSummaryItemMenuItems(e,t,r){return t?.length?t.map(i=>this._createQuickSummaryItemMenuItem(e,i,r)).filter(Boolean):[]}_createQuickSummaryItemMenuItem(e,t,r){return t?.actions?.length?this._createQuickSummaryItemMenuSubMenuItem(e,t,r):this._createQuickSummaryItemMenuActionItem(e,t,r)}_createQuickSummaryItemMenuSubMenuItem(e,t,r){const{name:i,icon:a,caption:o,actions:n}=t;return{type:"crt.MenuItem",name:`${e}_Create_${i}`,icon:a,caption:o,items:this._createQuickSummaryItemMenuItems(e,n,r)}}_createQuickSummaryItemMenuActionItem(e,t,r){const{name:i,icon:a,caption:o,summaryItemOptions:{label:n,expression:l}={}}=t,d=this._summaryItemMetaSettingsCreator.create({label:n,valueExpression:l,modelName:r});return{type:"crt.MenuItem",name:`${e}_Create_${i}`,icon:a,caption:o,clicked:{request:"crt.CreateSummaryItemRequest",params:{resources:d?.resources,summariesName:e,summaryItemViewConfig:d?.viewConfig}}}}_createQuickSummaryItemMenuItemsSection(e){var t=this;return(0,u.Z)(function*(){const{metadata:r,models:i,viewConfig:a}=e,o=a?.name,n=a?._designOptions?.modelName;if(!r||!n||!o)return[];const l=i?.find(P=>P.name===n),d=t._getDataSourceInfo(r,i,n);if(!l||!d)return[];const m=yield(0,_.lastValueFrom)(l.getSchema()),h=t._quickSummaryItemCreationActionsProvider.getActionsGroups(m,d),y=h?.flat()?.length,C=h.map(P=>t._createQuickSummaryItemMenuItems(o,P,n)).filter(P=>P?.length).map((P,T,xt)=>T===xt.length-1?P:[...P,Fr]).flat();return y?[{type:"crt.MenuLabel",caption:t._translateService.instant("Summaries.QuickSummaries.QuickSetup")},...C,{type:"crt.MenuDivider"}]:[]})()}_createAdvancedSetupActions(e){const{name:t}=e;return[{type:"crt.MenuLabel",caption:this._translateService.instant("Summaries.AdvancedSetup.Title")},{type:"crt.MenuItem",name:`${t}_AddCustomSummary`,icon:"add-button-icon",caption:this._translateService.instant("Summaries.AdvancedSetup.Actions.AddCustomSummary"),clicked:{request:"crt.AddSummaryItemRequest",params:{summariesName:t}}},{type:"crt.MenuDivider"}]}_getProfileActions(e){var t=this;return(0,u.Z)(function*(){if(!e)return[];const r=[{type:"crt.MenuItem",caption:t._translateService.instant("Summaries.ProfileActions.ResetToDefault"),icon:"reset-summaries",clicked:{request:"crt.ResetSummariesRequest",params:{summariesName:e}}}];return(yield t._rightsService.getCanExecuteOperation(Er))&&r.unshift({type:"crt.MenuItem",caption:t._translateService.instant("Summaries.ProfileActions.SaveForAll"),icon:"save",clicked:{request:"crt.SaveSummariesForAllRequest",params:{summariesName:e}}}),r})()}handle(e){var t=()=>super.handle,r=this;return(0,u.Z)(function*(){const i=e.viewConfig;if(!i?.name||i.actions||i.readonly===!0)return t().call(r,e);const a=yield r._getProfileActions(i.name),o=yield r._createQuickSummaryItemMenuItemsSection(e),n=r._createAdvancedSetupActions(i);return i.actions=[...o,...n,...a],t().call(r,e)})()}}Ve.\u0275fac=function(e){return new(e||Ve)(s.\u0275\u0275inject(M.TranslateService),s.\u0275\u0275inject(f.SummaryItemMetaSettingsCreator),s.\u0275\u0275inject(f.QuickSummaryItemCreationActionsProvider),s.\u0275\u0275inject(b.RightsService))},Ve.\u0275prov=s.\u0275\u0275defineInjectable({token:Ve,factory:Ve.\u0275fac});class Be extends F.AbstractHandler{constructor(e){super(),this._translateService=e}handle(e){const t=e?.viewConfig;return t?Boolean(t._designOptions?.modelName)?super.handle(e):(typeof t.title=="string"||(t.title=this._translateService.instant("Summaries.Hints.NoDataSource")),typeof t.disabled=="boolean"||(0,I.isBindingExpression)(t.disabled)||(t.disabled=!0),super.handle(e)):super.handle(e)}}Be.\u0275fac=function(e){return new(e||Be)(s.\u0275\u0275inject(M.TranslateService))},Be.\u0275prov=s.\u0275\u0275defineInjectable({token:Be,factory:Be.\u0275fac});class $e extends F.AbstractHandler{constructor(e,t){super(),this._featureValues=e,this._licenceOperationValues=t}handle(e){const t=e?.viewConfig,r=this._licenceOperationValues[f.CAN_MANAGE_SUMMARIES_LICENSE_OPERATION_CODE];return this._featureValues.DisableSummariesRestrictionsPreprocessing||r||!t?super.handle(e):(t.readonly=!0,super.handle(e))}}$e.\u0275fac=function(e){return new(e||$e)(s.\u0275\u0275inject(p.FEATURE_VALUES),s.\u0275\u0275inject(A.LICENSE_RESTRICTION_OPERATION_VALUES))},$e.\u0275prov=s.\u0275\u0275defineInjectable({token:$e,factory:$e.\u0275fac});class Le extends F.AbstractHandler{constructor(e){super(),this._translateService=e}handle(e){const t=e?.viewConfig;return!t?.name||t.actions||t.readonly===!0?super.handle(e):(t.actions=[{type:"crt.MenuItem",name:`${t.name}_DeleteAction`,caption:this._translateService.instant("SummaryItem.Actions.Delete"),icon:"delete-button-icon",clicked:{request:"crt.RemoveViewElementRequest",params:{name:t.name}}}],super.handle(e))}}Le.\u0275fac=function(e){return new(e||Le)(s.\u0275\u0275inject(M.TranslateService))},Le.\u0275prov=s.\u0275\u0275defineInjectable({token:Le,factory:Le.\u0275fac});const ur=new s.InjectionToken("Represents a handler to process summaries metadata on metadata init"),dr=new s.InjectionToken("Represents a handler to process summaries metadata on model init"),mr=new s.InjectionToken("Represents a handler to process summary item metadata on metadata init"),pr=new s.InjectionToken("Represents a factory for creating summary item value format");class xe extends F.AbstractHandler{constructor(e){super(),this._valueFormatFactory=e}_isValidValueOptions(e){return Boolean(e&&e.attribute&&e.modelName&&e.expression&&e.expression.function&&e.expression.columns)}handle(e){const{metadata:t,viewConfig:r}=e??{};if(!t||!r?.name||r.value!==void 0)return super.handle(e);const i=r._designOptions?.value;if(!this._isValidValueOptions(i))return super.handle(e);const{attribute:a,expression:o,modelName:n}=i,l=(0,f.createSummaryItemTargetAttributeName)(r),d=o.resultDataValueType??b.DataValueType.Text,m=`${i.attribute}_Format`,h=`${i.attribute}_ExpressionOptions`;return r.value=`$${a}`,t.viewModelConfig??(t.viewModelConfig={}),t.viewModelConfig.attributes={...t.viewModelConfig.attributes??{},[a]:{from:"crt.UpdateSummaryItemValueRequest",filter:`crt.ToObjectProp : 'target' | crt.IsTargetSummaryItem : $${l}`,converter:`crt.ToObjectProp : 'target' | crt.SummaryItemTargetToModelName | crt.SummaryItemToExpressionMetadata : $${h} | crt.ExecuteExpression | crt.FormatValue : $${m} | crt.ToEmptyPlaceholder : ${d}`},[m]:{value:this._valueFormatFactory.create(d)},[h]:{value:{...o,resultDataValueType:d}},[l]:{value:{modelName:n,viewElementName:r.name}}},super.handle(e)}}xe.\u0275fac=function(e){return new(e||xe)(s.\u0275\u0275inject(pr))},xe.\u0275prov=s.\u0275\u0275defineInjectable({token:xe,factory:xe.\u0275fac});class ke extends F.AbstractHandler{constructor(e,t){super(),this._featureValues=e,this._licenceOperationValues=t}handle(e){const t=e?.viewConfig,r=this._licenceOperationValues[f.CAN_MANAGE_SUMMARIES_LICENSE_OPERATION_CODE];return this._featureValues.DisableSummariesRestrictionsPreprocessing||r||!t?super.handle(e):(t.readonly=!0,super.handle(e))}}ke.\u0275fac=function(e){return new(e||ke)(s.\u0275\u0275inject(p.FEATURE_VALUES),s.\u0275\u0275inject(A.LICENSE_RESTRICTION_OPERATION_VALUES))},ke.\u0275prov=s.\u0275\u0275defineInjectable({token:ke,factory:ke.\u0275fac});class Mr{getViewConfigsByType(e,t){return(p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",[e],t.viewConfig)||[]).map(r=>r?.viewConfig).filter(Boolean)}processElementsOnMetadataInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i.getViewConfigsByType(e,r);yield Promise.all(a.map(o=>t?.handle({metadata:r,viewConfig:o})))})()}processElementsOnModelInit(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=a.getViewConfigsByType(e,r);yield Promise.all(o.map(n=>t?.handle({metadata:r,viewConfig:n,models:i})))})()}}class wt extends Mr{constructor(e,t,r){super(),this._summariesOnMetadataInitHandler=e,this._summariesOnModelInitHandler=t,this._summaryItemOnMetadataInitHandler=r}_removeSummaryItemsWithoutParent(e){e.viewConfig=(e?.viewConfig||[]).filter(t=>t.type!=="crt.SummaryItem")}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e;return t._removeSummaryItemsWithoutParent(r),t._summariesOnMetadataInitHandler&&(yield t.processElementsOnMetadataInit("crt.Summaries",t._summariesOnMetadataInitHandler,r)),t._summaryItemOnMetadataInitHandler&&(yield t.processElementsOnMetadataInit("crt.SummaryItem",t._summaryItemOnMetadataInitHandler,r)),Promise.resolve(e)})()}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){const i=e;return r._summariesOnModelInitHandler&&(yield r.processElementsOnModelInit("crt.Summaries",r._summariesOnModelInitHandler,i,t)),Promise.resolve(e)})()}}wt.\u0275fac=function(e){return new(e||wt)(s.\u0275\u0275inject(ur,8),s.\u0275\u0275inject(dr,8),s.\u0275\u0275inject(mr,8))},wt.\u0275prov=s.\u0275\u0275defineInjectable({token:wt,factory:wt.\u0275fac});const Rr=F.FactoryProvider.create({token:pr,mappings:[{predicate:c=>(0,S.without)(p.NUMERIC_DATA_VALUE_TYPES,b.DataValueType.Money).includes(c),useFactory:c=>({dataType:c,trimTrailingZeros:!0})}],default:{useFactory:c=>({dataType:c})}});class Y{}Y.\u0275fac=function(e){return new(e||Y)},Y.\u0275mod=s.\u0275\u0275defineNgModule({type:Y}),Y.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_PREPROCESSOR,useClass:wt,multi:!0},{provide:ur,useFactory:c=>{const e=c.get(Be);return e.setNext(c.get(we)).setNext(c.get($e)),e},deps:[s.Injector]},{provide:dr,useFactory:c=>c.get(Ve),deps:[s.Injector]},{provide:mr,useFactory:c=>{const e=c.get(ke);return e.setNext(c.get(xe)).setNext(c.get(Le)),e},deps:[s.Injector]},we,Be,Ve,Le,xe,$e,ke,Rr],imports:[f.QuickSummaryItemCreationActionsModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Y,{imports:[f.QuickSummaryItemCreationActionsModule]})}();class Vt{constructor(e,t){this._featureService=e,this._profileAttributeService=t,this._tabPanelActionsProcessingDisableFeature="DisableTabPanelPreprocessing",this._useTabPanelContainerFeature="UseTabPanelContainer"}get _useTabPanelContainer(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._useTabPanelContainerFeature))}_updateIconPosition(e){if(e.iconPosition)return;const t=!!e.icon;e.iconPosition=t?Ne.IconPositionEnum.LeftIcon:Ne.IconPositionEnum.OnlyText}_updateTabIconSource(e){f.TabItem.updateTabIconSource(e)}_updateTabHint(e){e.hint=e.caption}_convertViewConfigPropToBoolean(e,t,r){return t in e?!!e[t]:r}_getTabContainerHeader(e){const t=this._getTabPanelHeaderItemInputs();return{type:"crt.TabPanelHeader",tabs:e.viewConfig.items?.map(r=>({...Object.fromEntries(t.filter(i=>typeof r[i]<"u").map(i=>[i,r[i]])),type:"crt.TabPanelHeaderItem",name:r.name,titleColor:e.viewConfig.tabTitleColor,selectedTitleColor:e.viewConfig.selectedTabTitleColor,undrelineColor:e.viewConfig.underlineSelectedTabColor,styleType:e.viewConfig.styleType}))}}_getTabContainerBody(e){const t=this._convertViewConfigPropToBoolean(e.viewConfig,"allowToggleClose",!0),r=e.viewConfig.mode==="tab"?!1:t;return{type:"crt.ToggleContainer",preserveContent:this._convertViewConfigPropToBoolean(e.viewConfig,"preserveContent",!0),items:e.viewConfig.items?.map(i=>({...i,type:"crt.ToggleContainerItem",backgroundColor:e.viewConfig.bodyBackgroundColor,isToggleTabHeaderVisible:this._convertViewConfigPropToBoolean(i,"isToggleTabHeaderVisible",!1),allowToggleClose:r})),visibilityStrategyMode:e.viewConfig.visibilityStrategyMode}}_getTabPanelHeaderItemInputs(){return Object.keys(b.ViewElementRegistry.viewElements.get("crt.TabPanelHeaderItem")?.inputs||{})}get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._tabPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e;if(!(yield t.isProcessingDisabled)&&(p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TabContainer",r.viewConfig).forEach(a=>{t._updateIconPosition(a.viewConfig),t._updateTabIconSource(a.viewConfig),t._updateTabHint(a.viewConfig)}),yield t._useTabPanelContainer)){const a=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TabPanel",r.viewConfig);for(const o of a){yield t._profileAttributeService.prepareAttributeWithFeatureCheck(r,o.viewConfig,"selectedTabIndex","","DisableSaveToProfileSelectedTabIndex");const n=t._getTabContainerBody(o),l=t._getTabContainerHeader(o);if(o.viewConfig.mode==="toggle"){const d={...n,name:o.viewConfig.name,visible:o.viewConfig.visible,selectedTab:o.viewConfig.selectedTab,layoutConfig:o.viewConfig.layoutConfig||{},stretch:o.viewConfig.stretch,classes:o.viewConfig.classes,fitContent:o.viewConfig.fitContent},m=t._convertViewConfigPropToBoolean(o.viewConfig,"isToggleTabHeaderVisible",!0);d.items.forEach(h=>{h.isToggleTabHeaderVisible=m}),Object.keys(o.viewConfig).forEach(h=>delete o.viewConfig[h]),Object.assign(o.viewConfig,d)}else o.viewConfig.items=[l,n]}}return e})()}}Vt.\u0275fac=function(e){return new(e||Vt)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(w))},Vt.\u0275prov=s.\u0275\u0275defineInjectable({token:Vt,factory:Vt.\u0275fac});class Or{constructor(){this._dataSchemaRepository=(0,s.inject)(g.DataSchemaRepositoryService)}setupSelect(e,t){var r=this;return(0,u.Z)(function*(){!r.isCanSetupSelect(e,t)||(yield r.initializeSchemasNames(t),r.isCanRunSetupSelectData(t)&&(yield r.setupDataViewModel(e,t),yield r.setupInputs(t),yield r.setupRequests(t)))})()}isCanSetupSelect(e,t){return!!t.selectSchemaName&&!!t.selectColumnName&&this.isViewModelAttributeExist(e,t.recordId)}isViewModelAttributeExist(e,t){if(!t)return!1;const r=Object.keys(e.viewModelConfig?.attributes||{}),i=this.getAttributeName(t);return r.includes(i)}getAttributeName(e){return(0,I.isBindingExpression)(e)?e.slice(1):e}initializeSchemasNames(e){var t=this;return(0,u.Z)(function*(){yield t.initializeSelectSchemaName(e),yield t.initializeListSchemaName(e)})()}initializeSelectSchemaName(e){}initializeListSchemaName(e){var t=this;return(0,u.Z)(function*(){if(!e.selectColumnName)return;const i=(yield t.getSelectDataSchema(e)).findAttributeByName(e.selectColumnName);e.listSchemaName=i?.referenceSchemaName})()}isCanRunSetupSelectData(e){return!!e.selectSchemaName&&!!e.listSchemaName}setupDataViewModel(e,t){var r=this;return(0,u.Z)(function*(){yield r.createAndAddItemsViewModelAttributeData(e,t),yield r.createAndAddListItemsViewModelAttributeData(e,t)})()}createAndAddItemsViewModelAttributeData(e,t){var r=this;return(0,u.Z)(function*(){yield r.createAndAddItemsViewModelAttribute(e,t),r.createAndAddItemsViewModelSortingAttribute(e,t),r.createAndAddItemsViewModelFilterAttribute(e,t),r.createAndAddItemsViewModelFilterConfigAttribute(e,t)})()}createAndAddItemsViewModelAttribute(e,t){var r=this;return(0,u.Z)(function*(){const i=yield r.getSelectDataSchema(t),a=yield r.getListDataSchema(t),o=r.createItemsAttribute(t,i);r.addItemsAttributeViewModelConfig(o,t,i,a),r.addItemsEmbeddedDataSource(o,t),r.addItemsAttributeToViewModelConfig(e,t,o)})()}createItemsAttribute(e,t){const r=this.getItemsDataSourceName(e),i=this.getItemsFilterAttributeName(e);return(0,S.merge)(this.createCollectionAttribute(r),{modelConfig:{sortingConfig:this.getItemsSortingConfig(e,t),filterAttributes:[{name:i,loadOnChange:!0}]}})}createCollectionAttribute(e){return{isCollection:!0,modelConfig:{path:e}}}getItemsSortingConfig(e,t){return{default:[{columnName:"CreatedOn",direction:"desc"}],attributeName:this.getItemsSortingAttributeName(e)}}addItemsAttributeViewModelConfig(e,t,r,i){const a=this.getItemsDataSourceName(t),o=t.selectColumnName,n=i.primaryAttributeName,l=i.primaryDisplayAttributeName,d=i.primaryColorAttributeName,m={RelationRecordId:{modelConfig:{path:`${a}.${r.primaryAttributeName}`}},[n]:{modelConfig:{path:`${a}.${o}.${n}`}},[l]:{modelConfig:{path:`${a}.${o}.${l}`}}};d&&(m[d]={modelConfig:{path:`${a}.${o}.${d}`}}),e.viewModelConfig={attributes:m}}addItemsEmbeddedDataSource(e,t){const r=this.getItemsDataSourceName(t),i=t.selectSchemaName;e.embeddedModel=this.createEmbeddedDataSource(r,i)}createEmbeddedDataSource(e,t){return{name:e,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t},hiddenInPageDesigner:!1}}}addItemsAttributeToViewModelConfig(e,t,r){this.addViewModelConfigAttribute(e,this.getItemsAttributeName(t),r)}addViewModelConfigAttribute(e,t,r){!e?.viewModelConfig?.attributes||e.viewModelConfig.attributes[t]||(e.viewModelConfig.attributes[t]=r)}createAndAddItemsViewModelSortingAttribute(e,t){const r=this.createSortingAttributeConfig(),i=this.getItemsSortingAttributeName(t);this.addViewModelConfigAttribute(e,i,r)}createAndAddItemsViewModelFilterAttribute(e,t){const r=this.createItemsViewModelFilterAttribute(t),i=this.getItemsFilterAttributeName(t);this.addViewModelConfigAttribute(e,i,r)}createItemsViewModelFilterAttribute(e){const t=this.getAttributeName(e.recordId),r=this.getItemsFilterConfigAttributeName(e);return{from:t,converter:`crt.BaseSelectFilterAttributeConverter: $${r}`}}createAndAddItemsViewModelFilterConfigAttribute(e,t){const r={value:{selectSchemaName:t.selectSchemaName,selectColumnName:t.selectColumnName,recordRelationColumnName:t.recordRelationColumnName}},i=this.getItemsFilterConfigAttributeName(t);this.addViewModelConfigAttribute(e,i,r)}createAndAddListItemsViewModelAttributeData(e,t){var r=this;return(0,u.Z)(function*(){yield r.createAndAddListItemsViewModelAttribute(e,t),r.createAndAddListItemsViewModelSortingAttribute(e,t),r.createAndAddListItemsViewModelFilterAttribute(e,t)})()}createAndAddListItemsViewModelAttribute(e,t){var r=this;return(0,u.Z)(function*(){const i=yield r.getListDataSchema(t),a=r.createListItemsAttribute(t,i);r.addListItemsAttributeViewModelConfig(a,t,i),r.addListItemsEmbeddedDataSource(a,t),r.addListItemsAttributeToViewModelConfig(e,t,a)})()}getSelectDataSchema(e){const t=e.selectSchemaName;return this.getDataSchema(t)}getListDataSchema(e){const t=e.listSchemaName;return this.getDataSchema(t)}getDataSchema(e){return(0,_.lastValueFrom)(this._dataSchemaRepository.get(e))}createListItemsAttribute(e,t){const r=this.getListItemsDataSourceName(e),i=this.getListItemsFilterAttributeName(e),a={sortingConfig:this.getListItemsSortingConfig(e,t),filterAttributes:[{name:i,loadOnChange:!0}],pagingConfig:{rowCount:30}};return(0,S.merge)(this.createCollectionAttribute(r),{isLookup:!0,modelConfig:a})}getListItemsSortingConfig(e,t){return{default:[this.getDefaultSortingColumn(t)],attributeName:this.getListItemsSortingAttributeName(e)}}getDefaultSortingColumn(e){return{columnName:e.primaryDisplayAttributeName,direction:"asc"}}addListItemsAttributeViewModelConfig(e,t,r){const i=this.getListItemsDataSourceName(t),a={value:{modelConfig:{path:`${i}.${r.primaryAttributeName}`}},displayValue:{modelConfig:{path:`${i}.${r.primaryDisplayAttributeName}`}}};r.primaryColorAttributeName&&(a.primaryColorValue={modelConfig:{path:`${i}.${r.primaryColorAttributeName}`}}),e.viewModelConfig={attributes:a}}addListItemsEmbeddedDataSource(e,t){const r=this.getListItemsDataSourceName(t),i=t.listSchemaName;e.embeddedModel=this.createEmbeddedDataSource(r,i)}addListItemsAttributeToViewModelConfig(e,t,r){this.addViewModelConfigAttribute(e,this.getListItemsAttributeName(t),r)}createAndAddListItemsViewModelSortingAttribute(e,t){const r=this.createSortingAttributeConfig(),i=this.getListItemsSortingAttributeName(t);this.addViewModelConfigAttribute(e,i,r)}createSortingAttributeConfig(){return{isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}}}createAndAddListItemsViewModelFilterAttribute(e,t){const r=this.createListItemsViewModelFilterAttribute(t),i=this.getListItemsFilterAttributeName(t);this.addViewModelConfigAttribute(e,i,r)}createListItemsViewModelFilterAttribute(e){return{value:null}}setupInputs(e){this.setItemsAttributeValue(e),this.setListItemsAttributeValue(e)}setItemsAttributeValue(e){if(e.items)return;const t=this.getItemsAttributeName(e);e.items=`$${t}`}setListItemsAttributeValue(e){if(e.listItems)return;const t=this.getListItemsAttributeName(e);e.listItems=`$${t}`}setupRequests(e){this.setShowListRequest(e),this.setPaginationChangeRequest(e)}setShowListRequest(e){if(e.showList)return;const t=this.getListItemsDataSourceName(e),r=this.createLoadDataRequestConfig(t);r.params={...r.params,config:{loadType:b.DataSourceLoadType.Reload}},e.showList=r}setPaginationChangeRequest(e){if(e.paginationChange)return;const t=this.getListItemsDataSourceName(e);e.paginationChange=this.createLoadDataRequestConfig(t)}createLoadDataRequestConfig(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:e,primaryDisplayFilterValue:"@event.primaryDisplayFilterValue",parameters:[]},useRelativeContext:!0}}getItemsAttributeName(e){return`${e.name}_Items`}getItemsSortingAttributeName(e){return`${this.getItemsAttributeName(e)}_Sorting`}getItemsFilterAttributeName(e){return`${this.getItemsAttributeName(e)}_Filter`}getItemsFilterConfigAttributeName(e){return`${this.getItemsAttributeName(e)}_Filter_Config`}getItemsDataSourceName(e){return`${this.getItemsAttributeName(e)}_DS`}getListItemsAttributeName(e){return`${e.name}_List_Items`}getListItemsSortingAttributeName(e){return`${this.getListItemsAttributeName(e)}_Sorting`}getListItemsFilterAttributeName(e){return`${this.getListItemsAttributeName(e)}_Filter`}getListItemsDataSourceName(e){return`${this.getListItemsAttributeName(e)}_DS`}}class Ge extends Or{constructor(){super(...arguments),this._userInfo=(0,s.inject)(p.UserInfo),this._tagRightsService=(0,s.inject)(f.TagRightsService),this._allowedTagAccessesForTaggingIds=[]}_getTagSelectViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TagSelect",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_prepareDataForTagSelects(e){var t=this;return(0,u.Z)(function*(){let r=!1;e.forEach(i=>(0,f.isOldStructure)(i)?null:r=!0),r&&(yield t._prepareAllowedTagAccessesForTagging())})()}_processTagSelect(e,t,r){var i=this;return(0,u.Z)(function*(){if(!i._isRecordIdViewModelAttributeExist(e,t)){i._setTagSelectDisabled(t);return}yield i._setTagSelectRecordSchemaName(e,t,r),i._setTagSelectDisabledAttribute(e,t),yield i.setupSelect(e,t)})()}_setTagSelectDisabledAttribute(e,t){if(!this._isTagSelectDisabledAttributeFilled(t)){if(!this._isTagSelectRecordSchemaNameFilled(t)){this._setTagSelectDisabled(t);return}this._createAndAddTagSelectViewModelDisabledAttribute(e,t),t.disabled=`$${this._getTagSelectDisabledAttributeName(t)}`}}_setTagSelectDisabled(e){e.disabled=!0}_isTagSelectDisabledAttributeFilled(e){return"disabled"in e}_createAndAddTagSelectViewModelDisabledAttribute(e,t){const r=this.getAttributeName(t.recordId),i={from:r,converter:`crt.TagSelectDisabledAttributeConverter: '${r}'`},a=this._getTagSelectDisabledAttributeName(t);this.addViewModelConfigAttribute(e,a,i)}_isRecordIdViewModelAttributeExist(e,t){return this.isViewModelAttributeExist(e,t.recordId)}_setCreateTagRequest(e){var t=this;return(0,u.Z)(function*(){if(e.createTag)return;const r=yield t.getListDataSchema(e),i=t.getListItemsAttributeName(e);e.createTag=(0,f.isOldStructure)(e)?t._getCreateTagRequestForOldtructure(e,r):t._getCreateTagRequestForNewStructure(e,r,i)})()}_getCreateTagRequestForOldtructure(e,t){return{request:"crt.OpenOldTagMiniPageRequest",params:{entitySchemaName:e.listSchemaName,action:b.ModelInPageAction.Add,defaultValues:[{attributeName:t.primaryDisplayAttributeName,value:"@event.primaryDisplayFilterValue"}]}}}_getCreateTagRequestForNewStructure(e,t,r){return{request:"crt.CreateRecordRequest",params:{itemsAttributeName:r,defaultValues:[{attributeName:t.primaryDisplayAttributeName,value:"@event.primaryDisplayFilterValue"},{attributeName:f.TAG_ENTITY_SCHEMA_NAME_PAGE_ATTRIBUTE_NAME,value:e.recordSchemaName}],skipUnsavedData:!0}}}_setEditTagRequest(e){e.editTag||(e.editTag=(0,f.isOldStructure)(e)?this._getEditTagRequestForOldStructure(e):this._getEditTagRequestForNewStructure(e))}_getEditTagRequestForOldStructure(e){return{request:"crt.OpenOldTagMiniPageRequest",params:{entitySchemaName:e.listSchemaName,action:b.ModelInPageAction.Edit,recordId:"@event.id"}}}_getEditTagRequestForNewStructure(e){return{request:"crt.UpdateRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this.getListItemsAttributeName(e),trackUnsavedData:!1}}}_setDeleteTagRequest(e){e.deleteTag||(e.deleteTag={request:(0,f.isOldStructure)(e)?"crt.DeleteOldTagRecordRequest":"crt.DeleteRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this.getListItemsAttributeName(e)}})}_setAddTagsInRecordRequest(e){if(e.addTagsInRecord)return;const t=this.getItemsDataSourceName(e);e.addTagsInRecord={request:"crt.AddTagsInRecordRequest",params:{dataSourceName:t,tagIds:"@event.tagIds",recordId:e.recordId,recordSchemaName:e.recordSchemaName,tagInRecordSourceSchemaName:e.tagInRecordSourceSchemaName}}}_setDeleteTagInRecordRequest(e){if(e.deleteTagInRecord)return;const t=this.getItemsDataSourceName(e);e.deleteTagInRecord={request:"crt.DeleteTagInRecordRequest",params:{dataSourceName:t,id:"@event.id"}}}_setTagSelectRecordSchemaName(e,t,r){var i=this;return(0,u.Z)(function*(){if(i._isTagSelectRecordSchemaNameFilled(t))return;const a=yield i._getRecordSchemaName(e,t,r);!a||(t.recordSchemaName=a)})()}_isTagSelectRecordSchemaNameFilled(e){return!!e.recordSchemaName}_getRecordSchemaName(e,t,r){if(!e?.viewModelConfig?.attributes||!r?.length)return Promise.resolve(null);const[i,a]=this._getRecordIdAttributeModelPaths(e.viewModelConfig.attributes,t.recordId);return this._getRecordSchemaNameFromModel(i,a,r)}_getRecordIdAttributeModelPaths(e,t){const r=this.getAttributeName(t),o=e[r]?.modelConfig?.path?.split(".");return!o||o.length<2?["",""]:[o[0],o[1]]}_getRecordSchemaNameFromModel(e,t,r){var i=this;return(0,u.Z)(function*(){if(!e||!t)return null;const a=r.find(m=>m.name===e);if(!a)return null;const o=yield(0,_.lastValueFrom)(a.getSchema()),n=o.findAttributeByName(t);if(!n)return null;const l=n.referenceSchemaName??null,d=o.dataSourceConfig?.config?.entitySchemaName;return l||i._getEntitySchemaNameFromDataSchema(d,n)})()}_getEntitySchemaNameFromDataSchema(e,t){if(t.attributeType===b.DataSchemaAttributeType.OwnAttribute)return Promise.resolve(e);const r=t.path.split(".");return this._findEntitySchemaNameByColumnPath(e,r)}_findEntitySchemaNameByColumnPath(e,t){var r=this;return(0,u.Z)(function*(){if(!e)return null;const i=t.shift();if(!i)return e;const o=(yield r.getDataSchema(e)).attributes.find(n=>n.name===i);return o?.referenceSchemaName?r._findEntitySchemaNameByColumnPath(o.referenceSchemaName,t):e})()}_getTagSelectDisabledAttributeName(e){return`${e.name}_Disabled`}_prepareViewConfig(e){e.selectSchemaName=this._getSelectSchemaName(e),e.selectColumnName=f.DEFAULT_TAG_COLUMN_NAME_TAG_IN_RECORD_SCHEMA,e.recordRelationColumnName=this._getRecordRelationColumnName(e)}_getSelectSchemaName(e){return(0,f.isOldStructure)(e)?e.tagInRecordSourceSchemaName:f.DEFAULT_TAG_IN_RECORD_SOURCE_SCHEMA_NAME}_getRecordRelationColumnName(e){return(0,f.isOldStructure)(e)?f.OLD_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA:f.DEFAULT_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA}_prepareAllowedTagAccessesForTagging(){var e=this;return(0,u.Z)(function*(){e._allowedTagAccessesForTaggingIds=yield(0,f.getAllowedTagAccessesForTagging)(e._tagRightsService)})()}setupSelect(e,t){var r=()=>super.setupSelect,i=this;return(0,u.Z)(function*(){!i._isTagSelectRecordSchemaNameFilled(t)||(i._prepareViewConfig(t),yield r().call(i,e,t))})()}setupRequests(e){var t=()=>super.setupRequests,r=this;return(0,u.Z)(function*(){yield t().call(r,e),yield r._setCreateTagRequest(e),r._setEditTagRequest(e),r._setDeleteTagRequest(e),r._setAddTagsInRecordRequest(e),r._setDeleteTagInRecordRequest(e)})()}createItemsViewModelFilterAttribute(e){return{from:this.getAttributeName(e.recordId),converter:`crt.TagSelectFilterAttributeConverter: '${e.recordSchemaName}' : ${(0,f.isOldStructure)(e)}`}}createListItemsViewModelFilterAttribute(e){return{value:(0,f.isOldStructure)(e)?(0,f.createOldTagListFilter)(this._userInfo):(0,f.createTagListFilter)([e.recordSchemaName],this._allowedTagAccessesForTaggingIds)}}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){const i=e,a=r._getTagSelectViewConfigs(i);return yield r._prepareDataForTagSelects(a),yield Promise.all(a.map(o=>r._processTagSelect(i,o,t))),e})()}}Ge.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Ge)))(t||Ge)}}(),Ge.\u0275prov=s.\u0275\u0275defineInjectable({token:Ge,factory:Ge.\u0275fac});class Bt{constructor(e,t){this._quickFilterPreprocessorService=e,this._translateService=t}_getTimelineViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Timeline",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_getFilterByOwnerConfig(e){const t={caption:this._translateService.instant("Timeline.OwnerFilterCaption"),hint:this._translateService.instant("Timeline.OwnerFilterHint"),icon:"person-button-icon",iconPosition:"left-icon",entitySchemaName:"Contact"};return{filterType:"lookup",name:"ByOwnerQuickFilterIn"+e,type:"crt.QuickFilter",config:t}}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=t._getTimelineViewConfigs(r);return yield Promise.all(i.map(function(){var a=(0,u.Z)(function*(o){const n=t._getFilterByOwnerConfig(o.name);yield t._quickFilterPreprocessorService.crtOnMetaDataInit(n,e),o.quickFilterByOwnerConfig=n});return function(o){return a.apply(this,arguments)}}())),Promise.resolve(e)})()}}Bt.\u0275fac=function(e){return new(e||Bt)(s.\u0275\u0275inject(x),s.\u0275\u0275inject(M.TranslateService))},Bt.\u0275prov=s.\u0275\u0275defineInjectable({token:Bt,factory:Bt.\u0275fac});class $t{_modifyInputType(e,t,r){const i=e.control.replace("$",""),a=t.attributes[i]?.modelConfig?.path;if(a){const o=this._getDataSchemaAttributeByPath(a,r);b.DataValueType.WEB_TEXT&&o?.dataValueType===b.DataValueType.WEB_TEXT&&(e.type="crt.WebInput")}}_getDataSchemaAttributeByPath(e,t){const[r,i]=e.split("."),a=t.dataSchemas[r]?.attributes;let o;for(const n in a)if(a[n].path===i){o=a[n];break}return o}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),n=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.WebInput",a.viewConfig);return o.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),n.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),e})()}}$t.\u0275fac=function(e){return new(e||$t)},$t.\u0275prov=s.\u0275\u0275defineInjectable({token:$t,factory:$t.\u0275fac});var D=N(78094);const wr={type:"string",maxLinesCount:2,maxLineLength:10},Vr={type:"number",thousandAbbreviation:{enabled:!0}},fr="DISABLE_CHART_WIDGET_AXES_FORMATTING_ADAPTATION";class je{constructor(e,t,r){this._entitySchemaService=t,this._entitySchemaProvider=r,this._isAdaptionDisabled=Boolean(e[fr])}_getWidgetViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.ChartWidget"],e).map(t=>t?.viewConfig)}_adaptAxesFormatting(e){var t=this;return(0,u.Z)(function*(){const{scales:r,series:i}=e?.config??{},a=r?.xAxis??{};!t._isDefaultXAxisFormat(a)||!(yield t._isAllSeriesGroupingByNumericColumn(i))||(a.formatting=Vr)})()}_isDefaultXAxisFormat(e){return(0,S.isEqual)(e?.formatting,wr)}_isAllSeriesGroupingByNumericColumn(e){var t=this;return(0,u.Z)(function*(){if(!e?.length)return!1;for(const r of e)if(!(yield t._isSeriesGroupingByNumericColumn(r)))return!1;return!0})()}_isSeriesGroupingByNumericColumn(e){var t=this;return(0,u.Z)(function*(){const{schemaName:r,grouping:i}=e?.data?.providing??{};if(i?.type!==D.ChartGroupingType.ByValue)return!1;const a=i.column?.expression?.columnPath;if(!r||!a)return!1;const o=yield(0,_.firstValueFrom)(t._entitySchemaProvider.getSchemaByName(r)),n=yield(0,_.firstValueFrom)(t._entitySchemaService.getEntitySchemaColumnsInformationByPath(o.uId,a));return p.NUMERIC_DATA_VALUE_TYPES.includes(n?.dataValueType)})()}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(t._isAdaptionDisabled)return e;const r=e,i=t._getWidgetViewConfigs(r.viewConfig).map(a=>t._adaptAxesFormatting(a));return yield Promise.all(i),e})()}}je.\u0275fac=function(e){return new(e||je)(s.\u0275\u0275inject(p.FEATURE_VALUES),s.\u0275\u0275inject(p.EntitySchemaService),s.\u0275\u0275inject(p.EntitySchemaProvider))},je.\u0275prov=s.\u0275\u0275defineInjectable({token:je,factory:je.\u0275fac});const Jt=new s.InjectionToken("Represents a factory of widget data providing metadata compressors"),gr=new s.InjectionToken("Represents a list of widget element types that support data source");class qe{constructor(e,t,r){this._featureService=e,this._widgetDataProvidingMetadataCompressorFactory=r,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(D.DISABLE_SUPPORT_WIDGET_DATA_SOURCE_FEATURE_NAME).pipe((0,O.first)(),(0,O.map)(Boolean),(0,O.map)(t=>!t));return(0,_.lastValueFrom)(e)}_getWidgetViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>Boolean(t?.name)&&Boolean(t?.config))}_compressWidgetDataProvidingMetadata(e,t){this._widgetDataProvidingMetadataCompressorFactory.create(e.type)?.compress(e.name,t)}crtOnMetaDataChanged(e){var t=this;return(0,u.Z)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const r=e;return t._getWidgetViewConfigs(r.viewConfig).forEach(i=>t._compressWidgetDataProvidingMetadata(i,r)),e})()}}qe.\u0275fac=function(e){return new(e||qe)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(gr,8),s.\u0275\u0275inject(Jt))},qe.\u0275prov=s.\u0275\u0275defineInjectable({token:qe,factory:qe.\u0275fac});function Br(){return F.FactoryProvider.create({token:Jt,mappings:[{predicate:D.CHART_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.ChartWidgetDataProvidingMetadataCompressor},{predicate:D.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.IndicatorWidgetDataProvidingMetadataCompressor},{predicate:D.GAUGE_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.IndicatorWidgetDataProvidingMetadataCompressor}]})}class k{static for(...e){return{ngModule:k,providers:[{provide:g.CRT_METADATA_POSTPROCESSOR,useFactory:(t,r)=>new qe(t,e,r),deps:[A.FeatureService,Jt],multi:!0}]}}}k.\u0275fac=function(e){return new(e||k)},k.\u0275mod=s.\u0275\u0275defineNgModule({type:k}),k.\u0275inj=s.\u0275\u0275defineInjector({providers:[Br()],imports:[D.ChartWidgetDataProvidingMetadataCompressorModule,D.IndicatorWidgetDataProvidingMetadataCompressorModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(k,{imports:[D.ChartWidgetDataProvidingMetadataCompressorModule,D.IndicatorWidgetDataProvidingMetadataCompressorModule]})}();const Yt=new s.InjectionToken("Represents a factory of widget data providing metadata generators");class Ue{constructor(e,t,r){this._featureService=e,this._widgetDataProvidingMetadataGeneratorFactory=r,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(D.DISABLE_SUPPORT_WIDGET_DATA_SOURCE_FEATURE_NAME).pipe((0,O.first)(),(0,O.map)(Boolean),(0,O.map)(t=>!t));return(0,_.lastValueFrom)(e)}_getWidgetViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>Boolean(t?.name)&&Boolean(t?.config))}_generateWidgetDataProvidingMetadata(e,t){return this._widgetDataProvidingMetadataGeneratorFactory.create(e.type).generate(e,t)}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const r=e;return t._getWidgetViewConfigs(r.viewConfig).map(i=>t._generateWidgetDataProvidingMetadata(i,r)).forEach(i=>(0,S.defaultsDeep)(r,i)),e})()}}Ue.\u0275fac=function(e){return new(e||Ue)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(gr,8),s.\u0275\u0275inject(Yt))},Ue.\u0275prov=s.\u0275\u0275defineInjectable({token:Ue,factory:Ue.\u0275fac});function $r(){return F.FactoryProvider.create({token:Yt,mappings:[{predicate:D.CHART_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.ChartWidgetDataProvidingMetadataGenerator},{predicate:D.GAUGE_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.IndicatorWidgetDataProvidingMetadataGenerator},{predicate:D.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,injectable:D.IndicatorWidgetDataProvidingMetadataGenerator}]})}class B{static for(...e){return{ngModule:B,providers:[{provide:g.CRT_METADATA_PREPROCESSOR,useFactory:(t,r)=>new Ue(t,e,r),deps:[A.FeatureService,Yt],multi:!0}]}}}B.\u0275fac=function(e){return new(e||B)},B.\u0275mod=s.\u0275\u0275defineNgModule({type:B}),B.\u0275inj=s.\u0275\u0275defineInjector({providers:[$r()],imports:[D.ChartWidgetDataProvidingMetadataGeneratorModule,D.IndicatorWidgetDataProvidingMetadataGeneratorModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(B,{imports:[D.ChartWidgetDataProvidingMetadataGeneratorModule,D.IndicatorWidgetDataProvidingMetadataGeneratorModule]})}();class We{constructor(e){this._featureService=e,this._chartWidgetName="crt.ChartWidget",this._indicatorWidgetName="crt.IndicatorWidget",this._gaugeWidgetName="crt.GaugeWidget"}_getWidgetsArray(e){const t=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._chartWidgetName,e.viewConfig),r=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._indicatorWidgetName,e.viewConfig),i=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._gaugeWidgetName,e.viewConfig);return[...t,...r,...i]}_getWidgetName(e){return e.name.replace(/\./g,"_")}_getDataSetSortinAttributeName(e){return`${e.split(" ").join("").replace(/\./g,"_")}_ListDataDSSorting`}get _isDrillDownFeatureEnabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(D.CHART_WIDGET_DRILLDOWN_FEATURE_NAME))}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){const i=e,a=r._getWidgetsArray(i);for(const o of a){const n=o?.viewConfig;let l=i.viewModelConfig.attributes;l||(l=i.viewModelConfig.attributes={});const d=r._getWidgetName(n),m=`${g.DYNAMIC_DATA_SOURCE_PREFIX}_${d}`,h=r._getDataSetSortinAttributeName(m),y=`${m}_ListData`,C=`${y}_SearchFilter`;l[`${m}_ListConfig`]={value:[]},l[`${m}_UserProfileData`]={value:[]},l[y]={isCollection:!0,modelConfig:{path:`${m}_ListDataDS`,sortingConfig:{attributeName:h},filterAttributes:[{name:C,loadOnChange:!0}]},viewModelConfig:{attributes:{}}},h&&(l[h]={value:[]}),l[C]={value:{}}}return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=i._getWidgetsArray(a);for(const n of o){const l=n?.viewConfig,d=i._getWidgetName(l),m=`${g.DYNAMIC_DATA_SOURCE_PREFIX}_${d}`,h=`${m}_ListDataDS`,y=`${m}_ListConfig`,C=`${m}_ListData`,P=`${m}_UserProfileData`,T=`${C}_SearchFilter`;l.listData=`$${C}`,l.listConfig=`$${y}`,l.userProfileData=`$${P}`,l.drillDown={request:"crt.WidgetDrilldownRequest",params:{dataSourceName:h,listConfigAttributeName:y,listDataAttributeName:C,parameters:[],config:{schemaName:"@event.schemaName",groupByValue:"@event.groupByValue",pagingConfig:"@event.pagingConfig",sortingConfig:"@event.sortingConfig",groupBy:"@event.groupBy",aggregateBy:"@event.aggregateBy",columns:"@event.columns",filters:"@event.filters",dependencies:"@event.dependencies"}}},l.paginationChange=Wt(h),l.getProfileColumns={request:"crt.AnalyticsDataGridGetColumnsRequest",params:{userProfileDataAttributeName:P,widgetAttributePrefix:m,drilldownConfig:"@event.drilldownConfig",schemaName:"@event.schemaName",isDefault:!1}},l.columnsChange={request:"crt.AnalyticsDataGridSaveToProfileRequest",params:{schemaName:"@event.schemaName",isDefault:!1,dataTableData:"@event.dataTableData",listConfigAttributeName:y}},l.searchFilterChange={request:"crt.SearchFilterRequest",params:{value:"@event.value",searchFilterTargets:[{columns:"@event.columns",viewAttributeName:C,filterAttributeName:T}]}}}return e})()}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){var r;if(!(yield t._isDrillDownFeatureEnabled))return e;const i=e,a=t._getWidgetsArray(i);for(const o of a)!o.viewConfig||o.viewConfig?.pagingConfig||(o.viewConfig.pagingConfig=Zt(),(r=o.viewConfig).fullScreenStateChanged??(r.fullScreenStateChanged={request:"crt.WidgetFullScreenStateChangesRequest",params:{widgetName:o.viewConfig.name,fullScreenState:"@event"}}));return e})()}}We.\u0275fac=function(e){return new(e||We)(s.\u0275\u0275inject(A.FeatureService))},We.\u0275prov=s.\u0275\u0275defineInjectable({token:We,factory:We.\u0275fac});class G{}G.\u0275fac=function(e){return new(e||G)},G.\u0275mod=s.\u0275\u0275defineNgModule({type:G}),G.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_PREPROCESSOR,useClass:We,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:je,multi:!0}],imports:[B.for(D.CHART_WIDGET_VIEW_ELEMENT_TYPE,D.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,D.GAUGE_WIDGET_VIEW_ELEMENT_TYPE)]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(G,{imports:[B]})}();const Lr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),xr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),kr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Gr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),jr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),qr=JSON.parse(`{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Il n'y a aucun rapport disponible","GoToPrintablesSetupCaption":"Aller \xE0 la configuration du rapport"}}`),Ur=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Wr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Zr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Hr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Qr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u5229\u7528\u53EF\u80FD\u306A\u30EC\u30DD\u30FC\u30C8\u306F\u3042\u308A\u307E\u305B\u3093","GoToPrintablesSetupCaption":"\u30EC\u30DD\u30FC\u30C8\u306E\u8A2D\u5B9A\u306B\u79FB\u52D5"}}'),zr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Jr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Yr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Xr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Kr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"N\xE3o existem relat\xF3rios dispon\xEDveis","GoToPrintablesSetupCaption":"Ir para as configura\xE7\xF5es de relat\xF3rios"}}'),ei=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),ti=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nu exist\u0103 rapoarte disponibile","GoToPrintablesSetupCaption":"Merge\u021Bi la configurarea raportului"}}'),ri=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \u043E\u0442\u0447\u0435\u0442\u044B \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0435 \u0434\u043B\u044F \u043F\u0435\u0447\u0430\u0442\u0438","GoToPrintablesSetupCaption":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u043A \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0435 \u043E\u0442\u0447\u0435\u0442\u043E\u0432"}}'),ii=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),ai=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),oi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),ni=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),si=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041D\u0435\u043C\u0430\u0454 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0438\u0445 \u0437\u0432\u0456\u0442\u0456\u0432","GoToPrintablesSetupCaption":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u0434\u043E \u043D\u0430\u043B\u0430\u0448\u0442\u0443\u0432\u0430\u043D\u043D\u044F \u0437\u0432\u0456\u0442\u0443"}}'),ci=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),li={"zh-CN":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"vi-VN":ci,"uk-UA":si,"tr-TR":ni,"th-TH":oi,"sv-SE":ai,"sq-AL":ii,"ro-RO":ti,"pt-PT":ei,"pt-BR":Kr,"pl-PL":Xr,"nl-NL":Yr,"lv-LV":Jr,"ko-KR":zr,"ja-JP":Qr,"it-IT":Hr,"id-ID":Zr,"hu-HU":Wr,"he-IL":Ur,"fr-FR":qr,"es-ES":jr,"de-DE":kr,"cs-CZ":xr,"ar-SA":Lr,"en-US":Gr,"ru-RU":ri};class Ze{}Ze.\u0275fac=function(e){return new(e||Ze)},Ze.\u0275mod=s.\u0275\u0275defineNgModule({type:Ze}),Ze.\u0275inj=s.\u0275\u0275defineInjector({providers:[f.DataGridFilterOptionsBackwardCompatibilityModifier,f.FolderTreeFilterOptionsBackwardCompatibilityModifier,v.DATA_GRID_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,v.DATA_GRID_EDITING_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,v.FILE_LIST_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,{provide:g.CRT_METADATA_PREPROCESSOR,useClass:L,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:oe,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ne,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:le,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ue,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ie,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:se,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ce,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ae,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:It,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Pt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:pe,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:de,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ge,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ie,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ve,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Pe,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:dt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ut,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ye,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ht,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Vt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:He,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ee,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:he,multi:!0},A.DcmSettingsService,$,De,q,f.LookupQuickFilterValueRepositoryService,Q,z,J,w,x,A.PrintablesService,p.FileDownloaderService,{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Qe,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ze,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ot,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:me,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Dt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:bt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:yt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Nt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Et,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:$t,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Xe,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ft,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ot,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:X,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:St,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:At,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:st,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:nt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Me,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Bt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Re,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:gt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:be,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:_t,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ge,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ct,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:lt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ft,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:pt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Mt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Tt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:_e,multi:!0},{provide:A.LICENSE_RESTRICTION_OPERATION_CODES,useValue:ir,multi:!0},{provide:A.LICENSE_RESTRICTION_OPERATION_CODES,useValue:ar,multi:!0},{provide:A.LICENSE_RESTRICTION_OPERATION_CODES,useValue:or,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:mt,multi:!0}],imports:[kt.CommonModule,H,V.withModifiers([["crt.DataGrid",f.DataGridFilterOptionsBackwardCompatibilityModifier]]),V.withModifiers([["crt.FolderTree",f.FolderTreeFilterOptionsBackwardCompatibilityModifier]]),G,ye,U,Oe,j,F.CrtLibTranslateModule.forRoot({i18n:li}),Y]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Ze,{imports:[kt.CommonModule,H,V,V,G,ye,U,Oe,j,F.CrtLibTranslateModule,Y]})}();class Lt{_getHeaders(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.HeaderContainer",e.viewConfig)}crtOnModelInit(e,t){const r=e,i=r?.viewModelConfig?.attributes,a=this._getHeaders(r)[0];if(a){const o="HeaderCaption";i[o]={value:""},a.viewConfig.title=`$${o}`,a.viewConfig.styles={"border-top-left-radius":"8px","border-top-right-radius":"8px"},r.tag?.includes("BaseGridSectionTemplate")&&(a.viewConfig.styles["margin-bottom"]="0px")}return Promise.resolve(e)}}Lt.\u0275fac=function(e){return new(e||Lt)},Lt.\u0275prov=s.\u0275\u0275defineInjectable({token:Lt,factory:Lt.\u0275fac})}}]);
